var main=function(O){"use strict";function M(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function m(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function V(){V=function(){return o};var o={},e=Object.prototype,l=e.hasOwnProperty,c=Object.defineProperty||function(e,t,n){e[t]=n.value},t="function"==typeof Symbol?Symbol:{},i=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",s=t.toStringTag||"@@toStringTag";function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,n){return e[t]=n}}function r(e,t,n,i){var s,a,o,r,t=t&&t.prototype instanceof p?t:p,t=Object.create(t.prototype),i=new C(i||[]);return c(t,"_invoke",{value:(s=e,a=n,o=i,r="suspendedStart",function(e,t){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var n=o.delegate;if(n){n=function e(t,n){var i=n.method,s=t.iterator[i];if(void 0===s)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=void 0,e(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),u;i=d(s,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,u;s=i.arg;return s?s.done?(n[t.resultName]=s.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,u):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,u)}(n,o);if(n){if(n===u)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===r)throw r="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);r="executing";n=d(s,a,o);if("normal"===n.type){if(r=o.done?"completed":"suspendedYield",n.arg===u)continue;return{value:n.arg,done:o.done}}"throw"===n.type&&(r="completed",o.method="throw",o.arg=n.arg)}})}),t}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}o.wrap=r;var u={};function p(){}function g(){}function h(){}var t={},m=(a(t,i,function(){return this}),Object.getPrototypeOf),m=m&&m(m(y([]))),v=(m&&m!==e&&l.call(m,i)&&(t=m),h.prototype=p.prototype=Object.create(t));function b(e){["next","throw","return"].forEach(function(t){a(e,t,function(e){return this._invoke(t,e)})})}function f(o,r){var t;c(this,"_invoke",{value:function(n,i){function e(){return new r(function(e,t){!function t(e,n,i,s){var a,e=d(o[e],o,n);if("throw"!==e.type)return(n=(a=e.arg).value)&&"object"==typeof n&&l.call(n,"__await")?r.resolve(n.__await).then(function(e){t("next",e,i,s)},function(e){t("throw",e,i,s)}):r.resolve(n).then(function(e){a.value=e,i(a)},function(e){return t("throw",e,i,s)});s(e.arg)}(n,i,e,t)})}return t=t?t.then(e,e):e()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function y(t){if(t||""===t){var n,e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(l.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}throw new TypeError(typeof t+" is not iterable")}return c(v,"constructor",{value:g.prototype=h,configurable:!0}),c(h,"constructor",{value:g,configurable:!0}),g.displayName=a(h,s,"GeneratorFunction"),o.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,a(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},o.awrap=function(e){return{__await:e}},b(f.prototype),a(f.prototype,n,function(){return this}),o.AsyncIterator=f,o.async=function(e,t,n,i,s){void 0===s&&(s=Promise);var a=new f(r(e,t,n,i),s);return o.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},b(v),a(v,s,"Generator"),a(v,i,function(){return this}),a(v,"toString",function(){return"[object Generator]"}),o.keys=function(e){var t,n=Object(e),i=[];for(t in n)i.push(t);return i.reverse(),function e(){for(;i.length;){var t=i.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},o.values=y,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&l.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var i=this;function e(e,t){return a.type="throw",a.arg=n,i.next=e,t&&(i.method="next",i.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var s=this.tryEntries[t],a=s.completion;if("root"===s.tryLoc)return e("end");if(s.tryLoc<=this.prev){var o=l.call(s,"catchLoc"),r=l.call(s,"finallyLoc");if(o&&r){if(this.prev<s.catchLoc)return e(s.catchLoc,!0);if(this.prev<s.finallyLoc)return e(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return e(s.catchLoc,!0)}else{if(!r)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return e(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&l.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}var a=(s=s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc?null:s)?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,i,s=this.tryEntries[t];if(s.tryLoc===e)return"throw"===(n=s.completion).type&&(i=n.arg,S(s)),i}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:y(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},o}function U(e){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t,n,i,s,a,o){try{var r=e[a](o),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,s)}function F(r){return function(){var e=this,o=arguments;return new Promise(function(t,n){var i=r.apply(e,o);function s(e){W(i,t,n,s,a,"next",e)}function a(e){W(i,t,n,s,a,"throw",e)}s(void 0)})}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,ae(i.key),i)}}function a(e,t,n){return t&&H(e.prototype,t),n&&H(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t,n){(t=ae(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}function G(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K(e,t)}function z(e){return(z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function K(e,t){return(K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=z(n),t=(e=i?(e=z(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Y(t)}}function X(){return(X="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=z(e)););return e}(e,t);if(i)return(i=Object.getOwnPropertyDescriptor(i,t)).get?i.get.call(arguments.length<3?e:n):i.value}).apply(this,arguments)}function J(e,t){return Z(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,s,a,o,r=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(r.push(i.value),r.length!==t);l=!0);}catch(e){c=!0,s=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw s}}return r}}(e,t)||te(e,t)||ie()}function Q(e){return function(e){if(Array.isArray(e))return ne(e)}(e)||ee(e)||te(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e){if(Array.isArray(e))return e}function ee(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function te(e,t){var n;if(e)return"string"==typeof e?ne(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ne(e,t):void 0}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ie(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function se(e,t){var n,i,s,a,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return i=!(n=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return n=e.done,e},e:function(e){i=!0,s=e},f:function(){try{n||null==o.return||o.return()}finally{if(i)throw s}}};if(Array.isArray(e)||(o=te(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ae(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=typeof(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}function oe(e,t){return de(e,le(e,t,"get"))}function re(e,t,n){t=le(e,t,"set");if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}function le(e,t,n){if(t.has(e))return t.get(e);throw new TypeError("attempted to "+n+" private field on non-instance")}function ce(e,t,n){if(e!==t)throw new TypeError("Private static access of wrong provenance");t="get";if(void 0===n)throw new TypeError("attempted to "+t+" private static field before its declaration");return de(e,n)}function de(e,t){return t.get?t.get.call(e):t.value}function ue(e,t,n){if(t.has(e))return n;throw new TypeError("attempted to get private field on non-instance")}function pe(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ge(e,t,n){pe(e,t),t.set(e,n)}function he(e,t){pe(e,t),t.add(e)}var me=function(o){var l,e=Object.prototype,c=e.hasOwnProperty,d=Object.defineProperty||function(e,t,n){e[t]=n.value},t="function"==typeof Symbol?Symbol:{},i=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",s=t.toStringTag||"@@toStringTag";function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,n){return e[t]=n}}function r(e,t,n,i){var s,a,o,r,t=t&&t.prototype instanceof b?t:b,t=Object.create(t.prototype),i=new E(i||[]);return d(t,"_invoke",{value:(s=e,a=n,o=i,r=p,function(e,t){if(r===h)throw new Error("Generator is already running");if(r===m){if("throw"===e)throw t;return L()}for(o.method=e,o.arg=t;;){var n=o.delegate;if(n){n=function e(t,n){var i=n.method;var s=t.iterator[i];if(s===l)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=l,e(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),v;i=u(s,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;s=i.arg;if(!s)return n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v;{if(!s.done)return s;n[t.resultName]=s.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l)}n.delegate=null;return v}(n,o);if(n){if(n===v)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(r===p)throw r=m,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);r=h;n=u(s,a,o);if("normal"===n.type){if(r=o.done?m:g,n.arg!==v)return{value:n.arg,done:o.done}}else"throw"===n.type&&(r=m,o.method="throw",o.arg=n.arg)}})}),t}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}o.wrap=r;var p="suspendedStart",g="suspendedYield",h="executing",m="completed",v={};function b(){}function f(){}function _(){}var t={},S=(a(t,i,function(){return this}),Object.getPrototypeOf),S=S&&S(S(w([]))),C=(S&&S!==e&&c.call(S,i)&&(t=S),_.prototype=b.prototype=Object.create(t));function y(e){["next","throw","return"].forEach(function(t){a(e,t,function(e){return this._invoke(t,e)})})}function T(o,r){var t;d(this,"_invoke",{value:function(n,i){function e(){return new r(function(e,t){!function t(e,n,i,s){var a,e=u(o[e],o,n);if("throw"!==e.type)return(n=(a=e.arg).value)&&"object"===U(n)&&c.call(n,"__await")?r.resolve(n.__await).then(function(e){t("next",e,i,s)},function(e){t("throw",e,i,s)}):r.resolve(n).then(function(e){a.value=e,i(a)},function(e){return t("throw",e,i,s)});s(e.arg)}(n,i,e,t)})}return t=t?t.then(e,e):e()}})}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function w(t){if(t){var n,e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(c.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=l,e.done=!0,e}).next=e}return{next:L}}function L(){return{value:l,done:!0}}return d(C,"constructor",{value:f.prototype=_,configurable:!0}),d(_,"constructor",{value:f,configurable:!0}),f.displayName=a(_,s,"GeneratorFunction"),o.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,a(e,s,"GeneratorFunction")),e.prototype=Object.create(C),e},o.awrap=function(e){return{__await:e}},y(T.prototype),a(T.prototype,n,function(){return this}),o.AsyncIterator=T,o.async=function(e,t,n,i,s){void 0===s&&(s=Promise);var a=new T(r(e,t,n,i),s);return o.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},y(C),a(C,s,"Generator"),a(C,i,function(){return this}),a(C,"toString",function(){return"[object Generator]"}),o.keys=function(e){var t,n=Object(e),i=[];for(t in n)i.push(t);return i.reverse(),function e(){for(;i.length;){var t=i.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},o.values=w,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=l)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var i=this;function e(e,t){return a.type="throw",a.arg=n,i.next=e,t&&(i.method="next",i.arg=l),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var s=this.tryEntries[t],a=s.completion;if("root"===s.tryLoc)return e("end");if(s.tryLoc<=this.prev){var o=c.call(s,"catchLoc"),r=c.call(s,"finallyLoc");if(o&&r){if(this.prev<s.catchLoc)return e(s.catchLoc,!0);if(this.prev<s.finallyLoc)return e(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return e(s.catchLoc,!0)}else{if(!r)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return e(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}var a=(s=s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc?null:s)?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,i,s=this.tryEntries[t];if(s.tryLoc===e)return"throw"===(n=s.completion).type&&(i=n.arg,I(s)),i}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:w(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=l),v}},o}("object"===("undefined"==typeof module?"undefined":U(module))?module.exports:{});try{regeneratorRuntime=me}catch(e){"object"===("undefined"==typeof globalThis?"undefined":U(globalThis))?globalThis.regeneratorRuntime=me:Function("r","regeneratorRuntime = r")(me)}function ve(e){et.push(e)}function be(e,t){"component"===t?tt.push(e):tt.unshift(e)}function fe(){return Ze}function _e(e,t){Ze[e]=t}var Se=a(function e(t,n){d(this,e),u(this,"id",void 0),u(this,"children",void 0),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),this.id=t,this.children=n||[]}),Ce=function(){function e(){d(this,e)}return a(e,[{key:"provide",value:function(){return[]}}]),e}(),ye=function(){function i(e,t,n){d(this,i),u(this,"_context",void 0),u(this,"_scope",void 0),u(this,"_additionalDataContexts",void 0),this._context=e,this._scope=t,this._additionalDataContexts=n||[]}return a(i,[{key:"context",get:function(){return this._context}},{key:"scope",get:function(){return this._scope}},{key:"additionalDataContexts",get:function(){return this._additionalDataContexts}},{key:"toJSON",value:function(){return{context:this.context,scope:this.scope,additionalDataContexts:this.additionalDataContexts}}}]),i}(),me=function(){function c(e,t,n,i,s,a,o,r,l){d(this,c),u(this,"_owner",void 0),u(this,"_contextInfo",void 0),u(this,"_name",void 0),u(this,"_title",void 0),u(this,"_description",void 0),u(this,"_rule",void 0),u(this,"_tags",void 0),u(this,"_scaleMeta",void 0),u(this,"_triggers",void 0),this._contextInfo=e,this._name=t,this._title=n,this._description=i,this._owner=s,this._rule=a,this._tags=o||[],this._scaleMeta=r,this._triggers=l||[]}return a(c,[{key:"contextInfo",get:function(){return this._contextInfo}},{key:"name",get:function(){return this._name}},{key:"title",get:function(){return this._title}},{key:"description",get:function(){return this._description}},{key:"owner",get:function(){return this._owner}},{key:"rule",get:function(){return this._rule}},{key:"tags",get:function(){return this._tags}},{key:"scaleMeta",get:function(){return this._scaleMeta}},{key:"triggers",get:function(){return this._triggers}},{key:"toJSON",value:function(){return{contextInfo:this.contextInfo,name:this.name,title:this.title,description:this.description,owner:this.owner,tags:this.tags,scaleMeta:this.scaleMeta,triggers:this.triggers}}}]),c}(),Te=function(){function s(e,t,n,i){d(this,s),u(this,"_label",void 0),u(this,"_url",void 0),u(this,"_tooltip",void 0),u(this,"_description",void 0),this._label=e,this._url=t,this._tooltip=n,this._description=i}return a(s,[{key:"label",get:function(){return this._label}},{key:"url",get:function(){return this._url}},{key:"tooltip",get:function(){return this._tooltip}},{key:"description",get:function(){return this._description}}]),s}(),Pe=function(){function s(e,t,n,i){d(this,s),u(this,"_data",void 0),u(this,"_messageParams",void 0),u(this,"_scaleValues",void 0),u(this,"_listItems",void 0),this._data=e,this._messageParams=t,this._scaleValues=n,this._listItems=i}return a(s,[{key:"data",get:function(){return this._data}},{key:"messageParams",get:function(){return this._messageParams}},{key:"scaleValues",get:function(){return this._scaleValues}},{key:"listItems",get:function(){return this._listItems}}]),s}(),Ie=function(){function e(){d(this,e)}return a(e,[{key:"invoke",value:function(e){throw new Error("Must override method")}}]),e}(),Ee=function(){function n(e,t){d(this,n),u(this,"_meta",void 0),u(this,"_params",void 0),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),this._meta=e,this._params=t}return a(n,[{key:"meta",get:function(){return this._meta}},{key:"params",get:function(){return this._params}}]),n}(),we=Symbol.iterator,Le=function(){function t(e){d(this,t),u(this,"_ruleFactoryItems",void 0),this._ruleFactoryItems=e}return a(t,[{key:we,value:function(){var e=0,t=this._ruleFactoryItems;return{next:function(){return{done:e===t.length,value:t[e++]}}}}}]),t}(),De=function(){function e(){d(this,e),u(this,"_subscribers",void 0),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),this._subscribers=new Map}return a(e,[{key:"subscribe",value:function(e,t){var n=this._subscribers.get(e)||new Set;return this._subscribers.set(e,n),n.add(t),function(){n.delete(t)}}},{key:"enter",value:function(n){var i=this;this.iterateProperties(n,function(e,t){t=e+"="+t[e];(i._subscribers.get(t)||[]).forEach(function(e){return e(n)})})}},{key:"exit",value:function(n){var i=this;this.iterateProperties(n,function(e,t){t=e+"="+t[e]+":exit";(i._subscribers.get(t)||[]).forEach(function(e){return e(n)})})}},{key:"clear",value:function(){this._subscribers.clear()}},{key:"iterateProperties",value:function(e,t){for(var n in e)e.hasOwnProperty(n)&&("object"!==U(e[n])||Array.isArray(e[n])?t(n,e):this.iterateProperties(e[n],t))}}]),e}(),Ae=function(){function e(){d(this,e),u(this,"normalizeHrTime",function(e){return 1e3*e[0]+e[1]/1e6}),u(this,"_metrics",void 0),u(this,"getStartTime",function(){return[0,0]}),u(this,"getElapsedTime",function(){return 0}),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),this.setTimeHelpers(),this._metrics={executionTime:0,resultsReported:0}}return a(e,[{key:"setTimeHelpers",value:function(){var t=this;"undefined"!=typeof process&&"function"==typeof process.hrtime?(this.getStartTime=process.hrtime.bind(process),this.getElapsedTime=function(e){return t.normalizeHrTime(process.hrtime(e))}):"undefined"!=typeof performance&&"function"==typeof performance.now&&(this.getStartTime=function(){return[performance.now(),0]},this.getElapsedTime=function(e){return performance.now()-e[0]})}},{key:"metrics",get:function(){return this._metrics}},{key:"addResultMetric",value:function(e){var t=0<this._metrics.resultsReported?this._metrics.resultsReported:"";e.scaleValues&&(this._metrics["scaleValues"+t]=this.getScaleValueInformation(e.scaleValues)),e.messageParams&&0<e.messageParams.length&&(this._metrics["messageParams"+t]=e.messageParams.toString()),e.listItems&&0<e.listItems.length&&(this._metrics["listLength"+t]=e.listItems.length)}},{key:"getScaleValueInformation",value:function(e){var t="";return void 0!==e&&e.forEach(function(e){t=t.concat("[id:"+e.id+"-value:"+e.value+"]")}),t}}]),e}(),ke=function(){function o(e,t,n,i,s,a){d(this,o),u(this,"_eventManager",void 0),u(this,"_resultCallback",void 0),u(this,"_root",void 0),u(this,"_params",void 0),u(this,"_additionalData",void 0),u(this,"_benchmark",void 0),u(this,"_ruleFilter",void 0),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),this._root=t,this._eventManager=e,this._resultCallback=s,this._params=i,this._benchmark=new Ae,this._additionalData=n,this._ruleFilter=a}return a(o,[{key:"getParams",value:function(){return this._params}},{key:"getData",value:function(){return this._root}},{key:"getAdditionalData",value:function(){return this._additionalData}},{key:"getTriggers",value:function(){return this._ruleFilter?this._ruleFilter.triggers:[]}},{key:"getIncludeTags",value:function(){return this._ruleFilter?this._ruleFilter.includeTags:[]}},{key:"on",value:function(e,t){var n,i;this._eventManager.subscribe(e,(n=t,i=this._benchmark,function(){var e=i.getStartTime();try{n.apply(void 0,arguments)}finally{i.metrics.executionTime+=i.getElapsedTime(e)}}))}},{key:"report",value:function(e){this._benchmark.addResultMetric(e),this._benchmark.metrics.resultsReported+=1,this._resultCallback(e)}},{key:"getBenchmarkMetrics",value:function(){return this._benchmark.metrics}}]),o}(),Ne=function(){function e(){d(this,e),u(this,"_results",void 0),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),this._results=new Map}return a(e,[{key:"addResult",value:function(e,t){var n=this._results.get(e.id)||[];n.push(t),this._results.set(e.id,n)}},{key:"addResults",value:function(e,t){var n=(n=this._results.get(e.id)||[]).concat(t);this._results.set(e.id,n)}},{key:"results",get:function(){return this._results}}]),e}(),xe=function(){function i(e,t,n){d(this,i),u(this,"_id",void 0),u(this,"_scaleValue",void 0),u(this,"_scaleInfo",void 0),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),this._id=e,this._scaleValue=t,this._scaleInfo=n}return a(i,[{key:"id",get:function(){return this._id}},{key:"scaleValue",get:function(){return this._scaleValue}},{key:"scaleInfo",get:function(){return this._scaleInfo}}]),i}(),Re=function(){function n(e,t){d(this,n),u(this,"_scales",void 0),u(this,"_label",void 0),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),this._scales=e,this._label=t}return a(n,[{key:"scales",get:function(){return this._scales}},{key:"label",get:function(){return this._label}}]),n}(),je=function(){function n(e,t){if(d(this,n),u(this,"_context",void 0),u(this,"_name",void 0),u(this,"_title",void 0),u(this,"_description",void 0),u(this,"_tags",void 0),u(this,"_data",void 0),u(this,"_messageParams",void 0),u(this,"_scales",void 0),u(this,"_listItems",void 0),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),null===e.name||void 0===e.name||""===e.name)throw new Error("name must be set");if(null===t.data||void 0===t.data||0===t.data.length)throw new Error("data must be set");this._context=e.contextInfo.context,this._tags=e.tags,this._name=e.name,this._title=e.title,this._description=e.description,this._data=t.data,this._messageParams=t.messageParams,Array.isArray(t.scaleValues)&&e.scaleMeta&&Array.isArray(e.scaleMeta.scaleInfos)&&(this._scales=new Re(this.getScales(t.scaleValues,e.scaleMeta.scaleInfos),e.scaleMeta.label)),this._listItems=t.listItems}return a(n,[{key:"context",get:function(){return this._context}},{key:"name",get:function(){return this._name}},{key:"title",get:function(){return this._title}},{key:"description",get:function(){return this._description}},{key:"data",get:function(){return this._data}},{key:"messageParams",get:function(){return this._messageParams}},{key:"scales",get:function(){return this._scales}},{key:"listItems",get:function(){return this._listItems}},{key:"tags",get:function(){return this._tags}},{key:"getScales",value:function(e,t){var n,i=[],s=new Map,a=void 0,o=se(t);try{for(o.s();!(n=o.n()).done;){var r=n.value;r&&(r.id?s.has(r.id)||s.set(r.id,r):a=a||r)}}catch(e){o.e(e)}finally{o.f()}var l,c=0,d=se(e);try{for(d.s();!(l=d.n()).done;){var u,p,g=l.value;g&&(g.id&&s.has(g.id)?(u=s.get(g.id))&&(p="id-"+this.name+u.id,i.push(new xe(p,g,u))):this.setFallbackScaleInfo(c++,i,g,a))}}catch(e){d.e(e)}finally{d.f()}return i}},{key:"setFallbackScaleInfo",value:function(e,t,n,i){if(!i)throw new Error("No fallbackScaleInfo provided");e="idFallback-"+this.name+"-"+e;t.push(new xe(e,n,i))}}]),n}(),Be=function(){function i(e,t,n){d(this,i),u(this,"_enter",void 0),u(this,"_exit",void 0),u(this,"_instrumentationService",void 0),u(this,"_metrics",void 0),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),this._enter=e,this._exit=t,this._instrumentationService=n,this._metrics={_numNodes:0}}return a(i,[{key:"visit",value:function(e){this._metrics={_numNodes:0},this.visitNode(e,null),this._instrumentationService.mark("@analyzer/traverser","Traverse nodes",{numNodes:this._metrics._numNodes})}},{key:"visitNode",value:function(e,t){if(null!=e){this._metrics._numNodes+=1,this._enter(e,t);for(var n=e.children,i=0;i<n.length;++i)this.visitNode(n[i],e);this._exit(e,t)}}}]),i}(),Oe=function(){function i(e,t){var n=this;d(this,i),u(this,"_registry",void 0),u(this,"_eventMananger",void 0),u(this,"_traverser",void 0),u(this,"_rules",[]),u(this,"_instrumentationService",void 0),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),this._registry=e,this._instrumentationService=t,this._eventMananger=new De,this._traverser=new Be(function(e){try{n._eventMananger.enter(e)}catch(e){n._instrumentationService.error(e.message,"guardrailsRunRules",{exception:e})}},function(e){try{n._eventMananger.exit(e)}catch(e){n._instrumentationService.error(e.message,"guardrailsRunRules",{exception:e})}},this._instrumentationService)}var s,n;return a(i,[{key:"execute",value:(n=F(V().mark(function e(t,n){var i,s,a,o,r,l,c;return V().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=new Ne,s=se(t),e.prev=2,s.s();case 4:if((a=s.n()).done){e.next=27;break}if(a=a.value,o=a.context,r="",n&&n.triggers&&(r=n.triggers.sort().toString()),!(l=this._registry.getDataProvider(o))){e.next=25;break}this._instrumentationService.perfStart("Run all rules for context",{context:o,triggers:r},"executeGuardrails"),l=l.provide(),c=0;case 14:if(c<l.length)return e.t0=i,e.t1=l[c],e.next=19,this.runRules(a,l[c],n);e.next=24;break;case 19:e.t2=e.sent,e.t0.addResults.call(e.t0,e.t1,e.t2);case 21:c++,e.next=14;break;case 24:this._instrumentationService.perfEnd("Run all rules for context",{context:o,triggers:r},"executeGuardrails");case 25:e.next=4;break;case 27:e.next=32;break;case 29:e.prev=29,e.t3=e.catch(2),s.e(e.t3);case 32:return e.prev=32,s.f(),e.finish(32);case 35:return e.abrupt("return",i);case 36:case"end":return e.stop()}},e,this,[[2,29,32,35]])})),function(e,t){return n.apply(this,arguments)})},{key:"runRules",value:(s=F(V().mark(function e(t,c,d){var n,u,p,i,g,s,a,o,r,h=this;return V().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.context,u=[],p=new Map,this._eventMananger.clear(),this._instrumentationService.mark("@analyzer/engine","Number of rules",{numRules:this._registry.getRules(t,d).size,contextType:n}),i=se(this._registry.getRules(t,d)),e.prev=6,s=V().mark(function e(){var t,n,i,s,a,o,r,l;return V().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:l=g.value,n=l.rule,t=l.meta,l=l.params,n=new n,i=new Map,s=se(t.contextInfo.additionalDataContexts);try{for(s.s();!(a=s.n()).done;)o=a.value,(r=h._registry.getDataProvider(o))&&i.set(o,r.provide())}catch(e){s.e(e)}finally{s.f()}l=new ke(h._eventMananger,c,i,l,function(e){u.push(new je(t,e))},d),p.set(t.name,l);try{n.invoke(l)}catch(e){h._instrumentationService.error(e.message,"guardrailsRunRules",{rule:t.name,exception:e})}case 8:case"end":return e.stop()}},e)}),i.s();case 9:if((g=i.n()).done){e.next=13;break}return e.delegateYield(s(),"t0",11);case 11:e.next=9;break;case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(6),i.e(e.t1);case 18:return e.prev=18,i.f(),e.finish(18);case 21:this._traverser.visit(c),a=se(p.entries());try{for(a.s();!(o=a.n()).done;)r=o.value,this._instrumentationService.mark("@analyzer/engine","Rule execution",m(m({ruleName:r[0]},r[1].getBenchmarkMetrics()),{},{contextType:n}))}catch(e){a.e(e)}finally{a.f()}return e.abrupt("return",Promise.all(u));case 25:case"end":return e.stop()}},e,this,[[6,15,18,21]])})),function(e,t,n){return s.apply(this,arguments)})}]),i}(),Me=function(){function t(e){d(this,t),u(this,"_registryRules",new Map),u(this,"_registryDataProviders",new Map),u(this,"_ruleFilterBasic",void 0),u(this,"_filteredRegistryRules",new Map),u(this,"_maxCacheSize",10),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),this._ruleFilterBasic=e||new $e}return a(t,[{key:"addDataProvider",value:function(e,t){this._registryDataProviders.set(e,t)}},{key:"getDataProvider",value:function(e){return this._registryDataProviders.get(e)}},{key:"getAdditionalDataContexts",value:function(e,t){var e=this.getRules(e,t),n=new Set;return e.forEach(function(e){return e.meta.contextInfo.additionalDataContexts.forEach(n.add,n)}),n}},{key:"registerRules",value:function(e){var t,i=this,n=(this._filteredRegistryRules.clear(),new Map),s=se(e);try{for(s.s();!(t=s.n()).done;){var a=t.value,o=a.meta.contextInfo.context,r=n.get(o)||[];r.push(new Ve(a.meta.rule,a.meta,a.params)),n.set(o,r)}}catch(e){s.e(e)}finally{s.f()}n.forEach(function(e,t){var n=i._registryRules.get(t)||new Set;i.getFilteredRules(new Set(e),i._ruleFilterBasic).forEach(function(e){n.add(e)}),i._registryRules.set(t,n)})}},{key:"hasRules",value:function(e,t){return 0<this.getRules(e,t).size}},{key:"getRules",value:function(e,t){var n,i=this._registryRules.get(e.context);return void 0===i||0===i.size?new Set:void 0!==(n=this.getCachedFilteredRules(e,t))?new Set(n):(n=this.getFilteredRules(i,t,e.scope),this.setCachedFilteredRules(Array.from(n),e,t),n)}},{key:"getFilteredRules",value:function(e,t,n){e=Array.from(e);return void 0===t&&void 0===n||(e=this.getScopedRules(e,n),void 0!==t&&(e=t.getFilteredRules(e))),new Set(e)}},{key:"getScopedRules",value:function(e,t){if(void 0===t)return e;var n,i=[],s=se(e);try{for(s.s();!(n=s.n()).done;){var a=n.value,o=a.meta.contextInfo.scope;if(void 0!==o){var r=!0;if(this.haveSameKeySet(o,t)){var l,c=se(t);try{for(c.s();!(l=c.n()).done;){var d=J(l.value,2),u=d[0],p=d[1],g=o.get(u);if(void 0===g||void 0!==g&&!this.containsAnyElement(p,g)){r=!1;break}}}catch(e){c.e(e)}finally{c.f()}r&&i.push(a)}}}}catch(e){s.e(e)}finally{s.f()}return i}},{key:"getCachedFilteredRules",value:function(e,t){return this._filteredRegistryRules.get(this.getCacheId(e,t))}},{key:"setCachedFilteredRules",value:function(e,t,n){this._filteredRegistryRules.size>this._maxCacheSize&&this._filteredRegistryRules.clear(),this._filteredRegistryRules.set(this.getCacheId(t,n),e)}},{key:"getCacheId",value:function(e,t){return e.context.replace(/\s/g,"")+"-"+(void 0!==t?t.id:"")+this.getScopeId(e.scope||new Map)}},{key:"getScopeId",value:function(e){var n="";return void 0!==e&&e.forEach(function(e,t){n=n.concat("-"+t,"-"+e.sort().join(","))}),n.replace(/\s/g,"")}},{key:"haveSameKeySet",value:function(e,t){return e.size===t.size&&Array.prototype.every.call(e.keys(),function(e){return t.has(e)})}},{key:"containsAnyElement",value:function(e,t){return e.some(function(e){return 0<=t.indexOf(e)})}}],[{key:"isFilterPresent",value:function(t){return function(e){return void 0!==t&&void 0!==e&&-1<t.indexOf(e)}}}]),t}(),Ve=function(){function i(e,t,n){d(this,i),u(this,"_rule",void 0),u(this,"_meta",void 0),u(this,"_params",void 0),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),this._rule=e,this._meta=t,this._params=n||new Map}return a(i,[{key:"rule",get:function(){return this._rule}},{key:"meta",get:function(){return this._meta}},{key:"params",get:function(){return this._params}},{key:"toJSON",value:function(){return{rule:this.rule,meta:this.meta,params:Array.from(this.params.entries())}}}]),i}(),$e=function(){function n(e,t){d(this,n),u(this,"_includeTags",void 0),u(this,"_excludeTags",void 0),Object.defineProperty(this,Symbol.for("@@lockerLiveValue"),{value:void 0}),this._includeTags=e||[],this._excludeTags=t||[]}return a(n,[{key:"includeTags",get:function(){return this._includeTags}},{key:"excludeTags",get:function(){return this._excludeTags}},{key:"id",get:function(){return(this.includeTags.sort().join(",")+"-"+this.excludeTags.sort().join(",")).replace(/\s/g,"")}},{key:"getFilteredRules",value:function(e){return this.getFilteredRulesOnTags(e)}},{key:"getFilteredRulesOnTags",value:function(e){var t=this;return 0<t.includeTags.length&&(e=e.filter(function(e){return void 0===e.meta.tags||0===e.meta.tags.length||t.includeTags.some(Me.isFilterPresent(e.meta.tags))})),e=0<t.excludeTags.length?e.filter(function(e){return void 0===e.meta.tags||0===e.meta.tags.length||!t.excludeTags.some(Me.isFilterPresent(e.meta.tags))}):e}}]),n}(),Ue=function(){G(s,$e);var i=q(s);function s(e,t,n){return d(this,s),u(Y(e=i.call(this,e,t)),"_triggers",void 0),Object.defineProperty(Y(e),Symbol.for("@@lockerLiveValue"),{value:void 0}),e._triggers=n||[],e}return a(s,[{key:"triggers",get:function(){return this._triggers}},{key:"id",get:function(){return(this.includeTags.sort().join(",")+"-"+this.excludeTags.sort().join(",")+"-"+this.triggers.sort().join(",")).replace(/\s/g,"")}},{key:"getFilteredRules",value:function(e){return this.getFilteredRulesOnTriggers(this.getFilteredRulesOnTags(e))}},{key:"getFilteredRulesOnTriggers",value:function(e){var t=this;return e=e.filter(function(e){return 0===t.triggers.length?void 0===e.meta.triggers||0===e.meta.triggers.length:t.triggers.some(Me.isFilterPresent(e.meta.triggers))})}}]),s}(),We=function(){function n(e){var t=this;d(this,n),u(this,"_mutePreferenceKey",void 0),u(this,"isMuted",function(){return"true"===window.localStorage.getItem(t._mutePreferenceKey)}),this._mutePreferenceKey="".concat("guardrails",".").concat(e,".").concat("mute")}return a(n,[{key:"toggleMute",value:function(e){window.localStorage.setItem(this._mutePreferenceKey,String(e))}}]),n}(),e="undefined"==typeof global?window:global,b=e._,T=e.jQuery,Fe=e.Backbone,He=e.vex,p=e.VE_jQuery,e=e.HTMLHint,t=(b.templateSettings={evaluate:/\{\{(.+?)\}\}/g,escape:/\{\{-(.+?)\}\}/g,interpolate:/\{\{\=(.+?)\}\}/g},["login-error","login-home","login-main","forgot-password","self-register","check-password"]),P={workspace:{PAGE_CONFIG:"page-config",PREVIEW:"preview"},LEFT_PANEL:{COMPONENT_PALETTE:"component-palette",THEME_EDITOR:"theme-editor",PAGE_STRUCTURE:"page-structure",SETTINGS:"settings"},FLOATING_PANEL:{PROPERTIES_PANEL:"properties-panel",COPILOT_PANEL:"copilot-panel"},LIVE_RESIZE_BREAKPOINT:{PHONE:"phone",FLUID:"fluid",TABLET:"tablet"},ROUTE:{DETAIL_VIEW_TYPE_REGEXP:/^detail-([A-Za-z0-9]{3})$/,LIST_VIEW_TYPE_REGEXP:/^list-([A-Za-z0-9]{3})$/,RELATED_LIST_VIEW_TYPE_REGEXP:/^relatedlist-([A-Za-z0-9]{3})$/,EXT_DETAIL_VIEW_TYPE_REGEXP:/^extdetail-[A-Za-z0-9-_]+$/,GENERIC_DETAIL_NAME:"Record Detail",GENERIC_LIST_NAME:"Record List",GENERIC_RELATED_LIST_NAME:"Related Record List",GENERIC_DETAIL_VIEW_TYPE:"detail",GENERIC_LIST_VIEW_TYPE:"list",GENERIC_RELATED_LIST_VIEW_TYPE:"relatedlist",GENERIC_OBJECT_KEY_PREFIX_MARKER:"",DETAIL_ROUTE_URL_PATH_SUFFIX:"/:recordId",LIST_ROUTE_URL_PATH_SUFFIX:"/:objectApiName/:filterName",RELATED_LIST_ROUTE_URL_PATH_SUFFIX:"/related/:recordId/:relationshipApiName",DETAIL_ROUTE_NAME_SUFFIX:"Detail",LIST_ROUTE_NAME_SUFFIX:"List",RELATED_LIST_ROUTE_NAME_SUFFIX:"Related List",HOME_ROUTE_URL:"/",HOME_ROUTE_NAME:"Home",ERROR_ROUTE_URL:"/error",ERROR_ROUTE_NAME:"Error",LOGIN_APP_ROUTE_URL_PATH_PREFIX:"/login",MANAGED_CONTENT_VIEW_TYPE_REGEXP:/^managed-content-[A-Za-z0-9-_]+$/,LOGIN_ROUTE_TYPES:t,FIXED_URL_ROUTE_TYPES:t.concat(["home","error","messages"]),ROOT_SELECTION_MARKER:"root",SEARCH_VIEW_TYPE_REGEXP:/^global-search$/,CATEGORY_VIEW_TYPE_REGEXP:/^detail-0ZG$/},PROP:{NAME_KEY:"Name",URL_KEY:"Url",URL_PREFIX_KEY:"UrlPrefix",SEO_TITLE_KEY:"SeoTitle",SEO_DESC_KEY:"SeoDescription",SEO_METATAG_KEY:"SeoMetaTag",ROUTE_URL_KEY:"RouteUrl",ROUTE_URL_SEGMENT_KEY:"RouteUrlSegment",PARENT_URL_KEY:"ParentUrl",DEV_NAME_KEY:"DevName",PARENT_ID_KEY:"ParentId",PAGE_ACTIONS_KEY:"PageActions",FOLDER_ACTIONS_KEY:"FolderActions",CONTENT_LAYOUT_KEY:"AuraTag",THEME_LAYOUT_TYPE_KEY:"ThemeLayoutType",ROUTE_TYPE_KEY:"ViewType",IS_OOTB_KEY:"IsOOTB",PAGE_ID_KEY:"PageId",VIEW_PAGE_ID_KEY:"ViewPageID",ROUTE_PAGE_ID_KEY:"PageId",CONTENT_TYPE_LABEL:"ContentTypeLabel",VARIATION_STATUS_KEY:"PublishStateIncludingChildren",GA_TRACKING_ID:"GoogleAnalyticsTrackingID",GA_DATA_OPT_IN_ENABLED_KEY:"GoogleAnalyticsDataOptInEnabled",GA_ANONYMIZE_IP_ENABLED_KEY:"GoogleAnalyticsAnonymizeIpEnabled",ROUTE_AUTH_USE_PARENT:"UseParent",CONFIGURATION_TAGS:"ConfigurationTags"},LABEL_KEYS:{GOOGLE_ANALYTICS_GTAG_DOMAIN:"GoogleAnalyticsGtagDomain",GOOGLE_ANALYTICS_DOMAIN:"GoogleAnalyticsDomain",GOOGLE_ADWORDS_DOMAIN:"GoogleAdwordsDomain"},SEO_CMP_PROP:{TITLE_KEY:"title",DESC_KEY:"description",CUSTOM_HEADTAG_KEY:"customHeadTags",EXPRESSION_REGEXP:/\{!([^}]+)\}/g,WHITESPACE_REGEXP:/\s/,RECORD_EXPRESSION_PREFIX:"{!Record.",CMS_EXPRESSION_PREFIX:"{!Content."},PAGE_ACTIONS:{SETTINGS:"settings",CREATE_SUBPAGE:"create_subpage",MOVE:"move",DELETE:"delete"},NEW_PAGE_WIZARD:{STANDARD:"standard",DATA:"data",PAGE_TYPE:"page-type",FROM_VIEW_OR_LAYOUT:"from-view-or-layout",CHOOSE_OBJECT:"choose-object",NAME_PAGE:"name-page",CUSTOM_DATA_DETAIL_ROUTE_NAME_SUFFIX:"Detail",CUSTOM_DATA_DETAIL_URL_PATH_SUFFIX:"/:recordId",STANDARD_VIEW_ROUTE_TYPE:"",ERROR_ROUTE_URL:"/error"},FADE_TIME:200,LS_KEY:{Updated:"cb-updated"},KEYCODE:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},BRANDING_FIELD:{COLOR:"color",TEXT:"text",IMAGE:"image",BUTTONS:"buttons",FORMS:"forms",SITE_SPACING:"siteSpacing"},BRANDING_TYPE:{COLOR:"Color",IMAGE:"Image",PICKLIST:"Picklist",FONT:"Font"},BRANDING_PROP:{FAV_ICON:"FavIcon"},BRANDING_SET_TYPE:{APP:"APP",SCOPED:"SCOPED"},BRANDING_COMPONENT:{NAV:"nav"},BRANDING_PAGE:{LOGIN:"login"},GLOBAL_SELECTOR:{UPDATE_DLG:"global-update-dlg",PAGE_MANAGER:"global-page-manager",CSP_ERROR_DLG:"global-csp-error-dlg"},VF_ROUTE_TYPE:"sfdcpage",NO_INDEX:"NO_INDEX",THEME_LAYOUT_TYPE:{INNER:"Inner",LOGIN:"Login",SERVICE_NOT_AVAILABLE:"ServiceNotAvailable"},AUDIENCE_TARGET_NAME:{BRANDING:"Branding",PAGE:"Page",COMPONENT:"Component",THEME_LAYOUT:"ThemeLayout",EXPERIENCE_VARIATION:"ExperienceVariation"},FQNS:{SECTION:"forceCommunity:section",SECTION_LWC:"community_layout:section",COLUMNED_LAYOUT_LWC:"dxp_layout:columns",FLEXIBLE_LAYOUT_LWC:"community_layout:sldsFlexibleLayout",FLEXIBLE_LAYOUT_AURA:"siteforce:dynamicLayout"},SECURITY_LEVEL:{LOCKED:"locked",UNLOCKED:"unlocked",GRANDFATHERED:"grandfathered"},PERMISSIONS:{PUBLISH:"PUBLISH",PAGE_EDIT:"PAGE_EDIT",LANGUAGE_EDIT:"LANGUAGE_EDIT",OPEN_DEV_CONSOLE:"OPEN_DEV_CONSOLE",LWC_IDE_LITE:"LWC_IDE_LITE",CONTENT_PAGES:"CONTENT_PAGES",BRANDING_SETS:"BRANDING_SETS",BRAND_CONTENT_LINK:"BRAND_CONTENT_LINK",CMS_CONNECT:"CMS_CONNECT",GOOGLE_ANALYTICS:"GOOGLE_ANALYTICS",LANGUAGE_SETTINGS:"LANGUAGE_SETTINGS",MULTI_LANGUAGE_SETTINGS:"MULTI_LANGUAGE_SETTINGS",LWR_LANGUAGE_SETTINGS:"LWR_LANGUAGE_SETTINGS",MANAGE_THEME:"MANAGE_THEME",MOBILE_WORKSPACE:"MOBILE_WORKSPACE",PAGE_VARIATIONS:"PAGE_VARIATIONS",SITES_DATA_PROVIDER_EDITOR_ENABLED:"SITES_DATA_PROVIDER_EDITOR_ENABLED",PROGRESSIVE_RENDERING:"PROGRESSIVE_RENDERING",UNDO_REDO:"UNDO_REDO",SEO_SETTING:"SEO_SETTING",HELP_GUIDED_TOUR:"HELP_GUIDED_TOUR",HELP_WHATS_NEW:"HELP_WHATS_NEW",IS_WEB_ISOLATION:"IS_WEB_ISOLATION",THEME_OOTB_FONTS:"THEME_OOTB_FONTS",IS_COMM_AUTHENTICATED:"IS_COMM_AUTHENTICATED",IS_NATIVE_NAVIGATION_ENABLED:"IS_NATIVE_NAVIGATION_ENABLED",IS_MOBILE_PUBLISHER_APP_SETTINGS_ENABLED:"IS_MOBILE_PUBLISHER_APP_SETTINGS_ENABLED",IS_MOBILE_PUBLISHER_NAVIGATION_OPTIONS_ENABLED:"IS_MOBILE_PUBLISHER_NAVIGATION_OPTIONS_ENABLED",COOKIE_CONSENT_PILOT:"COOKIE_CONSENT_PILOT",IS_CDN_CONFIGURED_FOR_SNA:"IS_CDN_CONFIGURED_FOR_SNA",IS_BUILDER_BASED_SNA_ENABLED:"IS_BUILDER_BASED_SNA_ENABLED",IS_DEFAULT_CDN_ENABLED:"IS_DEFAULT_CDN_ENABLED",IS_TOO_MANY_REQUESTS_ENABLED:"IS_TOO_MANY_REQUESTS_ENABLED",IS_ENHANCED_DOMAINS_ENABLED:"IS_ENHANCED_DOMAINS_ENABLED",IS_EDGE_CUSTOM_DOMAIN_ENABLED:"IS_EDGE_CUSTOM_DOMAIN_ENABLED",IS_SEARCH_INDEXING_ENABLED:"IS_SEARCH_INDEXING_ENABLED",LWC_PROPERTY_SHEET:"LWC_PROPERTY_SHEET",RESPONSIVE_PROPERTIES:"RESPONSIVE_PROPERTIES",STYLE_PROPERTIES:"STYLE_PROPERTIES",VISIBILITY_PROPERTIES:"VISIBILITY_PROPERTIES",VARIATIONS_PROPERTIES:"VARIATIONS_PROPERTIES",RESPONSIVE_COMPONENT_VISIBILITY:"RESPONSIVE_COMPONENT_VISIBILITY",GOOGLE_ANALYTICS_TRUSTED_SITES_ACCESS:"GOOGLE_ANALYTICS_TRUSTED_SITES_ACCESS",IS_GOOGLE_FONTS_ENABLED:"IS_GOOGLE_FONTS_ENABLED",EXPERIMENTAL_A11Y:"EXPERIMENTAL_A11Y",NEW_PAGE_STRUCTURE_PANEL:"NEW_PAGE_STRUCTURE_PANEL",IS_SOCIAL_LINKS_ENABLED:"IS_SOCIAL_LINKS_ENABLED",IS_GUARDRAILS_ENABLED:"IS_GUARDRAILS_ENABLED",SITES_PREDICTION_SERVICE_ENABLED:"SITES_PREDICTION_SERVICE_ENABLED",IS_DATA_CLOUD_ENABLED:"IS_DATA_CLOUD_ENABLED",IS_GOOGLE_ANALYTICS_ENABLED:"IS_GOOGLE_ANALYTICS_ENABLED",IS_RECAPTCHA_IN_FORMS_ENABLED:"IS_RECAPTCHA_IN_FORMS_ENABLED",IS_DEBUG_CONSOLE_ENABLED:"IS_DEBUG_CONSOLE_ENABLED",IS_EXPERIENCES_MIGRATION_IN_CMS_ENABLED:"IS_EXPERIENCES_MIGRATION_IN_CMS_ENABLED",ENABLE_ROLLBACK_FOR_CMS_SITE:"ENABLE_ROLLBACK_FOR_CMS_SITE",MRT_PUBLISH:"MRT_PUBLISH",EINSTEIN_COPILOT:"EINSTEIN_COPILOT",LOCAL_DEV_PREVIEW:"LOCAL_DEV_PREVIEW"},PAGE_MENU:{MAX_STANDARD_PAGE_DEPTH:6,MAX_OBJECT_PAGE_DEPTH:5,FOLDER:{TYPE:{CONTENT:"Content",OBJECT:"Object"},NAME:{GENERIC_OBJECT:"Generic",LOGIN:"Login"}},BADGE:{AVAILABILITY:{NAME:"Availability"}}},SETTINGS_SEO_SITEMAP:{DEFAULT_VALUE:"-",STATUS:{IN_PROGRESS:"in-progress",COMPLETE:"complete",EMPTY:"empty"}},MOBILE_PUBLISHER:{MAX_NATIVE_TAB_MENU_ITEMS:7,ICON_TINT_COLOR:"IconTintColor"},PUBLISH_STATUS:{CHANGED:"CHANGED",NEW:"NEW",UNCHANGED:"UNCHANGED"},CONFIGURATION_TAGS:{SNA:"allow-in-static-site",TMR:"too-many-requests"},CMS_MEDIA_BASE_PATHS:["/cms/delivery/media"],FAV_ICON_ASSET_REF:"FavIconAssetRef",FLAGS:{KEEP_LHS_OPEN:"keepLHSOpen"},LANGUAGES:{BASE_LANG_ID:"",DEFAULT_FALLBACK_LANGUAGE_ID_VALUE:"none"},FONT_TYPES:{GOOGLE:"google",SYSTEM:"system"},URL:{MAX_ALLOWED_LENGTH:2e3},FILE_PICKER_VARIANT:{SMALL:"SMALL"},WEBSTORE:{RECORD_CREATION_STATUS:{NONE:"NONE",ALL:"ALL"}},INTEGRATION_ACTION:{ADD:"add",EDIT:"edit",REMOVE:"remove"},VARIATION_ERROR_TYPE:{BAD_REQUEST:"400"},DROPDOWN_DRAG_AT_ITEM:{DRAG_ALLOWED:"drag-allowed",DRAG_DISALLOWED:"drag-disallowed",DRAG_UNDEFINED:"drag-undefined"},DATA_PROVIDER:{PERSONALIZATION_RECOMMENDATIONS:"dxp:personalizationRecommendationsDataProvider",RECORD:"dxp:recordDetailDataProvider",UEM_RECORD:"sfdc_cms__recordDataProvider",USER:"dxp:userDataProvider",APEX:"dxp:apexDataProvider",APEX_FQN:"sfdc_cms__apexDataProvider",COMPONENT_NAME:"componentName",COMPONENT_ATTRIBUTES:"componentAttributes",APEX_CLASS_NAME:"apexClass",EXPRESSION_KEY:"sfdcExpressionKey",RECORD_OBJECT_API_NAME:"objectApiName"},CMS_CONTENT_TYPE:{IMAGE:"cms_image",BRAND:"sfdc_cms__brand"}},I={},l={},f={},Ge={},ze={},Ke={},g={},Ye={},qe={},Xe={},h={},v={},E={},Je={},S={},Qe={},Ze=(I.event=b.extend({},Fe.Events),{}),et=[],tt=[];function nt(){var e,t,n={},i=window.location.search.replace(/\+/g," ").replace("?","");if(!i||"/"===i)return{};for(var s=i.split("&"),a=0;a<s.length;a++)t=-1!==(t=s[a].indexOf("="))?(e=decodeURIComponent(s[a].substring(0,t)),decodeURIComponent(s[a].substring(t+1))):void(e=s[a]),n[e]=!t||t.replace("#","");return n}function it(e){var t=nt();if(t.hasOwnProperty(e))return t[e]||!0}var C={DEBOUNCE_INTERVAL:800,SLIDE_LEFT_OUT_DURATION:80,SLIDE_RIGHT_IN_DURATION:300,SLIDE_LEFT_IN_DURATION:60,SLIDE_RIGHT_OUT_DURATION:250,slideRightIn:function(e,t){T.Velocity.RunSequence([{elements:t,properties:"transition.slideLeftBigOut",options:{duration:this.SLIDE_LEFT_OUT_DURATION,complete:function(){e.css({display:"inherit",opacity:0})}}},{elements:e,properties:"transition.slideRightBigIn",options:{duration:this.SLIDE_RIGHT_IN_DURATION}}])},persistCurrentTarget:function(e,t){var n=t.currentTarget;e(m(m({},t),{},{currentTarget:n}))},slideRightOut:function(e,t){T.Velocity.RunSequence([{elements:t,properties:"transition.slideRightBigOut",options:{duration:this.SLIDE_RIGHT_OUT_DURATION,complete:function(){e.css({display:"inherit",opacity:0})}}},{elements:e,properties:"transition.slideLeftBigIn",options:{duration:this.SLIDE_LEFT_IN_DURATION}}])},createSharedDebounce:function(){var i=null,s=this;return function(e,t,n){i&&(clearTimeout(i),i=null),t?e():i=setTimeout(function(){i=null,e()},n||s.DEBOUNCE_INTERVAL)}},urlRequiresParameter:function(e){return _.includes(e,":")},buildQueryParams:function(n,e){var i=e?"&":"?",s=Object.keys(n).length,a=0;return _.forEach(n,function(e,t){i+=t+"="+n[t],++a!==s&&(i+="&")}),i},getCurrentLanguagePath:function(){var e=E.getSite().isWebApp(),t=I.getAppState().getCurrentLanguage().langCode,n=g.getBaseLanguage().LanguageFullCode;return this.getLanguagePath(e,t,n)},getLanguagePath:function(e,t,n){return e&&t!==n?"/"+t.replaceAll("_","-"):""},getCurrentPreviewPath:function(e){var t=E.getSite().isWebApp(),n=I.getAppState().getCurrentLanguage().langCode,i=g.getBaseLanguage().LanguageFullCode;return this.getPreviewPath(e,t,n,i)},getPreviewPath:function(e,t,n,i){return this.getLanguagePath(t,n,i)+e},getBasePreviewQueryString:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],e={orgId:e,siteId:t,app:"commeditor"};return n&&(e.language=n),i&&(e.redirect=!1),this.buildQueryParams(e,!1)},getLivePreviewQueryString:function(e,t,n){var i={view:"editor"},t=(e&&(i.formFactor=t),e&&(i.viewid=e),n&&(i.livePreviewBrandingSetID=n),it("aura.mode"));return t&&(i["aura.mode"]=t),this.buildQueryParams(i,!0)},isCSSVariableSupported:_.memoize(function(){var e="rgb(255, 198, 0)",t=document.createElement("span");t.style.setProperty("--fake-var",e),t.style.setProperty("background","var(--fake-var)"),document.body.appendChild(t);e=getComputedStyle(t).backgroundColor===e;return document.body.removeChild(t),e}),getUrlVars:nt,getUrlVar:it,createQueryString:function(i){var s=[];return T.each(i,function(e,t){var n=encodeURIComponent(e);i[e]&&(n+="="+encodeURIComponent(i[e])),s.push(n)}),s.join("&")},convertDateTimeToString:function(e){return e.toLocaleDateString()+", "+e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},isClickedInsideEl:function(e,t){return!!e.has(t.target).length||e.is(t.target)}},st=Fe.Collection.extend({whereIsBranding:function(){return this.filter(function(e){return 0==e.get("PropertySection").indexOf("style:")})}},{parseResult:function(e,t){var n;void 0!==t&&null!=t&&null!=e&&(n=this,T(t).each(function(e){n.processCPD(this)}),e.set?(e.set({CustomProperties:t}),e.set({CPs:new st(t)})):e.CPs=new st(t))},processCPD:function(e){e.ValueTypeName=PicassoWebServices.Labels.CPDFields[e.ValueType.replace(/\\./g,"_")],"java.lang.Boolean"==e.ValueType&&"false"==e.DefaultValue&&(e.DefaultValue=!1),e.Required=e.Required&&"false"!=e.Required,e.ReadOnly=e.ReadOnly&&"false"!=e.ReadOnly},loadCustomProperties:function(t,n){var e={projection:["ComponentID","ContainerId","Name","Required","ValueType","ReadOnly","PropertySection","DefaultValue","Label"],filter:[{field:"Type",operator:"EQUALS",value:"sites.core.CustomPropertyDefinitionComponent"},{field:"ContainerId",operator:"EQUALS",value:t.get("ComponentID")}]};PicassoWebServices.Collection.GetCollection(e,function(e){st.parseResult(t,e.Values),n&&n(t)})}}),at=Fe.Model.extend({initialize:function(e){at.__super__.initialize.apply(this,[e])},sync:function(e,t,n){switch(e){case"read":case"create":case"patch":case"update":PicassoWebServices.ManageSiteCommon.SetComponentProperties(t.get("ComponentID"),t.changed,n.success);break;case"delete":PicassoWebServices.ManageSiteCommon.DeleteItem(t.get("id"),function(e){OnPicassoEditorAJAXCallCompleted(e),e.DeletedItemID?n.success(e):n.failure(e)})}},getCustomProperties:function(){return this.get("CPs")}}),t=Fe.Collection.extend({model:at,initialize:function(e){this.isDataReady=!1,this.on("reset",function(){this.isDataReady=!0},this)},setDirty:function(){this.isDataReady=!1},sync:function(e,t,n){var i;"read"===e&&(this.isDataReady?n.success&&n.success(this):(i=this).query&&PicassoWebServices.Collection.GetCollection(this.query,function(e){i.reset(e.Values),n.success&&n.success(e,null,null)}))}}),n=at.extend({}),ot=n.extend({parse:function(e){return(e=e.Values?e.Values:e).LanguageContainerId&&(e.id=e.ComponentID=e.LanguageContainerId),e},getActiveLanguageData:function(){var e=g.getSiteLanguageCollection().get(this.get("ActiveLanguageId"));return e?e.getSiteLanguageData():this.getBaseLanguageData()},getBaseLanguageData:function(){return{langLabel:this.get("BaseLanguageLabel"),langCode:this.get("BaseLanguageCode"),langId:""}}}),rt=n.extend({sync:function(e,t,n){switch(e){case"delete":PicassoWebServices.Language.RemoveLanguage(t.get("ComponentID"),function(e){e.success?n.success(e):n.error(e)});break;case"create":PicassoWebServices.Language.AddLanguage(t.get("Name"),t.get("LanguageLabel"),t.get("LanguageCode"),t.get("LanguageCountryCode"),t.get("LanguageScriptCode"),function(e){e.NewLanguageId?(t.set("id",e.NewLanguageId),t.set("ComponentID",e.NewLanguageId),n.success(e)):n.error(e)});break;case"update":rt.__super__.sync.apply(this,arguments)}},getSiteLanguageData:function(){var e=this.get("LanguageCode"),t=this.get("LanguageCountryCode");return t&&(e=e+rt.LANGUAGE_CODE_SEPARATOR+t),{langLabel:this.get("LanguageLabel"),langCode:e,langId:this.get("ComponentID")}}},{LANGUAGE_CODE_SEPARATOR:"_"}),lt=t.extend({model:rt,initialize:function(e){lt.__super__.initialize.apply(this,[e]),this.query={projection:["ComponentID","Name","LanguageLabel","LanguageCode","LanguageCountryCode","LanguageScriptCode","LanguageActive","FallbackLanguageID"],filter:[{field:"Type",operator:"EQUALS",value:"sites.core.language.LanguageComponent"}]}},parse:function(e){e.Values&&(e=e.Values);for(var t=0;t<e.length;++t)e[t].id=e[t].ComponentID,e[t].LanguageActive=e[t].LanguageActive||"true"==e[t].LanguageActive;return e},activeLanguages:function(){return this.where({LanguageActive:!0})},upsertBatch:function(e){PicassoWebServices.Language.UpsertLanguages(e,function(e){g.getSiteLanguageCollection().reset(e.Languages.List,{parse:!0})})}});Fe.Collection.extend({localStorage:new Fe.LocalStorage("available-languages"),initialize:function(e){}});var o=b.extend({},Fe.Events),y={hasProcessedErrorInResults:function(e){var t=!1;return null!=e&&(e.Errors&&(o.trigger("show-alert",{message:e.Errors}),t=!0),e.ErrorCode&&1===e.ErrorCode&&(o.trigger("show-alert",{title:PicassoWebServices.Labels.PicassoDialog.RequestTimeoutTitle,message:PicassoWebServices.Labels.PicassoDialog.RequestTimeoutMsg}),t=!0),e.LastWarning)&&(o.trigger("show-alert",{title:e.LastWarningTitle||"Warning",message:e.LastWarning}),t=!0),t},processPreUIInitResponse:function(e){var t;I.handleInitResult(e),e.Languages&&(t=e.Languages,g.getSiteLanguageCollection().reset(t.Languages.List,{parse:!0,silent:!0}),g.getLanguageContainerModel().set(g.getLanguageContainerModel().parse(t.Languages))),e.ComponentWhitelistAura&&($P.cbMetadata.componentWhitelistAura=e.ComponentWhitelistAura)},processPostUIInitResponse:function(e){this.processUndoRedoResponse(e)},processUndoRedoResponse:function(e){null!==e.UndoStack&&null!==I.getAppState()&&I.getAppState().set("hasUndoStack",""!==e.UndoStack),null!==e.RedoStack&&null!==I.getAppState()&&I.getAppState().set("hasRedoStack",""!==e.RedoStack)},processJSONResponse:function(e){this.processPreUIInitResponse(e),this.processPostUIInitResponse(e)},parseErrorText:function(e){var t,e=e.responseText;try{var n=jQuery.parseJSON(e);n.Errors&&(t=n.Errors)}catch(e){}return t=void 0===t?PicassoWebServices.Labels.PicassoDialog.UnsuccessfulRequest:t}},ct=null;function dt(e,t){return e.get("AuraAppName")||t.get("isWebApp")?e:h.getPages().findWhere({ComponentID:e.get("MasterPageID")})}function ut(e){var e=0<arguments.length&&void 0!==e&&e,t=E.getSite().get("orgId"),n=E.getSite().get("uddid"),i=E.getSite().isWebApp()?"":g.getLanguageContainerModel().getActiveLanguageData().langCode;return C.getBasePreviewQueryString(t,n,i,e)}var n=Fe.Model.extend({defaults:{currentSite:null,currentPageId:null,currentResolution:null,currentViewId:null,currentRouteId:null,currentPreviewPath:null,currentPreviewSiteBrandingSetId:null,currentPreviewScopedBrandingSetId:null,dataObjects:null,isColorPaletteOpen:!1,hasUndoStack:!1,hasRedoStack:!1,workspaceMode:null},getCurrentPage:function(){return h.getPages().get(this.get("currentPageId"))},getCurrentPageId:function(){return this.get("currentPageId")},getCurrentThemeId:function(){return this.getCurrentPage().get("CurrentThemeID")},getCurrentRouteId:function(){return this.get("currentRouteId")},getCurrentPageUrl:function(){var e=this.getCurrentPage().get("Url");return e=this.getCurrentPageId()===E.getSite().get("homepage")?P.ROUTE.HOME_ROUTE_URL:e},getCurrentPageTemplate:function(){return dt(this.getCurrentPage(),this.getCurrentSite())},getCurrentLanguage:function(){return g.getLanguageContainerModel().getActiveLanguageData()},isPageAura:function(e){return e.isAuraBased()},isCurrentPageAura:function(){return this.isPageAura(this.getCurrentPageTemplate())},isLoginPageAura:function(){return this.isPageAura(this.getLoginPageTemplate())},isCurrentPageAuthenticated:function(){return I.AccessControl(P.PERMISSIONS.IS_COMM_AUTHENTICATED)},getLoginPageTemplate:function(){var e=h.getPages().get(E.getSite().get("loginpage"));return void 0!==e?dt(e,this.getCurrentSite()):null},getHomePageTemplate:function(){return dt(h.getPages().get(E.getSite().get("homepage")),this.getCurrentSite())},getHomePageTemplateMetadata:function(){var e=this.getHomePageTemplate();return $P.cbMetadata.templates[e.getDevName()]},getHomePageTemplateDisplayName:function(){var e=this.getHomePageTemplateMetadata();return e?e.displayName:""},supportViewCrud:function(){var e,t;return null===ct&&(e=this.getHomePageTemplate(),t=parseInt(e.get("ReleaseVersion"),10),ct=34<=t&&(!_.isEmpty(e.get("AuraTag"))||E.getSite().isWebApp())),ct},isCommunityTemplate:function(e){e=$P.cbMetadata.templates[e.getDevName()];return e&&(e.templateName===$P.cbMetadata.templateNames.NAPILI||e.templateName===$P.cbMetadata.templateNames.SERVICE)},isSelfServiceTemplate:function(e){var t=$P.cbMetadata.templates[$P.cbMetadata.templateNames.KOKUA],n=$P.cbMetadata.templates[$P.cbMetadata.templateNames.KOA];return t&&e.getDevName()===t.templateName||n&&e.getDevName()===n.templateName},isHomePageStarterTemplate:function(){return this.getHomePageTemplate().getDevName()===$P.cbMetadata.templateNames.STARTER},isHomePageIdentityTemplate:function(){return this.getHomePageTemplate().getDevName()===$P.cbMetadata.templateNames.IDENTITY},isMobileFormFactor:function(){return this.get("currentResolution").id===P.LIVE_RESIZE_BREAKPOINT.PHONE},isTabletFormFactor:function(){return this.get("currentResolution").id===P.LIVE_RESIZE_BREAKPOINT.TABLET},templateSupportsNewFeatures:function(e){var t=e?e.get("AuraTemplateCreationName"):"";return!!t&&(t=t.toLowerCase(),!["koa","kokua","identity"].some(function(e){return 0===t.indexOf(e)}))},supportsNewFeatures:function(){var e=I.getAppState().getHomePageTemplate();return this.templateSupportsNewFeatures(e)},getEditorPreviewQueryString:function(){var e=this.getCurrentViewId(),t=this.get("currentResolution").get("formFactor"),n=this.get("currentPreviewSiteBrandingSetId");return ut()+C.getLivePreviewQueryString(e,t,n)},getSitePreviewUrl:function(){var e=E.getSite().get("previewUrl"),t=E.getSite().isWebApp()&&this.isBaseLanguageActive();return e+this.get("currentPreviewPath")+ut(t)},getAnonymousPreviewUrl:function(){var e,t=E.getSite().get("anonPreviewUrl").split("?"),n="";return n=E.getSite().isWebApp()?this.isBaseLanguageActive()?C.buildQueryParams({app:"commeditor",redirect:!1},!0):"":(e=this.getCurrentLanguage().langCode,C.buildQueryParams({app:"commeditor",language:e},!0)),"".concat(t[0]).concat(this.get("currentPreviewPath"),"?").concat(t[1]).concat(n)},getEditorPreviewUrl:function(){return E.getSite().get("livePreviewUrl")+this.get("currentPreviewPath")+this.getEditorPreviewQueryString()},getNetworkId:function(){return this.get("currentSite").get("networkId")},getCurrentSite:function(){return this.get("currentSite")},getCurrentViewId:function(){return this.get("currentViewId")},getCurrentPreviewSiteBrandingSetId:function(){return this.get("currentPreviewSiteBrandingSetId")},getCurrentPreviewScopedBrandingSetId:function(){return this.get("currentPreviewScopedBrandingSetId")},getDataObjects:function(){return this.get("dataObjects")},getCurrentPageReleaseVersion:function(){return parseInt(this.getCurrentPage().get("ReleaseVersion"),10)},getCurrentAppVersion:function(){var e=this.get("currentSite");return{external:e.get("appVersionCurrentExternal"),internal:e.get("appVersionCurrentInternal"),label:e.get("appVersionCurrentLabel")}},isBaseLanguageActive:function(){return g.getLanguageContainerModel().getActiveLanguageData().langCode===g.getBaseLanguage().LanguageFullCode}}),i=Fe.Model.extend({getName:function(){return this.get("name")},getLabel:function(){var e=PicassoWebServices.Labels.LiveResize[this.get("name")];return e+=" ("+this.getWidth()+" &times; "+this.getHeight()+")"},getIcon:function(){return this.get("icon")},getWidth:function(){return this.get("width")},getHeight:function(){return this.get("height")},getType:function(){return this.get("type")}}),i=Fe.Collection.extend({presets:[{id:"phone",label:PicassoWebServices.Labels.LiveResize.phone,formFactor:"SMALL",icon:"icon-utility-phone_portrait",title:PicassoWebServices.Labels.LiveResize.PhoneDimensions,height:"700px",width:"375px",type:"resolution",canRotate:!0},{id:"tablet",label:PicassoWebServices.Labels.LiveResize.tablet,formFactor:"MEDIUM",icon:"icon-utility-tablet_portrait",title:PicassoWebServices.Labels.LiveResize.TabletDimensions,height:"1024px",width:"768px",type:"resolution",canRotate:!0},{id:"fluid",label:PicassoWebServices.Labels.LiveResize.fluid,formFactor:"LARGE",icon:"icon-utility-desktop",title:PicassoWebServices.Labels.LiveResize.FluidDimensions,height:"100%",width:"100%",type:"resolution",canRotate:!1}],model:i,initialize:function(){this.add(this.presets)}}),pt=P.LIVE_RESIZE_BREAKPOINT.FLUID,gt=new i;function ht(e){I.event.trigger("state:active-resolution-updated",{newViewmode:e.updatedViewmode}),e.successCallback&&e.successCallback()}gt.getDefaultResolution=function(){return gt.get(pt)},gt.getResolutionFromFormFactor=function(e){if(e){var t,n=se(gt.models);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.get("formFactor")===e)return i}}catch(e){n.e(e)}finally{n.f()}}return gt.getDefaultResolution()},I.event.on("action:set-active-resolution",function(t){PicassoWebServices.Resolution.SetActiveResolution(t.updatedViewmode,function(e){e.success?I.AccessControl(P.PERMISSIONS.RESPONSIVE_PROPERTIES)&&I.AccessControl(P.PERMISSIONS.STYLE_PROPERTIES)||I.AccessControl(P.PERMISSIONS.RESPONSIVE_COMPONENT_VISIBILITY)?f.getPageComponents().fetch({viewId:I.getAppState().getCurrentViewId(),force:!0,successCallback:ht.bind(this,t)}):ht(t):t.errorCallback&&t.errorCallback()})});var mt,vt,bt,ft,_t=new n,St=[],i=(I.getAppState=function(){return _t},I.handleInitResult=function(t){b.forEach(t.AccessPermissions,function(e,t){e&&St.push(t)}),b.each(et,function(e){e(t)})},I.handleInitAppState=function(e){var t=E.getSite().get("homepage"),n=e.pageUrl,i=e.viewId,s=e.routeId,a=e.CurrentSite.isWebApp,o=e.Languages.Languages.ActiveLanguageCode,r=e.Languages.Languages.BaseLanguageCode;_t.set({currentSite:E.getSite(),currentPageId:t,currentViewId:i,currentRouteId:s,currentPreviewPath:C.getPreviewPath(n,a,o,r),currentResolution:gt.getResolutionFromFormFactor(e.selectedFormFactor),workspaceMode:P.workspace.PAGE_CONFIG},{silent:!0})},I.handleUndoRedoResult=function(t,n){return y.processUndoRedoResponse(n),b.some(tt,function(e){return e(t,n)})},I.AccessControl=function(t,e,n){t=b.isArray(t)?t:[t];var i=b.some(St,function(e){return b.includes(t,e)}),e=i?e:n;return void 0===e?i:b.isFunction(e)?e():e},Fe.Model.extend({idAttribute:"targetValue",toJSONString:function(){return JSON.stringify(this)},isDefault:function(){var e=this.get("criteria");return e&&0<e.length&&"Default"===e[0].criteriaType}})),Ct=Fe.Collection.extend({model:i}),yt="action:set-preview-site-branding-set",Tt="action:set-preview-scoped-branding-set",Pt="state:branding-set-values-updated",It="state:branding-audience-target-infos-updated",Et="state:brand-source-link-updated";function wt(t){return b.find(mt,function(e){return e.id===t})}function Lt(e){for(var t=0;t<mt.length;++t)if(mt[t].id===e)return t;return-1}function Dt(e){var t=e.BrandingSet.id,n=Lt(t);if(n<0)throw{message:"Requested branding set "+t+" does not exist"};mt[n]=e.BrandingSet}function At(e){b.each(e.BrandingSets,function(e){var t=wt(e.id);t.default=e.default,t.status=e.status}),bt.reset(e.BrandingAudienceTargetInfos)}bt=new Ct,_e(P.AUDIENCE_TARGET_NAME.BRANDING,bt),ve(function(e){e.BrandingSets&&(mt=e.BrandingSets),e.BrandingSetsDefinition&&(vt=e.BrandingSetsDefinition),e.BrandingAudienceTargetInfos&&bt.reset(e.BrandingAudienceTargetInfos)}),be(function(e,t){return!!t.BrandingSets&&(mt=t.BrandingSets,I.event.trigger(Pt),!0)}),l.getBrandingSet=wt,l.setCategoryInfo=function(e){ft=e||"buttonColor"},l.getCategoryInfo=function(){return ft},l.getAllBrandingSets=function(t){return t?mt.filter(function(e){return e.type===t}):mt},l.getAllBrandingSetDefs=function(e){return vt},l.getPreviewBrandingSet=function(){return wt(I.getAppState().getCurrentPreviewSiteBrandingSetId())},l.getCurrentPreviewScopedBrandingSet=function(){return wt(I.getAppState().getCurrentPreviewScopedBrandingSetId())},l.getScopedBrandingSetUsagesPromise=function(n){return new Promise(function(t,e){n&&wt(n)?PicassoWebServices.CommBranding.GetScopedBrandingSetUsages(n,function(e){e=e.WidgetPageBrandingSetInstances;t({viewBrandingSetInstances:e})}):e(new Error(PicassoWebServices.Labels.ScopedBrandingSetsPanel.DropdownDeleteErrorContent))})},l.getDefaultBrandingSet=function(){return b.find(mt,function(e){return e.default})},l.getBrandingSetPropertyDefs=function(e){if(vt.hasOwnProperty(e))return vt[e].propertyDefinitions;throw{message:"Requested branding definition "+e+" does not exist"}},l.getCurrentPreviewBrandingSetPropertyDefs=function(){var e=l.getPreviewBrandingSet().def;if(e)return l.getBrandingSetPropertyDefs(e)},l.getAllBrandingAudienceTargetInfos=function(){return bt},l.getBrandingAudienceTargetInfo=function(e){return bt.get(e)},l.getBrandingAudienceTargetInfosPromise=function(){var t=T.Deferred();return PicassoWebServices.CommBranding.GetBrandingSetsStatusAndAudienceTargetInfos(function(e){At(e),t.resolve()}),t.promise()},l.getCurrentPreviewBrandingDefProperty=function(t){var e=l.getBrandingSet(I.getAppState().getCurrentPreviewSiteBrandingSetId()),e=l.getBrandingSetPropertyDefs(e.def);return b.find(e,function(e){return b.camelCase(e.name)===b.camelCase(t)})},I.event.on("action:update-branding-set-values",function(e){var t=e.id,n=e.values,i=e.successCallback,s=e.eventSource,a=e.propType,e=b.reduce(n,function(e,t){return e[t.name]=t.value,e},{});PicassoWebServices.CommBranding.SetBrandingSetValues(t,e,function(e){y.processUndoRedoResponse(e),Dt(e),I.event.trigger(Pt,s,n,a),i&&i(e)})}),I.event.on("action:set-branding-set-as-site-default",function(e){var t=e.id;PicassoWebServices.CommBranding.SetBrandingSetAsDefault(t,function(e){y.processUndoRedoResponse(e),At(e),I.getAppState().getCurrentPageTemplate().set("ActiveBrandingSetId",t),I.event.trigger("state:default-branding-set-updated")})}),I.event.on("action:update-branding-audience-target-infos",function(e){l.getBrandingAudienceTargetInfosPromise().done(function(){I.event.trigger(It)})}),I.event.on("action:update-branding-audience-target-priorities",function(e){var n=e.brandingSetIdToPriorityMap,t=e.successCallback,i={};bt.each(function(e){var t=e.get("targetValue"),t=n[t];null!=t&&(i[e.get("audienceTargetInfoID")]=t)}),PicassoWebServices.CommBranding.UpdateBrandingAudienceTargetInfoPriorities(i,function(e){At(e),t&&t(e),I.event.trigger("state:branding-audience-target-priorities-updated")})}),I.event.on(yt,function(e){var t=e.id,e=e.successCallback;I.getAppState().set("currentPreviewSiteBrandingSetId",t),I.event.trigger("state:preview-site-branding-set-updated"),e&&e()}),I.event.on(Tt,function(e){var t=e.id,e=e.successCallback;I.getAppState().set("currentPreviewScopedBrandingSetId",t),I.event.trigger("state:preview-scoped-branding-set-updated"),e&&e()}),I.event.on("action:duplicate-branding-set",function(e){var t=e.name,n=e.id,i=e.successCallback;PicassoWebServices.CommBranding.CloneBrandingSet(t,n,function(e){y.processUndoRedoResponse(e),mt.push(e.BrandingSet),I.event.trigger("state:branding-set-duplicated"),i&&i(e)})}),I.event.on("action:delete-branding-set",function(e){var i=e.id,s=e.successCallback;PicassoWebServices.CommBranding.DeleteBrandingSet(i,function(e){y.processUndoRedoResponse(e);var t=Lt(i);function n(){I.event.trigger("state:branding-set-deleted"),s&&s(e)}0<=t&&mt.splice(t,1),At(e),I.getAppState().getCurrentPreviewSiteBrandingSetId()===i?I.event.trigger(yt,{id:l.getDefaultBrandingSet().id,successCallback:function(){n()}}):I.getAppState().getCurrentPreviewScopedBrandingSetId()===i?I.event.trigger(Tt,{id:"",successCallback:function(){o.trigger("theme-editor-action:show-detail",P.BRANDING_SET_TYPE.APP),n()}}):n()})}),I.event.on("action:create-branding-set",function(e){var t=e.name,n=e.successCallback,e=e.type;(e&&e===P.BRANDING_SET_TYPE.SCOPED?PicassoWebServices.CommBranding.CreateScopedBrandingSet:PicassoWebServices.CommBranding.CreateBrandingSet)(t,function(e){y.processUndoRedoResponse(e),mt.push(e.BrandingSet),I.event.trigger("state:branding-set-created"),n&&n(e)})}),I.event.on("action:rename-branding-set",function(e){var t=e.id,n=e.name,i=e.successCallback;PicassoWebServices.CommBranding.RenameBrandingSet(n,t,function(e){y.processUndoRedoResponse(e),Dt(e),I.event.trigger("state:branding-set-renamed"),i&&i(e)})}),I.event.on("action:remove-branding-set-audience",function(e){e=e.id;PicassoWebServices.CommBranding.RemoveAudienceForBrandingSet(e,function(e){y.processUndoRedoResponse(e),At(e),I.event.trigger(It)})}),I.event.on("action:update-fav-icon-asset-ref",function(e){e=e.value;PicassoWebServices.ManageSiteCommon.UpdateProperty(E.getSite().get("homepage"),P.FAV_ICON_ASSET_REF,e)}),I.event.on("action:link-brand-in-branding-set",function(e){var t=e.contentKey,n=e.brandingSetId,i=e.brandingSetValues,s=e.errorCallback;PicassoWebServices.CommBranding.LinkBrandToBrandingSet(t,n,i,function(e){e.Errors&&s?s(e.Errors):e.BrandingSet&&(Dt(e),I.event.trigger(Pt),I.event.trigger(Et))})}),I.event.on("action:unlink-brand-from-branding-set",function(e){var t=e.brandingSetId,n=e.brandingSetValues,i=e.successCb;PicassoWebServices.CommBranding.UnlinkBrandFromBrandingSet(t,n,function(e){Dt(e),i(),I.event.trigger(Pt),I.event.trigger(Et)})});var kt=null,Nt=null,n=PicassoWebServices.Labels.CommunityBuilder,xt={SUCCESS:{themeClass:"slds-theme_success",iconClass:"slds-icon-utility-success",icon:"success",assistiveLabel:n.ToastSuccess,canDismiss:!0},WARNING:{themeClass:"slds-theme_warning",iconClass:"slds-icon-utility-warning",icon:"warning",assistiveLabel:n.ToastWarning,canDismiss:!0},ERROR:{themeClass:"slds-theme_error",iconClass:"slds-icon-utility-error",icon:"error",assistiveLabel:n.ToastError,canDismiss:!0}},Rt="#sitePreviewWorkarea",jt=400,Bt=_.template('<div class="cb-Toast slds-notify_container slds-is-absolute"><div class="slds-notify slds-notify_toast {{= themeClass}}" role="status"><span class="slds-assistive-text">{{= assistiveLabel }}</span><span class="slds-icon_container {{= iconClass}} slds-m-right_small slds-no-flex slds-align-top" title="{{= assistiveLabel }}"><svg class="slds-icon slds-icon_small" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#{{= icon }}"></use></svg></span><div class="slds-notify__content"><h2 class="slds-text-heading_small ">{{= message }}</h2>{{ if (typeof details !== "undefined") { }}<p>{{= details}}</p>{{ } }}</div>{{ if (canDismiss) { }}<div class="slds-notify__close"><button class="slds-button slds-button_icon slds-button_icon-inverse" title="'+n.ToastClose+'"><svg class="slds-button__icon slds-button__icon_large" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#close"></use></svg><span class="slds-assistive-text">'+n.ToastClose+"</span></button></div>{{ } }}</div></div>");function Ot(){var e=T.Deferred();return kt?(Nt&&(clearTimeout(Nt),Nt=null),kt.fadeOut(jt,function(){kt.remove(),kt.find(".slds-notify__close").off("click",Ot),kt=null,e.resolve()})):e.resolve(),e.promise()}function Mt(t){Ot().done(function(){var e;(kt=T(Bt(e=t))).hide(),T(Rt).append(kt),kt.fadeIn(jt),kt.find(".slds-notify__close").on("click",Ot),e.duration&&(Nt=setTimeout(Ot,Math.max(e.duration,jt)))})}function Vt(e){return!(!e||"string"!=typeof e||!(e=e.toLowerCase().replace(/^\s+|\s+$/g,"")))}var $t,Ut,Wt,Ft,w={DURATION_SHORT:3e3,DURATION_MEDIUM:5e3,DURATION_LONG:9e3,success:function(e){Mt(_.extend({},xt.SUCCESS,e))},warning:function(e){Mt(_.extend({},xt.WARNING,e))},error:function(e){Mt(_.extend({},xt.ERROR,e))},render:function(e){Mt(e)}},i=at.extend({isSPA:function(){var e;return!!this.get("IsSinglePageApp")||!!(e=this.get("MasterPageID"))&&(e=h.getPages().get(e))&&e.isSPA()},getPageIdsInTemplateChain:function(){for(var e=[this.get("ComponentID")],t=this.get("MasterPageID");t;)e.push(t),t=h.getPages().get(t).get("MasterPageID");return e},isMasterpage:function(){return"MASTERPAGE"===this.get("PageType")},getRootTemplateId:function(){var e=this.getPageIdsInTemplateChain();return e[e.length-1]},getDevName:function(){return this.get("AuraTag")?T.trim(this.get("AuraTemplateCreationName").split("-")[0]):E.getSite().isWebApp()?T.trim(this.get("AuraTemplateCreationName")):T.trim(this.get("Name").split("-")[0])},isAuraBased:function(){return!!this.get("AuraTag")},isLWRBased:function(){return E.getSite().isWebApp()}}),Ht=t.extend({model:i,initialize:function(e){Ht.__super__.initialize.apply(this,[e]),this.query={projection:["ComponentID","Name","Url","PageType","IsSiteMapVisible","Type","Title","AuraTitle","Deployed","IsEditableOnDeploy","IsOptionalOnDeploy","ReadOnly","MasterPageID","RestrictedIPs","RestrictedIPsRestrictedURL","RestrictedIPsEnabled","RequiresAuthorization","AuthProperty","IsSystem","IsSinglePageApp","DescriptiveText","ThumbnailImage","ReleaseVersion","AuraTag","CustomCSS","AuraTemplateCreationName","CurrentThemeID","IsDefaultHeaderHidden","HeadInlineScript","BodyInlineScript","IsHeadMarkupVerified","CmsSettings","AuraAppName","ActiveBrandingSetId"],filter:[{field:"Type",operator:"EQUALS",value:"sites.ui.Page"}]}},whereIsNormal:function(){return this.where({PageType:"NORMAL"})},whereIsTemplate:function(){return this.where({PageType:"MASTERPAGE"})},findIdFromUrl:function(e){e=this.findWhere({Url:e});return e?e.get("ComponentID"):null},comparator:function(e,t){e=e.get("Name").toLowerCase(),t=t.get("Name").toLowerCase();return e===t?0:e<t?-1:1},parse:function(e){e.Values&&(e=e.Values);for(var t=0;t<e.length;++t)e[t].id=e[t].ID||e[t].ComponentID,e[t].ReadOnly="true"==e[t].ReadOnly||"true"==e[t].IsSystem,e[t].Deployed="true"==e[t].Deployed,e[t].IsEditableOnDeploy="true"==e[t].IsEditableOnDeploy,e[t].IsOptionalOnDeploy="true"==e[t].IsOptionalOnDeploy,e[t].IsSiteMapVisible="true"==e[t].IsSiteMapVisible,e[t].Type=_.last(e[t].Type.split(".")),e[t].RequiresAuthorization="true"===e[t].RequiresAuthorization,e[t].AuthProperty="true"===e[t].AuthProperty,e[t].RestrictedIPsEnabled="true"===e[t].RestrictedIPsEnabled,e[t].IsSinglePageApp="true"===e[t].IsSinglePageApp,st.parseResult(e[t],e[t].CustomProperties);return e}}),L={isNotNullEmptyOrWhitespace:Vt,isNullEmptyOrWhitespace:function(e){return!Vt(e)},htmlEncode:function(e){return T("<div/>").text(e).html()},htmlDecode:function(e){return T("<div/>").html(e).text()},format:function(){if(0===arguments.length)return"";for(var e=arguments[0],t=1;t<arguments.length;t++)var n=new RegExp("\\{"+(t-1)+"\\}","gm"),e=e.replace(n,arguments[t]);return e},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},replaceSpaces:function(e,t){return e?e.replace(/ +/g,t):""}},Gt=t.extend({model:at,initialize:function(e){Gt.__super__.initialize.apply(this,[e]),this.query={projection:["ComponentID","Name","ReadOnly","IsSystem","AllowInstantiate","IsAvailableToEditors","Icon","Title","PlaceholderHtml","Section","Description","RootContainerReferences","ViewType","ViewPageID","IsOOTB","AuraTag","ThemeLayoutType","VariationDescription","ViewDataProviders"],filter:[{field:"Type",operator:"EQUALS",value:"sites.ui.widgets.custom.WidgetPage"}]}},parse:function(e){e.Values&&(e=e.Values);for(var t=0;t<e.length;++t)e[t].id=e[t].ComponentID,e[t].AllowInstantiate="false"!=e[t].AllowInstantiate,e[t].IsAvailableToEditors=e[t].AllowInstantiate&&"false"!=e[t].IsAvailableToEditors,e[t].ReadOnly="true"==e[t].ReadOnly||"true"==e[t].IsSystem,e[t].IsSystem="true"==e[t].IsSystem,e[t].IsOOTB="true"==e[t].IsOOTB,e[t].ViewDataProviders=L.isNullEmptyOrWhitespace(e[t].ViewDataProviders)?"[]":e[t].ViewDataProviders,st.parseResult(e[t],e[t].CustomProperties);return e},updateField:function(e,t,n,i){var s={};s[t]=n,this.get(e).set(s,{silent:!0}),PicassoWebServices.ManageSiteCommon.UpdateProperty(e,t,n,function(e){OnPicassoEditorPropertiesUpdateAJAXCallCompleted(e),i()})},revertInstance:function(e){PicassoWebServices.Widget.RevertCustomProperties(e,OnPicassoEditorAJAXCallCompleted)},upsert:function(e,t,n,i,s,a,o,r,l){return PicassoWebServices.Widget.UpsertWidget(e,t,n,i,s,a,o,r,l,OnPicassoEditorAJAXCallCompleted),!0},isView:function(e){return 0!==h.getRoutes().getRouteForView(e).length},getViewsForPage:function(t){return _.filter(this.models,function(e){return e.get("ViewPageID")===t})}},{getCustomProperties:function(e){return e.get("CPs")?e.get("CPs"):null}}),zt=_.template('<div class="cb-PageManager-popover cb-PageManager-popover--inputFields popover" role="tooltip"><div class="cb-PageManager-popoverArrow arrow"></div><div class="cb-PageManager-popoverContent popover-content js-input-{{= prop}}-popover-content js-page-manager-input-error"></div></div>'),c={displayProgressIndicator:function(e){e=e.closest(".cb-PageManager-inputGroup").find("label");e&&e.append('<span class="cb-PageManager-progressIndicator js-pm-progress-indicator">')},removeProgressIndicator:function(){T(".js-pm-progress-indicator").remove()},getRouteUrlPrefix:function(e){return e.split(/[/()]/)[1]},showErrorPopover:function(t,n,i){t.popover("hide"),setTimeout(function(){var e=t.data("bs.popover");e?(t.attr("data-content",n),e.setContent()):(t.popover({container:i,content:n,trigger:"manual",template:zt({prop:t.data("prop")?t.data("prop").toLowerCase():""})}),t.on("shown.bs.popover",function(){t.one("focus",function(e){t.popover("hide")})})),t.popover("show")},200)},removeErrorPopover:function(e){e.popover("destroy")},constructStyledUrl:function(e){var t=e.url,n=e.delimiter,i=e.truncationCutoff,i=void 0===i?3:i,s=e.addLeadingDelimiter,s=void 0===s||s,a=e.addTrailingDelimiter,a=void 0===a||a,e=e.segmentClass,t=t.split("/"),t=(Z(t=t)||ee(t)||te(t)||ie()).slice(1);return""===t[t.length-1]&&t.pop(),c.constructStyledPath({segments:t,delimiter:n,truncationCutoff:i,addLeadingDelimiter:s,addTrailingDelimiter:a,segmentClass:e})},constructStyledPath:function(e){var t,n=e.segments,i=e.delimiter,s=e.truncationCutoff,s=void 0===s?3:s,a=e.addLeadingDelimiter,a=void 0!==a&&a,o=e.addTrailingDelimiter,o=void 0!==o&&o,r=e.segmentClass,e=Q(n),n=(e=r?e.map(function(e){return'<span class="'.concat(r,'">').concat(e,"</span>")}):e).shift();return 0===e.length?n?"".concat(a?i:"").concat(n).concat(o?i:""):"".concat(a?i:""):(t=e.pop(),s=e.length>s-2?[n,"...",t]:[n].concat(Q(e),[t]),"".concat(a?i:"").concat(s.join(i).trim()).concat(o?i:""))},constructSpacedUrl:function(e){return e&&"/"!==e?c.constructStyledUrl({url:e,delimiter:'<span class="slds-p-horizontal_xxx-small">/</span>',segmentClass:"cb-parentUrl__segment"}):""},isLoginRoute:function(e){return 0<_.intersection(P.ROUTE.LOGIN_ROUTE_TYPES,_.map(e,"routeType")).length},isHomeNode:function(e){return e.name===P.ROUTE.HOME_ROUTE_NAME},isErrorNode:function(e){return e.name===P.ROUTE.ERROR_ROUTE_NAME},isFolderNode:function(e){return!!e.isNodeFolder},isObjectFolderNode:function(e){return e.isNodeFolder&&"Object"===e.nodeFolderType},isObjectNode:function(e){return!!e.keyPrefix},isCmsContentFolderNode:function(e){return e.isNodeFolder&&"Content"===e.nodeFolderType},isCmsContentNode:function(e){return!!e.contentTypeLabel},isParameterizedNode:function(e){return!!e.hasParams},isServiceNotAvailableNode:function(e){e=h.getRoutes().getRouteForView(e.viewId);return!_.isEmpty(e)&&e[0].isAllowedInStaticSite()},isServiceNotAvailableView:function(e){return this.isServiceNotAvailableNode({viewId:e})},hasChildren:function(e){return e.children&&0<e.children.length},getNonDeletableDescendantNodes:function(e){return function n(e){var t,e=e.children||[];return 0===e.length?[]:(t=e.reduce(function(e,t){return e.push.apply(e,Q(n(t))),e},[]),[].concat(Q(e),Q(t)))}(e).filter(function(e){return!(e.isNodeFolder||e.availableActions.includes("delete")||e.availableFolderActions.includes("delete"))})},stripParameters:function(e){return e&&e.replace(/(\/\:.*)/,"")},hasConflictingRouteSegment:function(e,t){return c.stripParameters(e.routeSegment)===c.stripParameters(t.routeSegment)},hasConflictingChild:function(e,t){var n=c.isFolderNode(t),i=n?{routeSegment:t.children[0].routeSegment}:t;return c.hasChildren(e)&&e.children.some(function(e){return!c.isFolderNode(e)&&c.hasConflictingRouteSegment(e,i)&&(!n||c.hasChildren(e))||c.isFolderNode(e)&&c.hasChildren(i)&&c.hasConflictingRouteSegment(e.children[0],i)})},hasConflictingFolderNode:function(e,t,n){return t.parent?t.parent.children.some(function(e){return t.id!==e.id&&c.isFolderNode(e)&&c.hasConflictingRouteSegment(e.children[0],t)}):e.some(function(e){return!e.parent&&c.isFolderNode(e)&&c.hasConflictingRouteSegment(e.children[0],t)&&c.hasConflictWithMovingFolderNode(t,e,n)})},hasConflictWithMovingFolderNode:function(e,t,n){return!(c.isFolderNode(n)&&!c.hasChildren(e)&&c.hasConflictingRouteSegment(n.children[0],t.children[0]))}},n=at.extend({sync:function(e,t,n){"delete"===e&&PicassoWebServices.VanityUrl.deleteRoute(t.get("id"),function(e){e.success?n.success(e):n.failure(e)})},getViewId:function(){var e=this.get("RenderList");return e&&0<e.length?e[0].viewID:null},getPreviewViewId:function(){var e=this.getViewId();return e||(e=J(this.getViews(),1)[0])&&e.id},getViewName:function(){return this.get("Name")},getDepth:function(){return this.get("ParentUrl").split("/").length-1},getRouteKeyPrefix:function(){return k.getKeyPrefixFromObjectRouteType(this.get("ViewType"))},getRouteSegment:function(){return this.get("RouteUrl").replace(this.get("ParentUrl"),"")},getRouteBaseSegment:function(){var e=c.getRouteUrlPrefix(this.getRouteSegment());return"/".concat(e)},isUrlSegmentEditable:function(){return this.get("PageActions").includes("change_url_segment")},isOnlyBaseUrlEditable:function(){return this.get("PageActions").includes("change_base_url")},isOOTB:function(){return this.get("IsOOTB")},isObjectDetailRoute:function(){return k.isObjectDetailRouteType(this.get("ViewType"))},isObjectListRoute:function(){return k.isObjectListRouteType(this.get("ViewType"))},isObjectRelatedListRoute:function(){return k.isObjectRelatedListRouteType(this.get("ViewType"))},isObjectRoute:function(){return k.isObjectRouteType(this.get("ViewType"))},isExtObjectRoute:function(){return k.isExtObjectRouteType(this.get("ViewType"))},isGenericObjectDetailRoute:function(){return k.isGenericObjectDetailRouteType(this.get("ViewType"))},isGenericObjectListRoute:function(){return k.isGenericObjectListRouteType(this.get("ViewType"))},isGenericObjectRelatedListRoute:function(){return k.isGenericObjectRelatedListRouteType(this.get("ViewType"))},isGenericObjectRoute:function(){return k.isGenericObjectRouteType(this.get("ViewType"))},isManagedContentRoute:function(){return k.isManagedContentRouteType(this.get("ViewType"))},isLoginRoute:function(){return _.includes(P.ROUTE.LOGIN_ROUTE_TYPES,this.get("ViewType"))},isPublicRoute:function(){return"Public"===this.getAuthState()},getAuthState:function(){return this.get("AuthorizationState")},isRouteDefinitionAuthStateAlwaysPublic:function(){return"ALWAYS_PUBLIC"===this.get("RouteDefinitionAuthState")},isRouteDefinitionAuthStateAlwaysPrivate:function(){return"ALWAYS_PRIVATE"===this.get("RouteDefinitionAuthState")},isRouteDefinitionAuthStateDefault:function(){return"DEFAULT"===this.get("RouteDefinitionAuthState")},setView:function(e,t){this.set("RenderList",[{viewID:e}],{silent:t})},getViews:function(){var e=this.get("ViewType"),t=this.get("PageId"),n=[];return h.getPages().get(t).isAuraBased()?(n=h.getViews().where({ViewType:e,ViewPageID:t}),this.isObjectRoute()&&(e=k.getMatchingGenericDataRouteType(e),t=h.getViews().findWhere({ViewPageID:t,ViewType:e}))&&n.push(t)):n=h.getViews().where({ComponentID:this.getViewId()}),n},isAllowedInStaticSite:function(){return _.includes(this.get(P.PROP.CONFIGURATION_TAGS),P.CONFIGURATION_TAGS.SNA)},isSnaRoute:function(){return this.isAllowedInStaticSite()&&!this.isTmrRoute()},isTmrRoute:function(){return _.includes(this.get(P.PROP.CONFIGURATION_TAGS),P.CONFIGURATION_TAGS.TMR)},isCommerceProductListRoute:function(){return k.isCommerceProductListRouteType(this.get("ViewType"))}}),Kt=t.extend({model:n,initialize:function(e){Kt.__super__.initialize.apply(this,[e]),this.query={projection:["ComponentID","Name","PageId","RouteUrl","RouteUrlWithOptionalParam","RenderList","ViewType","IsOOTB","AuthorizationState","UrlPrefix","RouteDefinitionAuthState","EntityAPIName"],filter:[{field:"Type",operator:"EQUALS",value:"sites.core.routes.Route"}]}},parse:function(e){e.Values&&(e=e.Values);for(var t=0;t<e.length;++t)e[t].id=e[t].ComponentID,e[t].IsOOTB="true"==e[t].IsOOTB;return e},getRoutesForPage:function(t){return _.filter(this.models,function(e){return e.get("PageId")===t})},getRouteForView:function(t){var e=_.filter(this.models,function(e){return e.getViewId()===t});return 0<e.length?e:(e=h.getViews().get(t))?this.where({PageId:e.get("ViewPageID"),ViewType:e.get("ViewType")}):[]},getRouteForPageAndViewType:function(t,n){return n?_.filter(this.models,function(e){return e.get("PageId")===t&&e.get("ViewType")===n}):[]},upsert:function(e,t,n,i,s){0!==t.indexOf("/")&&(t="/"+t);var a={},o=(a.Name=e,{});o.CreateView=a,o.routeName=e,o.pageId=n,o.routeUrl=t,o.fixedParameters={},o.urlParameters={},o.PageEventName=i,PicassoWebServices.VanityUrl.createRoute(o,s||OnPicassoEditorAJAXCallCompleted)}}),Yt="state:routes-properties-updated",qt="state:view-properties-updated",Xt="state:view-created",Jt="state:publish-warning",Qt=P.PROP,Zt=new Ht,en=new Gt,tn=new Kt,nn={},sn={},an=!1;function on(e,s,a){return b.some(e,function(e){var t=e[0],e=e[1],n=s.get(t);if(n){var i={};if(b.each(e,function(e,t){n.attributes.hasOwnProperty(t)&&(n.set(t,e),i[t]=e)}),!b.isEmpty(i))return a===Yt?I.event.trigger(a,[{id:t,props:i}]):I.event.trigger(a,t,i),!0}return!1})}function rn(e,t,n,i){var s,a,o,r=e.ViewId,l=e.Routes,c=e.CustomComponents;!y.hasProcessedErrorInResults(e)&&r?(s=Xt,a=h.getRoutes(),o=[],t&&0<l.length&&(a.add(l,{parse:!0,merge:!0}),l.forEach(function(e){o.push(a.get(e.id))}),s="state:route-created"),h.getViews().add(c,{parse:!0,merge:!0}),h.getViews().get(r).set(Qt.VARIATION_STATUS_KEY,P.PUBLISH_STATUS.NEW),t=a.getRouteForView(r)[0].id,I.event.trigger(s,{routeId:t,viewId:r,newRouteModels:o}),n&&n(e,t,r)):i&&i(e)}function ln(e,t){var n=$t[e];return(n=n||new Ct).reset(t.WidgetPageAudienceTargetInfos),$t[e]=n}function cn(n,i){var e=h.getRoutes().get(n),t=e.get(Qt.ROUTE_TYPE_KEY),e=e.get(Qt.PAGE_ID_KEY);PicassoWebServices.CommPage.GetCurrentPageAudienceTargetInfos(t,e,function(e){e.Routes&&h.getRoutes().reset(e.Routes,{parse:!0});var t=ln(n,e);i&&i(e,t)})}function dn(n){0<n.CustomComponents.length&&n.CustomComponents.forEach(function(e){var t=n.PublishState[e.ComponentID];null!=t&&(e[Qt.VARIATION_STATUS_KEY]=t)})}function un(e,t){return e.find(function(e){return e.get("targetValue").startsWith(t)})}function pn(e){var t=e.viewRegions;return function e(t,n){for(var i=0;i<t.length;i++){var s=t[i];if(s.id===n)return s;if(I.AccessControl(P.PERMISSIONS.VARIATIONS_PROPERTIES)){var a=hn(s);if(0<a.length){a=e(a,n);if(a)return a}}a=gn(s);if(0<a.length&&(s=e(a,n)))return s}return null}(void 0===t?[]:t,e.componentId)}function gn(e){return e.components||e.contents||[]}function hn(e){return e.variations||[]}function mn(e,t){return function e(t,n){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];for(var s=0;s<t.length;s++){var a,o=t[s];if(o.id===n)return vn(o)&&i.unshift({id:o.id,dataProviders:null!=(a=null==(a=o.dataBindingInfo)?void 0:a.dataProviders)?a:[]}),r=Object.assign({},null!=(a=o.dataBindingInfo)?a:{},{dataProviders:i}),{cmp:o,dataBindingContext:r};var r=gn(o);if(vn(o)&&i.unshift({id:o.id,dataProviders:null!=(l=null==(l=o.dataBindingInfo)?void 0:l.dataProviders)?l:[]}),0<r.length){var l=e(r,n,i);if(l)return l}var c=!_.isEmpty(o.variations);if(c){c=e(o.variations,n,i);if(c)return c}vn(o)&&i.shift()}return null}(e,t,[])}function vn(e){return 0<(null==e||null==(e=e.dataBindingInfo)||null==(e=e.dataProviders)?void 0:e.length)}$t={},_e(P.AUDIENCE_TARGET_NAME.PAGE,$t),ve(function(e){e.Pages&&h.getPages().reset(e.Pages,{parse:!0}),e.Routes&&h.getRoutes().reset(e.Routes,{parse:!0}),e.CustomComponents&&h.getViews().reset(e.CustomComponents,{parse:!0}),e.OOTBRouteTypeToURLMap&&(Ut=e.OOTBRouteTypeToURLMap),e.SeoComponentData&&(sn=e.SeoComponentData),e.RouteTypeToSEOIndexBlacklistMap&&(Wt=e.RouteTypeToSEOIndexBlacklistMap)}),be(function(e,t){var n,s,i,a,o=!1,t=t.UndoRedoActions;return t&&0<t.length&&("SetPropertyAction"===(n=t[0].ActionType)?(s=e,i=t,a=[],b.each(i,function(e){var t=e.ComponentID,n=b.find(a,function(e){return e[0]===t}),i=(n||((n=[]).push(t,{}),a.push(n)),"redo"===s?e.Value:e.Last);n[1][e.Name]=i}),o=(o=on(t=a,h.getRoutes(),Yt))||on(t,h.getViews(),qt)):"AuraMapAddAction"===n&&(i=e,n=t[0],t=n.Prop,i="redo"===e?n.Value:n.Last,o=!!(n=b.find(sn,{seoComponentId:n.ComponentID}))&&(n[t]=i,!0))),o}),h.getPages=function(){return Zt},h.getViews=function(){return en},h.getRoutes=function(){return tn},h.getAudienceTargetInfoForView=function(e,t){e=$t[e];return e&&e.get(t)},h.getAudienceTargetInfosForRoutePromise=function(e){var n=T.Deferred(),t=$t[e];return t?n.resolve(t):cn(e,function(e,t){n.resolve(t)}),n.promise()},h.getSEODataPromise=function(t){var n=T.Deferred();return sn[t]?n.resolve():PicassoWebServices.CommPage.GetSeoData(t,function(e){sn[t]=e.SeoComponentData,n.resolve()}),n.promise()},h.getPublishStatusPromise=function(e){var t,n,i=T.Deferred();return t=e,n=function(){i.resolve()},e=h.getRoutes().get(t),nn[t]?n&&n():(e=b.map(e.getViews(),"id"),PicassoWebServices.CommPage.GetPublishState(e,function(e){e.PublishState&&(e=e.PublishState,b.forIn(e,function(e){h.getViews().get(e.Key).set(Qt.VARIATION_STATUS_KEY,e.Value),nn[t]||(nn[t]=!0)})),n&&n()})),i.promise()},h.getOOTBRouteUrlByType=function(e){return Ut[e]},h.getDefaultThemeLayoutByRouteType=function(e){return Ft[e]},h.getSeoComponentDataByRouteId=function(e){return sn[e]},h.getSeoIndexByRouteType=function(e){return Wt[e]},h.isSeoComponentValueEqualToValue=function(e,t,n){return sn[e][t]===n},h.getSEOData=function(){PicassoWebServices.CommPage.getSEOUsage(function(e){I.event.trigger("state:seo-data-loaded",e)})},h.getAllSEORoutes=function(){var t;t=T.Deferred(),PicassoWebServices.CommPage.CanDisplaySeoSnapshotUi(function(e){!0===e?t.resolve():t.reject()}),t.promise().then(function(){PicassoWebServices.CommPage.GetRoutesForRefreshSnapshotFlow(function(e){I.event.trigger("state:seo-routes-loaded",e)})})},h.isThemeLayoutFetched=function(){return an},h.GetDefaultThemeLayoutForAllRoutes=function(){PicassoWebServices.CommCore.GetDefaultThemeLayoutForAllRoutes(function(e){e.RouteTypeToDefaultThemeLayoutMap&&(Ft=e.RouteTypeToDefaultThemeLayoutMap,an=!0,I.event.trigger("state:theme-layout-map-loaded"))})},h.GetDataProviderDataPromise=function(e){var t=T.Deferred();return PicassoWebServices.CommPage.GetDataProviderPicklistInfo(e,function(e){y.hasProcessedErrorInResults(e)||t.resolve(e.DataProviderValue)}),t.promise()},h.GetGlobalAndDefaultDataProvidersPromise=function(e){var t=T.Deferred();return PicassoWebServices.CommPage.GetGlobalAndDefaultDataProviders(e,function(e){y.hasProcessedErrorInResults(e)||t.resolve(e.GlobalDefaultAndConfiguredDataProviders)}),t.promise()},h.GetConfiguredDataProvidersDataProvidersPromise=function(e){var t=T.Deferred();return PicassoWebServices.CommPage.GetConfiguredDataProviders(e,function(e){y.hasProcessedErrorInResults(e)||t.resolve(e.GlobalDefaultAndConfiguredDataProviders)}),t.promise()},h.GetDataProviderBlockPromise=function(e){var t=T.Deferred();return PicassoWebServices.CommPage.GetDataProviderBlock(e,function(e){y.hasProcessedErrorInResults(e)?t.reject():t.resolve(e.DataProviderBlock)}),t.promise()},I.event.on("action:create-view-with-layout",function(e){var t=e.pageId,n=e.viewName,i=e.contentLayout,s=e.themeLayoutType,a=e.routeUrl,o=e.routeDevName,r=e.routeType,l=e.createRoute,c=e.parentId,d=e.successCallback,u=e.errorCallback;PicassoWebServices.CommPage.CreateLightningViewWithLayout({routePageId:t,routeName:n,routeDevName:o,routeUrl:a,parentId:c,routeType:r},n,s,i,l,function(e){rn(e,l,d,u)})}),I.event.on("action:create-view-from-global-page",function(e){var t=e.pageId,n=e.viewName,i=e.pageDef,s=e.routeUrl,a=e.routeDevName,o=e.routeType,r=e.parentId,l=e.themeLayoutType,c=e.successCallback,d=e.errorCallback;PicassoWebServices.CommPage.CreateGlobalPage({routePageId:t,routeName:n,routeDevName:a,routeType:o,parentId:r,routeUrl:s},i,l,function(e){rn(e,!0,c,d)})}),I.event.on("action:create-view-from-global-page-variation",function(e){var t=e.pageId,n=e.viewName,i=e.pageDef,s=e.routeType,a=e.themeLayoutType,o=e.successCallback,r=e.errorCallback;PicassoWebServices.CommPage.CreateGlobalPageVariation(t,i,n,s,a,function(e){rn(e,!1,o,r)})}),I.event.on("action:create-views-for-object",function(e){var t=e.homePageId,n=e.parentId,i=e.templateName,s=e.entityKeyPrefix,a=e.successCallback,o=e.errorCallback;PicassoWebServices.CommPage.CreateObjectPages(t,n,i,s,null,function(e){rn(e,!0,a,o)})}),I.event.on("action:create-views-for-ext-object",function(e){var t=e.objectPageNameMap,n=e.objectInfoParams,i=e.routeUrlPrefix,s=e.successCallback,a=e.errorCallback,e=E.getSite().get("homepage");PicassoWebServices.CommPage.CreateExtObjectPages(e,t,n,i,function(e){rn(e,!0,s,a)})}),I.event.on("action:update-route-property",function(e){var n=e.id,i=e.name,s=e.value,a=e.successCallback;i===Qt.ROUTE_URL_SEGMENT_KEY?function(e){var a=e.id,o=e.value,i=e.successCallback;PicassoWebServices.ManageSiteCommon.UpdateRouteUrlSegment(a,o,function(e){var t=e.UndoStack,n=e.RedoStack,e=e.Routes,s=[];y.processUndoRedoResponse({UndoStack:t,RedoStack:n}),e.forEach(function(e){var t,n=h.getRoutes().get(e.ComponentID),i=n.get(Qt.PARENT_URL_KEY),e=(n.set(e),n&&n.changed);e&&s.push({id:n.id,props:e}),n.id===I.getAppState().getCurrentRouteId()&&(e=n.get(Qt.PARENT_URL_KEY),t=n.id===a?C.getCurrentPreviewPath(t=e+o):I.getAppState().get("currentPreviewPath").replace(i,e),I.getAppState().set("currentPreviewPath",t))}),I.event.trigger(Yt,s),i&&i({UndoStack:t,RedoStack:n,Routes:e})}.bind(this))}({id:n,value:s,successCallback:a}):PicassoWebServices.ManageSiteCommon.UpdateProperty(n,i,s,function(e){y.processUndoRedoResponse(e);var t={};h.getRoutes().get(n).set(i,t[i]=s),I.event.trigger(Yt,[{id:n,props:t}]),a&&a(e)})}),I.event.on("action:update-route-seo-property",function(e){var n=e.id,i=e.name,s=e.value,a=e.successCallback,o=e.errorCallback,e={};e[i]=s,PicassoWebServices.CommContent.SetSeoComponentData(n,e,function(e){var t;y.processUndoRedoResponse(e),e.isSaved?(sn[n]=e.SeoComponentData,(t={})[i]=s,I.event.trigger(Yt,[{id:n,props:t}]),a&&a(e)):o&&o(e)})}),I.event.on("action:update-routes-base-urls",function(e){var t=e.routeIds,i=e.baseUrl,n=e.successCallback;function s(e,t,n){return e.replace(t,n)}var a=[];b.each(t,function(e){var t=h.getRoutes().get(e),n=t.getRouteBaseSegment(),t=s(t.getRouteSegment(),n,i),n={ComponentID:e,Params:{}};n.Params[Qt.ROUTE_URL_SEGMENT_KEY]=t,a.push(n)}),PicassoWebServices.ManageSiteCommon.SetComponentPropertiesBatch(a,function(e){y.processUndoRedoResponse(e),b.each(a,function(e){var e=h.getRoutes().get(e.ComponentID),t=e.getRouteBaseSegment(),n=s(e.getRouteSegment(),t,i);e.set(Qt.ROUTE_URL_KEY,e.get(Qt.PARENT_URL_KEY)+n),e.set(Qt.URL_PREFIX_KEY,e.get(Qt.PARENT_URL_KEY)+i),e.id===I.getAppState().getCurrentRouteId()&&(n=I.getAppState().get("currentPreviewPath").replace(e.get(Qt.PARENT_URL_KEY),""),e=e.get(Qt.PARENT_URL_KEY)+s(n,t,i),I.getAppState().set("currentPreviewPath",e))}),I.event.trigger("state:routes-base-urls-updated",t,i),n&&n(e)})}),I.event.on("action:delete-routes",function(e){var t=e.routeIds,o=e.successCallback;PicassoWebServices.CommPage.DeleteRoutes(t,!0,function(e){var t=e.Routes,n=e.CustomComponents,i=h.getRoutes(),s=[],a=(t.forEach(function(e){s.push(e.ComponentID),i.remove(i.get(e.ComponentID))}),h.getViews());n.forEach(function(e){a.remove(a.get(e.ComponentID))}),I.event.trigger("state:routes-deleted",s),o&&o(e)})}),I.event.on("action:move-route",function(l){function e(e){if(e.Errors)w.error({message:PicassoWebServices.Labels.CommBuilderPageManagement.MovePageError,canDismiss:!0});else{for(var t,n,i,s=e.Routes,a=I.getAppState().getCurrentRouteId(),o=!1,r=0;r<s.length;r++)if(s[r].ComponentID===a){t=h.getRoutes().get(a).get(Qt.PARENT_URL_KEY),o=!0;break}h.getRoutes().add(s,{parse:!0,merge:!0}),y.processPostUIInitResponse(e),o&&(i=I.getAppState().get("currentPreviewPath"),n=(n=C.getCurrentLanguagePath())?i.replace(n+t,""):i.replace(t,""),i=h.getRoutes().get(a).get(Qt.PARENT_URL_KEY),i=C.getCurrentPreviewPath(i+n),I.getAppState().set("currentPreviewPath",i)),I.event.trigger("state:route-moved",{movedRoutes:s,newParentRouteId:d,selectedRouteId:c}),l.successCallback&&l.successCallback(e)}}var c=l.selectedRouteId,t=l.keyPrefix,d=l.newParentRouteId;t||t===P.ROUTE.GENERIC_OBJECT_KEY_PREFIX_MARKER?PicassoWebServices.CommPage.MoveObjectPages(t,d,e):PicassoWebServices.CommPage.MovePage(c,d,e)}),I.event.on("action:update-view-property",function(e){var n=e.id,i=e.name,s=e.value,a=e.successCallback;function t(e){y.processUndoRedoResponse(e),h.getViews().get(n).set(i,s);var t={};t[i]=s,t.invalidateContentAreaAudienceTargetInfos=i===Qt.CONTENT_LAYOUT_KEY,I.event.trigger(qt,n,t),a&&a(e)}i===Qt.CONTENT_LAYOUT_KEY?PicassoWebServices.CommPage.ChangeViewLayout(n,s,t):PicassoWebServices.ManageSiteCommon.UpdateProperty(n,i,s,t)}),I.event.on("action:update-default-view",function(e){var t=e.viewId,n=e.routeId,i=e.routeType,s=e.spaPageId,a=e.successCallback;e.currentDefaultViewId;PicassoWebServices.CommPage.SetViewAsDefault(n,t,i,s,function(e){ln(n,e),dn(e),y.processJSONResponse(e),I.event.trigger("state:default-view-updated",{routeId:n,viewId:t}),a&&a(e)})}),I.event.on("action:remove-view-audience",function(e){var t=e.viewId,n=e.routeId,i=e.entityId,s=e.audienceId,a=e.routeType,o=e.spaPageId,r=e.successCallback;PicassoWebServices.CommPage.RemoveAudienceForView(i,s,a,o,t,function(e){ln(n,e),dn(e),y.processJSONResponse(e),I.event.trigger("state:view-audience-removed",{routeId:n,viewId:t}),r&&r(e)})}),I.event.on("action:delete-view",function(e){var t=e.viewId,n=e.routeId,i=e.routeType,s=e.spaPageId,a=e.successCallback;PicassoWebServices.CommPage.DeleteView(t,i,s,function(e){ln(n,e),dn(e),y.processJSONResponse(e),I.event.trigger("state:view-deleted",{routeId:n,viewId:t}),a&&a(e)})}),I.event.on("action:duplicate-view",function(e){var t=e.viewId,n=e.routeId,i=e.routeType,s=e.successCallback;PicassoWebServices.CommPage.DuplicateView(t,i,function(e){var t;0<(t=e).CustomComponents.length&&t.CustomComponents.map(function(e){var t=e.ComponentID,t=h.getViews().get(t),n=P.PUBLISH_STATUS.NEW;return t&&(n=t.get(Qt.VARIATION_STATUS_KEY)),e[Qt.VARIATION_STATUS_KEY]=n,e}),e=t,y.processJSONResponse(e),I.event.trigger(Xt,{routeId:n}),s&&s(e)})}),I.event.on("action:sync-view-publish-state",function(e){var t=e.id,n=e.successCallback;PicassoWebServices.CommPage.GetDraftHasPendingChanges(t,function(e){h.getViews().get(t).set(Qt.VARIATION_STATUS_KEY,e.publishState),I.event.trigger("state:view-publish-state-updated",t),n&&n(e)})}),I.event.on("action:update-page-audience-target-priorities",function(e){var n=e.viewIdToPriorityMap,t=e.routeId,i=e.successCallback,s={},e=($t[t].each(function(e){var t=e.get("targetValue"),t=n[t];null!=t&&(s[e.get("audienceTargetInfoID")]=t)}),h.getRoutes().get(t)),a=e.get(Qt.ROUTE_TYPE_KEY),e=e.get(Qt.PAGE_ID_KEY);PicassoWebServices.CommPage.UpdatePageAudienceTargetInfoPriorities(s,a,e,function(e){ln(t,e),dn(e),h.getViews().reset(e.CustomComponents,{parse:!0}),I.event.trigger("state:page-audience-target-priorities-updated"),i&&i(e)})}),I.event.on("action:sync-page-audience-target-infos",function(e){var t=e.routeId,n=e.successCallback;cn(t,function(){n(),I.event.trigger("state:page-audience-target-infos-updated",t)})}),I.event.on("action:export-page",function(e){PicassoWebServices.CommUtil.ExportToFlexiPage([e.viewId],function(e){I.event.trigger("state:page-exported",e)})}),I.event.on("action:refresh-seo-snapshot",function(e){PicassoWebServices.CommPage.RefreshSnapshotsForRoute(e.routeUuid,function(){I.event.trigger("state:seo-snapshot-refreshed")})}),I.event.on("action:trigger-sitemap-generation",function(e){PicassoWebServices.ManageSiteCommon.TriggerSitemapGenerationJob(function(e){y.hasProcessedErrorInResults(e)||I.event.trigger("state:sitemap-generation-triggered",e)})}),I.event.on("state:active-language-updated",function(){sn={}}),I.event.on("action:publish-site",function(e){nn={},PicassoWebServices.CommCore.PublishAll(e.note,function(e){e.PublishErrorContent&&e.PublishErrorTitle?I.event.trigger("state:publish-error",e):e.LastWarning?I.event.trigger(Jt,e.LastWarning):y.hasProcessedErrorInResults(e)||(y.processJSONResponse(e),I.event.trigger("state:site-published",e),E.getSite().set("isActive",!0))},function(e,t){t=y.parseErrorText(t);I.event.trigger(Jt,t)})}),I.event.on("action:upsert-page-level-data-providers",function(e){var t=e.routeId,n=e.dataProviders,i=e.successCallback,s=e.errorCallback;PicassoWebServices.ManageSiteCommon.UpsertDataProviders(t,n,function(e){y.hasProcessedErrorInResults(e)?s&&s():(h.getViews().get(t).set("ViewDataProviders",JSON.stringify(n)),i&&i(e.GlobalDefaultAndConfiguredDataProviders))})}),I.event.on("action:get-search-index-info",function(e){var t=e.successCallback;PicassoWebServices.CommPage.getSearchIndexInfo(function(e){t&&t(e)})});var bn="sites.ui.connectors.LumenPageComponentConnector",fn="sites.ui.connectors.LumenPageMutationComponentConnector",i=Fe.Model.extend({initialize:function(e){},sync:function(e,t,n){},getType:function(){return this.get("type")},removeChildren:function(){for(var t=this.getChildren(),n=[],e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return i.forEach(function(e){e=t.indexOf(e),e=t.splice(e,1);n.push.apply(n,Q(e))}),this.set("_children",t),n},appendChildren:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=[].concat(Q(this.getChildren()),t);return this.set("_children",i)},insertChild:function(e,t){var n=this.getChildren(),i=t?n.indexOf(t):n.length;return(i<0||!t)&&this.appendChildren(e),n.splice(i,0,e),this.set("_children",n)},getChildren:function(){return JSON.parse(JSON.stringify(this.get("_children")))},getParent:function(){return this.get("_parent")},setParent:function(e){return this.set("_parent",e)},isUsingDeclarativeTypes:function(){var e;return(this.getType()===bn||this.getType()===fn)&&(e=this.get("properties"))&&e.isUsingDeclarativeTypes},isVariation:function(){return this.getType()===fn},isInThemeRegion:function(){var e=this.get("properties");return e&&e.isInThemeRegion},getScopedBrandingSetId:function(){return(this.get("properties")||{}).scopedBrandingSetId},setScopedBrandingSetId:function(e){var t=this.getType();t!==bn&&t!==fn||(this.get("properties").scopedBrandingSetId=e)}}),_n=Fe.Collection.extend({model:i,initialize:function(e){},reset:function(){_n.__super__.reset.apply(this,arguments),this._fetchedViews.clear()},_fetchedViews:new Set,fetch:function(e){var t=e.viewId,n=e.force,i=e.successCallback,s=e.errorCallback,a=[],o=this;t&&(!n&&this._fetchedViews.has(t)?i&&i({collection:this,added:[]}):PicassoWebServices.CommPage.GetComponentsOnCanvas(t,function(e){e.Errors&&s?s(e.Errors):(e.Components&&(a=e.Components,o._fetchedViews.add(t),o.add(a,{merge:!0})),i&&i({collection:o,added:a}))}))},_getAllDescendants:function(e){var t;return e?(t=[],e.getChildren().forEach(function(e){e=this.get(e);e&&(t.push(e),t.push.apply(t,Q(this._getAllDescendants(e))))}.bind(this)),t):[]},doRemove:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){var e=this.get(e);e&&(e=[e].concat(Q(this._getAllDescendants(e))),this.remove(e))}.bind(this))},forEachAncestor:function(e,t){e&&e.getParent()&&(e=this.get(e.getParent()),t&&"function"==typeof t&&e&&t(e),this.forEachAncestor(e,t))},getComponentsForView:function(t){var n=S.getThemeLayoutByViewId(t).themeLayoutId;return this.filter(function(e){e=e.get("_viewOrThemeLayoutId");return e===t||e===n})}}),Sn=PicassoWebServices.Labels.CommunityBuilder,Cn=PicassoWebServices.Labels.General,D={SPINNER_CLASSNAME:"js-common-templates-spinner",radioDropdown:b.template('<div class="slds-picklist slds-dropdown-trigger slds-dropdown-trigger_click {{=className}}" aria-expanded="true"><button class="slds-button slds-button_neutral slds-picklist__label js-dropdown-button" aria-haspopup="true" aria-activedescendant=""><span class="slds-truncate {{=selectedLabelClassName}}">{{=selectedLabel}}</span><svg aria-hidden="true" class="slds-icon"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#down"></use></svg></button><div class="slds-dropdown slds-dropdown_left slds-dropdown_menu"><fieldset class="slds-form-element"><legend class="slds-form-element__legend slds-form-element__label">{{=dropdownLabel}}</legend><div class="slds-form-element__control">{{=dropdownItem}}</div></fieldset></div></div>'),urlSegmentInput:function(e){var t=e.tooltip,t=void 0===t?"":t,n=e.parentUrlHtml,i=e.parentUrlTooltip,i=void 0===i?"":i,s=e.isRequired,a=e.label,a=void 0===a?"":a,o=e.value,o=void 0===o?"":o,e=e.id,e=void 0===e?"":e;return'<label for="'.concat(e,'" class="slds-form-element__label">\n                ').concat(s?'<abbr class="slds-required" title="required">*</abbr>':"","\n                ").concat(a,"\n                ").concat(t?'<span class="cb-tooltip__url icon-utility-info js-url-tooltip" data-toggle="tooltip" data-placement="right" title="'.concat(t,'"></span>'):"",'\n            </label>\n            <div class="slds-form-element__control">\n                <div class="slds-input-group ').concat(n?"cb-urlSegment__container":"",'">\n                    ').concat(n?'<div class="slds-input-group-addon js-parent-url cb-urlSegment__parentUrl" title="'.concat(i,'/">\n                                ').concat(n,"\n                            </div>"):'<div class="slds-input-group-addon">/</div>','\n                    <input id="').concat(e,'" class="cb-urlSegment__input slds-input js-url-input" maxlength="45" value="').concat(o,'"/>\n                </div>\n            </div>\n            <div class="slds-form-element__help js-url-error"></div>').trim()},radioDropdownItem:b.template('<label class="slds-radio {{=className}}"><input type="radio" name="options" {{=value}}/><span class="slds-radio_faux"></span><span class="slds-form-element__label">{{=label}}</span></label>'),searchInput:b.template('<div class="slds-form-element {{=className}}"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_left"><svg aria-hidden="true" class="slds-input__icon slds-icon-text-default"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#{{=icon}}"></use></svg><input class="slds-input js-search" type="text" placeholder="{{=placeholder}}" /></div></div>'),spinner:'<div class="slds-spinner_container cb-common-templates-spinner js-common-templates-spinner">\n            <div class="slds-spinner_brand slds-spinner slds-spinner_medium" aria-hidden="false" role="alert">\n                <div class="slds-spinner__dot-a"></div>\n                <div class="slds-spinner__dot-b"></div>\n            </div>\n        </div>'.trim(),dataTable:b.template('<table class="slds-table slds-table_bordered {{= tableClassName }}">\n            <thead>\n                <tr class="{{= showHeader ? \'slds-line-height_reset\' : \'slds-assistive-text\' }}">\n                    {{ _.each(Object.keys(data[0]), function(key) { }}\n                        {{ if (key !== "id"){ }}\n                            <th data-key="{{= key }}" class="{{= tableHeaderClassName[key] || "" }}">\n                                <div class="slds-truncate">{{= labelMap[key] || "" }}</div>\n                            </th>\n                        {{ } }}\n                    {{ }) }}\n                </tr>\n            </thead>\n            <tbody>\n                {{ _.each(data, function(item) { }}\n                    <tr data-id="{{= item.id }}">\n                        {{ _.each(item, function(value, key, index) { }}\n                            {{ if (key !== "id"){ }}\n                                <td data-key="{{= key }}" class="{{= tableCellClassName[key] || "" }}">\n                                    <div class="slds-truncate {{= tableCellContentClassName[key] }}">{{= value }}</div>\n                                </td>\n                            {{ } }}\n                        {{ }) }}\n                    </tr>\n                {{ }) }}\n            </tbody>\n        </table>'),icon:function(e){var t=e.icon,n=e.sprite,e=e.svgClassName;return'<svg class="slds-icon '.concat(e||"",'" aria-hidden="true">\n                <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/').concat(n||"utility","-sprite/svg/symbols.svg#").concat(t,'"></use>\n            </svg>').trim()},iconWithAlt:function(e){var t=e.icon,n=e.sprite,i=e.className,s=e.svgClassName,e=e.label;return'<span class="slds-icon_container '.concat(i||"",'" title="').concat(e,'">\n                <svg class="slds-icon ').concat(s||"",'" aria-hidden="true">\n                    <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/').concat(n||"utility","-sprite/svg/symbols.svg#").concat(t,'"></use>\n                </svg>\n                <span class="slds-assistive-text">').concat(e,"</span>\n            </span>").trim()},buttonIcon:function(e){var t=e.buttonClassName,n=e.buttonAttributes,i=e.label,s=e.svgClassName,a=e.icon,e=e.sprite;return'<button class="slds-button slds-button_icon '.concat(t||"",'" ').concat(n||"",' title="').concat(i,'">\n                <svg class="slds-button__icon ').concat(s||"",'" aria-hidden="true">\n                    <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/').concat(e||"utility","-sprite/svg/symbols.svg#").concat(a,'"></use>\n                </svg>\n                <span class="slds-assistive-text">').concat(i,"</span>\n            </button>").trim()},buttonWithIcon:function(e){var t=e.buttonClassName,n=e.buttonVariantClassName,i=e.buttonAttributes,s=e.label,a=e.svgClassName,e=e.icon;return'<button class="slds-button '.concat(n||""," ").concat(t||"",'" ').concat(i||"",' title="').concat(s,'">\n                <svg class="slds-button__icon slds-button__icon_left ').concat(a||"",'" aria-hidden="true">\n                    <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#').concat(e,'"></use>\n                </svg>\n                ').concat(s,"\n            </button>").trim()},button:function(e){var t=e.buttonClassName,n=e.buttonVariantClassName,i=e.buttonAttributes,e=e.label;return'<button class="slds-button '.concat(n||""," ").concat(t||"",'" ').concat(i||"",' title="').concat(e,'">\n            <span>').concat(e,"</span>\n        </button>").trim()},tooltipButtonIcon:function(e){var t=e.buttonClassName,n=e.buttonAttributes,i=e.svgClassName,s=e.tooltipToggle,a=e.tooltipPlacement,e=e.tooltipLabel;return'<button class="slds-button slds-button_icon '.concat(t||"",'" aria-describedby="').concat(Cn.Help,'" aria-disabled="true" data-toggle="').concat(s||"tooltip",'" data-placement="').concat(a,'" ').concat(n||"",' title="').concat(e,'">\n                <svg class="slds-button__icon ').concat(i||"",'" aria-hidden="true">\n                    <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#info"></use>\n                </svg>\n                <span class="slds-assistive-text">').concat(e,"</span>\n            </button>").trim()},tooltipButtonIconWithDropdown:function(e){var t=e.buttonClassName,n=e.buttonAttributes,i=e.label,s=e.iconSvgClassName,a=e.dropdownIconSvgClassName,o=e.icon,r=e.sprite,l=e.tooltipToggle,c=e.tooltipPlacement,e=e.tooltipLabel;return'<button class="slds-button slds-button_icon slds-button_icon-container-more '.concat(t||"",'" ').concat(n||"",' \n            data-toggle="').concat(l||"tooltip",'" data-placement="').concat(c,'" title="').concat(e,'" aria-haspopup="true">\n                <svg class="slds-button__icon ').concat(s||"",'" aria-hidden="true">\n                    <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/').concat(r||"utility","-sprite/svg/symbols.svg#").concat(o,'"></use>\n                </svg>\n                <svg class="slds-button__icon ').concat(a||"",'" aria-hidden="true">\n                    <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#down"></use>\n                </svg>\n                <span class="slds-assistive-text">').concat(i,"</span>\n            </button>").trim()},dropdownButtonIcon:b.template('<button class="{{= buttonClassName }} slds-button slds-button_icon slds-button_icon-border slds-button_icon-x-small" aria-haspopup="true" title="'+Sn.ShowMore+'"><svg class="{{= svgClassName }} slds-button__icon" aria-hidden="true"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#down"></use></svg><span class="slds-assistive-text">'+Sn.ShowMore+"</span></button>"),select:b.template('<select class="slds-select {{= className }}">{{ _.each(data, function(item) { }}<option value="{{= item.value }}" {{= item.selected ? "selected" : ""}}>{{= item.label }}</option>{{ }) }}</select>'),list:b.template('<ul class="{{= listClassName }}">{{ _.each(items, function(item) { }}<li class="{{= listItemClassName }}">{{= item }}</li>{{ }) }}</ul>'),input:b.template('<div class="slds-form-element {{= formElementClassName }}"><input type="text" class="slds-input {{= inputClassName }}" maxlength="40" placeholder="{{= placeholder }}" value="{{- value }}" data-orig-value="{{- value }}"/><div class="slds-form-element__help {{= helpClassName }}"></div></div>'),visualPicker:function(e){var t=e.className,n=e.variantClassName,i=e.id,s=e.value,a=e.checked,o=e.displayName,e=e.description;return'<div class="slds-visual-picker '.concat(n||""," ").concat(t||"",'">\n                <input type="radio" id="').concat(i,'" value="').concat(s,'" name="options" ').concat(a?"checked":"",' />\n                <label for="').concat(i,'">\n                    <span class="slds-visual-picker__figure slds-visual-picker__text slds-align_absolute-center">\n                        <span>\n                            <span class="slds-text-heading_medium slds-m-bottom_x-small cb-slds-visual-picker__name">').concat(o,'</span>\n                            <span class="slds-text-title">').concat(e,'</span>\n                        </span>\n                    </span>\n                    <span class="slds-icon_container slds-visual-picker__text-check">\n                        <svg class="slds-icon slds-icon-text-check slds-icon_x-small" aria-hidden="true">\n                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#check"></use>\n                        </svg>\n                    </span>\n                </label>\n            </div>').trim()},comboboxPicklist:function(e){var t=e.formInputId,n=e.label,i=e.formInputClassName,s=e.value,e=e.fullWidth,e=void 0!==e&&e;return'<div class="slds-form-element">\n            <label class="slds-form-element__label" for="'.concat(t,'">').concat(n,'</label>\n            <div class="slds-combobox_container ').concat(e?"":"slds-size_small",'">\n                <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click slds-combobox-picklist slds-input-has-icon slds-input-has-icon_right" role="combobox">\n                    <input id="').concat(t,'" class="slds-input slds-combobox__input ').concat(i,'" type="text" placeholder="" readonly="" value="').concat(s,'" />\n                    <span class="slds-icon_container slds-icon-utility-down slds-input__icon slds-input__icon_right" title="').concat(Sn.ComboboxPicklistDropdownTooltip,'" style="pointer-events:none">\n                        <svg class="slds-icon slds-icon slds-icon_x-small slds-icon-text-default" aria-hidden="true">\n                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#down"></use>\n                        </svg>\n                        <span class="slds-assistive-text">').concat(Sn.ComboboxPicklistDropdownTooltip,"</span>\n                    </span>\n                </div>\n            </div>\n        </div>").trim()},bsButtonIconWithTooltip:b.template('<button class="{{= buttonClassName }} slds-button slds-button_icon" data-toggle="tooltip" data-placement="{{= placement}}" title="{{= label }}"><svg class="{{= svgClassName }} slds-button__icon" aria-hidden="true"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#{{= icon }}"></use></svg></button>'),bsButtonIconWithTooltipInContainer:b.template('<button class="{{= buttonClassName }} slds-button slds-button_icon" data-toggle="tooltip" data-placement="{{= placement}}" data-container="{{= container }}" data-html="true" title="{{= label }}"><svg class="{{= svgClassName }} slds-button__icon" aria-hidden="true"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#{{= icon }}"></use></svg></button>'),bsTooltipIcon:b.template('<span class="icon-utility-info {{= className }}" data-html="true" data-toggle="tooltip" data-placement="{{= placement }}" title="{{= content }}"></span>'),bsIconWithTooltip:b.template('<span class="slds-icon_container" data-toggle="tooltip" data-placement="{{= placement}}" title="{{- label }}"><svg class="{{= className }} slds-icon" aria-hidden="true"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#{{= icon }}"></use></svg></span>'),bsLabelWithTooltipIcon:b.template('<span>{{= label }}</span><span class="icon-utility-info {{= tooltipClassName }}" data-html="true" data-toggle="tooltip" data-placement="{{= placement }}" title="{{= tooltipContent }}"></span>')},yn={appendLocation:"#vexContainer",showCloseButton:!0,overlayClosesOnClick:!1,contentClassName:"cb-Dialog js-dialog",className:"picasso-vex-theme",a11y:!0},Tn={left:"cb-Dialog_checkbox__left",center:"cb-Dialog_checkbox__center",right:"cb-Dialog_checkbox__right"},Pn=function(e){var t=e.label,e=e.alignment;return t?'<div class="cb-Dialog_suppressCheckbox '.concat(Tn[void 0===e?"center":e]||Tn.center,'">\n            <div class="slds-checkbox">\n                <input type="checkbox" name="options" id="js-dialog-checkbox" class="js-checkbox" />\n                <label class="slds-checkbox__label" for="js-dialog-checkbox">\n                    <span class="slds-checkbox_faux"></span>\n                    <span class="slds-form-element__label">').concat(t,"</span>\n                </label>\n            </div>\n        </div>"):""};function In(n,i,s){return function(e){var t=!!s&&n.find(".js-checkbox").is(":checked");i&&i(e,t)}}function En(e){var t=e.title,n=e.subTitle,i=e.content,s=e.checkbox,a=e.onSubmit,o=e.callback,r=e.afterClose,l=e.afterCloseFocusEl,c=e.isConfirmPrompt,c=void 0!==c&&c,d=e.showCloseButton,d=void 0!==d&&d,u=e.headerClass,p=e.contentClassName,p=void 0===p?"":p,g=e.className,g=void 0===g?"":g,h=e.yesText,h=void 0===h?PicassoWebServices.Labels.PicassoDialog.Ok:h,m=e.yesTextClassName,m=void 0===m?"slds-button "+(c?"slds-button_brand":"slds-button_neutral"):m,v=e.noText,v=void 0===v?PicassoWebServices.Labels.PicassoDialog.Cancel:v,e=e.noTextClassName,e=void 0===e?"slds-button slds-button_neutral":e,n=T((n=(t={title:t,subTitle:n,content:i,checkbox:s,headerClass:void 0===u?c?"cb-Dialog_header--info":"cb-Dialog_header--error":u}).headerClass,i=void 0===(i=t.title)?"":i,u=void 0===(u=t.subTitle)?"":u,b=void 0===(b=t.content)?"":b,t=void 0===(t=t.checkbox)?{}:t,'<div class="cb-Dialog_header cb-Dialog_prompt_header '.concat(void 0===n?"":n,'">\n            <div class="cb-Dialog_title js-dialog-title" title="').concat(i,'">').concat(i,"</div>\n            ").concat(u?'<div class="cb-Dialog_subtitle js-dialog-subtitle">'.concat(u,"</div>"):"",'\n        </div>\n        <div class="cb-Dialog_content js-dialog-message">').concat(b,"</div>\n        ").concat(Pn(t)).trim())),i="slds-vex-theme slds-vex-theme--medium js-slds-prompt "+g,u="vex-content cb-Dialog js-dialog js-dialog-prompt"+(c?" cb-Dialog_prompt--confirm ":" cb-Dialog_prompt--alert ")+p+(d?"":" cb-Dialog_prompt"),b=[_.extend({},He.dialog.buttons.YES,{text:h,className:"test-yes ".concat(m)})],t=(c&&b.push(_.extend({},He.dialog.buttons.NO,{text:v,className:"test-no ".concat(e)})),In(n,o,s));return _.extend({},yn,{message:n,buttons:b,showCloseButton:d,className:i,contentClassName:u,callback:t,onSubmit:a,afterClose:function(){r&&r(),l&&l.focus()}})}function wn(e){var t=e.title,n=e.subtitle,i=e.content,s=e.checkbox,a=e.callback,o=e.afterClose,r=e.afterCloseFocusEl,l=e.className,l=void 0===l?"":l,c=e.contentClassName,c=void 0===c?"":c,d=e.isSingleButton,d=void 0!==d&&d,u=e.disabled,u=void 0!==u&&u,p=e.yesText,p=void 0===p?PicassoWebServices.Labels.PicassoDialog.Ok:p,g=e.yesTextClassName,g=void 0===g?"slds-button_brand":g,h=e.noText,h=void 0===h?PicassoWebServices.Labels.PicassoDialog.Cancel:h,e=e.noTextClassName,e=void 0===e?"slds-button_neutral":e,n=T((n=void 0===(n=(t={title:t,subtitle:n,checkbox:s}).title)?"":n,m=void 0===(m=t.subtitle)?"":m,t=void 0===(t=t.checkbox)?{}:t,'<div class="js-dialog-container">\n            <div class="cb-Dialog_header cb-Dialog-modal_header">\n                <div class="cb-Dialog_title js-dialog-title" title="'.concat(n,'">').concat(n,"</div>\n                ").concat(m?'<div class="cb-Dialog_subtitle js-dialog-subtitle">'.concat(m,"</div>"):"",'\n            </div>\n            <div class="cb-Dialog_content js-dialog-message"></div>\n            ').concat(Pn(t),"\n        </div>").trim())),m=(n.find(".js-dialog-message").append(i),"slds-vex-theme slds-vex-theme--medium js-slds-modal "+l),t="vex-content cb-Dialog js-dialog cb-Dialog_modal js-dialog-modal "+c,i=[_.extend({},He.dialog.buttons.YES,{text:p,className:"test-yes js-slds-modal-yes slds-button ".concat(g," ").concat(u?"disabled":"")})],l=(d||i.push(_.extend({},He.dialog.buttons.NO,{text:h,className:"test-no slds-button ".concat(e)})),In(n,a,s));return _.extend({},yn,{message:n,buttons:i,showCloseButton:!0,className:m,contentClassName:t,callback:l,afterClose:function(){o&&o(),r&&r.focus()}})}var Ln=["button","input:not([type=hidden])","[tabindex]","select","textarea","a[href]","details"].join(", ");function Dn(e){return Q(e.querySelectorAll(Ln)).filter(function(e){var t=null===e.offsetParent,n=e.hasAttribute("disabled"),e=e.hasAttribute("tabindex")&&parseInt(e.getAttribute("tabindex"))<0;return!t&&!n&&!e})}function An(e){var t,n;P.KEYCODE.TAB===e.keyCode&&(t=Dn(e.currentTarget),n=e.target,n=t.indexOf(n),e.shiftKey||n!==t.length-1?e.shiftKey&&0===n&&(t[t.length-1].focus(),e.preventDefault()):(t[0].focus(),e.preventDefault()))}var kn=function(){function t(e){if(d(this,t),!e.container)throw new Error("container element missing from config");this._container=e.container,this._focusFirst=e.focusFirst,this._trapFocus=e.trapFocus}return a(t,[{key:"initialize",value:function(){var e,t;return this._trapFocus&&this._container.addEventListener("keydown",An),this._focusFirst&&(e=this._container,t=Dn(e))&&0<t.length&&setTimeout(function(){t[0].focus()},0),this}}]),t}(),Nn=_.template('<div class="cb-Dialog_header {{= title  ? "" : "cb-Dialog_header--empty" }}">\n        <div class="cb-Dialog_title js-dialog-title" title="{{- title }}">{{= title }}</div>\n        {{ if (typeof subTitle !== "undefined") { }}\n            <div class="cb-Dialog_subtitle js-dialog-subtitle">{{= subTitle }}</div>\n        {{ } }}\n    </div>\n    <div class="cb-Dialog_content js-dialog-message {{= contentClass }}">{{= content }}</div>\n    {{ if (typeof checkbox !== "undefined") { }}\n        <div class="cb-Dialog_suppressCheckbox cb-Dialog_checkbox__center">\n            <div class="slds-checkbox">\n                <input type="checkbox" name="options" id="js-dialog-checkbox" class="js-checkbox" />\n                <label class="slds-checkbox__label" for="js-dialog-checkbox">\n                    <span class="slds-checkbox_faux"></span>\n                    <span class="slds-form-element__label">{{= checkbox.label }}</span>\n                </label>\n            </div>\n        </div>\n    {{ } }}');function xn(e,t,n){return n=n||{},T.extend({},yn,{message:e,buttons:[T.extend({},He.dialog.buttons.YES,{text:n.yesText||PicassoWebServices.Labels.PicassoDialog.Ok,className:n.yesTextClassName||"slds-button slds-button_brand test-yes"}),T.extend({},He.dialog.buttons.NO,{text:n.noText||PicassoWebServices.Labels.PicassoDialog.Cancel,className:n.noTextClassName||"slds-button slds-button_neutral test-no"})],callback:t,className:"slds-vex-theme slds-vex-theme--medium js-slds-confirm",contentClassName:"cb-Dialog js-dialog js-dialog-confirm",afterClose:function(){n.afterClose&&n.afterClose(),n.afterCloseFocusEl&&n.afterCloseFocusEl.focus()}},n)}function Rn(e,t){var n,i,s="slds-vex-theme slds-vex-theme--medium js-slds-alert",a="cb-Dialog js-dialog js-dialog-confirm";return(t=t||{}).className=t.className?t.className+" "+s:s,t.contentClassName=t.contentClassName?t.contentClassName+" "+a:a,n=(n=t)||{},T.extend({},yn,{message:e,buttons:[T.extend({},He.dialog.buttons.YES,{text:n.yesText||PicassoWebServices.Labels.PicassoDialog.Ok,className:n.yesTextClassName||"slds-button slds-button_brand"})],callback:i},n,{afterClose:function(){n.afterClose&&n.afterClose(),n.afterCloseFocusEl&&n.afterCloseFocusEl.focus()}})}function jn(e){e.attr("tabindex",0),setTimeout(function(){e.focus()},0)}function Bn(e){var t;e.find(".vex-close").append('<span class="slds-assistive-text">'+PicassoWebServices.Labels.PicassoDialog.Close+"</span>"),new kn({container:e[0],focusFirst:!1,trapFocus:!0}).initialize(),t=(e=e).data().vex,e=e.find(".vex-last"),t&&t.$closeButton&&t.$closeButton.is(":visible")?(jn(t.$closeButton),t.$closeButton.on("keydown",function(e){P.KEYCODE.ENTER===e.keyCode&&He.close(t.id)})):e.length&&jn(e)}var On,Mn,A={showDialogAdvanced:function(e){e=e||{};var t=_.assign({},yn,e,{afterClose:function(){e.afterClose&&e.afterClose(),e.afterCloseFocusEl&&e.afterCloseFocusEl.focus()}}),n=He.open(t);return t.a11y&&Bn(n),n},showDialog:function(e,t){t=t||{};var n=T.extend({},yn,{content:e.render().$el,beforeClose:function(){e.beforeClose&&e.beforeClose()},afterClose:function(){e.destroy&&e.destroy(),t.afterClose&&t.afterClose(),t.afterCloseFocusEl&&t.afterCloseFocusEl.focus()}},t),i=He.open(n);return n.a11y&&Bn(i),i},closeDialog:function(){return He.close()},closeDialogById:function(e){return He.closeByID(e)},sldsAlert:function(e,t,n){t=T(Nn({title:t,content:e,contentClass:"",checkbox:n&&n.checkbox})),n&&n.checkbox&&n.checkbox.callback&&(n.callback=function(){return T(".cb-Dialog_suppressCheckbox .js-checkbox").is(":checked")&&setTimeout(n.checkbox.callback(),0),!0}),n=Rn(t,n),e=He.dialog.alert(n);return n.a11y&&Bn(e),e},sldsConfirm:function(e,t,n,i){i=xn(T(Nn({title:t,content:e,contentClass:""})),n,i);t=He.dialog.confirm(i);return i.a11y&&Bn(t),t},sldsPromptConfirm:function(e){e.isConfirmPrompt=!0;e=En(e),e=He.dialog.confirm(e);return Bn(e),e},sldsPromptAlert:function(e){e=En(e),e=He.dialog.alert(e);return Bn(e),e},sldsModal:function(e){var e=wn(e),t=He.dialog.confirm(e);return t[0].addEventListener("toggle-button-enabled-state",function(e){e.stopPropagation();e=!!e.detail.enabled;t.find(".js-slds-modal-yes").prop("disabled",!e)}),Bn(t),t},confirmChoice:function(e,t,n,i){var s=[],a=(i&&i.hero&&s.push(i.hero),_.each(t,function(e){s.push(D.visualPicker(e))}),T(Nn({title:e,subTitle:i.subTitle,content:s.join(""),contentClass:"slds-text-align_center"})));return He.dialog.confirm(xn(a,function(e){var t=a.find("input:radio[name=options]:checked").val();n(e,t)},i))},isDialogOpen:function(){return 0<T(".cb-Dialog").length},hideCloseButton:function(){T(".vex-close").hide()},_formatMessage:function(e,t){var n="";return t&&(n+='<div class="cb-DialogPrompt-title js-dialog-title">'+t+"</div>"),e&&(n+='<div class="cb-DialogPrompt-message js-dialog-message">'+e+"</div>"),n}},Vn={isMobileExperienceEnabled:function(){return I.AccessControl(P.PERMISSIONS.MOBILE_WORKSPACE)},isResponsiveCmpVisibilityEnabled:function(){return I.AccessControl(P.PERMISSIONS.RESPONSIVE_COMPONENT_VISIBILITY)}},$n="state:aura-component-updated",Un="state:content-area-component-audience-updated",Wn="state:component-style-updated",Fn=PicassoWebServices.Labels.ExpressionBasedVariations,Hn=PicassoWebServices.Labels.ExpressionBasedVariationsVisibilityErrors,Gn={},zn=new _n;function Kn(e){I.AccessControl(P.PERMISSIONS.LWC_PROPERTY_SHEET,e)}function Yn(){var e=I.getAppState().getCurrentViewId();I.event.trigger("action:sync-view-publish-state",{id:e})}function qn(e,t){var t=t?t.ContentRegionComponentAudienceTargetInfos:null,n=On[e];n||(n=new Ct,On[e]=n),n.reset(t)}function Xn(e){var t=e.componentId,n=e.successCallback;f.getCanvasComponentsForViewAsync(I.getAppState().getCurrentViewId(),function(){n(),I.event.trigger("state:aura-component-created",t)},!0)}function Jn(e){var t=e.viewId,n=e.successCallback;Kn(function(){zn.fetch({viewId:t,force:!0,successCallback:n})})}function Qn(t,n){var e=I.getAppState().getCurrentPageId();PicassoWebServices.CommComponent.GetCurrentComponentAudienceTargetInfosForView(e,t,function(e){qn(t,e),n&&n()})}function Zn(e){var t,n=e.componentId,i=e.shouldRefreshComponent;I.AccessControl(P.PERMISSIONS.STYLE_PROPERTIES)&&((t=(e=zn.get(n)).get("properties").componentStyleProperties)&&I.event.trigger(Wn,{componentId:n,styleProperties:JSON.parse(t),shouldRefreshComponent:i}),e.getChildren().forEach(function(e){Zn({componentId:e,shouldRefreshComponent:i})}))}function ei(e,t,n){e.Errors?(null==e?void 0:e.ErrorCode)===P.VARIATION_ERROR_TYPE.BAD_REQUEST?t.handleInlineVariationError(!0,e.Errors):w.error({message:e.Errors||Hn.GenericApiError,duration:w.DURATION_MEDIUM,canDismiss:!0}):n()}function ti(e){if(e){var t,n=JSON.parse(e),i=f.getStylePropertiesDefinition();for(t in n)if(i[t].cssPropertyDefinitions)for(var s=Object.values(n[t]),a=0;a<s.length;a++)if(s[a])return!0}return!1}ve(function(e){var t=e.viewId;Kn(function(){return zn.fetch({viewId:t,force:!0})}),e.StylePropertiesDefinition&&(Mn=e.StylePropertiesDefinition)}),On={},fe()[P.AUDIENCE_TARGET_NAME.COMPONENT]=On,f.getContainingViewOrThemeLayoutId=function(e){var t=I.getAppState().getCurrentViewId();return function(e,t){var n=Gn[e];if(n)for(var i=0;i<n.length;++i){var s=n[i];if(pn({viewRegions:[s],componentId:t}))return s.isThemeRegion}}(t,e)?S.getThemeLayoutByViewId(t).themeLayoutId:t},f.getAudienceTargetInfoForComponent=function(e,t){var n,e=On[e];return n=e?un(e,t):n},f.getCanvasComponentsForViewAsync=function(t,n,e){Gn[t]&&!e?n(JSON.parse(JSON.stringify(Gn[t]))):(I.getAppState().isCurrentPageAura()&&I.getAppState().supportViewCrud()||E.getSite().isWebApp()?PicassoWebServices.CommPage.GetComponentStuctureOnCanvas:PicassoWebServices.ManageSiteCommon.GetAllComponentsOnCanvas)(t,function(e){Gn[t]=e,n(JSON.parse(JSON.stringify(e)))})},f.getRichContentEditorAttributes=function(e,t,n){PicassoWebServices.CommComponent.GetRichContentEditorAttributes(t,e,function(e){n(e)})},f.getComponentVariationsByPriority=function(e,t,n){PicassoWebServices.CommComponent.GetVariationsByPriority(t,e,function(e){null!=e&&e.Errors?A.sldsPromptAlert({title:PicassoWebServices.Labels.PicassoDialog.Error,content:e.Errors}):n(e.VariationPriorityList)})},f.triggerReorderVariationPriorityState=function(e,t,n){gi(e,t,n)},f.getPageComponents=function(){return zn},f.doesViewHavePrioritizedComponentsPromise=function(e){var t=T.Deferred();function n(e,t){for(var n=0;n<e.length;++n){var i=e[n];if(!i.isThemeRegion&&i.components)for(var s=0;s<i.components.length;++s){var a=i.components[s];a.priority&&"NEUTRAL"!==a.priority&&t.resolve(!0)}}t.reject()}return Gn[e]?n(Gn[e],t):this.getCanvasComponentsForViewAsync(e,function(e){n(e,t)}),t.promise()},f.hasComponentsWithVisibilityAudience=function(e){e=On[e];return!!e&&e.find(function(e){return!e.get("hasCmpAttributeVariation")})},f.hasComponentsWithAttributeVariationAudience=function(e){e=On[e];return!!e&&e.find(function(e){return e.get("hasCmpAttributeVariation")})},f.getComponentAudienceTargetInfosForViewPromise=function(e){var t=T.Deferred();return On[e]?t.resolve():Qn(e,function(){t.resolve()}),t.promise()},f.getStylePropertiesDefinition=function(){return Mn},f.hasResponsiveVisibilityHiddenComponents=function(){var e=I.getAppState().getCurrentViewId();return zn.getComponentsForView(e).some(function(e){e=e.get("properties").componentStyleProperties;if(e&&!1===JSON.parse(e).isVisible)return!0;return!1})},I.event.on("action:create-aura-component",function(e){var t=e.data,n=e.successCallback,i=e.errorCallback,e=t.argument,s=f.getContainingViewOrThemeLayoutId(t.container);PicassoWebServices.ManageSiteCommon.DropItem(t.type,e.properties.fqn,t.container,t.beforeId,"0","0","0","0",s,function(e){var t;y.processUndoRedoResponse(e),e.LastWarning?i(e):(t=e.CurrentItemID)&&(Jn({viewId:s,successCallback:Zn.bind(this,{componentId:t,shouldRefreshComponent:!1})}),Yn(),Xn({componentId:t,successCallback:n.bind(this,e)}))})}),I.event.on("action:delete-aura-component",function(e){var t=e.itemId,s=e.options||{},a=e.successCallback,e=f.getContainingViewOrThemeLayoutId(t);PicassoWebServices.ManageSiteCommon.DeleteItem(t,e,function(e){y.processUndoRedoResponse(e);var t,n,i=e.DeletedItemID;i&&(s.shouldRemoveFromCache&&I.event.trigger("action:remove-component-error",{fqn:s.fqn}),n=i,Kn(function(){zn.doRemove(n)}),a(e),Yn(),(t=e.ChildAuraComponents||[]).push(i),I.event.trigger("state:aura-component-deleted",t)),"lastSection"===e.Errors&&A.sldsPromptAlert({title:PicassoWebServices.Labels.ManageSite.CannotDeleteSectionTitle,content:PicassoWebServices.Labels.ManageSite.CannotDeleteSection,headerClass:"cb-Dialog_header--info",yesTextClassName:"slds-button slds-button_neutral",yesText:PicassoWebServices.Labels.PicassoDialog.GotIt})})}),I.event.on("action:move-aura-component",function(e){var t=e.data||{},d=e.successCallback,n=e.errorCallback,e=t.item,l=t.container,u=t.beforeId,p=zn.get(e),g=null==p?void 0:p.isVariation(),h=g?null==p?void 0:p.getParent():e,m=f.getContainingViewOrThemeLayoutId(h),v=f.getContainingViewOrThemeLayoutId(l);PicassoWebServices.ManageSiteCommon.MoveItem(h,l,u,"","",m,v,function(c){var a,e,i,s,o,r;y.processUndoRedoResponse(c),c.LastWarning?n(c):(a=g?null==p||null==(e=p.attributes)?void 0:e.id:c.CurrentItemID)&&(i=h,s=l,o=u,r=T.Deferred(),Kn(function(){var e=zn.get(i),t=zn.get(s),n=zn.get(e.getParent());t.isInThemeRegion()!==n.isInThemeRegion()?zn.fetch({viewId:I.getAppState().getCurrentViewId(),force:!0,successCallback:function(){r.resolve(!0)}}):(n.removeChildren(i),e.setParent(s),t.insertChild(i,o),r.resolve(!1))}),I.AccessControl(P.PERMISSIONS.LWC_PROPERTY_SHEET)||r.resolve(!1),e=r.promise(),T.when(e).then(function(e){var t,n,i,s,a,o,r,l;return d(c),I.AccessControl(P.PERMISSIONS.VISIBILITY_PROPERTIES)?Promise.all([(s=v,a=c.ExprVariationsRules,o=c.VariationsChildComponentsExprVisibilityRules,r=e,l=T.Deferred(),I.AccessControl(P.PERMISSIONS.VARIATIONS_PROPERTIES)&&a?PicassoWebServices.CommComponent.MoveVariations(s,a,o,function(e){e.Errors&&A.sldsPromptAlert({content:e.Errors,title:e.LastWarningTitle,headerClass:"slds-theme_alert-texture slds-theme_info"}),r?l.resolve(!0):l.resolve(!1)}):r?l.resolve(!0):l.resolve(!1),l.promise()),(s=h,a=m,o=v,t=c.ExprVisibilityRules,n=e,i=T.Deferred(),t&&Array.isArray(t)&&t.length?PicassoWebServices.CommComponent.MoveVisibilityRules(s,a,o,t,function(e){e.Errors&&A.sldsPromptAlert({content:e.Errors,title:e.LastWarningTitle,headerClass:"slds-theme_alert-texture slds-theme_info"}),n?i.resolve(!0):i.resolve(!1)}):n?i.resolve(!0):i.resolve(!1),i.promise())]):(s=T.Deferred(),e?s.resolve(!0):s.resolve(!1),s.promise())}).done(function(e){Yn();var t,n,i=c.ChildAuraComponents||[],s=(i.push(a),i=i,t=I.getAppState().getCurrentViewId(),n=S.getThemeLayoutByViewId(t).themeLayoutId,b.filter(i,function(e){return f.getAudienceTargetInfoForComponent(t,e)||S.getAudienceTargetInfoForComponent(n,e)}));0<s.length&&Qn(I.getAppState().getCurrentViewId(),function(){b.forEach(s,function(e){I.event.trigger(Un,e)})}),I.event.trigger("state:aura-component-moved",{itemId:a,cmpsWithAudienceTargetInfo:s,shouldReloadPropertyEditor:Array.isArray(e)?e[0]:e})}.bind(this)))})}),I.event.on("action:update-aura-component",function(e){var i=e.itemId,t=e.values,s=e.eventSource,a=e.forceRefreshModel,o=f.getContainingViewOrThemeLayoutId(i);PicassoWebServices.ManageSiteCommon.SetComponentProperties(i,t,o,function(e){var t,n;y.processUndoRedoResponse(e),Yn(),t=o,n=a,Kn(function(){n&&zn.fetch({viewId:t,force:!0})}),I.event.trigger($n,{itemId:i,props:e.RuntimeValues,eventSource:s,containerId:e.ContainerId})})}),I.event.on("action:update-component-style",function(e){var s=e.componentId,t=e.componentStyleProperties,e=e.shouldRefreshPropertyPanel,a=void 0!==e&&e,e=f.getContainingViewOrThemeLayoutId(s);PicassoWebServices.CommComponent.SetComponentStyleProperties(s,e,t,function(e){var t,n,i=zn.get(s);i&&(t=i.get("properties").componentStyleProperties,n=JSON.stringify(e.StyleProperties),i=function(e,t){e=ti(e),t=ti(t);return e!==t}(t,i.get("properties").componentStyleProperties=n),t=t,n=n,t=!!Vn.isResponsiveCmpVisibilityEnabled()&&JSON.parse(t||"{}").isVisible!==JSON.parse(n).isVisible,n=i||t,t&&I.event.trigger("state:component-responsive-visibility-updated",{componentStyleProperties:e.StyleProperties,componentId:s}),I.event.trigger(Wn,{componentId:s,styleProperties:e.StyleProperties,shouldRefreshComponent:n}),a)&&I.event.trigger("state:component-unhidden")})}),I.event.on("action:update-component-custom-css-classes",function(e){var n=e.componentId,e=e.componentCustomCssClasses,t=f.getContainingViewOrThemeLayoutId(n);PicassoWebServices.CommComponent.SetComponentCustomCssClasses(n,t,e,function(e){var t=zn.get(n);t&&(t.get("properties").componentCustomCssClasses=e.CustomCssClasses,I.event.trigger("state:component-custom-css-classes-updated",n))})}),I.event.on("action:update-visibility-rule",function(e){var t=e.componentId,e=e.hasVisibilityRule;I.event.trigger("state:visibility-rule-updated",{componentId:t,hasVisibilityRule:e})}),I.event.on("action:update-personalization",function(e){var t=e.componentId,e=e.hasPersonalizationOrVariations;I.event.trigger("state:personalization-updated",{componentId:t,hasPersonalizationOrVariations:e})});ni=I,ii=f,si=PicassoWebServices.ManageSiteCommon,ai=Gn,oi=pn,ri=Yn,li=y.processUndoRedoResponse,ui=$n,ci=function(e){return di.event.trigger(ui,e)};var ni,ii,si,ai,oi,ri,li,ci,di,ui,pi=function(e){var s=e.itemId,t=e.dataProviderPropertyValue,a=e.dataProviderInfoForCache,o=e.successCallback,e=ii.getContainingViewOrThemeLayoutId(s);si.SetComponentProperties(s,t,e,function(e){li(e);var t,n=ai[ni.getAppState().getCurrentViewId()],n=oi({viewRegions:n,componentId:s}),e=(n.dataBindingInfo=Object.assign({},n.dataBindingInfo,{dataProviders:_.cloneDeep(a)}),o(),ri(),{itemId:s,props:e.RuntimeValues,containerId:e.ContainerId}),n=n.dataBindingInfo.dataProviders,n=null!=n&&n.some(function(e){return e.componentName===P.DATA_PROVIDER.PERSONALIZATION_RECOMMENDATIONS}),i=ii.getPageComponents().get(s),i=0<(null==i||null==(t=i.attributes._variations)?void 0:t.length)||(null==i||null==(t=i.attributes.properties)?void 0:t.variationName);n||i?n&&(e.hasPersonalizationOrVariations=!0):e.hasPersonalizationOrVariations=!1,ci(e)})};function gi(e,t,n,i){I.event.trigger("state:reordered-variation-priority",e,t,n,i)}(di=I).event.on("action:update-component-data-provider",function(e){pi(e)}),I.event.on("action:update-component-scoped-branding-set",function(e){var t=e.componentId,n=e.brandingSetId,i=e.successCallback,e=f.getContainingViewOrThemeLayoutId(t);PicassoWebServices.CommBranding.SetComponentScopedBrandingSet(n,t,e,function(e){y.processUndoRedoResponse(e),Yn();e=pn({viewRegions:Gn[I.getAppState().getCurrentViewId()],componentId:t}),e&&(e.scopedBrandingSetId=n),e=zn.get(t);e&&e.setScopedBrandingSetId(n),I.event.trigger("action:set-preview-scoped-branding-set",{id:n,successCallback:function(){i&&i(),I.event.trigger("state:component-scoped-branding-set-updated",{componentId:t,brandingSetId:n})}})})}),I.event.on("action:clone-aura-component",function(e){var a=e.itemId,t=e.fqn,o=e.successCallback,r=f.getContainingViewOrThemeLayoutId(a);PicassoWebServices.ManageSiteCommon.CloneAndInsertAfterItem(a,t,r,function(e){s=a,t=e.CurrentItemID,n=r,i=T.Deferred(),I.AccessControl(P.PERMISSIONS.VISIBILITY_PROPERTIES)?PicassoWebServices.CommComponent.CloneVisibilityRules(s,t,n,function(){i.resolve()}):i.resolve();var t,n,i,s=i.promise();T.when(s).done(function(){y.processUndoRedoResponse(e),Jn({viewId:r,successCallback:Zn.bind(this,{componentId:e.CurrentItemID,shouldRefreshComponent:!0})}),Yn(),Xn({componentId:a,successCallback:o.bind(this,e)})})})}),I.event.on("action:create-variation-component",function(e){var t=e.itemId,s=e.variationName,a=f.getContainingViewOrThemeLayoutId(t);PicassoWebServices.CommComponent.CloneAndInsertVariation(t,a,s,function(i){ei(i,e,function(){var e,t,n;Jn({viewId:a,successCallback:function(){Zn({componentId:i.VariationId,shouldRefreshComponent:!0})}}),e={componentId:i.VariationId,variationName:s},t=e.componentId,n=e.variationName,f.getCanvasComponentsForViewAsync(I.getAppState().getCurrentViewId(),function(){I.event.trigger("state:variation-component-created",t,n)},!0)})})}),I.event.on("action:edit-variation-name",function(t){var e=t.itemId,n=t.variationName,i=f.getContainingViewOrThemeLayoutId(e);PicassoWebServices.CommComponent.UpdateVariationName(e,i,n,function(e){ei(e,t,function(){Jn({viewId:i,successCallback:function(){I.event.trigger("state:variation-name-edited",e)}})})})}),I.event.on("action:delete-variation-component",function(e){var t=e.itemId,n=e.variationId,i=(e.successCallback,f.getContainingViewOrThemeLayoutId(t));PicassoWebServices.CommComponent.DeleteVariation(t,n,i,function(e){e.DeletedItemID?(Jn({viewId:i,successCallback:function(){I.event.trigger("state:variation-component-deleted")}}),w.success({message:Fn.DeleteVariationComponentSuccessful,duration:w.DURATION_MEDIUM,canDismiss:!0})):w.error({message:Fn.DeleteVariationComponentFailure,duration:w.DURATION_MEDIUM,canDismiss:!0})})}),I.event.on("action:update-aura-component-visibility",function(t){var e=t.itemId,n={"system:IsVisible":t.isVisible},i=f.getContainingViewOrThemeLayoutId(e);PicassoWebServices.ManageSiteCommon.SetComponentProperties(e,n,i,function(e){y.processUndoRedoResponse(e),Yn(),I.event.trigger("state:aura-component-visibility-updated",t,e.RuntimeValues)})}),I.event.on("action:unassign-content-area-component-audience",function(e){var t=e.entityId,n=e.viewId,i=e.spaPageId,s=e.componentId;PicassoWebServices.CommComponent.RemoveAudienceForComponent(t,i,n,s,function(e){y.processUndoRedoResponse(e),qn(n,e),I.event.trigger(Un,s)})}),I.event.on("action:sync-content-area-component-audience",function(e){var t=e.viewId,n=e.componentId;Qn(t,function(){I.event.trigger(Un,n)})}),I.event.on("action:launch-head-markup-editor",function(){o.trigger("launch-head-markup-editor")}),I.event.on("action:initialize-property-editor",function(){I.event.trigger("state:property-editor-initialized")}),I.event.on("state:view-properties-updated",function(e,t){t.invalidateContentAreaAudienceTargetInfos&&Qn(e,function(){I.event.trigger("state:content-area-component-audiences-updated")}),Kn(function(){zn.fetch({viewId:e,force:!0})})}),I.event.on("state:theme-layout-updated",function(e,t){t&&Kn(function(){var e=I.getAppState().getCurrentViewId();zn.fetch({viewId:e,force:!0})})}),I.event.on("state:current-theme-updated",function(){Kn(function(){var e=I.getAppState().getCurrentViewId();zn.fetch({viewId:e,force:!0})})}),be(function(e,t){return Qn(I.getAppState().getCurrentViewId(),function(){Yn();var e=t&&t.DeletedItemID;e&&I.event.trigger(Un,e),I.event.trigger("state:aura-component-undo-redo",e)}),!0},"component"),I.event.on("action:reorder-variation-priority",function(t){var e;t.isValidMove?(e=f.getContainingViewOrThemeLayoutId(t.baseComponentId),PicassoWebServices.CommComponent.ReorderVariationPriority(e,t.baseComponentId,t.itemId,t.insertBeforeId,function(e){null!=e&&e.Errors?t.errorCallback&&t.errorCallback():gi(t.parentEvt,!0,e.VariationPriorityList,t.itemId)})):gi(t.parentEvt,!0,null)});var hi=[P.FQNS.FLEXIBLE_LAYOUT_AURA,P.FQNS.FLEXIBLE_LAYOUT_LWC],mi=[P.FQNS.SECTION,P.FQNS.SECTION_LWC];var vi={isFlexibleLayout:function(e){return hi.includes(e)},isSectionComponent:function(e){return mi.includes(e)}},r=P.PROP,bi=/^[^\\\/\'\"\<\>\&]+$/i,fi=["/cdn-cgi","/lo","/lwr","/lwr-info","/mobify","/mrt","/services","/sfsites"],_i=["/assets","/webruntime"],Si=[],Ci=["/styles","/projRes","/js","/slds","/cometd","/faces","/js","/img","/dimg","/css","/scss"],yi=["/main","/login","/checkpasswordresetemail","/forgotpassword","/selfregister","/sfdcpage"],Ti=[];function Pi(t,e,n){var i=e.toLowerCase();return h.getRoutes().find(function(e){return e.get(r.ROUTE_PAGE_ID_KEY)===n&&e.get(t).toLowerCase()===i})}var Ii,k={sortRouteViewsByAudience:function(s){return h.getRoutes().get(s).getViews().sort(function(e,t){var n=h.getAudienceTargetInfoForView(s,e.id),i=h.getAudienceTargetInfoForView(s,t.id);return null==n&&null==i?e.get(r.NAME_KEY).localeCompare(t.get(r.NAME_KEY)):null==n&&null!=i?1:null!=n&&null==i?-1:n.isDefault()?1:i.isDefault()?-1:0==(n=n.get("groupPriority")-i.get("groupPriority"))?e.get(r.NAME_KEY).localeCompare(t.get(r.NAME_KEY)):n})},getComponentInfoAsync:function(t,n){f.getCanvasComponentsForViewAsync(I.getAppState().getCurrentViewId(),function(e){n(pn({viewRegions:e,componentId:t}))})},getComponentDataProviderAsync:function(t,n){f.getCanvasComponentsForViewAsync(I.getAppState().getCurrentViewId(),function(e){n(mn(e,t))})},getComponentDataProviderPromise:function(e){var t=T.Deferred();return this.getComponentDataProviderAsync(e,function(e){t.resolve(e)}),t.promise()},getComponentVisibilityInfoAsync:function(s,a){f.getCanvasComponentsForViewAsync(I.getAppState().getCurrentViewId(),function(e){var t,e=function e(t,n,i){for(var s=0;s<t.length;s++){var a=t[s],o=gn(a);if(a.id===n)return i;if(0<o.length&&(o=e(o,n,a)))return o}return null}(e,s,null),n=gn(e),i=null;0<n.length&&(t=_.findIndex(n,function(e){return e.id===s}),i=(n=_.find(n,function(e){return!0===e.isVisible},t+1))?n.id:null),a({beforeId:i,parentId:e.id})})},getHiddenComponentCount:function(e){var n=0;return _.each(e,function(e){var t=gn(e);!1===e.isVisible&&n++,e.isThemeRegion&&t.forEach(function(e){e.isVisible=void 0}),n+=this.getHiddenComponentCount(t)}.bind(this)),n},hasResponsiveVisibilityHiddenComponents:function(e){return _.some(e,function(e){return!1===e.isVisibleInLwr||0<(e=gn(e)).length&&this.hasResponsiveVisibilityHiddenComponents(e)}.bind(this))},sortRouteViewsByName:function(e){return e.getViews().sort(function(e,t){return e.get(r.NAME_KEY).localeCompare(t.get(r.NAME_KEY))})},getDefaultViewIdForRoute:function(e){return h.getRoutes().get(e).getViewId()||this.sortRouteViewsByAudience(e)[0].id},getFullUrlForRoute:function(e){e=h.getRoutes().get(e);return e?e.get(r.ROUTE_URL_KEY):""},getActiveViewForRoute:function(e){var t;return t=e&&(e=h.getRoutes().get(e))?h.getViews().get(e.getViewId()):t},getHomePageHomeRoute:function(){return h.getRoutes().find(function(e){return this.isHomePageHomeRoute(e)}.bind(this))},getHomePageErrorRoute:function(){return h.getRoutes().find(function(e){return this.isHomePageErrorRoute(e)}.bind(this))},getPageRouteByUrl:function(e,t){return Pi(r.ROUTE_URL_KEY,e,t)},getPageRouteByDevName:function(e,t){return Pi(r.DEV_NAME_KEY,e,t)},isHomePageHomeRoute:function(e){return e.get(r.ROUTE_URL_KEY)===P.ROUTE.HOME_ROUTE_URL&&e.get(r.ROUTE_PAGE_ID_KEY)===E.getSite().get("homepage")},isHomePageErrorRoute:function(e){return e.get(r.ROUTE_URL_KEY)===P.ROUTE.ERROR_ROUTE_URL&&e.get(r.ROUTE_PAGE_ID_KEY)===E.getSite().get("homepage")},isReservedUrl:function(e){var e=e.toLowerCase(),t=I.getAppState().getCurrentSite().isWebApp(),n=t?_i:Si;if(e.split(/[/()]/).some(function(e){return-1<fi.indexOf("/".concat(e))||-1<n.indexOf("/".concat(e))}))return!0;if(-1<(t?Ti:yi).indexOf(e))return!0;if(e==="/"+h.getPages().get(E.getSite().get("homepage")).get(r.NAME_KEY).toLowerCase())return!0;t=E.getSite().get("loginpage");if(t&&e==="/"+h.getPages().get(t).get(r.NAME_KEY).toLowerCase())return!0;return!!I.getAppState().getCurrentSite().isNotPrefixedWithSlashS()&&("/s"===e||-1<Ci.indexOf(e))},isRouteUrlInUse:function(t){var n;return!!this.isReservedUrl(t)||h.getRoutes().some(function(e){if(((n=e.get(r.ROUTE_PAGE_ID_KEY))===E.getSite().get("homepage")||n===E.getSite().get("loginpage"))&&e.get(r.ROUTE_URL_KEY).toLowerCase()===t.toLowerCase())return!0})},isSegmentValidForRoute:function(t,e){var n="".concat(t.get(r.PARENT_URL_KEY),"/").concat(e);return t.getRouteSegment().toLowerCase()==="/".concat(e).toLowerCase()||!(this.isRouteUrlInUse(n)||h.getRoutes().some(function(e){return e.get(r.PARENT_ID_KEY)===t.id})&&this.isBaseUrlSegmentInUseAmongSiblings(t,"/".concat(e)))},isBaseUrlSegmentInUseAmongSiblings:function(t,n){return h.getRoutes().filter(function(e){return e.id!==t.id&&e.get(r.PARENT_ID_KEY)===t.get(r.PARENT_ID_KEY)&&C.urlRequiresParameter(e.get(r.ROUTE_URL_KEY))}).some(function(e){return e.getRouteBaseSegment()===n})},isBaseUrlValidForRoute:function(e,t){var n="".concat(e.get(r.PARENT_URL_KEY),"/").concat(t);return e.getRouteBaseSegment().toLowerCase()==="/".concat(t).toLowerCase()||!this.doesRouteWithBaseUrlExist(n)&&!this.getRouteSiblingsWithChildren(e.get(r.PARENT_ID_KEY),e.id).some(function(e){return e.getRouteSegment()==="/".concat(t)})},getRouteSiblingsWithChildren:function(t,n){return h.getRoutes().filter(function(e){return e.get(r.PARENT_ID_KEY)===t&&e.id!==n}).filter(function(t){return h.getRoutes().some(function(e){return e.get(r.PARENT_ID_KEY)===t.id})})},getAllRouteDescendants:function(t){var n=this,e=h.getRoutes().filter(function(e){return e.get(r.PARENT_ID_KEY)===t});return 0===e.length?[]:e.reduce(function(e,t){return[].concat(Q(e),Q(n.getAllRouteDescendants(t.id)))},e)},doesRouteWithBaseUrlExist:function(t){var n;return!!this.isReservedUrl(t)||("/"!==t.slice(-1)&&(t+="/"),h.getRoutes().some(function(e){if(((n=e.get(r.ROUTE_PAGE_ID_KEY))===E.getSite().get("homepage")||n===E.getSite().get("loginpage"))&&(e.isObjectRoute()||C.urlRequiresParameter(e.get(r.ROUTE_URL_KEY)))&&0===e.get(r.PARENT_URL_KEY).concat(e.getRouteBaseSegment()).concat("/").toLowerCase().indexOf(t.toLowerCase()))return!0}))},isNameForViewUnique:function(t,e,n){var i=e.toLowerCase();return!h.getViews().some(function(e){if(t===e.get("ViewPageID")&&i===e.get(r.NAME_KEY).toLowerCase()&&(!n||e.id!==n))return!0})},isNameForRouteUnique:function(t,e,n){var i=e.toLowerCase();return!h.getRoutes().some(function(e){if(t===e.get(r.ROUTE_PAGE_ID_KEY)&&i===e.get(r.NAME_KEY).toLowerCase()&&(!n||e.id!==n))return!0})},isOOTBTemplate:function(){var e=I.getAppState().getHomePageTemplateMetadata();return e&&e.isOOTB},isNapiliBasedTemplate:function(){var e=I.getAppState().getHomePageTemplate();return _.isUndefined(e)?null:e.get("AuraAppName")===$P.cbMetadata.templateAuraAppNames.Napili},isCommunityBasedTemplate:function(){var e=I.getAppState().getHomePageTemplate();return _.isUndefined(e)?null:e.get("AuraAppName")===$P.cbMetadata.templateAuraAppNames.Community},isLwrBasedTemplate:function(){return E.getSite().isWebApp()},isKoaKokuaTemplate:function(){var e=I.getAppState().getHomePageTemplate();return _.isUndefined(e)?null:(e=e.get("AuraAppName"))===$P.cbMetadata.templateAuraAppNames.Koa||e===$P.cbMetadata.templateAuraAppNames.Kokua},isDataRoute:function(e){return 0<=h.getRoutes().get(e).get(r.ROUTE_URL_KEY).indexOf(":")},isExportedRouteType:function(e){return""===e},isObjectDetailRouteType:function(e){return e&&e.match(P.ROUTE.DETAIL_VIEW_TYPE_REGEXP)},isObjectListRouteType:function(e){return e&&e.match(P.ROUTE.LIST_VIEW_TYPE_REGEXP)},isObjectRelatedListRouteType:function(e){return e&&e.match(P.ROUTE.RELATED_LIST_VIEW_TYPE_REGEXP)},isObjectRouteType:function(e){return this.isObjectDetailRouteType(e)||this.isObjectListRouteType(e)||this.isObjectRelatedListRouteType(e)},isExtObjectRouteType:function(e){return e&&e.match(P.ROUTE.EXT_DETAIL_VIEW_TYPE_REGEXP)},isGenericObjectDetailRouteType:function(e){return e===P.ROUTE.GENERIC_DETAIL_VIEW_TYPE},isGenericObjectListRouteType:function(e){return e===P.ROUTE.GENERIC_LIST_VIEW_TYPE},isGenericObjectRelatedListRouteType:function(e){return e===P.ROUTE.GENERIC_RELATED_LIST_VIEW_TYPE},isGenericObjectRouteType:function(e){return this.isGenericObjectDetailRouteType(e)||this.isGenericObjectListRouteType(e)||this.isGenericObjectRelatedListRouteType(e)},isManagedContentRouteType:function(e){return e&&e.match(P.ROUTE.MANAGED_CONTENT_VIEW_TYPE_REGEXP)},isCommerceProductListRouteType:function(e){return e&&(e.match(P.ROUTE.SEARCH_VIEW_TYPE_REGEXP)||e.match(P.ROUTE.CATEGORY_VIEW_TYPE_REGEXP))},getMatchingGenericDataRouteType:function(e){return this.isObjectDetailRouteType(e)&&P.ROUTE.GENERIC_DETAIL_VIEW_TYPE||this.isObjectListRouteType(e)&&P.ROUTE.GENERIC_LIST_VIEW_TYPE||this.isObjectRelatedListRouteType(e)&&P.ROUTE.GENERIC_RELATED_LIST_VIEW_TYPE||void 0},getKeyPrefixFromObjectRouteType:function(e){return e&&(e.match(P.ROUTE.DETAIL_VIEW_TYPE_REGEXP)&&e.replace(P.ROUTE.DETAIL_VIEW_TYPE_REGEXP,"$1")||e.match(P.ROUTE.LIST_VIEW_TYPE_REGEXP)&&e.replace(P.ROUTE.LIST_VIEW_TYPE_REGEXP,"$1")||e.match(P.ROUTE.RELATED_LIST_VIEW_TYPE_REGEXP)&&e.replace(P.ROUTE.RELATED_LIST_VIEW_TYPE_REGEXP,"$1")||void 0)||void 0},isValidName:function(e){return bi.test(e)},syncPublishStatePromise:function(e){var t=T.Deferred();return I.event.trigger("action:sync-view-publish-state",{id:e,successCallback:function(){t.resolve()}}),t.promise()},syncAudienceTargetInfosPromise:function(e){var t=T.Deferred();return I.event.trigger("action:sync-page-audience-target-infos",{routeId:e,successCallback:function(){t.resolve()}}),t.promise()},getViewsForThemeLayoutType:function(t){return h.getViews().filter(function(e){return e.get(r.THEME_LAYOUT_TYPE_KEY)===t})},hasComponentsWithAudiencePromise:function(e,t){var n=T.Deferred();return PicassoWebServices.CommPage.HasComponentsWithAudience(e,t,function(e){n.resolve(e)}),n.promise()},hasDynamicLayout:function(e){e=h.getViews().get(e).get("AuraTag");return vi.isFlexibleLayout(e)},getFlattenedImmediateChildren:function(e){return _.reduce(e,function(e,t){t=gn(t);return _.isEmpty(t)?e:e.concat(t)},[])},getFlattenedChildren:function(e){e=this.getFlattenedImmediateChildren(e);return e.concat(_.reduce(e,function(e,t){t=gn(t);return _.isEmpty(t)?e:e.concat(t,this.getFlattenedChildren(t))}.bind(this),[]))},getRegionContents:gn},t=Fe.Model.extend({isCommunityPublic:function(){return this.get("CommunityPublic")},isWebApp:function(){return this.get("isWebApp")},isInCmsStore:function(){return this.get("isInCmsStore")},isMigratedToGtagAnalytics:function(){return this.get("isMigratedToGtagAnalytics")},getDefaultThemeLayoutType:function(){return"Inner"},isProgressiveRenderingEnabled:function(){return this.get("isProgressiveRenderingEnabled")},setProgressiveRenderingEnabled:function(e){this.set("isProgressiveRenderingEnabled",e)},setCommunityLiveSiteUrl:function(e){this.set("communityLiveSiteUrl",e)},isCookieConsentEnabled:function(){return this.get("isCookieConsent")},isNotPrefixedWithSlashS:function(){return this.get("isNotPrefixedWithSlashS")},getMaxNumSiteLanguages:function(){return this.get("maxNumSiteLanguages")},parse:function(e){return(e=e.Values?e.Values:e).RestrictedIPsEnabled&&(e.RestrictedIPsEnabled="true"===e.RestrictedIPsEnabled),st.parseResult(e,e.CustomProperties),e},getCustomProperties:function(){return this.get("CPs")}}),Ei="state:site-preferred-domain-updated",wi=new t,Li=(E.getSite=function(){return wi},ve(function(e){e.CurrentSite&&wi.set(wi.parse(e.CurrentSite)),e.ComplianceBannerInfo&&(Ii=e.ComplianceBannerInfo)}),E.getComplianceBannerInfo=function(){return Ii},E.getChangeHistoryPromise=function(){var t=T.Deferred();return PicassoWebServices.ManageSiteCommon.GetAllChangelists(function(e){t.resolve(e)}),t.promise()},E.getDomainsPromise=function(){var t=T.Deferred();return PicassoWebServices.ManageSiteCommon.GetDomains(function(e){t.resolve(e.domains)}),t.promise()},E.hasCloudflareDomainPromise=function(){var t=T.Deferred();return PicassoWebServices.ManageSiteCommon.HasCloudflareDomain(function(e){e.communityLiveSiteUrl&&wi.setCommunityLiveSiteUrl(e.communityLiveSiteUrl),t.resolve(e)}),t.promise()},I.event.on("action:update-site-property",function(e){var t=e.name,n=e.value,i=e.successCallback,s=I.getAppState().getCurrentSite();PicassoWebServices.ManageSiteCommon.UpdateProperty(s.id,t,n,function(e){y.hasProcessedErrorInResults(e)||("CookieConsentEnabled"===t?s.set("isCookieConsent",n):s.set(t,n),I.event.trigger("state:site-property-updated",t,n),i&&i(e))})}),I.event.on("action:update-community-privacy",function(e){var t=e.value,n=e.successCallback,i=I.getAppState().getCurrentSite();PicassoWebServices.ManageSiteCommon.UpdateCommunityPrivacy(t,function(e){y.hasProcessedErrorInResults(e)||(i.set("CommunityPublic",t),k.getHomePageErrorRoute().set("AuthorizationState","UseParent"),I.event.trigger("state:community-privacy-updated",t),n&&n(e))})}),I.event.on("action:update-site-preferred-domain-id",function(e){var t=e.PreferredDomainId;wi.get("isInCmsStore")?PicassoWebServices.ManageSiteCommon.SetPreferredCustomUrl(t,function(e){I.event.trigger(Ei,t)}):PicassoWebServices.ManageSiteCommon.SetComponentProperties(wi.id,{PreferredDomainId:t},wi.id,function(e){I.event.trigger(Ei,t)})}),[]),Di=!1,Ai=!1,ki=!1;function Ni(t){var e=b.find(Li,function(e){return e.devName===t});if(e)return e;throw new Error("Invalid upgrade key provided: "+t)}Qe.fetchAllUpgradeFlows=function(){PicassoWebServices.CommCore.GetUpgrades(["Branding"],function(e){e.UpgradeFlows&&(Ai=e.UpgradeFlows[0].needsUpgrade,ki=!0,I.event.trigger("state:branding-upgradeflow-sync")),PicassoWebServices.CommCore.GetAllUpgrades(function(e){e.UpgradeFlows&&(Li=e.UpgradeFlows),Di=!0,I.event.trigger("state:upgradeflows-loaded")})})},Qe.needsUpgrade=function(){return 0<Li.filter(function(e){return e.needsUpgrade}).length},Qe.isAllUpgradeFlowsFetched=function(){return Di},Qe.isUpgradeNeeded=function(e){return Ni(e).needsUpgrade},Qe.getComponentsToUpgrade=function(e){return Ni(e).components},Qe.getUpgradeFlows=function(){return Li},Qe.isBrandingUpgradeNeeded=function(){return Ai},Qe.isBrandingUpgradeFlowFetched=function(){return ki};var xi={runAndHandleFailure:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Unknown",n=1<arguments.length?arguments[1]:void 0;try{for(var e=arguments.length,i=new Array(2<e?e-2:0),s=2;s<e;s++)i[s-2]=arguments[s];return n.apply(void 0,i)}catch(e){var n=e.stack||"",a=window.location,o=a.hostname,a=a.pathname,t="Client-side error while executing migration '".concat(t,"': ").concat(e.toString());PicassoWebServices.CommUtil.ReportClientSideError(t,JSON.stringify(n),o,a),console&&console.error&&console.error(PicassoWebServices.Labels.CommBuilderClientSideMigration.MigrationErrorMessage+"\n"+e)}}},Ri=function(n,e){var i=b.clone(n);return b.each(e,function(e,t){t=b.find(n,{name:t});t&&(e=e(t.value),i=i.concat(e))}),i},ji=["_DxpPageBackgroundColor","_BackgroundColor1","_BackgroundColor2","_BackgroundColor3","_TextColor1","_TextColor2","_TextColor3","_NeutralColor","_NeutralColor1","_NeutralColor2","_NeutralColor3","_NeutralForegroundColor","_NeutralForegroundColor1","_NeutralForegroundColor2","_NeutralForegroundColor3","_PrimaryAccentColor1","_PrimaryAccentColor2","_PrimaryAccentColor3","_PrimaryAccentForegroundColor1","_PrimaryAccentForegroundColor2","_PrimaryAccentForegroundColor3"],Bi=["_DxpPageBackgroundColor","TextColor","ActionColor","OverlayTextColor"],Oi="_DxpPageBackgroundColor";function Mi(i){var s,a=!1,t=se(i.BrandingSets);try{var e=function(){var e=s.value,t=e.values,n=i.BrandingSetsDefinition[e.def];ji.some(function(e){return!t[e]})&&(!function(e,t){!function(e,t){var n,i=e.values,s=se(Bi);try{for(s.s();!(n=s.n()).done;){var a,o=n.value;i[o]||(a=function(e,t){e=e.propertyDefinitions.filter(function(e){return e.name===t});if(e&&0!==e.length)return e[0].defaultValue}(t,o),o===Oi?i[Oi]=i.PageBackgroundColor||a||"#FFFFFF":i[o]=a)}}catch(e){s.e(e)}finally{s.f()}}(e,t);var n,i=[],s=se(Bi);try{for(s.s();!(n=s.n()).done;){var a=n.value;i.push({name:a,value:e.values[a]})}}catch(e){s.e(e)}finally{s.f()}t=I.getAppState().getCurrentPageTemplate(),t=$P.cbMetadata.getColorCalc(t,e.values),t=Ri(i,t);I.event.trigger("action:update-branding-set-values",{id:e.id,values:t,eventSource:this})}(e,n),a=!0)};for(t.s();!(s=t.n()).done;)e()}catch(e){t.e(e)}finally{t.f()}return a}var Vi={doMigration:function(e){var t;return!!((t=(t=e).Pages)&&0<t.filter(function(e){return"siteforce:communityApp"===e.AuraAppName}).length)&&Mi(e)}},$i="communitySetup:audienceSelector",Ui="$#$",Wi=P.AUDIENCE_TARGET_NAME;function Fi(e){return $P.isPersonalizationEnabled?Wi.EXPERIENCE_VARIATION:e}function Hi(e,t,n,i,s,a,o){var r={networkId:I.getAppState().getNetworkId(),groupName:e,targetName:t,isAudienceEditorV2Enabled:$P.hasAudienceEditorV2Enabled,audienceActionSuccessCallback:function(e,t){e&&I.event.trigger("action:update-audience-entity",{audienceId:e,audienceName:t}),a&&a()},audienceDeleteCallback:function(e,t){e&&I.event.trigger("action:delete-audience-entity",{audienceId:e,isAudienceAssigned:t})}};n&&(r.targetValue=n,r.targetEntityName=i),s&&(r.selectedAudienceId=s),o&&(r.entityApiName=o),$P.auraRun(function(){$A.createComponent($i,r,function(e){$A.getEvt("ui:createPanel").setParams({panelType:"modal",visible:!0,owner:$A.getRoot().getGlobalId(),panelConfig:{body:e,flavor:"cbDefault, cbAudienceSelector",showCloseButton:!0,useTransition:!1,closeDialogLabel:""}}).fire()})})}function Gi(e){return"".concat(e,"_field")}function zi(e){return"".concat(e,"_subfield")}var Ki={openAudienceSelectorForBranding:function(e,t){var n,i,s,a=($P.hasCommBuilderThemingPerm?I.getAppState().getCurrentThemeId():I.getAppState().getCurrentPageId())+Ui+Wi.BRANDING,o=Fi(Wi.BRANDING);e&&(i=l.getBrandingSet(e).name,s=l.getBrandingAudienceTargetInfo(e))&&(n=s.get("audienceId")),Hi(a,o,e,i,n,t)},openAudienceSelectorForPage:function(e,t,n){var i,s,a=h.getRoutes().get(e),o=a.get(P.PROP.PAGE_ID_KEY),r=a.get(P.PROP.ROUTE_TYPE_KEY),o=o+Ui+r,l=Fi(Wi.PAGE),e=(t&&(s=h.getViews().get(t).get(P.PROP.NAME_KEY),e=h.getAudienceTargetInfoForView(e,t))&&(i=e.get("audienceId")),0===r.indexOf("detail-")?a.get("EntityAPIName"):null);Hi(o,l,t,s,i,n,e)},openAudienceSelectorForComponent:function(e,t,n,i){var s=I.getAppState().getCurrentPageId()+Ui+e+Ui+t,a=Fi(Wi.COMPONENT);k.getComponentInfoAsync(t,function(e){e=e?e.label:"";Hi(s,a,t,e,n,i)})}},Yi={"dxp_base:button":{field:"buttons",category:"buttonColor",label:PicassoWebServices.Labels.CommBuilderPropertyEditor.ButtonBrandingDeepLink},"dxp_content_layout:paginator":{field:"buttons",category:"buttonColor",label:PicassoWebServices.Labels.CommBuilderPropertyEditor.ButtonBrandingDeepLink},"dxp_action:platformActionRibbon":{field:"buttons",category:"buttonColor",label:PicassoWebServices.Labels.CommBuilderPropertyEditor.ButtonBrandingDeepLink},"commerce_builder:productAddToWishlistButton":{field:"buttons",category:"buttonColor",label:PicassoWebServices.Labels.CommBuilderPropertyEditor.ButtonBrandingDeepLink},"commerce_builder:productBundleViewAllButton":{field:"buttons",category:"buttonColor",label:PicassoWebServices.Labels.CommBuilderPropertyEditor.ButtonBrandingDeepLink},"commerce_builder:reorderButton":{field:"buttons",category:"buttonColor",label:PicassoWebServices.Labels.CommBuilderPropertyEditor.ButtonBrandingDeepLink},"commerce_builder:actionButtons":{field:"buttons",category:"buttonColor",label:PicassoWebServices.Labels.CommBuilderPropertyEditor.ButtonBrandingDeepLink},"commerce_builder:productAddToCartButton":{field:"buttons",category:"buttonColor",label:PicassoWebServices.Labels.CommBuilderPropertyEditor.ButtonBrandingDeepLink},"commerce_my_account:myAccountAddAddressButton":{field:"buttons",category:"buttonColor",label:PicassoWebServices.Labels.CommBuilderPropertyEditor.ButtonBrandingDeepLink},"dxp_content_layout:paginator2":{field:"buttons",category:"buttonColor",label:PicassoWebServices.Labels.CommBuilderPropertyEditor.ButtonBrandingDeepLink}},qi=PicassoWebServices.Labels.BrandingSectionsLWR||{},Xi=PicassoWebServices.Labels.BrandingPropertiesLWR||{},Ji=PicassoWebServices.Labels.BrandingPreviewLWR||{},Qi=PicassoWebServices.Labels.BrandingPicklistValuesLWR||{},Zi=PicassoWebServices.Labels.BrandingSectionsAura||{},es=PicassoWebServices.Labels.BrandingPropertiesAura||{},ts=PicassoWebServices.Labels.BrandingPicklistValuesAura||{},ns=function(e){return"".concat(e,"_tab")};function is(e){e=e.field,e=void 0===e?"":e;return ps()[Gi(e)]||e}function ss(e){e=e.tab,e=void 0===e?"":e;return ps()[ns(e)]||e}function as(e){e=e.subfield,e=void 0===e?"":e;return ps()[zi(e)]||e}function os(e){var t=e.id,e=e.label;return gs()[t]||e}function rs(e){e=e.id;return gs()["".concat(e,"_description")]||""}function ls(e){e=e.group;return ps()["".concat(e,"_group_description")]||""}function cs(e){return Ji["".concat(e,"_previewLabel")]||""}function ds(e){var t=e.label,e=e.config,n=e.min,i=e.max,e=e.unit,n=Number(n).toLocaleString(),i=Number(i).toLocaleString(),s=gs().slider_label||"{0} ({1}–{2}{3})";return L.format(s,t,n,i,e)}function us(e){var t,n=e.id,e=e.value;return(hs()?Qi:ts)[t=e,"".concat(n,"_").concat(t)]||e}function ps(){return hs()?qi:Zi}function gs(){return hs()?Xi:es}function hs(){return E.getSite().isWebApp()}var ms=/\{\!\$brand\.(.*?)\}/;var vs=new WeakMap,bs=new WeakMap,fs=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{value:"",expression:""},t=e.value,e=e.expression;d(this,n),ge(this,vs,{writable:!0,value:void 0}),ge(this,bs,{writable:!0,value:void 0}),re(this,vs,t),re(this,bs,e)}return a(n,[{key:"getValue",value:function(){return oe(this,vs)}},{key:"getExpression",value:function(){return oe(this,bs)}}]),n}(),_s=new(function(){function e(){d(this,e),u(this,"brandingSetToBrandMap",new Map)}return a(e,[{key:"setBrandingSetToBrandMap",value:function(e){var n=this;Object.entries(e).forEach(function(e){var e=J(e,2),t=e[0],e=e[1];return n.brandingSetToBrandMap.set(t,e)})}},{key:"resetBrandingSetToBrandMap",value:function(){this.brandingSetToBrandMap.clear()}},{key:"getResolvedBrandValueFromPropName",value:function(e){var t;return(t=this.brandingSetToBrandMap.has(e)?this.brandingSetToBrandMap.get(e):t)?new fs(t):void 0}},{key:"getResolvedBrandValueFromExpression",value:function(t){var e=Q(this.brandingSetToBrandMap.entries()).find(function(e){e=J(e,2),e[0],e=e[1];return t===e.expression});return e?new fs(e[1]):void 0}},{key:"isBrandExpression",value:function(e){return ms.test(e)}},{key:"applyBrandToBrandingSet",value:function(e){var i=this;return Object.entries(e).reduce(function(e,t){var t=J(t,2),n=t[0],t=t[1];return e[n]=null!=(n=null==(n=i.getResolvedBrandValueFromPropName(n))?void 0:n.getExpression())?n:t,e},{})}},{key:"getResolvedBrandValues",value:function(e){var i=this;return Object.entries(e).reduce(function(e,t){var t=J(t,2),n=t[0],t=t[1];return e[n]=i.isBrandExpression(t)?i.getResolvedBrandValueFromPropName(n).getValue():t,e},{})}},{key:"calculateDerivedColorProperties",value:function(n,i,s){var e=I.getAppState().getCurrentPageTemplate(),e=$P.cbMetadata.getColorCalc(e,this.getResolvedBrandValues(n)),t=Q(this.brandingSetToBrandMap.entries()).filter(function(e){var t=J(e,1)[0],e=i.find(function(e){return e.name===t});return!!e&&e.type.name===P.BRANDING_TYPE.COLOR}).map(function(e){var e=J(e,2),t=e[0],e=e[1].value;return{name:t,value:s?n[t]:e}});return Ri(t,e).reduce(function(e,t){var n=t.name,t=t.value;return!n.startsWith("_")||n in e||(e[n]=t),e},{})}},{key:"getBrandingSetToBrandMap",value:function(e,n){return new Promise(function(t){PicassoWebServices.CommBranding.GetBrandingSetToBrandMap(e,n,function(e){t(e)})})}},{key:"saveUpdatedDerivedColorProperites",value:function(n,e){var i=[];Object.entries(e).forEach(function(e){var e=J(e,2),t=e[0],e=e[1];n.values[t]!==e&&i.push({name:t,value:e})}),i.length&&I.event.trigger("action:update-branding-set-values",{id:n.id,values:i})}},{key:"getPropertiesOnReset",value:function(e,s){var a=this;return Object.entries(e).reduce(function(e,t){var t=J(t,2),n=t[0],t=t[1],i=s.find(function(e){return e.name===n});return i&&a.brandingSetToBrandMap.has(n)?e[n]=i.defaultValue:e[n]=t,e},{})}}]),e}()),Ss=/var\((.*?)\)/;function Cs(e){var t=f.getPageComponents(),e=t.get(e),n=null==e?void 0:e.getScopedBrandingSetId();return n||t.forEachAncestor(e,function(e){n=n||e.getScopedBrandingSetId()}),n}function ys(e){return Ss.test(e)}function Ts(e,t){e=k.getFlattenedChildren(e),e=_.find(e,{id:t});return null!=e&&e.fqn?$P.cbMetadata.componentBrandingMap[e.fqn]:$P.cbMetadata.componentBrandingMap[t]}function Ps(e,t,n){var i;if("string"==typeof e[n])s=[e[n]];else if(Array.isArray(e[n]))s=e[n];else if("object"===U(e[n]))return Is(t,e[n]);if(s&&(s.forEach(function(e){i=i||l.getCurrentPreviewBrandingDefProperty(e)}),i)){var e=Es(i)&&Cs(t)||I.getAppState().getCurrentPreviewSiteBrandingSetId(),n=l.getBrandingSet(e),s=i.name&&n.values[i.name];if(s)return Es(i)&&(s=function(e,t){if(N.isCssVariableReference(e))return N.resolveCssVariableReferenceInBrandingSet(e,t);if(_s.isBrandExpression(e))return _s.getResolvedBrandValueFromExpression(e).getValue();return e}(s,n)),{definition:i,value:s,labels:function(e){e=N.getParentBrandingDefProperty(e);return{label:os({id:e.name,label:e.label}),field:is({field:e.field}),subfield:as({subfield:e.subfield})}}(i)}}}function Is(n,i){var s={};return Object.keys(i).forEach(function(e){var t=Ps(i,n,e);t&&(s[e]=t)}),s}function Es(e){return E.getSite().isWebApp()?!!e&&e.type.name===P.BRANDING_TYPE.COLOR:!!e&&"color"===e.field}u(n={isColorProperty:Es,getBrandingEditorDeepLink:function(e){return Yi[e.replace("/",":")]},isThemeSettingEnabled:function(){return I.getAppState().isCurrentPageAura()&&I.getAppState().supportsNewFeatures()||E.getSite().isWebApp()},isBrandingSetEditorEnabled:function(){return I.AccessControl(P.PERMISSIONS.BRANDING_SETS)&&$P.isAudienceFeatureSupportedForBranding&&!Qe.isBrandingUpgradeNeeded()&&$P.cbMetadata.templateNames.NAPILI!==I.getAppState().getHomePageTemplate().getDevName()||E.getSite().isWebApp()},isScopedBrandingSetManagementEnabled:function(){return E.getSite().isWebApp()},isBrandingSetEditorTabbedLayoutEnabled:function(){return E.getSite().isWebApp()},isBrandingSetEditorCategoryLayoutEnabled:function(){return E.getSite().isWebApp()},isBrandingSetEditorGroupLayoutEnabled:function(){return E.getSite().isWebApp()},isSubfieldMetadataPropertyEnabled:function(){return E.getSite().isWebApp()},isCustomCssEnabled:function(){return!E.getSite().isWebApp()},isAudienceManagementEnabled:function(){return!E.getSite().isWebApp()},isDefault:function(e){var t;return $P.isPersonalizationEnabled?(t=l.getBrandingSet(e))&&t.default:(t=l.getBrandingAudienceTargetInfo(e))&&t.isDefault()},hasAudience:function(e){return!!l.getBrandingAudienceTargetInfo(e)},isNameDuplicate:function(e){var t=e.trim().toLowerCase();return _.some(l.getAllBrandingSets(),function(e){return e.name.toLowerCase()===t})},openAudienceSelectorForBrandingSet:function(e){Ki.openAudienceSelectorForBranding(e,function(){I.event.trigger("action:update-branding-audience-target-infos")})},isDerivedProperty:function(e){return 0===e.name.indexOf("_")},isCssVariableReference:ys,resolveCssVariableReference:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=l.getCurrentPreviewScopedBrandingSet(),i=l.getPreviewBrandingSet(),s=l.getBrandingSetPropertyDefs(i.def),e=this.getBrandingPropertyFromCssVarReference({cssVarReference:e,brandingSetDefs:s});if(e)return ys(s=(n&&n.values[e.name]?n:i).values[e.name])&&t<6?this.resolveCssVariableReference(s,t+1):s},resolveCssVariableReferenceInBrandingSet:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=l.getBrandingSetPropertyDefs(t.def),e=this.getBrandingPropertyFromCssVarReference({cssVarReference:e,brandingSetDefs:i});if(e)return ys(i=t.values[e.name])&&n<6?this.resolveCssVariableReferenceInBrandingSet(i,t,n+1):i},getBrandingPropertyFromCssVarReference:_.memoize(function(e){var t,n=e.cssVarReference,e=e.brandingSetDefs,e=void 0===e?l.getCurrentPreviewBrandingSetPropertyDefs():e,i=ys(n=n)?-1<(i=(t=(t=J(n.match(Ss),2)[1]).trim()).indexOf(","))?t.substring(0,i):t:n;return _.find(e,{tokens:[i]})},function(e){return e.cssVarReference}),isPropertyVisibleForBrandingSet:function(e,t){return t.type!==P.BRANDING_SET_TYPE.SCOPED||Es(e)},getClosestBrandingSetId:function(e){return Cs(e)||I.getAppState().getCurrentPreviewSiteBrandingSetId()},getBrandingPropertyInfoForComponentAttribute:function(t,n,i){var e=I.getAppState().getCurrentViewId();f.getCanvasComponentsForViewAsync(e,function(e){var e=Ts(e,t);(e=e&&Ps(e,t,n))?i(e):i()})},getBrandingPropertyInfoForComponentAttributes:function(e,t,n){n(Is(e,$P.cbMetadata.componentBrandingMap[t]||{}))},getParentBrandingDefProperty:function(t){var e;return t?this.isDerivedProperty(t)&&(e=_.map($P.cbMetadata.getColorCalc(I.getAppState().getCurrentPage(),l.getPreviewBrandingSet().values),function(e,t){e=e("#fff");return _.forEach(e,function(e){e.parent=t}),e}),e=[].concat.apply([],e),e=(e=_.filter(e,{name:t.name}))&&1<e.length&&e.find(function(e){e=e.parent;return t.name.includes(e)})||e[0])&&e.parent?l.getCurrentPreviewBrandingDefProperty(e.parent):t:null},getBrandingPropertyMapForComponent:Ts},"getBrandingPropertyMapForComponent",function(e){return $P.cbMetadata.componentBrandingMap[e]}),u(n,"getInitialPreviewBrandingSetId",function(){var e=I.getAppState().getCurrentPageTemplate().get("ActiveBrandingSetId"),t=S.getCurrentTheme();return e=t&&t.ActiveBrandingSetId?t.ActiveBrandingSetId:e}),u(n,"createUniqueNameForClone",function(e){var t=1,n=e;do{var i,s=" (".concat(t,")")}while(100<(i="".concat(n).concat(s)).length&&(n=n.substring(0,100-s.length),i="".concat(n).concat(s)),t+=1,this.isNameDuplicate(i));return i});var ws,Ls,Ds,As,N=n,ks="state:theme-layout-area-component-audience-updated",Ns=P.PROP;function xs(){return Ds&&Ds.themeLayouts}function Rs(t){PicassoWebServices.ManageSiteCommon.GetCurrentSiteState(function(e){y.processJSONResponse(e),b.find(Ls,{devName:Ds.devName}).id=Ds.id,o.trigger("close-left-panel"),I.getAppState().set("currentPreviewSiteBrandingSetId",N.getInitialPreviewBrandingSetId()),I.event.trigger("state:current-theme-updated"),t&&t()})}function js(e,t){var t=t?t.ThemeRegionComponentAudienceTargetInfos:null,n=As[e];n||(n=new Ct,As[e]=n),n.reset(t)}function Bs(t,n){var e=I.getAppState().getCurrentPageId();PicassoWebServices.CommTheme.GetCurrentThemeLayoutAudienceTargetInfos(e,t,function(e){js(t,e),n&&n()})}As={},fe()[P.AUDIENCE_TARGET_NAME.THEME_LAYOUT]=As,ve(function(e){e.CurrentTheme&&(Ds=e.CurrentTheme,e=Ds.imgUrl)&&((new Image).src=e)}),be(function(e,t){var n,i=!1;return t&&t.UndoRedoActions&&"AuraMapAddAction"===(t=t.UndoRedoActions[0]).ActionType&&(t=t.ComponentID,t=S.getThemeLayoutById(t))&&(n=I.getAppState().getCurrentViewId(),n=S.getThemeLayoutByViewId(n).type===t.type,I.event.trigger("state:theme-layout-property-updated",t,n),i=!0),i}),S.getAudienceTargetInfoForComponent=function(e,t){var n,e=As[e];return n=e?un(e,t):n},S.hasComponentsWithAttributeVariationAudience=function(e){e=As[e];return e&&0!==e.length},S.getComponentAudienceTargetInfosForThemeLayoutPromise=function(e){var t=T.Deferred();return As[e]?t.resolve():Bs(e,function(){t.resolve()}),t.promise()},S.getCurrentTheme=function(){return Ds},S.getThemeLayoutById=function(e){var t=xs();return t&&b.find(t,{themeLayoutId:e})},S.getThemeLayoutByType=function(e){var t=xs();return t&&b.find(t,{type:e})},S.getThemeLayoutByViewId=function(e){var t=xs(),e=h.getViews().get(e).get(Ns.THEME_LAYOUT_TYPE_KEY);return t&&e&&b.find(t,{type:e})},S.getThemeDefinitionsPromise=function(){return ws||(ws=T.Deferred(),PicassoWebServices.CommTheme.GetAvailableThemesForCurrentTemplate(function(e){Ls=e,ws.resolve(Ls)})),ws.promise()},I.event.on("action:swap-current-theme",function(e){var t=e.devName,n=e.resetToOriginal,i=e.successCallback,s=e.errorCallback;PicassoWebServices.CommTheme.ChangeTheme(t,n,function(e){e&&e.Errors?s(e.Errors):Rs(n?i:function(){var e={Pages:Array.from(h.getPages().models,function(e){return e.attributes}),BrandingSets:l.getAllBrandingSets(),BrandingSetsDefinition:l.getAllBrandingSetDefs()};xi.runAndHandleFailure("BrandingPropertiesMigration from Theme Swap",Vi.doMigration,e),i&&i()})},s)}),I.event.on("action:delete-theme",function(e){var t=e.themeId,n=e.successCallback,e=e.errorCallback;PicassoWebServices.CommTheme.DeleteTheme(t,function(){b.find(Ls,{id:t}).id=null,I.event.trigger("state:theme-deleted"),n&&n()},e)}),I.event.on("action:reset-current-theme",function(e){var t=e.themeId,n=e.successCallback,i=e.errorCallback;PicassoWebServices.CommTheme.ResetTheme(t,function(e){e&&e.Errors?i(e.Errors):Rs(n)},i)}),I.event.on("action:export-theme",function(e){PicassoWebServices.CommUtil.CreateStaticResourceFromImageAndExportTheme(e.imgUrls,e.info,function(e){ws=null,I.event.trigger("state:theme-exported",e)})}),I.event.on("action:create-theme-layout",function(e){var t=e.themeId,n=e.themeLayoutType,e=e.targetThemeLayoutCmpDef;PicassoWebServices.CommTheme.CreateThemeLayout(t,n,e,function(e){y.processJSONResponse(e);e=e.themeLayout;Ds.themeLayouts.push(e),I.event.trigger("state:theme-layout-created",e)})}),I.event.on("action:update-theme-layout",function(e){var t=e.themeId,n=e.themeLayoutType,i=e.themeLayoutName,e=e.targetThemeLayoutCmpDef,s=I.getAppState().getCurrentViewId(),a=S.getThemeLayoutByViewId(s).type===n;PicassoWebServices.CommTheme.UpdateThemeLayout(t,n,i,e,function(e){y.processJSONResponse(e);for(var t=e.themeLayout,n=Ds.themeLayouts,i=0;i<n.length;i++)if(n[i].type===t.type){n[i]=t;break}js(t.themeLayoutId,e),I.event.trigger("state:theme-layout-updated",t,a)})}),I.event.on("action:delete-theme-layout",function(e){var t=e.themeId,e=e.themeLayoutType,n=I.getAppState().getCurrentViewId(),i=S.getThemeLayoutByViewId(n).type===e;PicassoWebServices.CommTheme.DeleteThemeLayout(t,e,function(e){y.processJSONResponse(e);var e=e.themeLayoutType,t=Ds.themeLayouts,e=t.splice(function(e){for(var t=Ds.themeLayouts,n=0;n<t.length;++n)if(t[n].type===e)return n;return-1}(e),1);Ds.themeLayouts=t,I.event.trigger("state:theme-layout-deleted",e[0],i)})}),I.event.on("action:sync-theme-layout-area-component-audience",function(e){var t=e.componentId,n=e.viewId;Bs(S.getThemeLayoutByViewId(n).themeLayoutId,function(){I.event.trigger(ks,{viewId:n,componentId:t})})}),I.event.on("state:aura-component-moved",function(e){var n,i=e.cmpsWithAudienceTargetInfo;0<i.length&&(n=I.getAppState().getCurrentViewId(),Bs(S.getThemeLayoutByViewId(n).themeLayoutId,function(){var t;t=n,b.forEach(i,function(e){I.event.trigger(ks,{viewId:t,componentId:e})})}))});var Os=PicassoWebServices.Labels.ComponentErrors,Ms="cb-AlertHeader-workarea--offset",Vs="cb-AlertHeader-workarea--doubleOffset",$s="cb-AlertHeader-workarea--tripleOffset",Us="cb-AlertHeader-workarea-transition",Ws=P.AUDIENCE_TARGET_NAME,i="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg",Fs=".js-alert-header-visibility-banner-container",Hs=Backbone.View.extend({_noDataTemplate:_.template('<div class="cb-NoDataHeader-container js-nodata-container js-alert-header-container slds-notify slds-notify--alert slds-theme--alert-texture slds-theme--warning"><span class="cb-AlertHeader-content"><svg aria-hidden="true" class="slds-icon cb-NoDataHeader-icon"><use xlink:href="'+i+'#warning"></use></svg><span class="cb-NoDataHeader-label js-nodata-header-label">'+Os.NoDataToastMsg+'</span><a href="{{= link }}" target="_blank">'+Os.NoDataToastMsgLearnMore+'</a></span><span class="cb-AlertHeader-dismissButton js-alertheader-dismiss-button"><svg aria-hidden="true" class="cb-AlertHeader-dismissButtonIcon"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/action-sprite/svg/symbols.svg#close"></use></svg></span></div>'),_sharedObjectPageHtml:'<div class="cb-SharedPageHeader-container js-sharedpage-container js-alert-header-container slds-notify slds-notify--alert slds-theme--alert-texture"><span class="cb-AlertHeader-content"><span class="slds-icon_container" title="info"><svg aria-hidden="true" class="slds-icon cb-SharedPageHeader-icon"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/action-sprite/svg/symbols.svg#info"></use></svg></span><span class="cb-SharedPageHeader-label js-sharedpage-header-label"></span></span><span class="cb-AlertHeader-dismissButton js-alertheader-dismiss-button"><svg aria-hidden="true" class="slds-icon cb-AlertHeader-dismissButtonIcon"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/action-sprite/svg/symbols.svg#close"></use></svg></span></div>',_audienceBannerHtml:'<div class="cb-AlertHeader-audienceBannerContainer js-alert-header-audience-banner-container js-alert-header-container slds-notify slds-notify--alert slds-theme--alert-texture slds-grid_align-end"><span class="cb-AlertHeader-content"><span class="slds-icon_container"><svg aria-hidden="true" class="slds-icon cb-AlertHeader-audienceBannerIcon"><use xlink:href="'+i+'#groups"></use></svg></span><span class="cb-AlertHeader-audienceBannerLabel js-alert-header-audience-banner-label"></span></span><span class="cb-AlertHeader-dismissButton js-alertheader-dismiss-button"><svg aria-hidden="true" class="slds-icon cb-AlertHeader-dismissButtonIcon"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/action-sprite/svg/symbols.svg#close"></use></svg></span></div>',_visibilityBannerHtml:'<div class="cb-AlertHeader-visibilityBannerContainer js-alert-header-visibility-banner-container js-alert-header-container slds-notify slds-notify_alert" role="alert">\n            <span class="cb-AlertHeader-content">    \n                '.concat(D.iconWithAlt({icon:"info",svgClassName:"cb-AlertHeader-visibilityBannerIcon",label:Os.BannerInfo}),'    \n                <span class="cb-AlertHeader-visibilityBannerLabel js-alert-header-visibility-banner-label">').concat(Os.PageHasHiddenComponentsInViewMode,"</span>\n            </span>\n            ").concat(D.buttonIcon({buttonClassName:"slds-button_icon-inverse js-alertheader-dismiss-button",label:Os.CloseBanner,svgClassName:"cb-AlertHeader-dismissButtonIcon",icon:"close"})," \n        </div>").trim(),_snaBannerHtml:'<div class="cb-AlertHeader-snaBannerContainer js-alert-header-sna-banner-container js-alert-header-container slds-notify slds-notify--alert slds-theme--alert-texture slds-grid_align-end">\n            <span class="cb-AlertHeader-content">\n                <span class="slds-icon_container">\n                    <svg aria-hidden="true" class="slds-icon cb-AlertHeader-snaBannerIcon">\n                        <use xlink:href="'.concat(i,'#info"></use>\n                    </svg>\n                </span>\n                <span class="cb-AlertHeader-snaBannerLabel js-alert-header-sna-banner-label">').concat(PicassoWebServices.Labels.ComponentErrors.SNA_NotUsedBanner,'</span>\n            </span>\n            <span class="cb-AlertHeader-dismissButton js-alertheader-dismiss-button">\n                <svg aria-hidden="true" class="slds-icon cb-AlertHeader-dismissButtonIcon">\n                    <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/action-sprite/svg/symbols.svg#close"></use>\n                </svg>\n            </span>\n        </div>').trim(),_tmrBannerHtml:'<div class="cb-AlertHeader-tmrBannerContainer js-alert-header-tmr-banner-container js-alert-header-container slds-notify slds-notify--alert slds-theme--alert-texture slds-grid_align-end">\n            <span class="cb-AlertHeader-content">\n                <span class="slds-icon_container">\n                    <svg aria-hidden="true" class="slds-icon cb-AlertHeader-tmrBannerIcon">\n                        <use xlink:href="'.concat(i,'#info"></use>\n                    </svg>\n                </span>\n                <span class="cb-AlertHeader-tmrBannerLabel js-alert-header-tmr-banner-label">').concat(PicassoWebServices.Labels.ComponentErrors.TMR_NotUsedBanner,'</span>\n            </span>\n            <span class="cb-AlertHeader-dismissButton js-alertheader-dismiss-button">\n                <svg aria-hidden="true" class="slds-icon cb-AlertHeader-dismissButtonIcon">\n                    <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/action-sprite/svg/symbols.svg#close"></use>\n                </svg>\n            </span>\n        </div>').trim(),_progressiveRenderingBannerHtml:'<div class="cb-AlertHeader-progressiveRenderingBannerContainer js-alert-header-progressive-rendering-banner-container js-alert-header-container slds-notify slds-notify--alert slds-theme--alert-texture slds-grid_align-end"><span class="cb-AlertHeader-content"><span class="slds-icon_container"><svg aria-hidden="true" class="slds-icon cb-AlertHeader-progressiveRenderingBannerIcon"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/standard-sprite/svg/symbols.svg#dashboard"></use></svg></span><span class="cb-AlertHeader-progressiveRenderingBannerLabel">'+Os.PageHasPrioritizedComponents+'</span></span><span class="cb-AlertHeader-dismissButton js-alertheader-dismiss-button"><svg aria-hidden="true" class="slds-icon cb-AlertHeader-dismissButtonIcon"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/action-sprite/svg/symbols.svg#close"></use></svg></span></div>',_productListBannerSearchIndexHtml:'<div class="cb-AlertHeader-productListBannerContainer js-alert-header-product-list-banner-container js-alert-header-container slds-notify slds-notify_alert slds-grid_align-end">\n        <span class="cb-AlertHeader-content">\n            <span class="slds-icon_container">\n                <svg aria-hidden="true" class="slds-icon cb-AlertHeader-product-listBannerIcon">\n                    <use xlink:href="'.concat(i,'#info"></use>\n                </svg>\n            </span>\n            <span class="cb-AlertHeader-productListBannerLabel js-alert-header-product-list-banner-label"></span>\n        </span>\n        <span class="cb-AlertHeader-dismissButton js-alertheader-dismiss-button">\n            <svg aria-hidden="true" class="slds-icon cb-AlertHeader-dismissButtonIcon">\n                <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/action-sprite/svg/symbols.svg#close"></use>\n            </svg>\n        </span>\n    </div>').trim(),events:{"click .js-alertheader-dismiss-button":"dismissHeader","click .js-alert-header-audience-name":"openAudienceSelector"},initialize:function(e){this._workareaLocator=(e=e||{}).workareaLocator,this.listenTo(I.event,"state:page-change-failed",this.handleFailPageLoad),this.listenTo(I.event,"state:page-change-start",this.handlePageChangeStart),this.listenTo(I.event,"state:page-change-success",this.handlePageChangeSuccess),this.listenTo(I.event,["state:default-view-updated","state:view-audience-removed"].join(" "),this.handleViewAudienceChanged),this.listenTo(I.event,"state:page-audience-target-infos-updated",this.handlePageAudienceUpdated),this.listenTo(I.event,["state:content-area-component-audience-updated","state:content-area-component-audiences-updated","state:theme-layout-area-component-audience-updated","state:theme-layout-area-component-audiences-updated"].join(" "),this.handleComponentAudienceUpdated),this.listenTo(I.event,"state:audience-entity-updated",this._handleAudienceEntityUpdated),this.listenTo(I.event,"state:aura-component-updated",this.handleComponentUpdated),this.listenTo(o,"canvas-state:aura-component-rendered",this.updatePriorityBanner),this.listenTo(I.event,["state:component-responsive-visibility-updated","state:aura-component-deleted"].join(" "),this.handleResponsiveVisibilityChange)},handlePageChangeStart:function(e){var t=e.url,n=e.viewId,e=e.routeId;this._handlePageChange(t,n,e)},handlePageChangeSuccess:function(e){this._viewId!==e.viewId&&this._handlePageChange(e.path,e.viewId,e.routeId),this.handleResponsiveVisibilityBannerOnLoad()},handleFailPageLoad:function(e,t){o.trigger("show-alert",{title:t.summary,message:t.detail})},handleComponentAudienceUpdated:function(){this.updateAudienceBanner()},handleViewAudienceChanged:function(e){var t=e.routeId,e=e.viewId,n=this.$(".js-alert-header-audience-banner-container"),i=n.attr("data-route-id");e===n.attr("data-view-id")&&t===i&&this.updateAudienceBanner()},handlePageAudienceUpdated:function(e){e===this.$(".js-alert-header-audience-banner-container").attr("data-route-id")&&this.updateAudienceBanner()},handleComponentUpdated:function(e){e=e.props;e&&e.RenderPriority&&f.getCanvasComponentsForViewAsync(I.getAppState().getCurrentViewId(),function(){this.updatePriorityBanner()}.bind(this),!0)},_handlePageChange:function(e,t,n){this._viewId=t,this.hide(),C.urlRequiresParameter(e)&&this.showNoDataHeader(),this.isSharedRecordPage(t)&&this.showSharedPageHeader(t),this.showDynamicBanners(t,n);var i=T(this._workareaLocator);setTimeout(function(){i.addClass(Us)},0)},hide:function(){var e=T(this._workareaLocator);e.removeClass(Us),this.isVisible()&&(this.$(".js-alert-header-container").hide(),e.removeClass(Ms),e.removeClass(Vs),e.removeClass($s))},dismissHeader:function(e){this.decreaseWorkspaceOffset(),T(e.currentTarget).parent().fadeOut(P.FADE_TIME)},decreaseWorkspaceOffset:function(){var e=T(this._workareaLocator);e.hasClass($s)?(e.removeClass($s),e.addClass(Vs)):e.hasClass(Vs)?(e.removeClass(Vs),e.addClass(Ms)):e.removeClass(Ms)},increaseWorkspaceOffset:function(){var e=T(this._workareaLocator);e.hasClass(Vs)?(e.removeClass(Vs),e.addClass($s)):e.hasClass(Ms)?(e.removeClass(Ms),e.addClass(Vs)):e.addClass(Ms)},showNoDataHeader:function(){this.increaseWorkspaceOffset(),this.$(".js-nodata-container").show()},showSharedPageHeader:function(e){this.increaseWorkspaceOffset(),this.$(".js-sharedpage-header-label").html(Os.SharedPageToastMsg.replace("{0}",this.getViewName(e))),this.$(".js-sharedpage-container").show()},showDynamicBanners:function(e,t){var n,i,s,a,o=this,r=(E.getSite().isWebApp()||(n=n||I.getAppState().getCurrentViewId(),r=r||I.getAppState().getCurrentRouteId(),this.$(".js-alert-header-audience-banner-container").attr("data-view-id",n).attr("data-route-id",r),r=h.getAudienceTargetInfosForRoutePromise(r),i=f.getComponentAudienceTargetInfosForViewPromise(n),s=S.getComponentAudienceTargetInfosForThemeLayoutPromise(S.getThemeLayoutByViewId(n).themeLayoutId),(a=[]).push(r,i,s),T.when.apply(this,a).done(function(){this.updateAudienceBanner()}.bind(this)),f.getCanvasComponentsForViewAsync(n,function(){this.updatePriorityBanner()}.bind(this),!0)),h.getRoutes().get(I.getAppState().getCurrentRouteId()));r.isSnaRoute()?this.updateSnaBanner.call(this):r.isTmrRoute()?this.updateTmrBanner.call(this):r.isCommerceProductListRoute()&&I.event.trigger("action:get-search-index-info",{successCallback:function(e){var t;e.SearchIndexLog&&0===Object.keys(e.SearchIndexLog).length&&o.updateProductListBannerNoLiveIndex(),e.SearchIndexLog&&0!=Object.keys(e.SearchIndexLog).length&&(t=(e=new Date(e.SearchIndexLog.lastCatalogSnapshotTime)).toDateString(),e=e.toLocaleTimeString(),o.updateProductListBannerLiveIndex(t,e))}})},updatePriorityBanner:function(){var e,t=this.$(".js-alert-header-progressive-rendering-banner-container"),n=t.is(":visible");E.getSite().isProgressiveRenderingEnabled()?(e=this,f.doesViewHavePrioritizedComponentsPromise(I.getAppState().getCurrentViewId()).then(function(){n||(e.increaseWorkspaceOffset(),t.show())}).fail(function(){n&&(e.decreaseWorkspaceOffset(),t.fadeOut(P.FADE_TIME))})):n&&(this.decreaseWorkspaceOffset(),t.fadeOut(P.FADE_TIME))},updatePageBanner:function(e,t,n,i,s){e=this.$(e);t()&&e.find(i).html(s),e.not(":visible")&&(this.increaseWorkspaceOffset(),e.show())},updateProductListBannerLiveIndex:function(e,t){var n=new Date,e=new Date(e+" "+t),t=new Date(n),i=(t.setDate(n.getDate()-365),{hour:"2-digit",minute:"2-digit"}),n=n.getDate()===e.getDate()?e.toLocaleTimeString("en-US",i):t<=e?"".concat(e.toLocaleDateString("en-US",{month:"short",day:"numeric"})," at ").concat(e.toLocaleTimeString("en-US",i)):"".concat(e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})," at ").concat(e.toLocaleTimeString("en-US",i),", ").concat(e.getFullYear()),t=(t=PicassoWebServices.Labels.CommunityBuilder.LiveIndexBanner).replace("{0}",n);this.updatePageBanner(".js-alert-header-product-list-banner-container",function(){return!0},".cb-AlertHeader-productListBannerLabel",".js-alert-header-product-list-banner-label",t)},updateProductListBannerNoLiveIndex:function(){var e=PicassoWebServices.Labels.CommunityBuilder.NoLiveIndexBanner;this.updatePageBanner(".js-alert-header-product-list-banner-container",function(){return!0},".cb-AlertHeader-productListBannerLabel",".js-alert-header-product-list-banner-label",e)},updateSnaBanner:function(){this.updatePageBanner(".js-alert-header-sna-banner-container",this.isSnaEnabled,".cb-AlertHeader-snaBannerIcon",".js-alert-header-sna-banner-label",PicassoWebServices.Labels.CommunityBuilder.SNA_InfoBanner)},updateTmrBanner:function(){this.updatePageBanner(".js-alert-header-tmr-banner-container",function(){return this.isTmrEnabled()}.bind(this),".cb-AlertHeader-tmrBannerIcon",".js-alert-header-tmr-banner-label",PicassoWebServices.Labels.CommunityBuilder.TMR_InfoBanner)},updateAudienceBanner:function(){var e,t,n,i,s,a;E.getSite().isWebApp()||(n=(e=this.$(".js-alert-header-audience-banner-container")).attr("data-view-id"),a=e.attr("data-route-id"),s=(a=h.getAudienceTargetInfoForView(a,n))&&!a.isDefault(),t=f.hasComponentsWithVisibilityAudience(n),n=f.hasComponentsWithAttributeVariationAudience(n)||S.hasComponentsWithAttributeVariationAudience(S.getThemeLayoutByViewId(n).themeLayoutId),s?(a=(s=I.AccessControl(P.PERMISSIONS.PAGE_EDIT))?'<a class="js-alert-header-audience-name">'+_.escape(a.attributes.audienceName)+"</a>":_.escape(a.attributes.audienceName),i=(t?n?s?Os.PageAndComponentAndAttributeHaveAudience:Os.PageAndComponentAndAttributeHaveAudienceNoUnderline:s?Os.PageAndComponentsHaveAudience:Os.PageAndComponentsHaveAudienceNoUnderline:n?s?Os.PageAndComponentAttributeHaveAudience:Os.PageAndComponentAttributeHaveAudienceNoUnderline:s?Os.PageHasAudience:Os.PageHasAudienceNoUnderline).replace("{0}",a)):t?i=n?Os.ComponentsAndAttributeHaveAudience:Os.ComponentsHaveAudience:n&&(i=Os.ComponentsHaveAttributeAudience),s=e.is(":visible"),a=this.$(".js-alert-header-audience-banner-label"),i&&s?a.html(i):i?(this.increaseWorkspaceOffset(),a.html(i),e.show()):s&&(this.decreaseWorkspaceOffset(),e.fadeOut(P.FADE_TIME)))},isResponsiveVisibilityBannerVisible:function(){return this.$(Fs).is(":visible")},toggleResponsiveVisibilityBanner:function(e,t){var n=this.$(Fs);e?t||(this.increaseWorkspaceOffset(),n.show()):t&&(this.decreaseWorkspaceOffset(),n.fadeOut(P.FADE_TIME))},handleResponsiveVisibilityBannerOnLoad:function(){var e;Vn.isResponsiveCmpVisibilityEnabled()&&(e=I.getAppState().getCurrentViewId(),f.getPageComponents().fetch({viewId:e,force:!1,successCallback:function(){this.toggleResponsiveVisibilityBanner(f.hasResponsiveVisibilityHiddenComponents(),this.isResponsiveVisibilityBannerVisible())}.bind(this)}))},handleResponsiveVisibilityChange:function(e){var t,e=e.componentStyleProperties;Vn.isResponsiveCmpVisibilityEnabled()&&(t=this.isResponsiveVisibilityBannerVisible(),e=!e||e.isVisible,t)&&e&&!f.hasResponsiveVisibilityHiddenComponents()&&this.toggleResponsiveVisibilityBanner(!1,!0)},openAudienceSelector:function(e){var t=this.$(".js-alert-header-audience-banner-container"),n=t.attr("data-route-id"),t=t.attr("data-view-id");Ki.openAudienceSelectorForPage(n,t,function(){k.syncAudienceTargetInfosPromise(n)})},isSnaEnabled:function(){return I.AccessControl(P.PERMISSIONS.IS_BUILDER_BASED_SNA_ENABLED)&&(I.AccessControl(P.PERMISSIONS.IS_CDN_CONFIGURED_FOR_SNA)||I.AccessControl(P.PERMISSIONS.IS_ENHANCED_DOMAINS_ENABLED)&&I.AccessControl(P.PERMISSIONS.IS_DEFAULT_CDN_ENABLED)||I.AccessControl(P.PERMISSIONS.IS_EDGE_CUSTOM_DOMAIN_ENABLED))},isTmrEnabled:function(){return!I.AccessControl(P.PERMISSIONS.IS_EDGE_CUSTOM_DOMAIN_ENABLED)&&this.isSnaEnabled()&&I.AccessControl(P.PERMISSIONS.IS_TOO_MANY_REQUESTS_ENABLED)},isVisible:function(){return this.$(".js-alert-header-container").is(":visible")},isSharedRecordPage:function(e){e=h.getRoutes().getRouteForView(e);return 0<e.length&&e[0].isGenericObjectRoute()},getViewName:function(e){e=h.getRoutes().getRouteForView(e);if(e.length)return e[0].getViewName()},render:function(){return this.$el.html(this._noDataTemplate({link:E.getSite().get("noDataHelpUrl")})+this._sharedObjectPageHtml+this._audienceBannerHtml+this._progressiveRenderingBannerHtml+this._snaBannerHtml+this._tmrBannerHtml+this._visibilityBannerHtml+this._productListBannerSearchIndexHtml),this},_handleAudienceEntityUpdated:function(e){e===Ws.PAGE&&this.updateAudienceBanner()}}),Gs=1,zs=3,Ks="cb-util-dropdown",Ys='[data-toggle="dropdown"]',qs=null,Xs=null,Js=null;function Qs(){var e,t,n=Xs[0].getBoundingClientRect(),i=document.documentElement,s=(window.pageYOffset||i.scrollTop)-(i.clientTop||0),i=(window.pageXOffset||i.scrollLeft)-(i.clientLeft||0),i=n.left+i,a=n.top+n.height+Gs+s;qs.css("left",i+"px"),qs.css("top",a+"px"),e=qs.offset().top+qs.outerHeight(),t=T(window).scrollTop()+T(window).height(),e<t||(a=n.top-n.height-qs.height()+zs+s,qs.css("top",a+"px")),e=qs.offset().left+qs.outerWidth(),t=T(window).scrollLeft()+T(window).width(),e<t&&"left"!==Js.position||(i=n.left+n.width-qs.width(),qs.css("left",i+"px"))}function Zs(){qs&&(qs.remove(),qs=null),T(document).off("."+Ks),T(window).off("."+Ks),T(T(Ys)).off("."+Ks),window.removeEventListener("scroll",ea,!0)}function ea(e){var t=e.target.contains(Xs[0]),n=Xs[0].getBoundingClientRect().top<e.target.getBoundingClientRect().top,e=Xs[0].getBoundingClientRect().bottom>e.target.getBoundingClientRect().bottom;(t&&((n||e)&&Js.hideOnOutOfBound||Js.hideOnScroll)?Zs:Qs)()}var ta={trigger:function(e,t,n){qs&&Xs&&"none"!==qs.css("display")&&t[0]===Xs[0]?Zs():(qs=e,Xs=t,Js=n||{},T("body").append(qs),qs.addClass(Ks),T("."+Ks).hide(),qs.css("z-index",999),qs.css("display","inline-block"),Qs(),window.addEventListener("scroll",ea,!0),T(document).on("click."+Ks,function(e){var t,n,i,s,a;t=e,n=qs,i=Xs,s=Js.allowedSelectorOutsideDropdown,a=!1,s&&(s=document.querySelector(s))&&(a=s.contains(t.target)),(n&&n[0].contains(t.target)||i[0].contains(t.target)||a)&&(s=e,!(n=Js.dismissSelectorWithinDropdown&&qs.find(Js.dismissSelectorWithinDropdown))||!n.find(s.target).length&&!n.is(s.target))||Zs()}),T(Ys).on("mousedown."+Ks,function(e){Zs()}),T(window).on("blur."+Ks,function(){Zs()}))},isActive:function(e){return T("."+Ks).is(":visible")&&qs[0].contains(e.target)}};function na(e){return b.every(e,function(e){return!P.SEO_CMP_PROP.WHITESPACE_REGEXP.test(e)})}function ia(t){var n=T.Deferred();if(ha.getAvailableLayouts)return ha.getAvailableLayouts(function(e){e&&"function"==typeof t&&t(e),n.resolve()}),n.promise();t([]),n.resolve()}function sa(t,e){var n=T.Deferred();return fa&&!e?(t(fa),n.resolve()):PicassoWebServices.CommPage.GetAllGlobalPages(function(e){(fa=e)&&"function"==typeof t&&t(e),n.resolve()}),n.promise()}function aa(t){var n=T.Deferred();return PicassoWebServices.CommPage.GetCMSContentTypes(function(e){e.CMSContentTypes&&"function"==typeof t&&t(e.CMSContentTypes),n.resolve()}),n.promise()}function oa(e,t,n){o.trigger("page-wizard-show-loading",!1),A.closeDialog(),I.event.trigger("action:navigate-to-page",{routeId:t,viewId:n,successCallback:function(){I.getAppState().set("workspaceMode",P.workspace.PAGE_CONFIG),o.trigger("close-page-menu")}})}function ra(){var e=T(".cb-Dialog--PageWizard").data().vex.id;A.closeDialogById(e)}function la(e){var t=E.getSite(),n=t.get("homepage"),i=t.getDefaultThemeLayoutType();return ya.getLoginPageRouteForViewType(e.get("routeType"))&&(n=t.get("loginpage"),i="Login"),{pageId:n,themeLayoutType:i}}function ca(e){return _.includes(P.ROUTE.LOGIN_ROUTE_TYPES,e)}function da(e){return Ca(E.getSite().get("loginpage"),e)}function ua(e){return Ca(E.getSite().get("homepage"),e)}function pa(e){var t=E.getSite().get("homepage");return!h.getRoutes().getRouteForPageAndViewType(t,e)}var ga=function(e){var t=e.value,e=e.invalidELCallback,t=t.match(P.SEO_CMP_PROP.EXPRESSION_REGEXP);t&&0<t.length&&(na(t)||e&&e())},ha={load:function(){var e=[["getDataObjects",PicassoWebServices.CommUtil.GetAvailableDataObjects]],t=E.getSite().get("homepage"),t=h.getPages().get(t),t=t?t.get("AuraTemplateCreationName"):null,n=E.getSite().get("isWebApp");t&&(e.push(["getAvailableLayouts",PicassoWebServices.CommCore.GetAllLightningLayouts]),n||e.push(["getCurrentThemeLayouts",PicassoWebServices.CommTheme.GetCurrentThemeLayouts])),_.each(e,function(e){var t=e[0],n=e[1],e=e[2]||[],i=T.Deferred();e.push(function(e){i.resolve(e)}),ha[t]=function(t,n){i.done(function(e){n?t.call(n,e):t(e)})},n.apply(this,e)})}},ma=["home","error","contactsupport"],va=["Chatter Case Detail","Basic Case Detail"],ba=["Case Detail"],fa=null,_a=function(e){return!!e.get("parentId")},Sa=function(e){return!!e.pageActions.includes(P.PAGE_ACTIONS.MOVE)},Ca=function(e,t){e=h.getRoutes().getRouteForPageAndViewType(e,t);return e&&0<e.length?e[0]:null},ya={createLightningViewWithLayout:function(e){o.trigger("page-wizard-show-loading",!0);var t=!e.get("pageVariationMode")&&!e.get("selectedView")||pa(e.get("routeType")),n=la(e);I.event.trigger("action:create-view-with-layout",{pageId:n.pageId,viewName:e.get("name"),themeLayoutType:n.themeLayoutType,contentLayout:e.get("selectedLayout"),routeUrl:e.get("url"),parentId:e.get("parentId"),routeDevName:e.get("devName"),routeType:e.get("routeType"),createRoute:t,successCallback:oa,errorCallback:ra})},createGlobalPage:function(e){o.trigger("page-wizard-show-loading",!0);var t=la(e);I.event.trigger("action:create-view-from-global-page",{pageId:t.pageId,pageDef:e.get("selectedPage"),parentId:e.get("parentId"),viewName:e.get("name"),routeUrl:e.get("url"),routeDevName:e.get("devName"),routeType:e.get("routeType"),themeLayoutType:t.themeLayoutType,successCallback:oa,errorCallback:ra})},createGlobalPageVariation:function(e){o.trigger("page-wizard-show-loading",!0);var t=la(e);I.event.trigger("action:create-view-from-global-page-variation",{pageId:t.pageId,pageDef:e.get("selectedPage"),viewName:e.get("name"),routeType:e.get("routeType"),themeLayoutType:t.themeLayoutType,successCallback:oa,errorCallback:ra})},createObjectPages:function(e){o.trigger("page-wizard-show-loading",!0),I.event.trigger("action:create-views-for-object",{homePageId:E.getSite().get("homepage"),parentId:e.get("parentId"),templateName:I.getAppState().getHomePageTemplate().getDevName(),entityKeyPrefix:e.get("selectedObject").KeyPrefix,successCallback:oa,errorCallback:ra})},getFilteredViewsForRouteType:function(t,e){return ca(t)?_.filter(e,function(e){return e.routeType===t}):_.includes(ma,t)||"custom"===t.split("-")[0]?_.filter(e,function(e){return e.routeType===t||k.isExportedRouteType(e.routeType)}):k.isNapiliBasedTemplate()||k.isCommunityBasedTemplate()?_.filter(e,function(e){return!_.includes(va,e.id)&&e.routeType===t}):k.isKoaKokuaTemplate()?_.filter(e,function(e){return!_.includes(ba,e.id)&&e.routeType===t}):_.filter(e,function(e){return e.routeType===t})},getFilteredViews:function(e,n){var i=h.getRoutes().map(function(e){return e.get("ViewType")});return _.filter(e,function(e){var t=e.routeType;return!ca(t)&&(!_.includes(i,t)&&h.getOOTBRouteUrlByType(t)||k.isExportedRouteType(t))&&(t=e,!_a(n)||Sa(t))})},getRouteForRouteType:function(e){return da(e)||ua(e)},getHomePageRouteForViewType:ua,getLoginPageRouteForViewType:da,getData:function(t){var e=[];return e.push(function(t){var n=T.Deferred();if(ha.getDataObjects)return ha.getDataObjects(function(e){e&&"function"==typeof t&&t(e),n.resolve()}),n.promise();t([]),n.resolve()}(function(e){t.set("availableDataObjects",e)})),e.push(ia(function(e){t.set("availableLayouts",e)})),e.push(sa(function(e){t.set("globalPages",e.StandardGlobalPages),t.set("customGlobalPages",e.AllGlobalPages)})),e.push(aa(function(e){t.set("cmsContentTypes",e)})),e},getAvailableLayouts:ia,getAllGlobalPages:sa,getCMSContentTypes:aa,isLoginRouteType:ca,isSubpageMode:_a},t=PicassoWebServices.Labels.CommBuilderPageWizard,Ta=Backbone.View.extend({layoutsTemplate:_.template('<div class="cb-AvailableLayouts js-pageWizard-chooseLayout"><div class="cb-AvailableLayouts-container"><ul class="cb-AvailableLayouts-items">{{= standardOptions }}{{= customOptions }}</ul></div></div>'),layoutsWithDynamicOptionsTemplate:_.template('<div class="cb-AvailableLayouts js-pageWizard-chooseLayout"><div class="cb-AvailableLayouts-container"><h2 class="cb-AvailableLayouts-header">'+t.dynamicLayouts+'</h2><div class="cb-AvailableLayouts-dynamicLayout"><ul class="cb-AvailableLayouts-items">{{= dynamicOptions }}</ul><div class="cb-AvailableLayouts-dynamicLayoutDescriptionContainer"><h2 class="cb-AvailableLayouts-dynamicLayoutHeader">'+t.dynamicLayoutDescriptionHeader+'<span class="slds-badge slds-align-middle cb-AvailableLayouts-newBadge">'+t.newBadgeLabel+'</span></h2><h3 class="cb-AvailableLayouts-dynamicLayoutSubHeader">'+t.dynamicLayoutDescriptionSubHeader+'</h3><p class="cb-AvailableLayouts-dynamicLayoutDescription">'+t.dynamicLayoutDescription+'</p></div></div></div><hr class="cb-AvailableLayouts-divider"><div class="cb-AvailableLayouts-container"><h2 class="cb-AvailableLayouts-header">'+t.fixedLayouts+'</h2><ul class="cb-AvailableLayouts-items">{{= standardOptions }}{{= customOptions }}</ul></div></div>'),layoutOptionItemTemplate:_.template('<li class="cb-AvailableLayout-container js-layout-option-item {{= isCustom ? "js-layout-available-custom" : "" }} {{= isCurrent ? "cb-AvailableLayout-container--current js-current-layout" : "" }} {{= isDisabled ? "disabled" : "" }}" data-layout="{{= layoutName }}" ><div class="cb-AvailableLayout-desc js-layout-label" title="{{= layoutDesc}}">{{= layoutLabel}}</div>{{ if (isCurrent) { }}<span class="cb-AvailableLayout-currentLayout">'+t.currentLayout+'</span>{{ } }}{{ if (isDisabled) { }}<span class="cb-AvailableLayout-disabledLayout">'+t.disabledLayout+'</span>{{ } }}<div class="cb-AvailableLayout-preview" style="background-image:url({{= layoutImg}})"></div></li>'),events:{"click .js-layout-option-item:not(.is-selected)":"_onSelectLayoutOption"},_deferred:[],_currentLayout:"",_shouldSelectDefaultLayout:!1,_availableLayoutInfos:[],_selectedLayout:"",_onLayoutSelectionHandler:null,_hasLoadedData:!1,initialize:function(e){this.options=e||{},this._currentLayout=e.currentLayout,this._shouldSelectDefaultLayout=e.shouldSelectDefaultLayout||!1,this._availableLayoutInfos=e.layouts||[],this._onLayoutSelectionHandler=e.onLayoutSelectionHandler||null,e.layouts?this._hasLoadedData=!0:this._deferred.push(ya.getAvailableLayouts(function(e){this._availableLayoutInfos=e}.bind(this)))},render:function(){var e,t;return this._hasLoadedData?(e=this._getCustomFilteredLayouts(),t=this._getStandardFilteredLayouts(),e=_.extend({customOptions:this._buildLayoutOptionsHtml(e),standardOptions:this._buildLayoutOptionsHtml(t[0]),dynamicOptions:this._buildLayoutOptionsHtml(t[1])}),this._shouldIncludeDynamicLayouts()?this.$el.html(this.layoutsWithDynamicOptionsTemplate(e)):this.$el.html(this.layoutsTemplate(e)),this._shouldSelectDefaultLayout&&(t=this._getFirstStandardLayout())&&t.click()):this.renderAsync(),this},renderAsync:function(){T.when(this._deferred).done(function(){this._hasLoadedData=!0,this.render()}.bind(this))},getSelectedLayout:function(){return this._selectedLayout},_onSelectLayoutOption:function(e){var e=T(e.currentTarget),t=e.data("layout");vi.isFlexibleLayout(t)&&!_.isEmpty(this._currentLayout)||(this._selectedLayout=t,this.$(".js-layout-option-item").removeClass("is-selected"),e.addClass("is-selected"),this.trigger("enableSaveButton",this._selectedLayout),"function"==typeof this._onLayoutSelectionHandler&&this._onLayoutSelectionHandler(this._selectedLayout))},_getCustomFilteredLayouts:function(){var e=this._availableLayoutInfos.filter(function(e){return e.IsCustom});return _.sortBy(e,function(e){return e.Label})},_getStandardFilteredLayouts:function(){var e=this._availableLayoutInfos.filter(function(e){return!e.IsCustom}),t=[],n=[],i=[],s=[],a=[];return _.map(e,function(e){(0<e.Name.indexOf("One")?t:0<e.Name.indexOf("Two")?n:0<e.Name.indexOf("Three")?i:vi.isFlexibleLayout(e.Name)?a:s).push(e)}),t=_.sortBy(t,function(e){return e.Name}),n=_.sortBy(n,function(e){return e.Name}),i=_.sortBy(i,function(e){return e.Name}),s=_.sortBy(s,function(e){return e.Name}),a=_.sortBy(a,function(e){return e.Name}),[t.concat(n,i,s),a]},_shouldIncludeDynamicLayouts:function(){return k.isCommunityBasedTemplate()||k.isLwrBasedTemplate()},_buildLayoutOptionsHtml:function(e){var i=[];return _.each(e,function(e){var t=e.Name===this._currentLayout,n=!_.isEmpty(this._currentLayout)&&vi.isFlexibleLayout(e.Name),e=this.layoutOptionItemTemplate({layoutName:e.Name,layoutLabel:e.Label,layoutImg:e.ImageUrl,layoutDesc:e.Description,isCustom:e.IsCustom,isCurrent:t,isDisabled:n});i.push(e)}.bind(this)),i.join("")},_getFirstStandardLayout:function(){var e=this.$(".js-layout-available-standard .js-layout-option-item:first-of-type");return e.length?T(e[0]):null}}),Pa=PicassoWebServices.Labels.CommBuilderViewCreationWizard,Ia=P.PROP,Ea=Backbone.View.extend({className:"cb-ChangeLayoutWizard js-page-choose-layout",template:_.template('<div class="cb-ChangeLayoutWizard-title">'+Pa.LayoutTitle+'</div><div class="cb-ChangeLayoutWizard-content"><h2 class="cb-ChangeLayoutWizard-descriptionTitle">'+Pa.LayoutContentDescription+'</h2><div class=" cb-ChangeLayoutWizard-layouts js-layout-wizard-contents"></div><div class="cb-ChangeLayoutWizard-buttonContainer clearfix"><button class="cb-Button cb-ChangeLayoutWizard-cancel js-layout-wizard-cancel">'+Pa.LayoutCancelButton+'</button><button class="cb-Button cb-Button--primary cb-ChangeLayoutWizard-save is-disabled">'+Pa.LayoutChangeButton+"</button></div>"),events:{"click .js-layout-wizard-save":"_checkUpdateProperty","click .js-layout-wizard-cancel":"_cancel"},_viewId:"",initialize:function(e){this._viewId=e.viewId,this._routeId=e.routeId,e.successCallback&&(this._successCallback=e.successCallback),this._chooseLayoutStep=new Ta({currentLayout:h.getViews().get(e.viewId).get(Ia.CONTENT_LAYOUT_KEY)}),this.listenTo(this._chooseLayoutStep,"enableSaveButton",this._enableSaveButton)},render:function(){return this.$el.html(this.template()),this.$(".js-layout-wizard-contents").append(this._chooseLayoutStep.render().el),this._show(this._chooseLayoutStep),this},_enableSaveButton:function(){T(".cb-ChangeLayoutWizard-save").removeClass("is-disabled").addClass("js-layout-wizard-save")},_checkUpdateProperty:function(){A.closeDialog(),PicassoWebServices.CommPage.GetRegionDifference(this._viewId,this._chooseLayoutStep.getSelectedLayout(),function(e){var t;0<e.length?(t=T("<ul/>"),e=_.sortBy(e,function(e){return e.toLowerCase()}),_.each(e,function(e){T("<li/>").text(e).appendTo(t)}),A.sldsModal({content:L.format(Pa.LayoutConfirmContent,t[0].outerHTML),title:Pa.LayoutConfirmTitle,className:"cb-ConfirmChangeLayout-dialog",callback:function(e){e&&this._updateProperty()}.bind(this)})):this._updateProperty()}.bind(this))},_updateProperty:function(){var e=this._chooseLayoutStep.getSelectedLayout(),t=this._viewId,n=this._successCallback;I.event.trigger("action:update-view-property",{id:t,name:Ia.CONTENT_LAYOUT_KEY,value:e,successCallback:n})},_cancel:function(){A.closeDialog()},_show:function(e){e.render().$el.show()}}),wa=/^\/[a-z0-9\-]+$/i,La=Backbone.View.extend({className:"cb-ChangeUrlDialog js-change-url-dialog",dialogTemplate:function(e){var t=e.urlSegment,n=e.parentUrlHtml,i=e.parentUrlTooltip,s=e.description,a=e.label,e=e.badgeText;return'<div class="cb-ChangeUrlDialog-content">\n                <div class="cb-ChangeUrlDialog-formItem slds-form-element">\n                    '.concat(D.urlSegmentInput({isRequired:!0,value:t,label:a,parentUrlHtml:n,parentUrlTooltip:i,id:"js-change-url-dialog-url-input"}),'\n                </div>\n                <div class="cb-ChangeUrlDialog-desc test-desc">').concat(s,"</div>\n                ").concat(e?'<div class="cb-ChangeUrlDialog-warningContainer slds-m-top_medium slds-m-bottom_x-small">\n                            <span class="slds-badge slds-theme_warning cb-ChangeUrlDialog-warning js-warning-badge">'.concat(e,"</span>\n                        </div>"):"","\n            </div>").trim()},events:{"input .js-url-input":"_onUrlChange","change .js-url-input":"_onUrlChange","keydown .js-url-input":"_onKeyDown"},initialize:function(e){var t=e.urlSegment,n=e.parentUrlHtml,i=e.parentUrlTooltip,s=e.isChangingBaseUrl,a=e.routeId,o=e.itemRoutes,e=e.onSave;this._itemRoutes=o,this._urlSegment=t,this._parentUrlHtml=n||"",this._parentUrlTooltip=i,this._routeId=a,this._isChangingBaseUrl=s,this._onSave=e},render:function(){return this.$el.html(this.dialogTemplate({urlSegment:this._urlSegment,description:this._getDescription(),label:this._getLabel(),badgeText:this._getBadgeText(),parentUrlHtml:this._parentUrlHtml,parentUrlTooltip:this._parentUrlTooltip})),A.sldsModal({title:this._getTitle(),content:this.$el,yesText:this._getLabelSection().UpdateButton,noText:this._getLabelSection().CancelButton,callback:function(e){e&&this._onUrlChange(null,!0)}.bind(this)}),_.defer(function(){var e=this.$(".js-url-input");e.select(),e.focus()}.bind(this)),this},beforeClose:function(){clearTimeout(this.errorTimeout)},_getTitle:function(){return this._getLabelSection().Title},_getDescription:function(){return this._getLabelSection().Description},_getLabel:function(){return this._getLabelSection().UrlInputLabel},_getLabelSection:function(){return this._isChangingBaseUrl?PicassoWebServices.Labels.ChangeBaseUrlDialog:PicassoWebServices.Labels.ChangeUrlDialog},_getBadgeText:function(){var e=this._isChangingBaseUrl?this._itemRoutes&&this._itemRoutes.length||1:k.getAllRouteDescendants(this._routeId).length+1,t=this._getLabelSection().TotalAffectedPages;return 1<e?L.format(t,e):""},_onUrlChange:function(e,t){this._isChangingBaseUrl?this._onBaseUrlChange(e,t):this._onUrlSegmentChange(e,t)},_onUrlSegmentChange:function(e,t){var n=this,i=this.$(".js-url-input"),s=i.val()&&i.val().trim(),i=this._isUrlValid(s,function(){return k.isSegmentValidForRoute(n._getCurrentRoute(),s)});if(this._urlSegment===s)t||(this._valid(),this._updateButtonState(!0));else if(0<i.length)this._valid(i[0]),this._updateButtonState(!1);else if(t){if("/"===s.slice(-1))throw s.substring(0,s.length-1),new TypeError('"'+"newUrlSegment"+'" is read-only');this._onSave&&"function"==typeof this._onSave&&this._onSave(s)}else this._valid(),this._updateButtonState(!0)},_onBaseUrlChange:function(e,t){var n=this.$(".js-url-input"),n=n.val()&&n.val().trim(),i=this._isBaseUrlValid(n);this._urlSegment===n?t||(this._valid(),this._updateButtonState(!0)):0<i.length?(this._valid(i[0]),this._updateButtonState(!1)):t?("/"===n.slice(-1)&&(n=n.substring(0,n.length-1)),this._onSave&&"function"==typeof this._onSave&&this._onSave(n)):(this._valid(),this._updateButtonState(!0))},_valid:function(e){var t=this.$(".js-url-input").closest(".slds-form-element"),n=t.find(".slds-form-element__help");e?(t.addClass("slds-has-error"),n.text(e)):(t.removeClass("slds-has-error"),n.text(""))},_updateButtonState:function(e){e=new CustomEvent("toggle-button-enabled-state",{bubbles:!0,detail:{enabled:e}});this.$el[0].dispatchEvent(e)},_isBaseUrlValid:function(e){var t=this._getCurrentRoute();return this._isUrlValid(e,function(){return k.isBaseUrlValidForRoute(t,e)})},_getCurrentRoute:function(){return h.getRoutes().get(this._routeId)},_isUrlValid:function(e,t){var n=[];return wa.test("/".concat(e))||n.push(this._getLabelSection().ValidationErrorPageUrlInvalid),t()||n.push(this._getLabelSection().ValidationErrorPageUrlNotUnique),n},_onKeyDown:function(e){e.which===P.KEYCODE.ENTER&&this._onUrlChange(e,!0)}}),n=PicassoWebServices.Labels.GoogleAnalyticsIntegration;i=m(m({},n),{},{type:"GA4",cardHelpLink:"https://analytics.google.com/analytics/web/#/provision",logoURL:"/img/integrations/google-analytics-logo.png",isExternal:!0,isIntegrationEnabled:function(){return I.AccessControl(P.PERMISSIONS.IS_GOOGLE_ANALYTICS_ENABLED)},inputs:[{id:"apiKey",name:n.measurementIdLabel,fieldLevelHelp:n.fieldLevelHelp,placeholder:"G-XXXXXXX",pattern:"^(G)-[a-zA-Z0-9]+$",messageWhenPatternMismatch:n.measurementIdError}]}),t=PicassoWebServices.Labels.GoogleRecaptchaIntegration;var x={GA4:i,GRECAPTCHA:m(m({},t),{},{type:"GRECAPTCHA",cardHelpLink:"https://www.google.com/recaptcha/about/",logoURL:"/img/integrations/google-recaptcha-logo.png",isExternal:!0,isIntegrationEnabled:function(){return!(!I.getAppState()||!I.getAppState().getHomePageTemplate())&&"marketing-landing-template"===I.getAppState().getHomePageTemplate().get("AuraTemplateCreationName")&&I.AccessControl(P.PERMISSIONS.IS_RECAPTCHA_IN_FORMS_ENABLED)},inputs:[{id:"siteKey",name:t.siteKeyLabel,placeholder:t.siteKeyPlaceholder},{id:"secretKey",name:t.secretKeyLabel,placeholder:t.secretKeyPlaceholder}]}),DATA_CLOUD:m(m({},PicassoWebServices.Labels.DataCloudIntegration),{},{type:"DATA_CLOUD",cardHelpLink:"https://www.salesforce.com/products/genie/overview/",logoURL:"/img/integrations/data-cloud-logo.png",isExternal:!1,isIntegrationEnabled:function(){return I.AccessControl(P.PERMISSIONS.IS_DATA_CLOUD_ENABLED)},inputs:[]}),CONSENT_BANNER:m(m({},PicassoWebServices.Labels.ConsentBannerIntegration),{},{type:"CONSENT_BANNER",cardHelpLink:"https://developer.salesforce.com/",logoURL:"/img/integrations/data-cloud-logo.png",isExternal:!1,isIntegrationEnabled:function(){return!(!I.getAppState()||!I.getAppState().getHomePageTemplate())&&"marketing-landing-template"===I.getAppState().getHomePageTemplate().get("AuraTemplateCreationName")},inputs:[]})},Da=[],Aa=(Xe.isAnyIntegrationAvailable=function(){for(var e in x)if(x[e].isIntegrationEnabled())return!0;return!1},Xe.getAllIntegrations=function(){return Da},Xe.getAllIntegrationPromise=function(){var t=T.Deferred();return PicassoWebServices.SiteIntegration.GetAllIntegrationTypes(function(e){Da=e.ThirdPartyAnalytics,t.resolve()}),t.promise()},Xe.getInstallIntegrationTypePromise=function(e){var t=T.Deferred(),n=e.integrationType,i=e.install,s=e.enable,a=e.contentValue,o=e.saveSuccessCallback;return PicassoWebServices.SiteIntegration.SetupIntegrationSettingsForSite(n,i,s,a,function(e){b.isFunction(o)&&o({integrationType:n,isSuccess:!!e,contentValue:a,integrationStatus:null==e?void 0:e.integrationStatus}),t.resolve()}),t.promise()},Xe.getRemovedIntegrationPromise=function(e){var t=T.Deferred();return PicassoWebServices.SiteIntegration.UninstallIntegrationModuleForSite(e.integrationType,function(e){e&&t.resolve()}),t.promise()},Xe.getIsIntegrationTypeActivePromise=function(t){var n=T.Deferred();return Xe.getAllIntegrationPromise().done(function(){var e=null==(e=Xe.getAllIntegrations().find(function(e){return e.integrationType===t}))?void 0:e.isInstalled;n.resolve(e)}),n.promise()},Xe.updateConfigurationValue=function(e){I.event.trigger("state:analytics-configuration-input-value",e)},I.event.on("action:remove-analytics-configuration",function(e){Xe.getRemovedIntegrationPromise(e).done(function(){e.isSuccess=!0,I.event.trigger("state:analytics-configuration-removed",e)}.bind(this))}),I.event.on("action:analytics-configuration-input-value-change",function(e){Xe.updateConfigurationValue(e)}),Xe.upgradeIntegration=function(e){var t=T.Deferred();return PicassoWebServices.SiteIntegration.UpgradeIntegration(e,function(e){e&&t.resolve()}),t.promise()},P.LABEL_KEYS),ka=PicassoWebServices.Labels.CommBuilderSecurityCSPSettings;function Na(){var e=v.getScriptSrcTrustedSites();return Object.values(xa()).filter(function(t){return!e.some(function(e){return e.get("isActive")&&e.get("source")===t})})}function xa(){var e={};return e[Aa.GOOGLE_ANALYTICS_DOMAIN]=ka[Aa.GOOGLE_ANALYTICS_DOMAIN],e[Aa.GOOGLE_ADWORDS_DOMAIN]=ka[Aa.GOOGLE_ADWORDS_DOMAIN],(E.getSite().isMigratedToGtagAnalytics()||Ba())&&(e[Aa.GOOGLE_ANALYTICS_GTAG_DOMAIN]=ka[Aa.GOOGLE_ANALYTICS_GTAG_DOMAIN]),e}function Ra(){var e=v.getScriptSrcTrustedSites();return function(){var e=["https://*.google-analytics.com","https://*.analytics.google.com","https://*.g.doubleclick.net","https://*.google.com"];(E.getSite().isMigratedToGtagAnalytics()||Ba())&&e.push("https://*.googletagmanager.com");return e}().filter(function(t){return!e.some(function(e){return e.get("isActive")&&e.get("source")===t})})}function ja(){return v.getCurrentScriptSecurityLevel()===v.getScriptSecurityLevels().GRANDFATHERED}function Ba(){return $P.app.state.getCurrentSite().get("isInCmsStore")}function Oa(e,t){e?t(!0):Ba()?Xe.getIsIntegrationTypeActivePromise("GA4").done(function(e){return t(e)}):t(!1)}var Ma,Va={addMissingGoogleDomains:function(e,n){e&&!ja()?Oa(e,function(e){var t;e&&(e=E.getSite().isMigratedToGtagAnalytics()||Ba(),t=0<Na().length,e||t)?A.sldsModal({title:ka.GoogleAnalyticsConsentNotifTitle,content:(e=xa(),E.getSite().isMigratedToGtagAnalytics()||Ba()?ka.GoogleAnalyticsGtagConsentNotifBody.replace("{0}",e[Aa.GOOGLE_ANALYTICS_GTAG_DOMAIN]).replace("{1}",e[Aa.GOOGLE_ANALYTICS_DOMAIN]).replace("{2}",e[Aa.GOOGLE_ADWORDS_DOMAIN]):ka.GoogleAnalyticsConsentNotifBody.replace("{0}",e[Aa.GOOGLE_ANALYTICS_DOMAIN]).replace("{1}",e[Aa.GOOGLE_ADWORDS_DOMAIN])),isSingleButton:!0,yesText:ka.OK,afterCloseFocusEl:document.activeElement,callback:function(e){if(e)return function(){v.addGoogleAnalyticsTrustedSites(function(){U(n)===("undefined"==typeof Function?"undefined":U(Function))&&n()})};U(n)===("undefined"==typeof Function?"undefined":U(Function))&&n()}(t)}):U(n)===("undefined"==typeof Function?"undefined":U(Function))&&n()}):U(n)===("undefined"==typeof Function?"undefined":U(Function))&&n()},addMissingGoogleDomainsForLWRSites:function(e,t){var n=b.isFunction(t);ja()?n&&t():Oa(e,function(e){e&&0<Ra().length?v.addIntegrationTrustedSitesForLwr(Ra(),function(){n&&t()}):n&&t()})},getGoogleAnalyticsDomains:xa,getMissingGoogleDomainsFromCspWhitelist:Na,addDataCloudIntegrationDomains:function(a,o){return new Promise(function(s){PicassoWebServices.SiteIntegration.GetCDPTenantSpecificEndpoint(function(e){var n,t=[a],i=(e&&t.push(e),b.isFunction(o)),t=(e=t,n=v.getScriptSrcTrustedSites(),e.filter(function(t){return!n.some(function(e){return e.get("isActive")&&e.get("source")===t})}));!ja()&&0<t.length?v.addIntegrationTrustedSitesForLwr(t,function(){i&&o()}):i&&o(),s()})})}},$a="state:script-src-trusted-sites-updated",Ua="state:csp-violations-list-updated",Wa="state:clickjack-trusted-domains-updated",Fa=PicassoWebServices.Labels.CommBuilderSecurityCSPSettings,Ha=Immutable.fromJS([]),Ga=PicassoWebServices.ManageSiteCommon,za=P.SECURITY_LEVEL,Ka="siteClickjackProtectionLevel";function Ya(e){return new Promise(function(i){Ga.AddTrustedSites(e,function(e){var t=!1,n={CspViolations:[]};e.forEach(function(e){n.CspViolations=b.merge(n.CspViolations,e.CspViolations),e.hasOwnProperty("SecuritySettings")&&(t=!0,!n.hasOwnProperty("SecuritySettings")||e.SecuritySettings.ScriptSrcTrustedSites.length>n.SecuritySettings.ScriptSrcTrustedSites.length)&&(n.SecuritySettings=b.extend({},e.SecuritySettings))}),qa(t,n),i()})})}function qa(e,t){Ha=t.CspViolations,I.event.trigger(Ua,t),e&&(Ma=Immutable.fromJS(t.SecuritySettings),I.event.trigger($a,t))}ve(function(e){e.SecuritySettings&&(Ma=Immutable.fromJS(e.SecuritySettings))}),v.getSiteClickjackProtectionLevel=function(){return E.getSite().get(Ka)},v.isLockerServiceEnabled=function(){return Ma?Ma.get("isLockerServiceEnabled"):null},v.getCspGrandfatherStatus=function(){return Ma?Ma.get("CspGrandfatherStatus"):null},v.getUsingGrandfatheredCsp=function(){return Ma?Ma.get("UsingGrandfatheredCsp"):null},v.getUsingScriptSrcUnsafeInlineUnsafeEval=function(){return Ma?Ma.get("UsingScriptSrcUnsafeInlineUnsafeEval"):null},v.getScriptSrcTrustedSites=function(){return Ma?Ma.get("ScriptSrcTrustedSites"):null},v.getClickjackTrustedDomains=function(){return Ma?Ma.get("ClickjackTrustedDomains"):null},v.getCSPTrustedSites=function(){return Ma?Ma.get("CSPTrustedSites"):null},v.getSFDCTRustedSites=function(){return Ma?Ma.get("SFDCTrustedSites"):null},v.getScriptSecurityLevels=function(){return v.getCspGrandfatherStatus()?za:b.omit(za,"GRANDFATHERED")},v.getScriptSrcTrustedSiteById=function(t){var e=v.getScriptSrcTrustedSites();return e?e.find(function(e){return e.get("id")===t}):null},v.getCurrentScriptSecurityLevel=function(){return v.getCspGrandfatherStatus()&&v.getUsingGrandfatheredCsp()?v.getScriptSecurityLevels().GRANDFATHERED:v.getUsingScriptSrcUnsafeInlineUnsafeEval()?v.getScriptSecurityLevels().UNLOCKED:v.getScriptSecurityLevels().LOCKED},v.addGoogleAnalyticsTrustedSites=function(e){var t={},n=Va.getMissingGoogleDomainsFromCspWhitelist();b.each(n,function(e){t[e]=["connect-src","script-src"]}),Ya(t).then(function(){U(e)===("undefined"==typeof Function?"undefined":U(Function))&&e()})},v.addIntegrationTrustedSitesForLwr=function(e,t){var n={};b.each(e,function(e){n[e]=["connect-src","script-src"]}),Ya(n).then(function(){b.isFunction(t)&&t()})},v.addGoogleTranslateTrustedSites=function(e){v.addTrustedSite(Fa.GoogleTranslateDomain,null).then(e)},v.getCspViolations=function(t){return void 0!==t&&Ga.GetCspViolations(function(e){e.CspViolations&&(Ha=e.CspViolations,t(e.CspViolations))}),Ha},v.checkCSPTrustedSite=function(t){return new Promise(function(e){Ga.isCSPSiteListed(t,e)})},v.addTrustedSite=function(e,i){return new Promise(function(t){var n="script-src"===i;Ga.AddTrustedSite(e,n,function(e){qa(n,e),t()})})},v.getDisallowedCustomComponentsAsync=function(t){Ga.GetAllDisallowedComponentsForCSP(function(e){t(e)})},v.getDisallowedCustomComponentsForDisablingLockerAsync=function(t){Ga.GetAllDisallowedComponentsForDisablingLocker(function(e){t(e)})},I.event.on("action:update-site-clickjack-protection-level",function(e){var t=e.level,n=e.successCallback,i=E.getSite(),e={};e[Ka]=t,PicassoWebServices.SiteCommon.SetSiteProperties(i.get("guid"),e,function(e){i.set(Ka,t),n&&n(),I.event.trigger("state:site-clickjack-protection-level-updated",e)})}),I.event.on("action:set-csp-security-level",function(e){var t,n,e=e.securityLevel;za.GRANDFATHERED===e?n=t=!0:za.LOCKED===e?n=t=!1:za.UNLOCKED===e&&(n=!(t=!1)),Ga.SetSecurityLevel(t,n,function(e){Ma=Immutable.fromJS(e.SecuritySettings),I.event.trigger("state:csp-security-level-updated")})}),I.event.on("action:add-script-src-trusted-site",function(e){e=e.trustedSiteInfo;Ga.AddScriptSrcTrustedSite(e,function(e){Ma=Immutable.fromJS(e.SecuritySettings),I.event.trigger($a,e)})}),I.event.on("action:remove-script-src-trusted-site",function(e){var t=e.trustedSiteId,e=e.existingTrustedSite;Ga.RemoveScriptSrcTrustedSite(t,e,function(e){Ma=Immutable.fromJS(e.SecuritySettings),I.event.trigger($a,e)})}),I.event.on("action:update-script-src-trusted-site",function(e){var t=e.trustedSiteInfo,e=e.existingTrustedSite;Ga.UpdateActiveScriptSrcTrustedSite(t,e,function(e){Ma=Immutable.fromJS(e.SecuritySettings),I.event.trigger($a,e)})}),I.event.on("action:add-clickjack-trusted-domain",function(e){e=e.trustedDomain;Ga.AddClickjackTrustedDomain(e,function(e){Ma=Immutable.fromJS(e.SecuritySettings),I.event.trigger(Wa,e)})}),I.event.on("action:remove-clickjack-trusted-domain",function(e){e=e.trustedSiteId;Ga.RemoveClickjackTrustedDomain(e,function(e){Ma=Immutable.fromJS(e.SecuritySettings),I.event.trigger(Wa,e)})}),I.event.on("action:update-locker-service-enabled-state",function(e){e=e.enableLockerService;Ga.SetLockerService(e,function(e){Ma=Immutable.fromJS(e.SecuritySettings),I.event.trigger("state:locker-service-enabled-state-updated")})});var n={id:"secure-head-markup-rule",description:"secure head markup rule for locker service",init:function(e,l){var c=this,d=PicassoWebServices.Labels.CommBuilderTextEditorHeader,u=[],p={base:["href","target"],link:["as","charset","crossorigin","disabled","href","hreflang","id","import","integrity","media","rel","rellist","rev","sheet","sizes","target","title","type","fetchpriority"],meta:["charset","content","http-equiv","name","scheme","property","itemprop"],title:[],noscript:[],style:[]},g=["cleartype","content-type","content-language","default-style","x-ua-compatible"],h=["alternate","apple-touch-icon","apple-touch-icon-precomposed","apple-touch-startup-image","author","bookmark","external","help","icon","license","manifest","mask-icon","next","nofollow","noopener","noreferrer","pingback","prefetch","preload","prev","search","shortcut icon","stylesheet","tag","canonical"],m=["iframe","img","a"],i=["iframe","img","a","meta"];e.addListener("tagend",function(e){var t=u.lastIndexOf(e.tagName);if("noscript"===e.tagName){for(var n=u.length-1;t<n;n--)i.indexOf(u[n])<0&&l.error(d.InvalidNoScript,e.line,e.col,c,e.raw);u.splice(t,1)}}),e.addListener("tagstart",function(i){var s,a,e,t,o=i.tagName,r=p[o.toLowerCase()],n=0<=m.indexOf(o.toLowerCase());u.push(o.toLowerCase()),"script"===o.toLowerCase()||"x-oasis-script"===o.toLowerCase()?v.getCurrentScriptSecurityLevel()!==v.getScriptSecurityLevels().GRANDFATHERED?l.warn(d.ScriptTagWarning,i.line,i.col,c,i.raw):l.warn(d.ScriptTagGrandfatheredWarning,i.line,i.col,c,i.raw):u.indexOf("noscript")<0&&n?l.error(d.InvalidTagOutsideNoScript.replace("{0}",o),i.line,i.col,c,i.raw):r||n?r&&(s=!1,(a=2<=u.length&&"noscript"===u[u.length-2])&&"meta"===o.toLowerCase()&&(n=function(t,e){return e.every(function(e){return t.includes(e)})},t=i.attrs.map(function(e){return e.name}),n(e=["http-equiv","content"],t=t)&&n(t,e)?i.attrs.forEach(function(e){var t=e.name,e=e.value;"http-equiv"===t.toLowerCase()&&"refresh"!==e.toLowerCase()&&(t=d.InvalidMetaAttributeNoScriptTag,l.error(t,i.line,i.col,c,i.raw))}):l.error(d.InvalidMetaAttributeNoScriptTag,i.line,i.col,c,i.raw)),i.attrs.forEach(function(e){var t=e.name,n="";0===r.length||r.indexOf(t.toLowerCase())<0?n=d.InvalidAttribute.replace("{0}",o).replace("{1}",t):(e=e.value,a||("meta"===o.toLowerCase()&&"http-equiv"===t.toLowerCase()?"x-ua-compatible"===e.toLowerCase()?s=!0:g.indexOf(e.toLowerCase())<0&&(n=d.InvalidHttpEquivValue.replace("{0}",e)):s&&"content"===t.toLowerCase()&&"ie=edge"!==e.toLowerCase()?n=d.InvalidXUACompatibleValue:"link"===o.toLowerCase()&&"rel"===t.toLowerCase()&&h.indexOf(e.toLowerCase())<0&&(n=d.InvalidRelValue.replace("{0}",e)))),n&&l.error(n,i.line,i.col,c,i.raw)})):l.error(d.InvalidTag.replace("{0}",o),i.line,i.col,c,i.raw)})}},i={id:"secure-ui-output-rich-text-rule",description:"secure ui:outputRichText rule for Html Content Editor",init:function(e,a){var o=this,r=["abbr","acronym","address","blockquote","br","cite","code","dfn","div","em","font","h1","h2","h3","h4","h5","h6","kbd","p","pre","q","samp","span","strong","u","var","strike","a","dl","dt","dd","ol","ul","li","b","big","hr","i","small","sub","sup","tt","del","ins","bdo","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr","img","center","xmp","s","dir","menu","basefont","form","input","textarea","button","select","optgroup","option","label","fieldset","legend","map","area","nav","picture","video","source","iframe"],l=["align","alt","href","src","size","face","style","border","background","width","height","rowspan","colspan","color","class","start","title","valign","cellspacing","cellpadding","summary","abbr","accept-charset","accept","accesskey","action","alink","autocomplete","axis","bgcolor","char","charoff","charset","checked","cite","classid","clear","code","codebase","codetype","cols","compact","content","coords","data","datetime","declare","default","defer","dir","disabled","download","enctype","for","frameborder","headers","hreflang","hspace","http-equiv","id","ismap","label","lang","language","link","list","longdesc","loop","low","marginheight","marginwidth","max","maxlength","media","method","min","multiple","name","nohref","noresize","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","rows","rules","scheme","scope","scrolling","selected","shape","span","spellcheck","srclang","standby","step","tabindex","target","text","type","usemap","value","valuetype","version","vlink","vspace","xmlns","srcset","frameborder","allowfullscreen","mozallowfullscreen","webkitallowfullscreen","controls","controls-list","poster","autoplay","loop","muted","poster"];e.addListener("tagstart",function(t){var n,e,i=PicassoWebServices.Labels.CommBuilderHtmlContentEditor,s=t.tagName;r.indexOf(s.toLowerCase())<0?(e=i.InvalidTag.replace("{0}",s),a.error(e,t.line,t.col,o,t.raw)):("img"===s.toLowerCase()&&(e=_.find(t.attrs,{name:"src"}),n=e&&e.value&&e.value.toLowerCase()||"",s=new RegExp("^//|^http").test(n),e=v.getSFDCTRustedSites().some(function(e){return 0===n.indexOf(e.toLowerCase())}),s)&&!e&&(v.getCurrentScriptSecurityLevel()!==v.getScriptSecurityLevels().GRANDFATHERED?a.warn(i.CSPGutter,t.line,t.col,o,t.raw):a.warn(i.CSPGutterGrandfathered,t.line,t.col,o,t.raw)),t.attrs.forEach(function(e){var e=e.name;"data-"!==e.toLowerCase().substring(0,5)&&l.indexOf(e.toLowerCase())<0&&(e=i.InvalidAttribute.replace("{0}",e),a.error(e,t.line,t.col,o,t.raw))}))})}},t={id:"secure-headtag-rule",description:"secure headtag rule for SEO",init:function(e,r){var l=this,t={link:["as","charset","crossorigin","disabled","href","hreflang","id","import","integrity","media","rel","rellist","rev","sheet","sizes","target","title","type"],meta:["charset","content","http-equiv","name","scheme","property","itemprop"],script:["type"]},c=["cleartype","content-type","content-language","default-style"],d=["application/ld+json"],n=r.ruleset.expectedELPrefix;e.addListener("text",function(e){var t;""!==e.raw.trim()&&(t=PicassoWebServices.Labels.CommBuilderTextEditorHeadTag,r.error(t.InvalidTextOutsideHeadTag,e.line,e.col,l,e.raw))}),e.addListener("tagstart",function(i){var s=PicassoWebServices.Labels.CommBuilderTextEditorHeadTag,a=i.tagName,o=(ga({value:i.raw,expectedELPrefix:n,isELEnabled:!0,unsupportedELCallback:function(){r.error(PicassoWebServices.Labels.CommBuilderTextEditorHeadTag.UnsupportedExpression,i.line,i.col,l,i.raw)},invalidELCallback:function(){r.error(PicassoWebServices.Labels.CommBuilderTextEditorHeadTag.InvalidExpression,i.line,i.col,l,i.raw)}}),t[a.toLowerCase()]);o?i.attrs.forEach(function(e){var t=e.name,n="";0===o.length||o.indexOf(t.toLowerCase())<0?n=s.InvalidAttribute.replace("{0}",a).replace("{1}",t):(e=e.value,"http-equiv"===t&&c.indexOf(e.toLowerCase())<0?n=s.InvalidHttpEquivValue.replace("{0}",e):"script"===a.toLowerCase()&&"type"===t&&d.indexOf(e.toLowerCase())<0&&(n=s.InvalidTypeValue.replace("{0}",e))),n&&r.error(n,i.line,i.col,l,i.raw)}):r.error(s.InvalidTag.replace("{0}",a),i.line,i.col,l,i.raw)})}},Xa="expression",Ja="text/expression",Qa=function(i){for(var e in CodeMirror.defineMode(Xa,function(e){return{token:function(e){return e.skipToEnd()}}}),CodeMirror.defineMIME(Ja,Xa),i)CodeMirror.defineMode(Xa+e,function(e){return{token:function(e){return e.skipToEnd()}}}),CodeMirror.defineMIME(Ja+e,Xa+e);CodeMirror.defineMode("htmlwithexpressions",function(e){var t,n=[CodeMirror.getMode(e,"text/html")];for(t in i)n.push({open:"{!"+t+".",close:"}",mode:CodeMirror.getMode(e,Ja+t),delimStyle:"delimit"});return n.push({open:"{!",close:"}",mode:CodeMirror.getMode(e,Ja),delimStyle:"delimit"}),CodeMirror.multiplexingMode.apply(null,n)}),CodeMirror.registerHelper("hint","entityDictHint",function(e){return eo(e,Object.keys(i))});for(var t in i)!function(t){CodeMirror.registerHelper("hint",Xa+t,function(e){return eo(e,i[t]&&i[t].length?i[t]:[])})}(t)},Za=function(e){e.on("inputRead",function(e,t){var n=e.getCursor(),n=CodeMirror.innerMode(e.getMode(),e.getTokenAt(n).state).mode.name;n==Xa?e.showHint({hint:CodeMirror.hint.entityDictHint,completeSingle:!1}):CodeMirror.hint[n]&&e.showHint({hint:CodeMirror.hint[n],completeSingle:!1})})};function eo(e,t){var n,i=e.getCursor(),e=e.getTokenAt(e.getCursor()),s=e.string,a=e.start,o=e.end;return"delimit delimit-open"==e.type?{list:t.sort(),from:CodeMirror.Pos(i.line,o),to:CodeMirror.Pos(i.line,o)}:s?(n=new RegExp("^"+s,"i"),{list:(s?t.filter(function(e){return e.match(n)}):t.sort()).sort(),from:CodeMirror.Pos(i.line,a),to:CodeMirror.Pos(i.line,o)}):void 0}var to=PicassoWebServices.Labels.PicassoDialog,no=PicassoWebServices.Labels.CommBuilderTextEditorCss,io=".".concat(D.SPINNER_CLASSNAME),so={editorMode:"",contentKey:"",shouldValidateOnType:!1,shouldValidateOnSave:!1,updateCss:!1,reloadIFrame:!1,onSaveCallback:void 0,initialValuePromise:void 0,EditorTitle:"",EditorTips:"",CloseWarning:"",ValidationWarning:""},ao={continuousScanning:250,lineNumbers:!0,textWrapping:!1,indentUnit:4,highlightSelectionMatches:!0,autoCloseBrackets:!0,matchBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete"},mode:""},oo=["bulletproof-font-face"],ro=null;var lo=Backbone.View.extend({template:_.template('<h1 class="cb-Dialog-title">{{= title }}</h1><div class="cb-TextEditor-tips js-TextEditor-tip">{{= tips }}</div><div class="cb-TextEditor-contents"><div class="cb-TextEditor-container"><textarea class="js-TextEditor-content"></textarea></div></div><div class="cb-TextEditor-buttonBar"><button class="cb-TextEditor-cancelButton cb-Button js-text-editor-cancel">{{= cancelButton }}</button><button class="cb-TextEditor-saveButton cb-Button cb-Button--primary js-text-editor-save">{{= saveButton }}</button></div>'),warningMessage:_.template('<div class="cb-TextEditor-tipsWarningContainer">{{= icon }}<div class="cb-TextEditor-tipsWarning">{{= message }}</div></div>'),events:{"click .js-text-editor-cancel":"_cancel","click .js-text-editor-save":"_save","click .js-text-editor-clear":"_clear"},initialize:function(e){if(e.editorMode&&e.contentKey){if(!ro){var t=CSSLint.getRules();CSSLint.clearRules();for(var n=0;n<t.length;n++)-1===oo.indexOf(t[n].id)?CSSLint.addRule(t[n]):t.splice(n,1);ro=t}var i={mode:e.editorMode,readOnly:!!e.readOnly,placeholder:e.placeholder};e.shouldValidateOnType&&(i.lint=this._getCodeMirrorLintConfig(e),i.gutters=["CodeMirror-lint-markers"]),this._codeMirrorConfig=T.extend({},ao,i),this._options=T.extend({},so,e),Qa(e.expressionDictionary),e.render&&this.render(),this.listenTo(this,"focus",function(){this._getEditor().focus(),this._getEditor().refresh()})}},render:function(){return this.$el.html(this.template({title:this._options.EditorTitle,tips:this._options.EditorTips,cancelButton:to.Cancel,saveButton:to.Save})),this.$el.append(D.spinner),this._options.hideSaveButton&&(this.$(".js-text-editor-save").hide(),this.$(".js-text-editor-cancel").text(to.Close)),setTimeout(function(){var t,e=this.$(".js-TextEditor-content")[0],e=($P.texteditor=$P.texteditor||{},$P.texteditor.editor=$P.texteditor.editor||{},$P.texteditor.editor[this._options.contentKey]=CodeMirror.fromTextArea(e,this._codeMirrorConfig),$P.texteditor.editor[this._options.contentKey]);Za(e),this._resizeCodeMirrorEditorBox(),this._getEditor().focus(),this._getEditor().refresh(),this.$(".cb-TextEditor-container").attr("isReady","true"),this._options.initialValuePromise&&(t=this)._options.initialValuePromise.done(function(e){t._initTextEditorContent(e)})}.bind(this),0),this},showLoadingIndicator:function(e){this.$(io).show(),e&&(this._getEditor().options.readOnly=!0)},_options:{},_codeMirrorConfig:{},_dirtyFlag:!1,_getEditor:function(){return $P.texteditor.editor[this._options.contentKey]},_initTextEditorContent:function(e){this.$(io).hide();var t=e.value;t?this._getEditor().setValue(t):this._getEditor().setValue(""),e.loginPageReadOnly&&(this._getEditor().options.readOnly=!0,this.$(".js-TextEditor-tip").html(this.warningMessage({icon:D.icon({svgClassName:"slds-icon-text-warning slds-icon_small",icon:"warning"}),message:e.loginPageReadOnlyMessage})),(t=this.$(".js-text-editor-save")).hide(),this._generateClearButton().insertBefore(t),this._resizeCodeMirrorEditorBox(),this._getEditor().refresh()),this._getEditor().on("change",function(){this._dirtyFlag||(this._dirtyFlag=!0,this.$el.trigger("dirty",[this._options.idx]))}.bind(this)),T(window).resize(function(){this._resizeCodeMirrorEditorBox()}.bind(this))},_resizeCodeMirrorEditorBox:function(){var e=this._options,t=e.resizeSelector,n=e.resizeOffset,n=void 0===n?60:n,e=e.textEditorDialogClassName;t?(t=T(t),this.$(".CodeMirror").css({height:t.height()+"px"})):(t=T(".".concat(e)).height()-this.$(".cb-TextEditor-tips").height()-this.$(".cb-Dialog-title").height()-this.$(".cb-TextEditor-saveButton").height()-n,this.$(".CodeMirror").css({height:t+"px"}))},_generateClearButton:function(){var e=to.Clear;return T('<button class="cb-TextEditor-clearButton cb-Button cb-Button--primary js-text-editor-clear">'+e+"</button>")},_clear:function(){A.sldsModal({title:no.CSSEditorClearTitle,content:no.CSSEditorClearMsg,yesText:to.Clear,yesTextClassName:"slds-button_destructive",callback:function(e){e&&(this._getEditor().setValue(""),this._save())}.bind(this)})},_cancel:function(){if(!this._dirtyFlag)return A.closeDialog();A.sldsConfirm(this._options.CloseWarning,this._options.CloseWarningTitle,function(e){if(e)return e=T("."+this._options.textEditorDialogClassName).data().vex.id,A.closeDialogById(e)}.bind(this))},_save:function(){var e=this._getEditor().getValue().trim();if(this._options.shouldValidateOnSave&&""!==e){this._options.shouldValidateOnType||((t={}).lint=this._getCodeMirrorLintConfig(this._options),this._codeMirrorConfig=T.extend({},this._codeMirrorConfig,t));var t=this._getEditor().getHelper({line:0,ch:0},"lint")(e,this._codeMirrorConfig.lint),n=!1;if(_.some(t,function(e){if("error"===e.severity)return A.sldsAlert(this._options.ValidationWarning,this._options.ValidationWarningTitle,{yesText:this._options.ValidationWarningYes}),n=!0}.bind(this)),n)return}this._options.onSaveCallback&&"function"==typeof this._options.onSaveCallback&&this._options.onSaveCallback(e,this)},_getCodeMirrorLintConfig:function(e){return!e.customLintRules||{rules:e.customLintRules}}}),n=(e.addRule(n),e.addRule(t),e.addRule(i),"slds-tabs_default__item"),t="slds-tabs_default__content",co="."+n,uo="."+t,po=_.template('<div class="slds-tabs_default {{= className }}"><ul class="slds-tabs_default__nav" role="tablist">{{ _.each(items, function(item) { }}<li class="'+n+' {{= item.isActive ? "slds-is-active" : ""}} {{= item.tabClassName ? item.tabClassName : "" }}" role="presentation"><a class="js-tab-link slds-tabs_default__link" href="javascript:void(0)" role="tab">{{= item.label }}</a></li>{{ }) }}</ul></div>'),go=_.template('<div class="'+t+' {{= isActive ? "slds-show" : "slds-hide" }} {{= contentClassName }}" role="tabpanel"></div>');function ho(t,n){t.append(po(_.extend({className:""},n))),_.each(n.items,function(e){t.append(go(_.extend({isActive:!1,contentClassName:""},e)))}),t.find(uo).each(function(e){n.items[e].view=n.items[e].content(T(this))}),t.on("click",co,function(e){e=T(e.currentTarget),t.find(co).removeClass("slds-is-active"),e.addClass("slds-is-active"),e=e.index(),t.find(uo).addClass("slds-hide").removeClass("slds-show").eq(e).addClass("slds-show").removeClass("slds-hide"),e=n.items[e].view;e&&e.trigger&&e.trigger("focus")})}var mo=Backbone.View.extend({className:"cb-TabbedTextEditorView slds-p-vertical_medium ",template:'<div class="js-tabs-container"></div>',initialize:function(e){var e=e.initialValuePromise,t=this;this.isLoading=!0,e.then(function(e){t.isLoading=!1,t.tabs=e,t.render()}),this.render()},render:function(){if(this.isLoading)this.$el.html(D.spinner);else{this.$el.html(this.template);var e=this.$(".js-tabs-container");if(!(this.tabs&&0<this.tabs.length))throw A.closeDialog(),Error("loading finished but no tab content was loaded");ho(e,{className:"slds-p-horizontal_large",items:this.tabs.map(function(e,t){var n=e.textEditorOptions;return m(m({},e.tab),{},{content:function(e){return new lo(m(m({},n),{},{el:e,render:!0,idx:t}))},contentClassName:"js-tabbed-text-editor-".concat(t)})})}),this.$(".js-tabs-container").on("dirty",function(e,t){t=this.$(".js-tab-link").eq(t);t&&0<t.length&&t.text("".concat(t.text(),"*"))}.bind(this))}return this}}),vo=(Ye.getLwcSourcePromise=function(e){return new Promise(function(t,n){e||n(new Error("component FQN is required")),PicassoWebServices.PicassoDebug.getComponentSourceCode(e,function(e){e&&!e.Errors?t(e):n(e&&e.Errors)})})},I.event.on("action:update-lwc-src",function(e){var t=e.cmpFqn,n=e.sources,i=e.successCallback,s=e.errorCallback;PicassoWebServices.PicassoDebug.UpdateComponentSourceCode(t,void 0===n?{}:n,function(e){e.Errors&&s?s(e.Errors):!e.Errors&&i&&i(e)})}),PicassoWebServices.Labels.CommBuilderHtmlContentEditor),bo=PicassoWebServices.Labels.LwcIDELite;function fo(){t={},Object.keys($P.texteditor.editor).forEach(function(e){t[e]=$P.texteditor.editor[e].getValue()});var t,e=t,e=Object.entries(e).filter(function(e){return J(e,1)[0].startsWith("lwc/")}),n={};return e.forEach(function(e){var e=J(e,2),t=e[0],e=e[1];n[t]=e}),n}function _o(i,e,t,n){u(s={editorMode:function(e){switch(e){case"js":return"text/javascript";case"html":return"text/html";case"css":return"css";case"xml":return"xml";default:return"text"}}(-1<(s=(a=e).lastIndexOf("."))&&s<a.length-1?a.substring(s+1):a),contentKey:e,shouldValidateOnType:!1,shouldValidateOnSave:!0,EditorTitle:i,EditorTips:"<b>[Internal Only]</b> ".concat(bo.Description),textEditorDialogClassName:"cb-TextEditor-dialog"},"shouldValidateOnSave",!1),u(s,"ValidationWarning",vo.ValidationWarning),u(s,"CloseWarningTitle",vo.CloseWarningTitle),u(s,"ValidationWarningTitle",vo.ValidationWarningTitle),u(s,"CloseWarning",vo.CloseWarning),u(s,"resizeOffset",180);var s,a=s,e=(0<n&&(a.resizeSelector=".js-tabbed-text-editor-0 .CodeMirror"),$.Deferred());return e.resolve({value:t}),a.initialValuePromise=e.promise(),a.onSaveCallback=function(e,t){var n;t.showLoadingIndicator(!0),n=i,t=fo(),I.event.trigger("action:update-lwc-src",{cmpFqn:n,sources:t,successCallback:function(){A.closeDialog(),I.event.trigger("action:refresh-current-page"),w.success({message:L.format(bo.SuccessMessage,n),duration:w.DURATION_MEDIUM,canDismiss:!0})},errorCallback:function(e){A.closeDialog(),w.error({message:L.format(bo.FailureMessage,n,e),canDismiss:!0})}})},a}function So(n,e){var i=T.Deferred();(0,PicassoWebServices.ManageSiteCommon.GetCommunityBuilderTextEditorContent)(n.pageId,n.contentKey,function(e){var t=E.getSite().get("loginpage");n.pageId===t&&k.isCommunityBasedTemplate()&&"page"===e.origin&&(e.loginPageReadOnly=!0,e.loginPageReadOnlyMessage=PicassoWebServices.Labels.CommBuilderTextEditorCss.EditorLoginReadOnly),i.resolve(e)}),n.initialValuePromise=i.promise(),n.onSaveCallback=function(t){PicassoWebServices.ManageSiteCommon.SetCommunityBuilderTextEditorContent(n.pageId,n.contentKey,t,function(e){e.isSaved?("function"==typeof n.successCallback&&n.successCallback(e,t),n.updateCss&&j.getAppEvent().trigger("custom-css-changed",t),n.reloadIFrame&&I.event.trigger("action:refresh-current-page"),I.getAppState().getCurrentPage().set(n.contentKey,t),n.keepOpen||A.closeDialog()):A.sldsAlert(n.errorMessage)})},Eo(n,e)}function Co(t,e){var n=PicassoWebServices.Labels.CommBuilderHtmlContentEditor,n=(v.getCurrentScriptSecurityLevel(),v.getScriptSecurityLevels().GRANDFATHERED,{editorMode:"htmlwithexpressions",contentKey:"CustomMarkup",shouldValidateOnType:!0,shouldValidateOnSave:!0,EditorTitle:n.EditorTitle,EditorTips:n.EditorTips.replace("{0}",E.getSite().get("htmlContentEditorHelpUrl")),textEditorDialogClassName:"cb-TextEditor-dialog",ValidationWarning:n.ValidationWarning,CloseWarningTitle:n.CloseWarningTitle,ValidationWarningTitle:n.ValidationWarningTitle,CloseWarning:n.CloseWarning,customLintRules:{"secure-ui-output-rich-text-rule":!0},expressionDictionary:e}),i=T.Deferred(),e=f.getContainingViewOrThemeLayoutId(t),e=(PicassoWebServices.ManageSiteCommon.GetHtmlForContentBlocks([t],!1,e,function(e){i.resolve({value:e[t]})}),n.initialValuePromise=i.promise(),{showCloseButton:!(n.onSaveCallback=function(e){I.event.trigger("action:save-rte-content",{itemId:t,editorContent:e,decodeContentAsset:!0,successCallback:function(){I.event.trigger("state:aura-component-updated",{itemId:t}),A.closeDialog()}})}),contentClassName:n.textEditorDialogClassName,className:"cb-TextEditor-vex-theme",escapeButtonCloses:!1});Eo(n,e)}function yo(e){var e=Ye.getLwcSourcePromise(e).then(function(e){var s=e.fqn,t=e.source;return new Promise(function(e){e(Object.entries(t).map(function(e,t){var e=J(e,2),n=e[0],e=e[1],i=n.lastIndexOf("/"),i=n.substring(i+1);return{textEditorOptions:_o(s,n,e,t),tab:{label:i,tabClassName:"js-tab-".concat(n.replaceAll(/[\/\.]/g,"-")),isActive:0===t}}}))})}).catch(function(e){return console.warn(e)}),t={showCloseButton:!1,contentClassName:"cb-TextEditor-dialog",className:"cb-TextEditor-vex-theme cb-TextEditor-lwcEditor",escapeButtonCloses:!1},n=e;n=new mo({initialValuePromise:e}),A.showDialog(n,t)}function To(e){return 0===e.indexOf("/")?e:"/"+e}function Po(e){return S.getThemeLayoutByType(e).name}function Io(e){var t=e.tooltipLabel,e=e.buttonAttributes;return D.tooltipButtonIcon({buttonClassName:"slds-form-element__icon",buttonAttributes:e,tooltipPlacement:"right",tooltipLabel:t})}var Eo=function(e,t){e=new lo(e);A.showDialog(e,t)},R=PicassoWebServices.Labels.CommBuilderPageManagement,wo=PicassoWebServices.Labels.CommBuilderTextEditorHeadTag,Lo="."+P.GLOBAL_SELECTOR.PAGE_MANAGER,Do=P.PROP,Ao=P.SEO_CMP_PROP,ko=P.ROUTE.LOGIN_APP_ROUTE_URL_PATH_PREFIX,No=P.THEME_LAYOUT_TYPE,xo=[{Label:R.DeprecatedOneColLayout,Name:"siteforce:oneColumnLayout"},{Label:R.DeprecatedTwoColLayout,Name:"siteforce:twoColumnLayout"}],Ro=["article","createrecord","feeditem-generic","feeditem","search-topic","topic","usersettings","category-1","category-2","search-category","list-Case","error"],jo=" ("+R.DefaultThemeLayoutSuffix+")",Bo="base",Oo="segment",Mo=Backbone.View.extend({_routeId:null,_deferredContentLayouts:[],_layouts:[],_hasLoadedContentLayouts:!1,_canChangeLayout:!0,_isSeoDataLoaded:!1,_contentTemplate:_.template('<div class="cb-PageManager-routeDetails slds-form--stacked">{{= routeDetails }}</div><div class="cb-PageManager-viewDetails slds-form--stacked {{= hasViews ? "contained" : ""}}">{{ if (hasViews) { }}{{= viewPicklist }}{{ } }}{{= viewDetails }}</div>'),_inputTextTemplate:_.template('<div class="form-group cb-PageManager-inputGroup slds-form-element test-input-{{= name }}"><label for="js-input-{{= name }}" class="cb-PageManager-inputGroupLabel slds-form-element__label">{{= label}}</label>'+Io({tooltipLabel:"{{= tooltip }}"})+'{{ if (isELEnabled) { }}{{= $P.viewTypes.CommonTemplates.bsButtonIconWithTooltipInContainer({ buttonClassName: "cb-PageManager-expressionIcon test-el-tooltip", placement: "right", container: "'+Lo+'", svgClassName: "", icon: "merge_field", label: seoELTooltipText }) }}{{ } }}<input type="text" class="form-control js-validation-required js-input js-input-{{= name }} slds-input" id="js-input-{{= name }}" data-prop="{{= propName }}" value="{{= value }}" placeholder="{{= placeholder }}" maxlength="{{= maxlength }}" {{= isDisabled ? "disabled" : "" }}></div>'),_inputTextareaTemplate:_.template('<div class="form-group cb-PageManager-inputGroup slds-form-element test-input-description"><label for="js-input-description" class="cb-PageManager-inputGroupLabel slds-form-element__label">{{= label}}</label>'+Io({tooltipLabel:"{{= tooltip }}"})+'{{ if (isELEnabled) { }}{{= $P.viewTypes.CommonTemplates.bsButtonIconWithTooltipInContainer({ buttonClassName: "cb-PageManager-expressionIcon test-el-tooltip", placement: "right", container: "'+Lo+'", svgClassName: "", icon: "merge_field", label: seoELTooltipText }) }}{{ } }}<textarea class="form-control cb-PageManager-inputGroupTextArea slds-textarea js-validation-required js-input-description" id="js-input-description" data-prop="{{= propName }}" placeholder="{{= placeholder }}" maxlength="{{= maxlength }}">{{= value }}</textarea></div>'),_inputHeadTagTemplate:_.template('<div class="form-group cb-PageManager-inputGroup slds-form-element"><label for="js-input-headtag" class="cb-PageManager-inputGroupLabel slds-form-element__label">{{= label }}</label>'+Io({tooltipLabel:"{{= tooltip }}"})+'{{= $P.viewTypes.CommonTemplates.button({ buttonClassName: "cb-PageManager-headTagBtn js-input-headtag", buttonVariantClassName: "slds-button_neutral", label: "'+R.EditHeadTags+'" }) }} </div>'),_inputDisabledUrlTemplate:function(e){var t=e.name,n=e.label,i=e.tooltip,s=e.value,s=void 0===s?"":s,a=e.buttonTemplate,a=void 0===a?"":a,e=e.propName;return'<div class="form-group cb-PageManager-inputGroup slds-form-element">\n                <label for="js-input-'.concat(t,'" class="cb-PageManager-inputGroupLabel slds-form-element__label">').concat(n,"</label>\n                ").concat(Io({tooltipLabel:"".concat(i)}),'\n                <div class="slds-form-element__control">\n                    <input type="text" class="form-control js-input-url js-input-').concat(t,' slds-input" id="js-input-').concat(t,'" value="').concat(s,'" disabled data-prop="').concat(e,'">\n                </div>\n                ').concat(a,"\n            </div>").trim()},_inputAuthStateTemplate:_.template('<div class="form-group cb-PageManager-inputGroup slds-form-element"><label for="js-input-{{= name }}" class="cb-PageManager-inputGroupLabel slds-form-element__label">{{= label}}</label>'+Io({buttonAttributes:'data-html="true"',tooltipLabel:"{{= tooltip }}"})+'<div class="slds-form-element__control"><div class="slds-input-group cb-input-group"><div class="slds-select_container"><select class="slds-select js-input-auth-state" data-prop="{{= propName }}">{{= authStateOptionsHtml }}</select></div></div></div></div>'),_inputAuthStateDescriptionTemplate:_.template('<div class="cb-PageManager-contentDetails-section js-auth-state-section"><div class="cb-PageManager-contentDetails-section--heading js-auth-state-section-heading">'+R.AuthStateLabel+'</div><div class="cb-PageManager-contentDetails-section--helpText js-auth-state-section-helpText">{{= helpText }}</div></div>'),_viewPicklistTemplate:_.template('<div class="form-group cb-PageManager-inputGroup cb-PageManager-viewPicklist slds-form-element test-view-picklist-container"><span class="slds-badge slds-truncate cb-PageManager-viewBadge test-view-picklist-badge" title="{{- viewName}}">{{- viewName }}</span><label for="js-input-view" class="cb-PageManager-inputGroupLabel slds-form-element__label">{{= label}}</label>'+Io({buttonAttributes:'data-html="true" data-container="'.concat(Lo,'"'),tooltipLabel:"{{= tooltip }}"})+'<div class="slds-form-element__control"><div class="slds-input-group cb-input-group"><div class="slds-select_container"><select class="slds-select js-input-view test-select-page-variation-dropdown">{{= viewOptionsHtml }}</select></div></div></div></div>'),_contentLayoutTemplate:_.template('<div class="form-group cb-PageManager-inputGroup slds-form-element js-content-layouts-section"><label class="cb-PageManager-inputGroupLabel slds-form-element__label">{{= label}}</label>'+Io({buttonAttributes:'data-html="true" data-container="'.concat(Lo,'"'),tooltipLabel:"{{= tooltip }}"})+'<div class="slds-form-element__control"><div class="slds-input-group"><input type="text" class="form-control slds-input js-content-layout-field" value="{{- value }}" disabled><a class="slds-input-group-addon slds-button cb-PageManager-inputButton js-content-layout {{= layoutsLoaded && canChangeLayout ? "" : "disabled" }}">'+R.InputFieldLayoutButton+"</a></div></div></div>"),_themeCheckboxTemplate:function(e){var t=e.isChecked,e=e.tooltip;return'<div class="form-group cb-PageManager-inputGroup slds-form-element">\n            <div class="slds-form-element__control">\n                <span class="slds-checkbox">\n                    <input type="checkbox" id="js-input-theme-checkbox" class="js-input-theme-checkbox" '.concat(t?"checked":"",'/>\n                    <label class="slds-checkbox__label" for="js-input-theme-checkbox">\n                        <span class="slds-checkbox_faux"></span>\n                        <span class="slds-form-element__label">').concat(R.ThemeLayoutCheckboxLabel,"</span>\n                        ").concat(D.tooltipButtonIcon({buttonAttributes:'data-html="true" data-container="'.concat(Lo,'"'),tooltipPlacement:"right",tooltipLabel:"".concat(e)}),"\n                    </label>\n                </span>\n            </div>\n        </div>").trim()},_themeLayoutTemplate:_.template('<div class="form-group cb-PageManager-inputGroup slds-form-element js-theme-picklist {{= isCheckboxChecked ? "" : "hidden"}}"><label for="js-input-theme-layout" class="cb-PageManager-inputGroupLabel slds-form-element__label">{{= label}}</label>'+Io({buttonAttributes:'data-html="true" data-container="'.concat(Lo,'"'),tooltipLabel:"{{= tooltip }}"})+'<div class="slds-form-element__control"><div class="slds-input-group cb-input-group"><div class="slds-select_container"><select class="slds-select js-input-theme-layout test-input-theme-layout" data-prop="{{= propName }}">{{= themeLayoutTypeOptionsHtml }}</select></div></div></div></div>'),_themeContainerTemplate:_.template('<div class="form-group cb-PageManager-inputGroup slds-form-element js-theme-layout-container">{{= themeHtml}}</div>'),_seoSectionTemplate:_.template('<div><div class="cb-PageManager-contentDetails-section--heading js-seo-section-heading">'+R.SeoSectionHeading+'</div><div class="cb-PageManager-contentDetails-section--helpText js-seo-section-helpText">{{= seoHelpLabel }}</div></div>'),_seoSectionContainerTemplate:_.template('<div class="cb-PageManager-contentDetails-section js-seo-section"></div>'),_layoutSectionTemplate:_.template('<div class="cb-PageManager-contentDetails-section"><div class="cb-PageManager-contentDetails-section--heading">'+R.LayoutSectionHeading+"</div>{{= contentLayoutHtml}}{{= themeContainerHtml}}</div>"),_changeUrlButton:function(e){var t=e.urlType,e=e.label;return'<button class="cb-PageManager-contentDetails-section--changeUrl js-change-url slds-button slds-button_neutral slds-m-top_small" data-type="'.concat(t,'">\n            ').concat(e,"\n        </button>").trim()},events:{"keyup .js-input":function(e){C.persistCurrentTarget(this._handleInputKeyUp.bind(this),e)},"keyup .js-input-url":function(e){C.persistCurrentTarget(this._handleInputKeyUp.bind(this),e)},"blur .js-input:not(.js-input-title)":"_onUpdateRouteProp","blur .js-input-title":function(e){C.persistCurrentTarget(this._onUpdateSeo.bind(this),e)},"blur .js-input-description":function(e){C.persistCurrentTarget(this._onUpdateSeo.bind(this),e)},"change .js-input-auth-state":"_onUpdateRouteProp","change .js-input-theme-checkbox":"_onToggleThemeCheckbox","change .js-input-theme-layout":"_onChangeThemeLayout","change .js-input-view":"_onChangeView","click .js-content-layout:not(.disabled)":"_changeContentLayout","click .js-input-headtag":"_handleInputHeadTag","click .js-change-url":"_onChangeUrl"},initialize:function(e){this.options=e||{},this._routeId=this.options.routeId,this._selectedRouteId=this.options.selectedRouteId,this._itemRoutes=e.parent&&e.parent.getItemRoutes(),this._viewId=this._routeId===this._selectedRouteId?I.getAppState().getCurrentViewId():this.options.viewId,this._defaultThemeLayout="",this._deferredContentLayouts.push(ya.getAvailableLayouts(function(e){this._layouts=e.concat(xo),this._hasLoadedContentLayouts=!0}.bind(this))),this._deferredSeoPromise=h.getSEODataPromise(this._routeId),this._canChangeLayout=!k.hasDynamicLayout(this._viewId)&&!c.isServiceNotAvailableView(this._viewId),this._themeLayoutTypes=_.chain(S.getCurrentTheme().themeLayouts).sortBy(function(e){return e.name.toLowerCase()}).map(function(e){return e.type}).value(),this.$el.scroll(function(){this.$(".js-validation-required").popover("destroy")}.bind(this)),this._setupListeners()},render:function(){return this._hasLoadedContentLayouts||this.renderContentLayoutAsync(),h.isThemeLayoutFetched()?this._defaultThemeLayout=this._getDefaultThemeLayoutByRouteType(this._routeId):this.listenTo(I.event,"state:theme-layout-map-loaded",this.renderThemeLayoutAsync),this.$el.html(this._contentTemplate({routeDetails:this._buildRouteDetailsHtml(this._routeId),hasViews:1<this._getRoute().getViews().length,viewPicklist:this._buildViewPicklistHtml(this._viewId),viewDetails:this._buildViewDetailsHtml(this._viewId)})),this._isSeoDataLoaded||this.renderSeoSectionAsync(),this.initializeToolTips(),this},renderContentLayoutAsync:function(){return T.when.apply(this,this._deferredContentLayouts).done(function(){var e=[];this._buildContentLayoutHtml(this._viewId,e),this.$el.find(".js-content-layouts-section").html(e.join(""))}.bind(this)),this},renderThemeLayoutAsync:function(){this._defaultThemeLayout=this._getDefaultThemeLayoutByRouteType(this._routeId);var e=[];return this._buildThemeHtml(Do.THEME_LAYOUT_TYPE_KEY,this._viewId,e),this.$el.find(".js-theme-layout-container").html(e.join("")),this},renderSeoSectionAsync:function(){return this._deferredSeoPromise.done(function(){this._isSeoDataLoaded=!0;var e=[];this._buildSeoSectionHtml(e),this.$el.find(".js-seo-section").html(e.join(""))}.bind(this)),this},initializeToolTips:function(){T.when.apply(this,[this._deferredContentLayouts,this._deferredSeoPromise]).done(function(){this.$('[data-toggle="tooltip"]').tooltip()}.bind(this))},_buildSeoSectionHtml:function(e){var t,n,i=this._getRoute().get(Do.ROUTE_TYPE_KEY);I.AccessControl(P.PERMISSIONS.SEO_SETTING)&&(this._shouldDisplaySEOFields()?(n=(t=h.getSeoComponentDataByRouteId(this._routeId)).title,t=t.description,this._buildSeoSectionHeaderHtml(e,R.SeoSectionHelpText+"&nbsp;"+R.LearnMore),this._buildInputTitleHtml(Ao.TITLE_KEY,n,e),this._buildInputDescriptionHtml(Ao.DESC_KEY,t,e),this._buildInputHeadTagHtml(e)):(n=h.getSeoIndexByRouteType(i)===P.NO_INDEX?R.SeoSectionNoIndexHelpText:R.SeoSectionNoFieldsHelpText,this._buildSeoSectionHeaderHtml(e,n+"&nbsp;"+R.LearnMore)))},_buildSeoContainerHtml:function(e){e.push(this._seoSectionContainerTemplate())},_buildAuthStateHtml:function(e){for(var t=I.getAppState().getCurrentSite().isCommunityPublic(),n=R.AuthStateRequiresLogin,i=(t&&(n=R.AuthStatePublic),""),s=[{value:"UseParent",label:R.AuthStateUseParent+": "+n},{value:"Public",label:R.AuthStatePublic},{value:"RequiresLogin",label:R.AuthStateRequiresLogin}],a=0;a<s.length;++a){var o=s[a],r=e===o.value;i+='<option value="'+o.value+'"'+(r?"selected":"")+">"+o.label+"</option>"}return this._inputAuthStateTemplate({name:"route-auth",label:R.AuthStateLabel,propName:"AuthorizationState",authStateOptionsHtml:i,tooltip:R.AuthStateTooltip})},_shouldDisplayAuthStateDropdown:function(e){var t=e.get(Do.ROUTE_TYPE_KEY),n=_.includes(Ro,t),i=I.getAppState().isCurrentPageAuthenticated(),t="error"===t&&!I.getAppState().getCurrentSite().isCommunityPublic();return!e.isObjectRoute()&&!e.isGenericObjectRoute()&&!n&&e.isRouteDefinitionAuthStateDefault()&&i||t},_getHelpText:function(e,t){var n=R.CommunityPublicHelpText,i=R.CommunityPrivateHelpText;return E.getSite().isWebApp()&&(n=R.LwrCommunityPublicHelpText,i=R.LwrCommunityPrivateHelpText),e.isRouteDefinitionAuthStateDefault()&&"error"===t?R.ErrorRouteAuthStatePublic:e.isRouteDefinitionAuthStateDefault()&&I.getAppState().getCurrentSite().isCommunityPublic()?n:e.isRouteDefinitionAuthStateAlwaysPrivate()?R.RouteDefinitionAuthStateAlwaysPrivateHelpText:e.isRouteDefinitionAuthStateDefault()&&I.getAppState().isCurrentPageAuthenticated()?i:""},_buildRouteDetailsHtml:function(e){var t,n=[],i=this._getRoute(),s=i.get(Do.ROUTE_URL_KEY),a=i.getAuthState(),o=i.get(Do.NAME_KEY),r=i.get(Do.ROUTE_TYPE_KEY),l=i.get(Do.DEV_NAME_KEY),o=(this._buildInputNameHtml(Do.NAME_KEY,o,!this._isRouteRenameAllowed(i),n),R.InputFieldUrlNotEditableTooltip);return i.isUrlSegmentEditable()&&(o=R.InputFieldUrlFullUrlEditableTooltip,t=this._changeUrlButton({urlType:Oo,label:R.ActionChangeURL})),i.isOnlyBaseUrlEditable()&&(o=R.InputFieldUrlOnlyBaseEditableTooltip,t=this._changeUrlButton({urlType:Bo,label:R.ActionChangeBaseURL})),i.isLoginRoute()&&E.getSite().get("loginpage")&&(s="/"===s?ko:ko.concat(s)),this._buildInputUrlHtml({propName:Do.ROUTE_URL_KEY,currentUrl:s,buttonTemplate:t,html:n,tooltip:o}),this._buildInputDevNameHtml(Do.DEV_NAME_KEY,l,!0,n),n=this._shouldDisplayAuthStateDropdown(i)?[].concat(Q(n),[this._buildAuthStateHtml(a)]):(s=this._getHelpText(i,r))?[].concat(Q(n),[this._inputAuthStateDescriptionTemplate({helpText:s})]):n,this._buildSeoContainerHtml(n),n.join("")},_buildViewPicklistHtml:function(n){var e=[],i="",t=_.sortBy(this._getRoute().getViews(),function(e){return e.get(Do.NAME_KEY).toLowerCase()});return _.each(t,function(e){var t=e.id;i+='<option class="test-page-variation-option" value="'+t+'"'+(n===t?"selected":"")+">"+e.get(Do.NAME_KEY)+"</option>"}),e.push(this._viewPicklistTemplate({label:R.PageVariationPickerLabel,tooltip:R.InputFieldPageVariationPickerTooltip,viewName:h.getViews().get(this._viewId).get(Do.NAME_KEY),viewOptionsHtml:i})),e.join("")},_buildViewDetailsHtml:function(e){var t=[];return this._buildLayoutSectionHtml(t,this._getRoute(),e),t.join("")},_buildInputNameHtml:function(e,t,n,i){i.push(this._inputTextTemplate({name:"name",label:R.InputFieldNameHeading,propName:e,value:t,placeholder:R.InputFieldNamePlaceholder,maxlength:40,isDisabled:n,tooltip:R.InputFieldNameTooltip,isELEnabled:!1}))},_buildInputDevNameHtml:function(e,t,n,i){i.push(this._inputTextTemplate({name:"devname",label:R.InputFieldDevNameHeading,propName:e,value:t,placeholder:R.InputFieldDevNamePlaceholder,maxlength:40,isDisabled:n,tooltip:R.InputFieldDevNameTooltip,isELEnabled:!1}))},_buildInputTitleHtml:function(e,t,n){n.push(this._inputTextTemplate({name:"title",label:R.InputFieldTitleHeading,propName:e,value:_.escape(t),placeholder:R.InputFieldTitlePlaceholder,maxlength:100,isDisabled:!1,tooltip:R.InputFieldTitleTooltip,isELEnabled:!0,seoELTooltipText:this._getSeoELToolTipText()}))},_buildInputDescriptionHtml:function(e,t,n){n.push(this._inputTextareaTemplate({label:R.InputFieldDescriptionHeading,propName:e,value:t,placeholder:R.InputFieldDescriptionPlaceholder,maxlength:400,tooltip:R.InputFieldDescriptionTooltip,isELEnabled:!0,seoELTooltipText:this._getSeoELToolTipText()}))},_buildInputHeadTagHtml:function(e){e.push(this._inputHeadTagTemplate({label:R.HeadTags,tooltip:R.InputFieldHeadTagTooltip}))},_buildInputUrlHtml:function(e){var t=e.propName,n=e.currentUrl,i=e.buttonTemplate,s=e.html,e=e.tooltip;c.isServiceNotAvailableView(this._viewId)||s.push(this._inputDisabledUrlTemplate({name:"routeurl",label:R.InputFieldUrlHeading,propName:t,buttonTemplate:i,value:To(n),tooltip:e}))},_buildContentLayoutHtml:function(e,t){var e=h.getViews().get(e).get("AuraTag"),n=_.find(this._layouts,{Name:e}),i=R.Loading;this._hasLoadedContentLayouts&&(i=n?n.Label:e),t.push(this._contentLayoutTemplate({name:"layout",label:R.InputFieldLayoutHeading,value:i,tooltip:R.InputFieldLayoutTooltip,layoutsLoaded:this._hasLoadedContentLayouts,canChangeLayout:this._canChangeLayout}))},_buildThemeHtml:function(e,t,n){var i=h.getViews().get(t).get("ThemeLayoutType"),s="",a=c.isServiceNotAvailableView(t);_.each(this._themeLayoutTypes,function(e){var t=i===e,n=this._defaultThemeLayout===e?Po(e)+jo:Po(e);(a&&e===No.SERVICE_NOT_AVAILABLE||!a&&e!==No.SERVICE_NOT_AVAILABLE)&&(s+='<option class="test-theme-layout-option" value="'+_.escape(e)+'"'+(t?"selected":"")+">"+_.escape(n)+"</option>")}.bind(this)),1<s.length&&(null!==this._defaultThemeLayout&&n.push(this._themeCheckboxTemplate({isChecked:i!==this._defaultThemeLayout,tooltip:R.InputFieldThemeLayoutPicklistTooltip})),n.push(this._themeLayoutTemplate({label:R.InputFieldThemeLayoutHeading,propName:e,themeLayoutTypeOptionsHtml:s,tooltip:R.InputFieldThemeLayoutTypeTooltip,isCheckboxChecked:i!==this._defaultThemeLayout})))},_buildRequiresAuthHtml:function(e,t,n,i){i.push("<div></div>")},_buildSeoSectionHeaderHtml:function(e,t){e.push(this._seoSectionTemplate({seoHelpLabel:t}))},_buildLayoutSectionHtml:function(e,t,n){var i=[],s=[],a=[];this._buildContentLayoutHtml(n,i),(I.getAppState().isCurrentPageAura()&&I.getAppState().supportsNewFeatures()||E.getSite().isWebApp())&&!t.isAllowedInStaticSite()&&(h.isThemeLayoutFetched()?(this._buildThemeHtml(Do.THEME_LAYOUT_TYPE_KEY,n,a),s.push(this._themeContainerTemplate({themeHtml:0<a.length?a.join(""):""}))):s.push(this._themeContainerTemplate({themeHtml:R.Loading}))),e.push(this._layoutSectionTemplate({contentLayoutHtml:i,themeContainerHtml:0<s.length?s.join(""):""}))},_shouldDisplaySEOFields:function(){var e=this._getRoute().get(Do.ROUTE_TYPE_KEY);return!(k.isGenericObjectListRouteType(e)||k.isGenericObjectRelatedListRouteType(e)||k.isObjectListRouteType(e)||k.isObjectRelatedListRouteType(e)||k.isExtObjectRouteType(e)||h.getSeoIndexByRouteType(e)||_.isEmpty(h.getSeoComponentDataByRouteId(this._routeId)))},_changeContentLayout:function(){var e=new Ea({viewId:this._viewId,routeId:this._routeId,successCallback:this._onViewPropUpdated.bind(this)});A.showDialog(e,{contentClassName:"cb-Dialog cb-ChangeLayoutDialog",className:"slds-vex-theme"})},_onToggleThemeCheckbox:function(e){var t=this.$(".js-theme-picklist"),e=(t.toggleClass("hidden"),!T(e.currentTarget).is(":checked"));e||t[0].scrollIntoView(),e&&T(".js-input-theme-layout").val()!==this._defaultThemeLayout&&this._updateThemeLayout(this._defaultThemeLayout)},_onChangeThemeLayout:function(e){e=T(e.currentTarget).val();this._updateThemeLayout(e)},_onChangeUrl:function(e){var t,e=T(e.currentTarget).data("type"),n=this.$(".js-input-url"),i=this._getRoute().get(Do.PARENT_URL_KEY);e===Bo?t=new La({urlSegment:this._getObjectUrlPrefixSegment(),parentUrlHtml:c.constructSpacedUrl(i),parentUrlTooltip:i,itemRoutes:this._itemRoutes,routeId:this._routeId,isChangingBaseUrl:!0,onSave:this._updateRouteBaseUrls.bind(this)}):e===Oo&&(e=h.getRoutes().get(this._routeId).getRouteSegment().replace("/",""),t=new La({urlSegment:e,parentUrlHtml:c.constructSpacedUrl(i),parentUrlTooltip:i,routeId:this._routeId,isChangingBaseUrl:!1,onSave:function(e){this._doRoutePropChange(Do.ROUTE_URL_SEGMENT_KEY,"/".concat(e),n)}.bind(this)})),t&&t.render()},_updateThemeLayout:function(e){I.event.trigger("action:update-view-property",{id:this._viewId,name:Do.THEME_LAYOUT_TYPE_KEY,value:e,successCallback:this._onViewPropUpdated.bind(this)})},_onViewPropUpdated:function(){I.event.trigger("action:navigate-to-page",{viewId:this._viewId,routeId:this._routeId})},_onChangeView:function(e){e=T(e.currentTarget).val();this._canChangeLayout=!k.hasDynamicLayout(e),I.event.trigger("action:navigate-to-page",{viewId:e,routeId:this._routeId})},_handleInputKeyUp:_.debounce(function(e){var t=T(e.currentTarget);e.which===P.KEYCODE.ENTER&&t.trigger("blur")},C.DEBOUNCE_INTERVAL),_handleShowErrorPopover:function(e,t){return 0<t.length?(e.data("error",t[0]),c.showErrorPopover(e,t[0],Lo),!0):(e.removeData("error"),c.removeErrorPopover(e),!1)},_updateRouteBaseUrls:function(e){var t=_.map(this._itemRoutes,function(e){return e.id});I.event.trigger("action:update-routes-base-urls",{routeIds:t,baseUrl:"/".concat(e),successCallback:function(){this._urlPrefix=e}.bind(this)})},_onUpdateRouteProp:function(e){var e=T(e.currentTarget),t=e.val(),n=e.data("prop"),i=[];this._getRoute().get(n)===t||(n===Do.NAME_KEY&&(40<t.length&&(t=t.substring(0,40)),i=this._isNameValid(t)),this._handleShowErrorPopover(e,i))||this._doRoutePropChange(n,t,e)},_doRoutePropChange:function(e,t,n){this._getRoute().get(e)!==t&&(c.displayProgressIndicator(n),I.event.trigger("action:update-route-property",{id:this._routeId,name:e,value:t,successCallback:function(){c.removeProgressIndicator()}}))},_onUpdateSeo:_.debounce(function(e){var e=T(e.currentTarget),t=e.val(),n=e.data("prop"),i=[];h.getSeoComponentDataByRouteId(this._routeId)[n]===t||(n===Ao.TITLE_KEY?(100<t.length&&(t=t.substring(0,100)),i=this._isTitleValid(t)):n===Ao.DESC_KEY&&(400<t.length&&(t=t.substring(0,400)),i=this._isDescValid(t)),this._handleShowErrorPopover(e,i))||this._doRouteSeoPropChange(n,t,e)},125),_doRouteSeoPropChange:function(e,t,i){c.displayProgressIndicator(i),I.event.trigger("action:update-route-seo-property",{id:this._routeId,name:e,value:t,successCallback:function(){c.removeProgressIndicator(),i.data("error")&&i.removeData("error")},errorCallback:function(e){var t,n;c.removeProgressIndicator(),(e.invalidFields||e.noAccessFields)&&(n="",e.invalidFields&&(t=e.invalidFields.join(", "),n+=R.ValidationErrorInvalidFields+t),e.noAccessFields&&(t=e.noAccessFields.join(", "),n=""===n?n:n+". \n",n+=R.ValidationErrorNoAccessFields+t),i.data("error",n),c.showErrorPopover(i,n,Lo))}})},_addELErrors:function(e,t){ga({value:e,unsupportedELCallback:function(){t.push(R.ValidationErrorPageUnsupportedEL)},invalidELCallback:function(){t.push(R.ValidationErrorInvalidEL)}})},_isNameValid:function(e){var t=[];return L.isNullEmptyOrWhitespace(e)?t.push(R.ValidationErrorPageNameEmpty):k.isValidName(e)?k.isNameForRouteUnique(this._getRoute().get(Do.ROUTE_PAGE_ID_KEY),e,this._routeId)||t.push(R.ValidationErrorPageNameNotUnique):t.push(R.ValidationErrorPageNameInvalid),t},_isTitleValid:function(e){var t=[];return L.isNullEmptyOrWhitespace(e)&&t.push(R.ValidationErrorPageTitleEmpty),this._addELErrors(e,t),t},_isDescValid:function(e){var t=[];return this._addELErrors(e,t),t},_setupListeners:function(){this.listenTo(I.event,"state:routes-base-urls-updated",this._handleRoutesBaseUrlsChanged),this.listenTo(I.event,"state:view-properties-updated",this._handleViewPropertiesChanged),this.listenTo(I.event,"state:routes-properties-updated",this._handleRoutesPropertiesUpdated),this.listenTo(I.event,"state:view-created",this._refreshIfRouteMatches),this.listenTo(I.event,"state:view-deleted",this._handleViewDeleted),this.listenTo(I.event,"state:page-change-start",this._handlePageNav),this.listenTo(I.event,"state:page-change-success",this._handlePageNav)},_handleRoutesBaseUrlsChanged:function(e){_.includes(e,this._routeId)&&this._updateUrlInput()},_handleRoutesPropertiesUpdated:function(e){var n=this;e.some(function(e){var t=e.id,e=e.props;return t===n._routeId&&e[Do.ROUTE_URL_KEY]})&&this._updateUrlInput()},_updateUrlInput:function(){var e=this._getRoute().get(Do.ROUTE_URL_KEY);this.$(".js-input-url").val(To(e))},_handleViewPropertiesChanged:function(e,t){e=this._viewId===e||h.getRoutes().getRouteForView(e)[0].id===this._routeId;(t.Name||t.ThemeLayoutType||t.AuraTag)&&e&&this.render()},_refreshIfRouteMatches:function(e){e=e.routeId;this._routeId===e&&this.render()},_handleViewDeleted:function(e){var t=e.routeId,e=e.viewId;this._routeId===t&&(this._viewId===e&&(this._viewId=k.getDefaultViewIdForRoute(t)),this.render())},_handlePageNav:function(){var e=I.getAppState().getCurrentRouteId(),t=I.getAppState().getCurrentViewId();e===this._routeId&&t!==this._viewId&&(this._viewId=t,this.render())},_handleInputHeadTag:function(){var t,e,n={editorMode:"text/html",contentKey:"HeadInlineScript",shouldValidateOnType:!0,shouldValidateOnSave:!0,customLintRules:{"secure-headtag-rule":!0},updateCss:!1,reloadIFrame:!0,placeholder:wo.Placeholder,EditorTitle:wo.EditorTitle,EditorTips:this._isManagedContentRoute()?wo.EditorTipsELEnabledForCMS:wo.EditorTipsELEnabled,CloseWarning:wo.CloseWarning,ValidationWarning:wo.ValidationWarning,CloseWarningTitle:wo.CloseWarningTitle,ValidationWarningTitle:wo.ValidationWarningTitle,errorMessage:wo.ErrorMessage,textEditorDialogClassName:"cb-TextEditor-dialog",routeId:this._routeId};n={showCloseButton:!1,contentClassName:(t=n).textEditorDialogClassName,className:"cb-TextEditor-vex-theme",escapeButtonCloses:!1},e=h.getSeoComponentDataByRouteId(t.routeId),e=T.Deferred().resolve({value:e.customHeadTags,isValid:e.isValid}),t.initialValuePromise=e.promise(),t.onSaveCallback=function(e){I.event.trigger("action:update-route-seo-property",{id:t.routeId,value:e,name:P.SEO_CMP_PROP.CUSTOM_HEADTAG_KEY,successCallback:function(){A.closeDialog()},errorCallback:function(e){var t;e.invalidFields?(t=e.invalidFields.join("<br/>"),A.sldsAlert(PicassoWebServices.Labels.CommBuilderTextEditorHeadTag.InvalidFieldWarning+t)):e.noAccessFields?(t=e.noAccessFields.join("<br/>"),A.sldsAlert(PicassoWebServices.Labels.CommBuilderTextEditorHeadTag.NoAccessFieldWarning+t)):A.sldsAlert(PicassoWebServices.Labels.CommBuilderTextEditorHeadTag.ValidationWarning,PicassoWebServices.Labels.CommBuilderTextEditorHeadTag.ValidationWarningTitle)}})},Eo(t,n)},_isRouteRenameAllowed:function(e){return!e.isOOTB()&&!e.isObjectRoute()},_getRoute:function(){return h.getRoutes().get(this._routeId)},_getObjectUrlPrefixSegment:function(){if(0<this._itemRoutes.length){var e=J(this._itemRoutes,1)[0];if(e&&e.id)return h.getRoutes().get(e.id).getRouteBaseSegment().replace("/","")}return""},_isManagedContentRoute:function(){return this._getRoute().isManagedContentRoute()},_getSeoELToolTipText:function(){return this._isManagedContentRoute()?R.SeoELTooltipForCMS:R.SeoELTooltip},_getDefaultThemeLayoutByRouteType:function(e){e=h.getRoutes().get(e).get(Do.ROUTE_TYPE_KEY);return h.getDefaultThemeLayoutByRouteType(e)||P.THEME_LAYOUT_TYPE.INNER}}),e=_.template('\n    <tr class="js-table-row {{- row[0].selected ? \'slds-is-selected\' : \'\' }}" data-id="{{- row[0].id }}">\n        {{ _.each(row.slice(1), function(cell) { }}\n        <td class="{{= cell.className }} slds-p-around_x-small slds-truncate"\n                title="{{= _.escape(cell.title) }}" data-type="{{= cell.type }}">\n            {{= cell.value }}\n        </td>\n        {{ }) }}\n    </tr>'.trim()),Vo={tableTemplate:_.template('\n    <table class="cb-Table {{= className }} js-table slds-table slds-table_cell-buffer slds-no-row-hover slds-table_bordered">\n        {{= headHtml }}\n        {{= bodyHtml }}\n    </table>'.trim()),theadTemplate:_.template('\n    <thead>\n        <tr class="slds-line-height_reset">\n            {{ _.each(headers, function(header) { }}\n                <th class="{{= header.headerClassName }} slds-truncate">\n                    {{= header.headerLabel }}\n                </th>\n            {{ }) }}\n        </tr>\n    </thead>'.trim()),tbodyTemplate:_.template('\n    <tbody class="{{= className }}">\n        {{ _.each(data, function(row) { }}\n            {{= trTemplate({row:row}) }}\n        {{ }) }}\n    </tbody>'.trim()),trTemplate:e,titleTemplate:_.template('\n    <div class="cb-Table-title slds-grid slds-grid_vertical-align-center">\n        <div class="cb-Table-label slds-medium-size_7-of-12">\n            <div class="slds-text-heading_small">\n                {{= title.label }}\n            </div>\n        </div>\n        {{ if (title.actions) {}}\n        <div class="cb-Table-actions slds-medium-size_5-of-12">\n            {{= title.actions }}\n        </div>\n        {{}}}\n    </div>'.trim()),emptyContent:_.template('\n    <div class="cb-Table-emptyContent slds-align_absolute-center">\n        <p>{{= message }}</p>\n    </div>\n'.trim()),createDataProviderWrapper:function(i,e){return{getColumns:function(){return i.getColumns(e)},getTableClassName:function(){return i.tableClassName||""},getRowSections:function(){return i.getRowSections(e)},getValue:function(e,t){return i.value[e](t)},getData:function(){var e=arguments[0],t=arguments[1],n=[].slice.call(arguments,2),e=i[e];return e[t]?e[t].apply(null,n):""}}},HEADER_DATA_TYPES:["headerLabel","headerClassName"],CELL_DATA_TYPES:["value","className"]},$o=PicassoWebServices.Labels.CommunityBuilder,Uo=!1,Wo=Backbone.View.extend({className:"cb-DropdownMenu-dropdown js-dropdown-menu dropdown-menu slds-dropdown slds-dropdown_left",_currentId:"",_parentTriggerEvt:"",_sortableClass:"",_onDragAction:"",_dropdownTemplate:_.template('\n        <span aria-live="assertive" class="assistive-text"></span>\n        <span id="announcement-text" class="announcement-text">\n            {{= isDragAllowed  ? "'.concat($o.ReorderDropdownIntitialAssistiveText,'" : "" }} \n        </span>\n        <ul class="cb-DropdownMenu-dropdown--scrollable slds-dropdown__list slds-scrollable_y {{= customClass }}" role="menu" aria-label="').concat($o.ShowMore,'" data-id="{{= id }}">\n            {{ _.each(sections, function(section) { }}\n                {{ if (_.isFunction(section.isHidden) ? !section.isHidden(id, contextParams, parentRef) : !section.isHidden) { }}\n                    {{ if (section.label || section.addSeparator) { }}\n                        <li class="{{= _.isEmpty(section.label) ? "" : "slds-dropdown__header"}} {{=section.addSeparator === true ? "slds-border_top slds-border_color-brand" : ""}}" role="separator">\n                            {{ if (section.label) { }}\n                                <span>{{= section.label }}</span>\n                            {{ } }}\n                        </li>\n                    {{ } }}\n                    {{ _.each(section.items, function(item) { }}\n                        {{ if (_.isFunction(item.isHidden) ? !item.isHidden(id, contextParams, parentRef) : !item.isHidden) { }}\n                            <li role="presentation" class="{{= _.isEmpty(item.locator) ? "" : item.locator }}  cb-DropdownMenu-dropdownItem js-dropdown-menu-item {{= item.closeMenuOnClick === false ? "" : "js-close-menu-on-click"}} slds-dropdown__item {{= (isDragAllowed) ?  ((typeof item.isDraggable !== "undefined" && item.isDraggable !== "').concat(P.DROPDOWN_DRAG_AT_ITEM.DRAG_UNDEFINED,'") ? "js-dropdown-menu-item-in-draggable-section" : "js-dropdown-menu-item-not-in-draggable-section") : "" }} {{=item.addBorder === true ? "slds-border_top slds-border_color-brand" : ""}}\n                            {{= (isDragAllowed && item.isDraggable === "').concat(P.DROPDOWN_DRAG_AT_ITEM.DRAG_ALLOWED,'") ? "js-dropdown-menu-item-is-draggable" : "" }} \n                            {{= (_.isFunction(item.isDisabled) ? item.isDisabled(id, contextParams, parentRef) : item.isDisabled ) ? "cb-DropdownMenu-dropdownItem--disabled js-disabled" : "" }}" data-value="{{= item.key }}">\n                                <a class="cb-DropdownMenu-dropdownItemLink" href="javascript:void(0);" role="menuitem" tabindex="-1"   aria-describedby={{= (isDragAllowed && item.isDraggable === "').concat(P.DROPDOWN_DRAG_AT_ITEM.DRAG_ALLOWED,'")  ? "announcement-text" : "" }}>\n                                    {{ if (isDragAllowed && item.isDraggable === "').concat(P.DROPDOWN_DRAG_AT_ITEM.DRAG_ALLOWED,'") { }}  \n                                        <span class="cb-DropdownMenu-dragIcon">\n                                            ').concat(D.icon({icon:"drag_and_drop",svgClassName:"slds-icon_small cb-DropdownMenu-dragHandle js-dropdownMenu-item-pill-drag-handle"}),'\n                                        </span>\n                                    {{ } }}\n                                    \n                                    <span class="cb-DropdownMenu-dropdownItemLinkContent \n                                    {{= (isDragAllowed && (typeof item.isDraggable !== "undefined" && item.isDraggable !== "').concat(P.DROPDOWN_DRAG_AT_ITEM.DRAG_UNDEFINED,'" )) ?  ((item.isDraggable === "').concat(P.DROPDOWN_DRAG_AT_ITEM.DRAG_ALLOWED,'") ? "cb-DropdownMenu-draggableDropdownItem" : "cb-DropdownMenu-draggableDropdownItemDefault") : "" }}  \n                                    slds-truncate" title={{= (item.showToolTip) ? item.label : "" }}>\n                                        {{ if (item.icon) { }}\n                                            <svg class="slds-icon slds-icon-text-default slds-m-right_x-small {{= (typeof item.icon.extraClass !== "undefined") ? item.icon.extraClass : "slds-icon_x-small" }}" aria-hidden="true">\n                                                <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/{{= item.icon.sprite }}-sprite/svg/symbols.svg#{{= item.icon.name }}"></use>\n                                            </svg>\n                                        {{ } }}\n                                        {{= item.label }}\n                                        {{ if (isDragAllowed && item.isDraggable === "').concat(P.DROPDOWN_DRAG_AT_ITEM.DRAG_ALLOWED,'" && item.subText) { }}\n                                            <div class="js-dropdown-menu-subtext cb-DropdownMenu-subText"> \n                                             {{= item.subText }}                                            \n                                            </div>\n                                        {{ } }}                                        \n                                    </span>\n  \n                                </a>\n                            </li>\n                        {{ } }}\n                    {{ }) }}\n                {{ } }}\n            {{ }) }}\n        </ul>')),events:{"click .js-dropdown-menu-item":"_onClickItem","keydown .js-dropdown-menu-item":"_onKeydown"},initialize:function(e){this._config=this._addConfigHelpers(e.config),this._customClass=e.customClass||"",this._allowedSelectorOutsideDropdown=e.allowedSelectorOutsideDropdown,this._isDragAllowed=e.isDragAllowed,this._parentTriggerEvt=e.parentEvent,this._sortableClass=e.sortableClass,this._onDragAction=e.onDragAction,e.allowedSelectorOutsideDropdown&&void 0!==e.sortableClass&&(this._customClass=this._customClass+" "+e.sortableClass)},render:function(){return this.$el.html(this._dropdownTemplate({sections:this._config,id:this._currentId,contextParams:this._contextParams,parentRef:this._parentRef,customClass:this._customClass,isDragAllowed:this._isDragAllowed})),this.$("."+this._sortableClass).sortable({axis:"y",opacity:.5,handle:".js-dropdownMenu-item-pill-drag-handle",start:function(e,t){t.item.find(".js-dropdown-menu-subtext").css("display","none")},stop:function(e,t){t.item.find(".js-dropdown-menu-subtext").css("display","block")},update:this._reorderItem.bind(this),placeholder:"cb-DropdownMenu-dragPlaceholder"}).disableSelection(),this},onToggle:function(e,t,n,i,s){var a=this;this.$el.remove(),this._$trigger=e,this._currentId=t,this._parentRef=n,this._contextParams=i,this.render().delegateEvents(),ta.trigger(this.$el,e,{hideOnScroll:!0,dismissSelectorWithinDropdown:".js-dropdown-menu-item.js-close-menu-on-click",allowedSelectorOutsideDropdown:this._allowedSelectorOutsideDropdown,position:s}),this._initEnabledItems(),0<this._enabledItems.length&&(t=0,null!=(n=this._contextParams)&&n.focusItemId&&-1==(t=this._enabledItems.findIndex(function(e){return e.id===a._contextParams.focusItemId}))&&(t=0),null!=(i=this._contextParams)&&i.fromReorder&&(t=this._enabledItems.findIndex(function(e){return e.id===a._contextParams.itemId})),this._focusOnMenuItem(this._enabledItems[t].key))},_initEnabledItems:function(){this._enabledItems=[],_.each(this._config,function(e){_.each(e.items,function(e){var t=this._findMenuItem(e.key);0<t.length&&!t.hasClass("js-disabled")&&this._enabledItems.push(e)}.bind(this))}.bind(this))},_updateLiveText:function(e){T(".assistive-text").html(e)},_findMenuItem:function(e){return this.$('.js-dropdown-menu-item[data-value="'+e+'"]')},_focusOnMenuItem:function(e){this._findMenuItem(e).find("a").focus()},close:function(){this.$el.is(":visible")&&this.$el.css("display","none")},_addConfigHelpers:function(e){return e.triggerUpdateStart=function(e){this.trigger("update-start",e)}.bind(this),e},_onClickItem:function(e){var t,e=e.currentTarget;!e.classList.contains("js-disabled")&&(t=e.getAttribute("data-value"),e=_.flatten(_.map(this._config,"items")),e=_.find(e,function(e){return e.key===t}))&&("js-propertyeditor-variation"===e.locator?e.action(e.id,e.label):e.action(this._currentId,this._contextParams,this._parentRef))},_onKeydown:_.debounce(function(t){var e,n,i,s,a=this._enabledItems.filter(function(e){return e.isDraggable==P.DROPDOWN_DRAG_AT_ITEM.DRAG_ALLOWED}),o=null==(r=a.find(function(e){return e.id==T(t.currentTarget).attr("data-value")}))?void 0:r.label,r=a.findIndex(function(e){return e.label==o})+1;this._onDragAction&&t.which===P.KEYCODE.SPACE&&(Uo=!Uo,i=$o.ReorderDropdownItemPositionAssistiveText.replace("{0}","".concat(r)).replace("{1}","".concat(a.length)),Uo?(e=$o.ReorderDropdownItemGrabbedAssistiveText.replace("{0}","".concat(o)).replace("{1}","".concat(i)),this._updateLiveText(e)):(e=$o.ReorderDropdownItemDroppedAssistiveText.replace("{0}","".concat(o)).replace("{1}",i),this._updateLiveText(e))),t.which===P.KEYCODE.ESCAPE||t.which===P.KEYCODE.TAB?(this.close(),this._$trigger.focus()):(e=T(t.currentTarget).attr("data-value"),e=_.findIndex(this._enabledItems,{key:e}),t.which===P.KEYCODE.DOWN||t.which===P.KEYCODE.UP?(s=this._enabledItems.length,e+=t.which===P.KEYCODE.DOWN?1:-1,s=this._enabledItems[(e+s)%s].key,this._focusOnMenuItem(s),this._onDragAction&&Uo&&(this._reorderItem(t,T(t.currentTarget),t.which===P.KEYCODE.UP,t.which===P.KEYCODE.DOWN),n=null==(s=a.find(function(e){return e.id==T(t.currentTarget).attr("data-value")}))?void 0:s.key,r=(a=this._enabledItems.filter(function(e){return e.isDraggable==P.DROPDOWN_DRAG_AT_ITEM.DRAG_ALLOWED})).findIndex(function(e){return e.key==n})+1,i=$o.ReorderDropdownItemPositionAssistiveText.replace("{0}","".concat(r)).replace("{1}","".concat(a.length)),this._updateLiveText("".concat(i,".")))):(s=t.key.toLowerCase(),(r=(r=this._findItemByFirstLabelChar(s,e+1))||this._findItemByFirstLabelChar(s,0))&&this._focusOnMenuItem(r.key)))},300),_findItemByFirstLabelChar:function(t,e){return _.find(this._enabledItems,function(e){return e.label[0].toLowerCase()===t},e)},_reorderItem:function(e,t){var n,i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],s=i||3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=(s&&(a=i?t.prev():null==(i=t.next())?void 0:i.next()),s?t:T(t.item)),s=s?a:T(t.item).next(),a=this._currentId,t=this._parentTriggerEvt;null!=(n=s[0])&&null!=(n=n.classList)&&n.contains("js-dropdown-menu-item-in-draggable-section")&&null!=(n=i[0])&&null!=(n=n.classList)&&n.contains("js-dropdown-menu-item-is-draggable")&&this._onDragAction?I.event.trigger(this._onDragAction,{itemId:i.attr("data-value"),insertBeforeId:0<s.length?s.attr("data-value"):null,baseComponentId:a,parentEvt:t,isValidMove:!0,errorCallback:function(){this._showErrorDialogOnDrag()}}):(I.event.trigger(this._onDragAction,{itemId:i.attr("data-value"),insertBeforeId:0<s.length?s.attr("data-value"):null,baseComponentId:a,isValidMove:!1,parentEvt:t,errorCallback:function(){this._showErrorDialogOnDrag()}}),Uo=!1)},_showErrorDialogOnDrag:function(){A.sldsPromptAlert({title:PicassoWebServices.Labels.PicassoDialog.Error,content:$o.ReorderDropdownItemFailureText})}});var Fo,Ho,Go,zo=Backbone.View.extend({className:"js-dnd-table-container",events:{"click .js-dropdown-trigger":"_onDropdownTrigger"},initialize:function(e){this._dataProvider=Vo.createDataProviderWrapper(e.dataProvider,e.contextParams),this._dropdown=new Wo({config:e.dropdownConfig}),this._parentRef=e.parentRef,this._contextParams=e.contextParams,this.listenTo(this._dropdown,"update-start",this._handleUpdateStart)},render:function(){var e=this._dataProvider.getColumns(),t=this._getBodyHtml(e);return this.$el.html(Vo.tableTemplate({className:this._dataProvider.getTableClassName()+" cb-DndTable js-dnd-table",headHtml:this._getHeadHtml(e),bodyHtml:t})),this._contextParams&&this._contextParams.title&&this.$el.prepend(Vo.titleTemplate({title:this._contextParams.title})),!t&&this._contextParams&&this._contextParams.emptyMessage&&this.$el.append(Vo.emptyContent({message:this._contextParams.emptyMessage})),this._enableDnd(),this.$('[data-toggle="tooltip"]').tooltip(),this._highlightRowIfNeeded(),this},_highlightRowIfNeeded:function(){this._highlightRowIdOnRender&&(this.$('.js-table-row[data-id="'+this._highlightRowIdOnRender+'"]').effect("highlight","slow",3),this._highlightRowIdOnRender=null)},_handleUpdateStart:function(e){this._highlightRowIdOnRender=e},_enableDnd:function(){this.$(".js-dnd-rows").sortable({axis:"y",helper:function(e,t){return T('<div class="cb-DndTable-dndHelper">'+t.find("td").first().html()+"</div>")},handle:".js-dnd-table-dnd-handle",containment:this.$(".js-dnd-table"),placeholder:"cb-DndTable-dndPlaceholder js-table-dnd-placeholder",update:function(){var n={},t=[];this.$(".js-dnd-rows .js-table-row").each(function(){var e=T(this).data("id");t.push(e)}),_.each(t,function(e,t){n[e]=t+1}),this.trigger("dnd-update",n)}.bind(this)})},_getHeadHtml:function(e){var i=this._dataProvider,s=this._contextParams,e=_.map(e,function(t){var n={};return _.each(Vo.HEADER_DATA_TYPES,function(e){n[e]=i.getData(e,t,s)}),n});return e.push({headerLabel:"",headerClassName:"slds-size--1-of-12"}),Vo.theadTemplate({headers:e})},_getBodyHtml:function(e){var t=this._dataProvider.getRowSections(),n=[],i=1<t.dndRows.length;return 0<t.dndRows.length&&n.push(Vo.tbodyTemplate({data:this._getTbodyData(e,t.dndRows,i,!0),className:"js-dnd-rows",trTemplate:Vo.trTemplate})),0<t.nonDndRows.length&&n.push(Vo.tbodyTemplate({data:this._getTbodyData(e,t.nonDndRows,i,!1),className:"js-no-dnd-rows",trTemplate:Vo.trTemplate})),n.join("")},_getTbodyData:function(t,e,a,o){var r=this._dataProvider,l=this._contextParams;return _.map(e,function(i){var s=[{id:i.id,selected:i.selected}],e=(_.each(t,function(t,e){var n={};_.each(Vo.CELL_DATA_TYPES,function(e){n[e]=r.getData(e,t,i,l)}),0===e&&a&&(e=o?D.icon({svgClassName:"cb-DndTable-dndHandle slds-icon_x-small js-dnd-table-dnd-handle",icon:"rows"}):'<span class="cb-DndTable-dndHandlePlaceholder"></span>',n.value=e+n.value),n.value&&((e=T(T.parseHTML(n.value))).find(".slds-assistive-text").remove(),n.title=e.text().trim()),n.type=t,s.push(n)}),{value:D.dropdownButtonIcon({buttonClassName:"js-dropdown-trigger",svgClassName:""}),className:"dropdown cb-DndTable-dropdown slds-text-align--right"});return e.type="dropdown-trigger",s.push(e),s})},_onDropdownTrigger:function(e){var e=T(e.currentTarget),t=e.closest(".js-table-row").attr("data-id");this._dropdown.onToggle(e,t,this._parentRef,this._contextParams,"left")}}),Ko=function(){var s=PicassoWebServices.Labels.CommBuilderPageManagement,t=P.PROP,r=["pageName","visibility","status"],e={};s.PageAssignmentCriteriaProfile,s.PageAssignmentCriteriaGeoLocation,s.PageAssignmentCriteriaFieldBased,s.PageAssignmentCriteriaDomain;return e.value={pageName:function(e){return e.get(t.NAME_KEY)},visibility:function(e,t){var t=h.getRoutes().get(t.routeId),n=t.getViewId(),i='<span class="slds-badge js-default-badge">'+s.PageVisibilityDefault+"</span>";return e.id===n?i:(n=h.getAudienceTargetInfoForView(t.id,e.id),(t=n)&&t.get("audienceName")?n.isDefault()?i:_.escape(n.get("audienceName")):s.PageVisibilityNone)},priority:function(e,t){t=h.getAudienceTargetInfoForView(t.routeId,e.id);return t&&!t.isDefault()?t.get("groupPriority"):D.iconWithAlt({className:"js-no-priority-dash",svgClassName:"slds-icon_x-small slds-icon-text-light",icon:"dash",label:s.PagePriorityNone})},status:function(e){return s["PublishState_"+e.get(t.VARIATION_STATUS_KEY)]}},e.className={pageName:function(){return"js-page-table-item-name"},visibility:function(){return"js-page-table-item-visibility"},priority:function(){return"js-page-table-item-priority slds-text-align--center"},status:function(){return"js-page-table-item-variation-status"}},e.headerLabel={pageName:function(){return s.PageNameColumn},visibility:function(){return D.bsLabelWithTooltipIcon({label:s.PageVisibilityColumn,tooltipClassName:"cb-PageManager-visibilityTooltip",tooltipContent:s.PageVisibilityColumnTooltip,placement:"top"})},priority:function(){return D.bsLabelWithTooltipIcon({label:s.PagePriorityColumn,tooltipClassName:"cb-PageManager-priorityTooltip",tooltipContent:s.PagePriorityColumnTooltip,placement:"top"})},status:function(){return s.PageStatusColumn}},e.headerClassName={pageName:function(){return"slds-size--4-of-12"},visibility:function(){return"slds-size--3-of-12"},priority:function(){return"slds-size--2-of-12 slds-text-align--center"},status:function(){return"slds-size--2-of-12"}},e.tableClassName="cb-PageManager-pagesTable",e.getColumns=function(e){for(var t,n=r.slice(),i=0,s=(t=e,h.getRoutes().get(t.routeId).getViews()),a=0;a<s.length;++a){var o=h.getAudienceTargetInfoForView(e.routeId,s[a].id);if(o&&!o.isDefault()&&1<++i){n.splice(2,0,"priority");break}}return n},e.getRowSections=function(n){var i=[],s=[],e=k.sortRouteViewsByAudience(n.routeId);return _.each(e,function(e){var t=h.getAudienceTargetInfoForView(n.routeId,e.id);(!t||t.isDefault()?s:i).push(e)}),{dndRows:i,nonDndRows:s}},e}(),Yo=PicassoWebServices.Labels.RenameWidgetDialog,qo=P.PROP,Xo=Backbone.View.extend({className:"cb-RenameWidgetDialog",_view:null,template:_.template('<div class="cb-RenameWidgetDialog-headerSection"><h1 class="cb-RenameWidgetDialog-headerSectionTitle">'+Yo.Title+'</h1><div class="cb-RenameWidgetDialog-headerSectionDesc">'+Yo.Description+'</div></div><div class="cb-RenameWidgetDialog-content"><div class="cb-RenameWidgetDialog-formItem"><label class="cb-RenameWidgetDialog-label slds-form-element__label" for="cb-RenameWidgetDialog-name">'+Yo.NameInputLabel+'</label><input type="text" class="form-control js-name-input slds-input" id="cb-RenameWidgetDialog-name" name="name" value="{{= name }}" maxlength="40" data-container="body" data-toggle="popover" data-placement="right"></div></div><div class="cb-RenameWidgetDialog-footer"><input type="button" class="cb-RenameWidgetDialog-button--neutral cb-RenameWidgetDialog-button js-cancel" value="'+Yo.CancelButton+'"/><input type="button" class="cb-RenameWidgetDialog-button--primary cb-RenameWidgetDialog-button js-save" value="'+Yo.SaveButton+'"/></div>'),popoverTemplateHtml:'<div class="cb-Dialog-popover cb-RenameWidgetDialog-popover cb-RenameWidgetDialog-popover--inputFields popover" role="tooltip"><div class="cb-RenameWidgetDialog-popoverArrow arrow"></div><div class="cb-RenameWidgetDialog-popoverContent popover-content"></div></div>',events:{"input .js-name-input":"_onNameChange","change .js-name-input":"_onNameChange","keydown .js-name-input":"_onKeyDown","click .js-cancel":"_onCancel","click .js-save":"_onSave"},initialize:function(e){this._view=h.getViews().get(e&&e.viewId)},render:function(){return this.$el.html(this.template({name:this._view.get(qo.NAME_KEY)})),_.defer(function(){var e=this.$(".js-name-input");e.select(),e.focus()}.bind(this)),this},beforeClose:function(){var e=this.$(".js-name-input");clearTimeout(this.errorTimeout),e.popover("destroy")},_onCancel:function(){A.closeDialog()},_onSave:function(e){this._onNameChange(e,!0)},_onNameChange:function(e,t){var n=this.$(".js-name-input"),i=n.val()&&n.val().trim(),s=this._view,a=s.get(qo.VIEW_PAGE_ID_KEY);s.get(qo.NAME_KEY)===i?t&&A.closeDialog():""===i?this._showErrorPopover(n,Yo.ValidationErrorEmptyName):k.isValidName(i)?k.isNameForViewUnique(a,i,s.id)?t?I.event.trigger("action:update-view-property",{id:s.id,name:qo.NAME_KEY,value:i,successCallback:function(){A.closeDialog()}}):n.popover("hide"):this._showErrorPopover(n,Yo.ValidationErrorNameAlreadyUsed):this._showErrorPopover(n,Yo.ValidationErrorInvalidName)},_onKeyDown:function(e){e.which===P.KEYCODE.ENTER&&this._onNameChange(e,!0)},_showErrorPopover:function(t,n){t.popover("hide");var i=this;this.errorTimeout=setTimeout(function(){var e=t.data("bs.popover");e?(t.attr("data-content",n),e.setContent()):t.popover({content:n,trigger:"manual",template:i.popoverTemplateHtml}),t.popover("show")},200)}}),Jo=(i=PicassoWebServices.Labels.CommBuilderPageManagement,Fo=P.PROP,Ho=["home","error","detail-0F9","login-error","login-home","forgot-password","self-register","check-password"],Go=[{label:i.ActionHeaderPageVariation,items:[{key:"edit",label:i.ActionEdit,icon:{sprite:"utility",name:"edit_form"},action:function(e,t){I.getAppState().set("workspaceMode",P.workspace.PAGE_CONFIG),j.getAppEvent().trigger("close-page-menu"),I.event.trigger("action:navigate-to-page",{viewId:e,routeId:t.routeId})}},{key:"rename",label:i.ActionRename,icon:{sprite:"utility",name:"edit"},isDisabled:function(e){return e=Qo(e=e).get(Fo.ROUTE_TYPE_KEY),!!k.isGenericObjectRouteType(e)},action:function(e,t){A.showDialog(new Xo({viewId:e}))}},{key:"duplicate",label:i.ActionDuplicate,icon:{sprite:"utility",name:"copy"},action:function(e,t,n){I.event.trigger("action:duplicate-view",{viewId:e,routeId:t.routeId,routeType:t.routeType})}},{key:"preview",label:i.ActionPreview,icon:{sprite:"utility",name:"preview"},action:function(e,t){j.getAppEvent().trigger("select-preview-mode"),j.getAppEvent().trigger("close-page-menu"),I.event.trigger("action:navigate-to-page",{viewId:e,routeId:t.routeId})}},{key:"delete",label:i.ActionDelete,icon:{sprite:"utility",name:"delete"},isDisabled:function(e,t){return t=t,n=Qo(e=e),i=h.getRoutes().get(t.routeId),s=n.get(Fo.ROUTE_TYPE_KEY),a=!0,o=i.getViewId(),!(a=!(!I.getAppState().supportsNewFeatures()&&o===n.id||I.getAppState().supportsNewFeatures()&&o===n.id&&nr(0,t)||k.isGenericObjectRouteType(s)||1===i.getViews().length)&&a);var n,i,s,a,o},action:function(e,t,n){n.handleDeleteView(e)}}]},{label:i.ActionHeaderAudience,items:[{key:"assignVisibility",label:i.ActionAssignVisibility,icon:{sprite:"utility",name:"groups"},isHidden:function(e,t){return $P.isPersonalizationEnabled?er(e,t)||tr(e,t)||!Zo():er(e,t)||!Zo()},isDisabled:function(e,t){return tr(e,t)&&(nr(0,t)||!Zo())},action:function(e,t,n){n.handleManageVisibility(e,function(){Go.triggerUpdateStart(e)})}},{key:"editVisibility",label:i.ActionEditVisibility,icon:{sprite:"utility",name:"groups"},isHidden:function(e,t){return $P.isPersonalizationEnabled?!er(e,t)&&!tr(e,t)||!Zo():!er(e,t)||!Zo()},isDisabled:function(e,t){return tr(e,t)&&nr(0,t)},action:function(e,t,n){n.handleManageVisibility(e,function(){Go.triggerUpdateStart(e)})}},{key:"removeVisibility",label:i.ActionRemoveVisibility,icon:{sprite:"utility",name:"ban"},isHidden:function(e,t){return $P.isPersonalizationEnabled&&!nr(0,t)?!ir(e,t)&&!tr(e,t):!ir(e,t)},action:function(e,t,n){Go.triggerUpdateStart(e),n.handleRemoveViewVisibility(e)}},{key:"makeDefault",label:i.ActionVisibilityDefault,icon:{sprite:"utility",name:"bookmark"},isHidden:function(e,t){return!(!tr(e=e,t=t)||tr(e,t)&&!Zo())},isDisabled:function(e,t){return tr(e,t)&&!Zo()},action:function(e,t,n){Go.triggerUpdateStart(e),n.handleMakeViewDefault(e)}}]}]);function Qo(e){return h.getViews().get(e)}function Zo(){return I.getAppState().supportsNewFeatures()}function er(e,t){t=h.getAudienceTargetInfoForView(t.routeId,e);return t&&t.get("audienceName")}function tr(e,t){return e===h.getRoutes().get(t.routeId).getViewId()}function nr(e,t){return _.includes(Ho,t.routeType)}function ir(e,t){return(!tr(e,t)||!nr(0,t))&&er(e,t)}var n=PicassoWebServices.Labels.CommBuilderPageWizard,t=Backbone.View.extend({template:_.template('<div class="cb-PageWizard-layout js-page-choose-layout"><div class="cb-PageWizardLayout-layouts js-layouts"></div></div>'),footerTemplate:_.template('<div class="cb-PageWizardFooter"><button class="cb-PageWizardFooter-back slds-button slds-button_neutral js-back"><svg aria-hidden="true" class="slds-button__icon slds-button__icon--left"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#back"></use></svg>'+n.back+'</button><button class="cb-PageWizardFooter-next slds-button slds-button_brand js-next" disabled>'+n.next+"</button></div>"),events:{"click .js-choose-layout":"_chooseLayout","click .js-next":"_next","click .js-back":"_back"},_currentLayout:null,initialize:function(e){this.parent=e.parent,this.model=this.parent.model},render:function(){return this._chooseLayoutStep=new Ta({layouts:this.model.get("availableLayouts")}),this.listenTo(this._chooseLayoutStep,"enableSaveButton",this._enableSaveButton),this.$el.html(this.template()).append(this.footerTemplate()),this.$(".js-layouts").html(this._chooseLayoutStep.render().$el),this.delegateEvents(),this},_enableSaveButton:function(e){this._currentLayout=e,this.$(".js-next").prop("disabled",!1)},_next:function(){this.model.set("selectedLayout",this._currentLayout),this.trigger("next")},_back:function(){this.trigger("back")}}),sr=PicassoWebServices.Labels.CommBuilderPageWizard,ar=P.PROP,or=/^[a-z0-9\-]+$/i,rr=/^\/[a-z0-9\-]+(\/:recordId)(\/)?$/i,lr=/^$|^[a-z][a-z0-9]*(?:[_][a-z0-9]+)*$/i,e=Backbone.View.extend({_nameTemplate:'<label for="js-page-wizard-choose-name-name-input" class="slds-form-element__label">\n            <abbr class="slds-required" title="required">*</abbr>\n            '.concat(sr.pageName,'\n        </label>\n        <div class="slds-form-element__control">\n            <input id="js-page-wizard-choose-name-name-input" class="cb-PageWizardChooseName-form__inputName slds-input js-name-input" maxlength="40"/>\n        </div>\n        <div class="slds-form-element__help js-name-error"></div>'),_devNameTemplate:function(e){return'<label for="js-page-wizard-choose-name-devname-input" class="slds-form-element__label">'.concat(sr.pageDevName,"</label>\n                ").concat(D.tooltipButtonIcon({buttonClassName:"js-devname-tooltip",svgClassName:"cb-PageWizardChooseName-tooltipIcon",tooltipPlacement:"right",tooltipLabel:"".concat(e)}),'\n            <div class="slds-form-element__control">\n                <input id="js-page-wizard-choose-name-devname-input" class="cb-PageWizardChooseName-form__inputDevName slds-input js-devname-input" maxlength="40"/>\n            </div>\n            <div class="slds-form-element__help js-devname-error"></div>').trim()},formTemplate:function(e){var t=e.variationMode,n=e.devNameTemplate,i=e.urlTemplate,e=e.nameTemplate;return'<div class="cb-PageWizardChooseName js-page-wizard-choose-name '.concat(t?"cb-PageWizardChooseName--variationMode":"",'">\n                <div class="cb-PageWizardChooseName-form slds-form--stacked js-name-form">\n                    <div class="slds-form-element cb-PageWizardChooseName-formElement">\n                        ').concat(e(),'\n                    </div>\n                    <div class="slds-form-element cb-PageWizardChooseName-formElement">\n                        ').concat(i(),"\n                    </div>\n                    ").concat(t?"":'<div class="slds-form-element cb-PageWizardChooseName-formElement">\n                                '.concat(n(),"\n                            </div>"),"\n                </div>\n            </div>").trim()},footerTemplate:_.template('<div class="cb-PageWizardFooter"><button class="cb-PageWizardFooter-back slds-button slds-button_neutral js-back"><svg aria-hidden="true" class="slds-button__icon slds-button__icon--left"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#back"></use></svg>'+sr.back+'</button><button class="cb-PageWizardFooter-next slds-button slds-button_brand js-next" disabled>'+sr.create+"</button></div>"),events:{"keyup .js-name-input":"_onInputNameKeyup","keyup .js-url-input":"_onInputUrlKeyup","keyup .js-devname-input":"_onInputDevNameKeyup","click .js-next":"_next","click .js-back":"_back"},name:"",url:"",devName:"",_nameErrorMessage:"",_urlErrorMessage:"",_devNameErrorMessage:"",_hasSelectedView:!1,initialize:function(e){this.parent=e.parent,this.model=this.parent.model},render:function(){var e=this,t=this.model.get("selectedView"),n=ya.getRouteForRouteType(this.model.get("routeType")),i=n?n.get("PageId"):E.getSite().get("homepage"),s=this.model.get("parentId"),a=this.model.get("pageVariationMode"),o=sr.DisabledUrlInfo.replace("{0}",n?n.name:""),r=a?o:"",o=a?"":sr.pageDevNameDescription,l=k.getFullUrlForRoute(s),s=this.formTemplate({variationMode:a,urlTemplate:function(){return D.urlSegmentInput({parentUrlHtml:c.constructSpacedUrl(l),parentUrlTooltip:l,tooltip:r,label:sr.pageUrl,isRequired:!0,id:"js-page-wizard-choose-name-url-input"})},nameTemplate:function(){return e._nameTemplate},devNameTemplate:this._devNameTemplate.bind(this,o)});return this.$el.html(s).append(this.footerTemplate()),this.model.get("defaultUrl")?(this._disableUrl(this.model.get("defaultUrl")),this._validateDefaultUrl(i)):t?(this._hasSelectedView=!0,this._disableUrl(t.Url)):n?(this._hasSelectedView=!0,this._disableUrl(n.get("RouteUrl"))):this._hasSelectedView=!1,this.delegateEvents(),_.defer(function(){this.$(".js-name-input").focus()}.bind(this)),this.$('[data-toggle="tooltip"]').tooltip(),this},_disableUrl:function(e){this.url=0===e.indexOf("/")?e.substring(1,e.length):e,this.$(".js-url-input").val(this.url).prop("disabled",!0)},_onInputNameKeyup:function(e){this._isValidEnterKey(e)&&this._next(),this.name=e.target.value,this.$(".js-url-input").is(":disabled")||(e=this.name.toLowerCase().replace(/[^\w _\-]+/g,"").replace(/[ _\-]+/g,"-"),this.$(".js-url-input").val(e),this.url=e),this._validateNameAndUrl()},_onInputUrlKeyup:function(e){this._isValidEnterKey(e)&&this._next();e=this.$(".js-url-input");e.is(":disabled")||(this.url=e.val()),this._validateNameAndUrl()},_onInputDevNameKeyup:function(e){this._isValidEnterKey(e)&&this._next(),this.devName=this.$(".js-devname-input").val(),this._validateDevName()},_isValidEnterKey:function(e){return e.which===P.KEYCODE.ENTER&&!this.$(".js-next").prop("disabled")},_validateDefaultUrl:function(e){var t=this._getValidUrl(this.url),t=k.getPageRouteByUrl(t,e),e=t&&t.get(ar.ROUTE_TYPE_KEY)!==this.model.get("routeType");this._urlErrorMessage=e?sr.ValidationErrorUrlAlreadyUsed:"",this._valid(".js-url-input",this._urlErrorMessage)},_validateNameAndUrl:function(){this._nameErrorMessage=this._getNameValidationErrors(),this._valid(".js-name-input",this._nameErrorMessage),this.$(".js-url-input").is(":disabled")||(this._urlErrorMessage=this._getUrlValidationErrors(),this._valid(".js-url-input",this._urlErrorMessage)),this.$(".js-next").prop("disabled",!!(this._nameErrorMessage||this._urlErrorMessage||this._devNameErrorMessage))},_validateDevName:function(){this._devNameErrorMessage=this._getDevNameValidationErrors(),this._valid(".js-devname-input",this._devNameErrorMessage),this.$(".js-next").prop("disabled",!!(this._nameErrorMessage||this._urlErrorMessage||this._devNameErrorMessage))},_valid:function(e,t){var e=this.$(e).closest(".slds-form-element"),n=e.find(".slds-form-element__help");t?(e.addClass("slds-has-error"),n.text(t)):(e.removeClass("slds-has-error"),n.text(""))},_getNameValidationErrors:function(){return this._getNameValidationErrorsForPage(E.getSite().get("homepage"))||this._getNameValidationErrorsForPage(E.getSite().get("loginpage"))},_getNameValidationErrorsForPage:function(e){var t=this.name.trim(),n=this.model.get("pageVariationMode");return t?k.isValidName(t)?!n&&!k.isNameForRouteUnique(e,t)||n&&!k.isNameForViewUnique(e,t)?sr.ValidationErrorNameAlreadyUsed:"":sr.ValidationErrorInvalidName:sr.ValidationErrorEmptyName},_getUrlValidationErrors:function(){var e=this.url.trim();if(this.model.get("routeType")===this.model.PAGE_TYPES.DATA){if(!rr.test(e))return sr.ValidationErrorInvalidDataUrl}else if(!or.test(e))return sr.ValidationErrorInvalidUrl;var e=this._getValidUrl(e),t=k.getFullUrlForRoute(this.model.get("parentId")),t="".concat(t).concat(e);return k.isReservedUrl(t)||k.getPageRouteByUrl(t,E.getSite().get("homepage"))||k.getPageRouteByUrl(t,E.getSite().get("loginpage"))?sr.ValidationErrorUrlAlreadyUsed:""},_getValidUrl:function(){var e=this.url.trim();return 0!==e.indexOf("/")?"/"+e:e},_getDevNameValidationErrors:function(){var e=this.devName.trim();return lr.test(e)?k.getPageRouteByDevName(e,E.getSite().get("homepage"))||k.getPageRouteByDevName(e,E.getSite().get("loginpage"))?sr.ValidationErrorDevNameAlreadyUsed:"":sr.ValidationErrorInvalidDevName},_next:function(){this.model.set("name",this.name.trim()),this.model.set("url",this._getValidUrl()),this.model.set("devName",this.devName.trim()),this.trigger("next")},_back:function(){this.trigger("back")}}),cr=PicassoWebServices.Labels.CommBuilderPageWizard,dr="installed",ur={hasPages:{iconName:"overflow",tooltip:cr.stepObjectTooltip,class:"js-pageWizard-custom-pages-icon"},hasConflict:{iconName:"info",tooltip:cr.stepObjectConflictTooltip,class:"js-pageWizard-url-conflict-icon"}},i=Backbone.View.extend({template:_.template('<div class="cb-PageWizard-listContainer js-page-wizard-choose-object"><div class="cb-PageWizardToolbar">{{= searchInput }}{{= objectDropdown }}</div><div class="cb-PageWizardList"><ul class="cb-PageWizard-listItems js-content-items"></ul></div><div class="cb-PageWizardList-noResults slds-text-heading_small js-no-results">'+cr.noResults+'</div><div class="cb-PageWizardList-noResults slds-text-heading_small js-no-installed-results">'+cr.noInstalledResults+"</div></div>"),listItemTemplate:function(e){var t=e.name,n=e.selected,i=e.disabled,s=e.label,a=e.labelName,o=e.isNew,e=e.icon,r=e.iconName,l=e.class,e=e.tooltip;return'<li class="cb-PageWizard-listItem js-content-item '.concat(n?"selected":"",'" data-value="').concat(t,'" tabindex="0" ').concat(i?"disabled":"",'>\n            <span class="cb-PageWizard-listItemLabel js-page-wizard-list-item-label">\n                ').concat(s,'\n                <span class="cb-PageWizard-listItemLabelName">').concat(a,'</span>\n            </span>\n            <div class="cb-PageWizard-listItemPage ').concat(r?"hasIcon":""," ").concat(l||"",'">\n                <span class="slds-icon_container" data-toggle="tooltip" data-placement="bottom" title="').concat(e||"",'">\n                    ').concat(r?'<svg aria-hidden="true" class="slds-icon cb-PageWizard-listItemPageIcon">\n                                <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#'.concat(r,'"></use>\n                            </svg>'):"",'\n                </span>\n            </div>\n            <span class="cb-PageWizard-newBadge slds-badge ').concat(o?"slds-show":"slds-hide",' js-page-wizard-new-badge">\n                ').concat(cr.newTag,"\n            </span>\n        </li>").trim()},footerTemplate:_.template('<div class="cb-PageWizardFooter"><button class="cb-PageWizardFooter-back slds-button slds-button_neutral js-back"><svg aria-hidden="true" class="slds-button__icon slds-button__icon--left"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#back"></use></svg>'+cr.back+'</button><button class="cb-PageWizardFooter-next slds-button slds-button_brand js-next" disabled>'+cr.create+"</button></div>"),events:{"click .js-content-item:not([disabled])":"_clickContentItem","keyup .js-content-item:not([disabled])":"_clickContentItem","click .js-next":"_next","click .js-back":"_back","click .js-filter .js-dropdown-button":"_openFilter","click .js-filter-all":"_filterAll","click .js-filter-installed":"_filterInstalled","input .js-search":"_search"},_availableDataObjects:[],_listItemTemplates:[],_filter:"",_currentObjectName:"",initialize:function(e){this.parent=e.parent,this.model=this.parent.model},render:function(){this._currentObjectName="",this._filter="",this._globalPages=this.model.get("globalPages"),this._availableDataObjects=this._getFilteredDataObjects(),this._routeUrlConflictMap=this._getRouteUrlConflictMap();var e=D.radioDropdown({className:"cb-PageWizardToolbar-dropdown js-filter",selectedLabel:cr.all,dropdownLabel:cr.showObjects,selectedLabelClassName:"js-selected-label",dropdownItem:[D.radioDropdownItem({label:cr.all,className:"js-filter-all",value:"checked"}),D.radioDropdownItem({label:cr.installed,className:"js-filter-installed",value:""})].join("")});return this.$el.html(this.template({searchInput:D.searchInput({icon:"search",placeholder:cr.search,className:"cb-PageWizardToolbar-searchInput"}),objectDropdown:e})).append(this.footerTemplate()),this._renderList(this._availableDataObjects),this.delegateEvents(),this},_getFilteredDataObjects:function(){var e=this.model.get("availableDataObjects"),t=I.getAppState().getDataObjects(),e=_.reject(e,function(e){return _.find(t,{keyPrefix:e.KeyPrefix})});return this._tagFilteredObjects(e),_(e).chain().groupBy("Label").each(function(e){1<e.length&&_.each(e,function(e){e.showLabelName=!0})}).values().flatten().sortBy(function(e){return e.Label}).sortBy(function(e){return-e.timeMillis}).sortBy(function(e){return!e.isNew}).value()},_tagFilteredObjects:function(e){_.each(e,function(t){t.pages=_.filter(this._globalPages,function(e){return e.routeType.split("-").pop()===t.KeyPrefix}),_.isEmpty(t.pages)?t.timeMillis=0:t.timeMillis=_.max(_.map(t.pages,"timeMillis")),t.isNew=_.some(t.pages,function(e){return e.isNew})}.bind(this))},_getRouteUrlConflictMap:function(){var e=this.model.get("parentId")||"";return k.getRouteSiblingsWithChildren(e).filter(function(e){return e.getRouteSegment()===e.getRouteBaseSegment()}).reduce(function(e,t){return e[t.getRouteSegment()]=!0,e},{})},_renderList:function(e){var i=this;this.listItemTemplates=_.chain(e).reject(function(e){return i._filter===dr&&0===e.pages.length}).map(function(e){var t=!!i._routeUrlConflictMap[e.UrlPrefix],n=t?ur.hasConflict:e.pages.length?ur.hasPages:{};return i.listItemTemplate({label:_.escape(e.Label),name:e.Name,labelName:e.showLabelName?"("+e.Name+")":"",selected:e.Name===i._currentObjectName,disabled:t,isNew:e.isNew,icon:n})}).value(),this.$(".js-no-results, .js-no-installed-results").hide(),0===this.listItemTemplates.length&&(this._filter===dr?this.$(".js-no-installed-results"):this.$(".js-no-results")).show(),this.$(".js-content-items").html(this.listItemTemplates.join("")),this.$('[data-toggle="tooltip"]').tooltip({container:".cb-Dialog--PageWizard"})},_search:function(){var t=this.$(".js-search").val().trim(),e=(t||this._renderList(this._availableDataObjects),_.filter(this._availableDataObjects,function(e){return-1<e.Label.toLowerCase().indexOf(t.toLowerCase())}));this._renderList(e)},_clickContentItem:function(e){e.which!==P.KEYCODE.ENTER&&"click"!==e.type||(e=T(e.currentTarget),this._currentObjectName=e.data("value"),this.$(".js-content-item").removeClass("selected"),e.closest(".js-content-item").addClass("selected"),this.$(".js-next").prop("disabled",!1))},_openFilter:function(){this.$(".js-filter .js-dropdown-button").focus()},_filterInstalled:function(){this._filter=dr,this.$(".js-selected-label").html(cr.installed),this._search()},_filterAll:function(){this._filter="",this.$(".js-selected-label").html(cr.all),this._search()},_next:function(){var e=_.find(this._availableDataObjects,function(e){return e.Name===this._currentObjectName}.bind(this));this.model.set("selectedObject",e),this.trigger("next")},_back:function(){this.trigger("back")}}),pr=PicassoWebServices.Labels.CommBuilderPageWizard,n=Backbone.View.extend({template:function(e){e=e.searchInput;return'<div class="cb-PageWizard-listContainer js-page-wizard-choose-page">\n                <div class="cb-PageWizardToolbar">\n                    '.concat(e,"\n                    ").concat(D.buttonWithIcon({buttonClassName:"cb-PageWizardToolbar-newButton js-new-blank-page",buttonVariantClassName:"slds-button_brand",icon:"add",label:pr.newBlankPage}),'\n                </div>\n                <div class="cb-pageWizardList">\n                    <ul class="cb-PageWizard-listItems js-content-items"></ul>\n                </div>\n                <div class="cb-PageWizardList-noResults slds-text-heading_small js-no-results">').concat(pr.noResults,"</div>\n            </div>").trim()},listItemTemplate:_.template('<li class="cb-PageWizard-listItem js-content-item {{=selected ? "selected" : ""}}" data-value="{{=value}}" data-type="{{=type}}" tabindex="0"><span class="cb-PageWizard-listItemImg slds-icon_container"><svg aria-hidden="true" class="slds-icon cb-PageWizard-listItemIcon"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#page"></use></svg><span class="slds-assistive-text">{{=name}}</span></span><span class="cb-PageWizard-listItemLabel js-page-wizard-list-item-label" title="{{=devName}}">{{=name}}</span><span class="cb-PageWizard-newBadge slds-badge {{= isNew ? "slds-show" : "slds-hide"}} js-page-wizard-new-badge">'+pr.newTag+"</span></li>"),footerTemplate:_.template('<div class="cb-PageWizardFooter"><button class="cb-PageWizardFooter-back slds-button slds-button_neutral js-back"><svg aria-hidden="true" class="slds-button__icon slds-button__icon--left"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#back"></use></svg>'+pr.back+'</button><button class="cb-PageWizardFooter-next slds-button slds-button_brand js-next" disabled>'+pr.next+"</button></div>"),events:{"click .js-new-blank-page":"_createNewBlankPage","click .js-content-item":"_clickContentItem","keyup .js-content-item":"_clickContentItem","click .js-next":"_next","click .js-back":"_back","input .js-search":"_search"},_selectedName:"",_selectedValue:"",_selectedType:"",_availableViews:null,initialize:function(e){this.parent=e.parent,this.model=this.parent.model},render:function(){return this._selectedName="",this._selectedValue="",this._selectedType="",this._globalPages=this._getFilteredGlobalPages(),this.model.set("selectedPage",null),this.model.set("defaultUrl",null),0===this._globalPages.length&&this._createNewBlankPage(!0,!0),this.$el.html(this.template({searchInput:D.searchInput({icon:"search",placeholder:pr.search,className:"cb-PageWizardToolbar-searchInput"})})).append(this.footerTemplate()),this._renderList(this._globalPages),this.delegateEvents(),this},_getFilteredGlobalPages:function(){var e=this.model.get("globalPages"),t=this.model.get("routeType"),t=this.model.get("pageVariationMode")?ya.getFilteredViewsForRouteType(t,e):ya.getFilteredViews(e,this.model);return _(t).chain().sortBy("labelName").value()},_renderList:function(e){var t=this,e=e.map(function(e){return t.listItemTemplate({name:e.labelName,value:e.id,selected:e.id===t._selectedValue,type:e.pageType,isNew:e.isNew,devName:e.devName})});0===e.length?this.$(".js-no-results").show():this.$(".js-no-results").hide(),this.$(".js-content-items").html(e.join(""))},_search:function(e){var t=T(e.target).val().trim(),e=(t||this._renderList(this._globalPages),_.filter(this._globalPages,function(e){return-1<e.labelName.toLowerCase().indexOf(t.toLowerCase())}));this._renderList(e)},_clickContentItem:function(e){e.which!==P.KEYCODE.ENTER&&"click"!==e.type||(e=T(e.currentTarget),this._selectedType=e.data("type"),this._selectedValue=e.data("value"),this.$(".js-content-item").removeClass("selected"),e.closest(".js-content-item").addClass("selected"),this.$(".js-next").prop("disabled",!1))},_createNewBlankPage:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this._setSelectedLayout(),this.trigger("next",e,t)},_setSelectedLayout:function(){var e=this.model.get("availableLayouts");e&&1===e.length&&(e=e[0].Name,this.model.set("selectedLayout",e))},_next:function(){var e=_.find(this.model.get("globalPages"),function(e){return this._selectedValue===e.id}.bind(this)),t=ya.getRouteForRouteType(this.model.get("routeType"));null!==t?this.model.set("defaultUrl",t.get("RouteUrl")):(t=!k.isExportedRouteType(e.routeType)&&h.getOOTBRouteUrlByType(e.routeType))&&this.model.set("defaultUrl",t),this.model.set("selectedPage",e),this.trigger("next")},_back:function(){this.trigger("back")}}),gr=PicassoWebServices.Labels.CommBuilderPageWizard,hr=Backbone.View.extend({template:_.template('<div class="cb-PageWizardChooseType"><div class="cb-PageWizardChooseType-item cb-PageWizardChooseType-item--standard js-new-page" tabindex="0"><h1 class="cb-PageWizardChooseType-itemTitle slds-text-heading_medium">'+gr.page+'</h1><span class="cb-PageWizardChooseType-itemDescription">'+gr.pageDescription+'</span>{{=pageIcon}}</div><div class="cb-PageWizardChooseType-item cb-PageWizardChooseType-item--object js-new-object {{= shouldDisableObjectPage ? "disabled" : ""}}" tabindex="0">{{ if (shouldDisableObjectPage) { }}{{=objectPageDisabledTooltipIcon}}{{ } }}<h1 class="cb-PageWizardChooseType-itemTitle slds-text-heading_medium">'+gr.object+'</h1><span class="cb-PageWizardChooseType-itemDescription">'+gr.objectDescription+"</span>{{=objectIcon}}</div>{{=contentPageOption}}</div>"),pageIcon:_.template('<div class="cb-PageWizardChooseType-pageIcon"><svg aria-hidden="true" class="slds-icon cb-PageWizardChooseType-pageIconSvg"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#page"></use></svg></div>'),objectIcon:_.template('<div class="cb-PageWizard-objectIconWrapper"><div class="cb-PageWizard-objectIcon"><div class="cb-PageWizard-objectIconItem cb-PageWizard-objectIconItem--1"><div class="cb-PageWizard-objectIconItemOverlay"></div></div><div class="cb-PageWizard-objectIconItem cb-PageWizard-objectIconItem--2"><div class="cb-PageWizard-objectIconItemOverlay"></div></div><div class="cb-PageWizard-objectIconItem cb-PageWizard-objectIconItem--3"><svg aria-hidden="true" class="slds-icon cb-PageWizard-objectIconItemContentIcon"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/standard-sprite/svg/symbols.svg#environment_hub"></use></svg></div></div></div>'),contentPageOptionTemplate:_.template('<div class="cb-PageWizardChooseType-item cb-PageWizardChooseType-item--content js-new-content-page {{= shouldDisableContentPage ? "disabled" : ""}}" tabindex="0">{{ if (shouldDisableContentPage) { }}{{=contentPageDisabledTooltipIcon}}{{ } }}<h1 class="cb-PageWizardChooseType-itemTitle slds-text-heading_medium">'+gr.contentPage+'</h1><span class="cb-PageWizardChooseType-itemDescription">'+gr.contentPageDescription+"</span>{{=pageIcon}}</div>"),events:{"click .js-new-page":"_newPage","keyup .js-new-page":"_newPage","click .js-new-object:not(.disabled)":"_newObject","keyup .js-new-object:not(.disabled)":"_newObject","click .js-new-content-page:not(.disabled)":"_newContentPage","keyup .js-new-content-page:not(.disabled)":"_newContentPage"},initialize:function(e){this.parent=e.parent,this.model=this.parent.model},render:function(){var e=I.AccessControl(P.PERMISSIONS.CONTENT_PAGES),t=(I.getAppState().supportsNewFeatures()||(this.model.set("pageType",this.model.PAGE_TYPES.STANDARD),this.trigger("next",!0)),this.model.get("parentLevel")>=P.PAGE_MENU.MAX_OBJECT_PAGE_DEPTH),n=e?"cb-PageWizardChooseType-objectDisabledTooltipWithContentPage":"cb-PageWizardChooseType-objectDisabledTooltipNoContentPage",i=this.model.get("parentLevel")>=P.PAGE_MENU.MAX_OBJECT_PAGE_DEPTH,n=t?this._pageDisabledToolTipIcon(n,gr.ObjectPagesDisabledTooltip):"",s=i?this._pageDisabledToolTipIcon("cb-PageWizardChooseType-contentPageDisabledTooltip",gr.ContentPagesDisabledTooltip):"",a=this.pageIcon(),i=this.contentPageOptionTemplate({pageIcon:a,shouldDisableContentPage:i,contentPageDisabledTooltipIcon:s});return this.$el.html(this.template({pageIcon:a,objectIcon:this.objectIcon(),shouldDisableObjectPage:t,objectPageDisabledTooltipIcon:n,contentPageOption:e?i:""})),this.$('[data-toggle="tooltip"]').tooltip(),this.delegateEvents(),this},_newPage:function(e){this._isValidEnterKey(e)||(this.model.set("pageType",this.model.PAGE_TYPES.STANDARD),this.trigger("next"))},_newObject:function(e){this._isValidEnterKey(e)||(this.model.set("pageType",this.model.PAGE_TYPES.DATA),this.trigger("next"))},_newContentPage:function(e){this._isValidEnterKey(e)||(this.model.set("pageType",this.model.PAGE_TYPES.CONTENT),this.trigger("next"))},_isValidEnterKey:function(e){return e.which!==P.KEYCODE.ENTER&&"click"!==e.type},_pageDisabledToolTipIcon:function(e,t){return D.bsTooltipIcon({placement:"top",className:e,content:t})}}),mr=PicassoWebServices.Labels.CommBuilderPageWizard,mr=Backbone.View.extend({template:_.template('<div class="cb-PageWizard-objectInfo js-page-wizard-object-info">\n            <span class="cb-PageWizard-objectInfoIconContainer slds-icon_container">\n                <svg aria-hidden="true" class="slds-icon cb-PageWizard-objectInfoIcon">\n                    <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#standard_objects"></use>\n                </svg>\n            </span>\n            <div class="cb-PageWizard-objectInfoFlow">\n                <div class="cb-PageWizard-objectInfoFlowCurveContainer">\n                    <div class="cb-PageWizard-objectInfoFlowCurve"></div>\n                </div>\n                <div class="cb-PageWizard-objectInfoFlowLine"></div>\n            </div>\n            <div class="cb-PageWizard-objectInfoFiles">\n                <div class="cb-PageWizard-objectInfoFile">\n                    <img class="cb-PageWizard-objectInfoFileIcon" src="/sfsites/sfservice/builder/resources/images/icons/file-detail.svg"/>\n                    <div class="cb-PageWizard-objectInfoFileLabel">'.concat(mr.detailIconLabel,'</div>\n                </div>\n                <div class="cb-PageWizard-objectInfoFile">\n                    <img class="cb-PageWizard-objectInfoFileIcon" src="/sfsites/sfservice/builder/resources/images/icons/file-list.svg"/>\n                    <div class="cb-PageWizard-objectInfoFileLabel">').concat(mr.listIconLabel,'</div>\n                </div>\n                <div class="cb-PageWizard-objectInfoFile">\n                    <img class="cb-PageWizard-objectInfoFileIcon" src="/sfsites/sfservice/builder/resources/images/icons/file-relatedList.svg"/>\n                    <div class="cb-PageWizard-objectInfoFileLabel">').concat(mr.relatedListIconLabel,'</div>\n                </div>\n            </div>\n            <div class="cb-PageWizard-objectInfoDescription">').concat(mr.objectInfoDescription,'</div>\n            <div class="cb-PageWizard-objectInfoCheckbox">\n                <div class="slds-checkbox">\n                    <input type="checkbox" name="options" id="js-dialog-checkbox" class="js-checkbox"/>\n                    <label class="slds-checkbox__label" for="js-dialog-checkbox">\n                        <span class="slds-checkbox_faux"></span>\n                        <span class="slds-form-element__label">\n                            ').concat(mr.objectInfoCheckbox,"\n                        </span>\n                    </label>\n                </div>\n            </div>\n        </div>")),footerTemplate:_.template('<div class="cb-PageWizardFooter"><button class="cb-PageWizardFooter-back slds-button slds-button_neutral js-back"><svg aria-hidden="true" class="slds-button__icon slds-button__icon--left cb-PageWizardFooter-backIcon"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#back"></use></svg>'+mr.back+'</button><button class="cb-PageWizardFooter-next slds-button slds-button_brand js-next">'+mr.create+"</button></div>"),events:{"click .js-next":"_next","click .js-back":"_back"},initialize:function(e){this.parent=e.parent,this.model=this.parent.model},render:function(){return this.$el.html(this.template()).append(this.footerTemplate()),this.delegateEvents(),this},_next:function(){this.$(".js-checkbox").is(":checked")&&T.cookie(I.getAppState().getNetworkId()+"_objectInfo",!0),this.trigger("next")},_back:function(){this.trigger("back")}}),vr=PicassoWebServices.Labels.CommBuilderPageWizard,br="managed-content-",fr=Backbone.View.extend({template:function(){return'<div class="cb-PageWizard-listContainer js-page-wizard-choose-content-type">\n                <div class="cb-PageWizardList">\n                    <ul class="cb-PageWizard-listItems js-content-types"></ul>\n                    <div class="cb-PageWizardList-noResults js-no-contentTypes">\n                        <div class="slds-text-heading_medium js-emptystate-heading">'.concat(vr.noContentTypesHeader,'</div>\n                        <div class="slds-m-top_small js-emptystate-msg">').concat(vr.noContentTypesMsg,"</div>\n                    </div>\n                </div>\n            </div>").trim()},listItemTemplate:function(e,t,n){return'<li class="cb-PageWizard-listItem js-content-type '.concat(n?"selected":"",'" data-value="').concat(e,'" tabindex="0">\n                <span class="cb-PageWizard-listItemLabel js-page-wizard-list-item-label">').concat(t,"</span>\n            </li>").trim()},footerTemplate:function(){return'<div class="cb-PageWizardFooter">\n                <button class="cb-PageWizardFooter-back slds-button slds-button_neutral js-back">\n                    <svg aria-hidden="true" class="slds-button__icon slds-button__icon--left">\n                        <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#back"></use>\n                    </svg>\n                    '.concat(vr.back,'\n                </button>\n                <button class="cb-PageWizardFooter-next slds-button slds-button_brand js-next" disabled>\n                    ').concat(vr.create,"\n                </button>\n            </div>").trim()},events:{"click .js-content-type":"_clickContentType","keyup .js-content-type":"_clickContentType","click .js-next":"_next","click .js-back":"_back"},_availableContentTypes:[],_currentContentTypeName:"",initialize:function(e){this.parent=e.parent,this.model=this.parent.model},render:function(){return this._currentContentTypeName="",this._availableContentTypes=this._getContentTypes(),this.$el.html(this.template()).append(this.footerTemplate()),this._renderList(this._availableContentTypes),this.delegateEvents(),this},_getContentTypes:function(){var e=this.model.get("cmsContentTypes");return _.reject(e,function(t){return h.getRoutes().find(function(e){if(e.isManagedContentRoute())return this._getContentTypeFqn(t)===e.get("ViewType").split("-").pop()}.bind(this))}.bind(this))},_getContentTypeFqn:function(e){return e.fullyQualifiedName||e.developerName},_renderList:function(e){var t=this;this.listItemTemplates=_.chain(e).map(function(e){return t.listItemTemplate(this._getContentTypeFqn(e),e.masterLabel,this._getContentTypeFqn(e)===t._currentContentTypeName)}.bind(this)).value(),0===this.listItemTemplates.length?this.$(".js-no-contentTypes").show():this.$(".js-no-contentTypes").hide(),this.$(".js-content-types").html(this.listItemTemplates.join("")),this.$('[data-toggle="tooltip"]').tooltip({container:".cb-Dialog--PageWizard"})},_clickContentType:function(e){e.which!==P.KEYCODE.ENTER&&"click"!==e.type||(e=T(e.currentTarget),this._currentContentTypeName=e.data("value"),this.$(".js-content-type").removeClass("selected"),e.closest(".js-content-type").addClass("selected"),this.$(".js-next").prop("disabled",!1))},_isBaseUrlAvailable:function(t){var e=this.model.get("parentId")||"",n=e?h.getRoutes().get(e).get(P.PROP.ROUTE_URL_KEY):"",n="".concat(n,"/").concat(t),e=k.getRouteSiblingsWithChildren(e);return!k.doesRouteWithBaseUrlExist(n)&&!e.some(function(e){return e.getRouteSegment()==="/".concat(t)})},_next:function(){var e=_.find(this._availableContentTypes,function(e){return this._getContentTypeFqn(e)===this._currentContentTypeName}.bind(this)),t=h.getOOTBRouteUrlByType("managed-content-__id"),n=e.developerName.toLowerCase().replace(/_/g,"-"),i=this._getContentTypeFqn(e).toLowerCase().replace(/_/g,"-"),i=this._isBaseUrlAvailable(n)?n:this._isBaseUrlAvailable(i)?i:br+n,n=t.replace("__id",i),t=this.model.get("customGlobalPages"),i=_.find(t,function(e){return"managed-content"===e.routeType}),t=e.masterLabel+" "+P.NEW_PAGE_WIZARD.CUSTOM_DATA_DETAIL_ROUTE_NAME_SUFFIX;this.model.set("name",t),this.model.set("url",n),this.model.set("devName",t),this.model.set("routeType",br+this._getContentTypeFqn(e)),this.model.set("selectedPage",i),this.trigger("next")},_back:function(){this.trigger("back")}}),_r=PicassoWebServices.Labels.CommBuilderPageWizard,Sr=Object.freeze({PageWizardStepChooseLayout:{viewType:t,getTitle:function(e){var t=e.isVariationMode,e=e.isSubpageMode;return t?_r.stepNewPageVariationLayoutTitle:e?_r.stepAddSubpageTitle:_r.stepLayoutTitle},getDescription:function(e){return e.isVariationMode?_r.stepNewPageVariationLayoutDescription:_r.stepLayoutDescription},containerClass:"cb-PageWizard-stepHeight--3"},PageWizardStepChooseName:{viewType:e,getTitle:function(e){var t=e.isVariationMode,e=e.isSubpageMode;return t?_r.stepNewPageVariationNameTitle:e?_r.stepAddSubpageTitle:_r.stepNameTitle},getDescription:function(e){return e.isVariationMode?_r.stepNewPageVariationNameDescription:_r.stepNameDescription},containerClass:"cb-PageWizard-stepHeight--1"},PageWizardStepChooseObject:{viewType:i,getTitle:function(){return _r.stepObjectTitle},getDescription:function(){return _r.stepObjectDescription},containerClass:"cb-PageWizard-stepHeight--3"},PageWizardStepChoosePage:{viewType:n,getTitle:function(e){var t=e.isVariationMode,e=e.isSubpageMode;return t?_r.stepNewPageVariationTitle:e?_r.stepAddSubpageTitle:_r.stepPageTitle},getDescription:function(e){return e.isVariationMode?_r.stepNewPageVariationDescription:_r.stepPageDescription},containerClass:"cb-PageWizard-stepHeight--3"},PageWizardStepChooseType:{viewType:hr,getTitle:function(e){return e.isSubpageMode?_r.stepAddSubpageTitle:_r.stepTypeTitle},getDescription:function(){return _r.stepTypeDescription},containerClass:"cb-PageWizard-stepHeight--2"},PageWizardStepObjectInfo:{viewType:mr,getTitle:function(){return _r.stepObjectInfoTitle},getDescription:function(){return""},containerClass:"cb-PageWizard-stepHeight--4"},PageWizardStepChooseContentType:{viewType:fr,getTitle:function(){return _r.stepContentPageTitle},getDescription:function(){return _r.stepContentPageSelectTypeDescription},containerClass:"cb-PageWizard-stepHeight--5"}}),Cr={_wizard:null,_model:null,_views:{},_history:[],_selectedName:null,initialize:function(n,e,t){var i=this;_.extend(i,Fe.Events),i._wizard=n,i._model=e,i.configs={},i._history=[],this._setConfigs(i._model.get("pageVariationMode"),ya.isSubpageMode(i._model)),_.each(i.configs,function(e,t){i._views[t]=new e.viewType({parent:n}),i.listenTo(i._views[t],"next",i["_"+t]),i.listenTo(i._views[t],"back",i._stepBack)}),t&&i._setContent(t,!0)},_setConfigs:function(i,s){var a=this;Object.keys(Sr).forEach(function(e){a.configs[e]=m({},Sr[e]);var t=Sr[e],n=t.getTitle,t=t.getDescription;a.configs[e].title=n({isVariationMode:i,isSubpageMode:s}),a.configs[e].description=t({isVariationMode:i,isSubpageMode:s})})},_stepBack:function(){var e=this._history.pop();e?this._setContent(e,!0):A.closeDialog()},_PageWizardStepChooseType:function(e){var t=this._model.get("pageType");t===this._model.PAGE_TYPES.STANDARD?this._model.get("globalPages").length?this._setContent("PageWizardStepChoosePage",!!e):this._createNewBlankPage(!1,!!e):t===this._model.PAGE_TYPES.DATA?this._setContent("PageWizardStepChooseObject",!!e):t===this._model.PAGE_TYPES.CONTENT&&this._setContent("PageWizardStepChooseContentType",!!e)},_PageWizardStepChoosePage:function(e,t){this._createNewBlankPage(e,t)},_createNewBlankPage:function(e,t){this._shouldSkipChooseLayout(e)?this._setContent("PageWizardStepChooseName",!!t):this._setContent("PageWizardStepChooseLayout",!!t)},_shouldSkipChooseLayout:function(e){return this._model.get("selectedPage")||this._model.get("selectedLayout")||!e},_PageWizardStepChooseLayout:function(){this._setContent("PageWizardStepChooseName")},_PageWizardStepChooseName:function(){this._model.get("selectedPage")?this._model.get("pageVariationMode")?ya.createGlobalPageVariation(this._model):ya.createGlobalPage(this._model):ya.createLightningViewWithLayout(this._model)},_PageWizardStepChooseObject:function(){T.cookie(I.getAppState().getNetworkId()+"_objectInfo")?ya.createObjectPages(this._model):this._setContent("PageWizardStepObjectInfo")},_PageWizardStepObjectInfo:function(){ya.createObjectPages(this._model)},_PageWizardStepChooseContentType:function(){ya.createGlobalPage(this._model)},_setContent:function(e,t){var n=this._views[e],i=this.configs[e];!t&&this._model.get("currentViewName")&&this._history.push(this._model.get("currentViewName")),this._model.set("currentViewName",e),this._wizard.setContent(n,i.title,i.description,i.containerClass)}},yr=Fe.Model.extend({PAGE_TYPES:{STANDARD:"STANDARD",DATA:"DATA",CONTENT:"CONTENT"},FROM_VIEW_OR_LAYOUT_ACTIVE_TAB:{VIEW:"VIEW",FLEXIPAGE_VIEW:"FLEXIPAGE_VIEW",LAYOUT:"LAYOUT"},defaults:{availableLayouts:[],availableDataObjects:[],globalPages:[],selectedLayout:"",currentViewName:"",selectedView:null,selectedFlexipageId:"",pageType:null,name:null,parentId:null,parentLevel:null,url:null,devName:null,shouldCreateRoute:!0,routeId:"",routeType:"",pageVariationMode:!1}}),Tr="cb-PageWizard-contentContainer js-content-container",Pr=".".concat(D.SPINNER_CLASSNAME),Ir=Backbone.View.extend({_template:function(e){return'<div class="'.concat(Tr," ").concat(e,'" tabindex="0">\n                <div class="cb-PageWizard-content js-content"></div>\n            </div>\n            ').concat(D.spinner).trim()},_headerTemplate:_.template('<div class="cb-PageWizardHeader">\n            <div class="cb-PageWizardHeader-title js-page-wizard-header-title slds-text-heading_large">{{= title }}</div>\n            <div class="cb-PageWizardHeader-description {{= description ? "" : "slds-hide"}}">{{= description }}</div>\n        </div>'.trim()),_placeholderHtml:'<div class="cb-PageWizard-placeholder">'.concat(D.spinner,"</div>").trim(),contentView:null,title:"",description:"",initialize:function(e){var t=e.routeId,t=void 0===t?"":t,n=e.routeType,n=void 0===n?"":n,i=e.pageType,i=void 0===i?"":i,s=e.pageVariationMode,a=e.contentView,o=e.parentId,e=e.parentLevel;this.model=new yr,this.model.set("routeId",t),this.model.set("parentId",o),this.model.set("parentLevel",e),this.model.set("routeType",n),this.model.set("pageType",i),this.model.set("pageVariationMode",!!s),this.model.set("currentViewName",a),Cr.initialize(this,this.model,a),j.getAppEvent().on("page-wizard-show-loading",this._setLoading.bind(this))},render:function(){return this._hasLoadedData?(this.$el.html(this._template(this._getCurrentViewConfig().containerClass)).prepend(this._headerTemplate({title:this.title,description:this.description})),this.contentView&&this.$(".js-content").html(this.contentView.render().$el),this.$(Pr).hide()):this._renderAsync(),this},_getCurrentViewConfig:function(){return Cr.configs[this.model.get("currentViewName")]},_renderAsync:function(){return this.$el.html(this._placeholderHtml),this._setLoading(!0),T.when.apply(T,ya.getData(this.model)).done(function(){this._setLoading(!1),this._hasLoadedData=!0,this.render()}.bind(this)),this},_setLoading:function(e){var t=this.$(Pr),n=T(".vex-close");e?(t.fadeIn(),n.hide()):(t.fadeOut(),n.show())},setContent:function(e,t,n,i){this.contentView=e,this.title=t,this.description=n,this.$(".js-content-container").attr("class",Tr).addClass("cb-PageWizard-contentContainer--fadeOut").addClass(i),setTimeout(function(){this.render()}.bind(this),200)}}),Er=PicassoWebServices.Labels.CommBuilderPageManagement,wr=P.PROP;var Lr=Backbone.View.extend({_routeId:null,_routeType:null,_parent:null,_deferred:[],_hasLoadedData:!1,_auraPanels:[],_template:function(e){e=e.supportsAudience;return'<div class="cb-PageManager-content-variations">\n                <div class="cb-PageManager-content-variations-header">\n                    <div class="cb-PageManager-content-variations-helptext-container">\n                        '.concat("<p>".concat(e?Er.PageVariationsHeading1Title:Er.PageVariationsHeading1TitleNoPageAssignment,"</p>"),"\n                        <p>").concat(Er.PageVariationsHeading2Title,'</p>\n                    </div>\n                    <div class="cb-PageManager-actions-container">\n                        ').concat(e?D.bsButtonIconWithTooltip({buttonClassName:"cb-PageManager-contentHeaderToolbarButton cb-PageManager-contentHeaderToolbarAudienceButton js-pm-page-table-manage-audience slds-button_icon-border slds-button slds-button_icon",placement:"top",svgClassName:"",icon:"groups",label:"".concat(Er.ManageAudiences)}):"","\n                        ").concat(D.buttonWithIcon({buttonClassName:"cb-PageManager-contentHeaderToolbarButton cb-PageManager-contentHeaderToolbarNewButton js-pm-page-table-create-page",buttonVariantClassName:"slds-button_neutral slds-truncate",icon:"add",label:"".concat(Er.CreateAssociatedPageTitle)}),'\n                    </div>\n                </div>\n                <div class="cb-PageManager-pagesTableWrapper js-table-container"></div>\n            </div>').trim()},events:{"click .js-pm-page-table-create-page":"_onCreateAssociatedPage","click .js-pm-page-table-manage-audience:not(.disabled)":"_onManageAudience"},initialize:function(e){this.options=e||{},this._routeId=this.options.routeId,this._parent=this.options.parent;e=h.getRoutes().get(this._routeId);this._routeType=e.get(wr.ROUTE_TYPE_KEY),this._spaPageId=e.get(wr.PAGE_ID_KEY),this._deferred.push(h.getAudienceTargetInfosForRoutePromise(this._routeId)),this._deferred.push(h.getPublishStatusPromise(this._routeId)),this._table=new zo({dataProvider:Ko,dropdownConfig:Jo,parentRef:this,contextParams:{routeId:this._routeId,routeType:this._routeType}}),this.listenTo(this._table,"dnd-update",this._updatePriorities),this.listenTo(I.event,["state:default-view-updated","state:view-audience-removed","state:view-deleted","state:view-created"].join(" "),this._refreshIfRouteMatches),this.listenTo(I.event,"state:view-publish-state-updated",this._refreshIfViewMatches),this.listenTo(I.event,"state:view-properties-updated",this._handleViewPropertiesChanged),this.listenTo(I.event,"state:site-published",this._refreshPublishState.bind(this))},_renderAsync:function(){return T.when.apply(this,this._deferred).done(function(){this._hasLoadedData=!0,this.render()}.bind(this)),this},render:function(){return this._hasLoadedData?(this._table.$el.remove(),this.$el.html(this._template({supportsAudience:I.getAppState().supportsNewFeatures()})),this.$(".js-table-container").append(this._table.render().$el),this._table.delegateEvents(),this.$('[data-toggle="tooltip"]').tooltip()):this._renderAsync(),this},_updatePriorities:function(e){I.event.trigger("action:update-page-audience-target-priorities",{viewIdToPriorityMap:e,routeId:this._routeId,successCallback:function(){this.render()}.bind(this)})},_refreshPublishState:function(){h.getPublishStatusPromise(this._routeId).done(function(){this.render()}.bind(this))},_refreshViewAfterVisibilityUpdate:function(e){var t=h.getRoutes().get(this._routeId);e===t.getViewId()&&t.setView(null,!0),this._deferred=[],e&&this._deferred.push(k.syncPublishStatePromise(e)),this._deferred.push(k.syncAudienceTargetInfosPromise(this._routeId)),this._renderAsync()},_refreshIfRouteMatches:function(e){e=e.routeId;this._routeId===e&&this.render()},_refreshIfViewMatches:function(e){var t=h.getRoutes().get(this._routeId).getViews();return!!_.find(t,{id:e})&&(this.render(),!0)},_handleViewPropertiesChanged:function(e){I.event.trigger("action:sync-view-publish-state",{id:e})},_getViewIdFromEvent:function(e){e=T(e.currentTarget).closest(".js-page-table-item");return e&&e.data("id")},handleRemoveViewVisibility:function(e){var t=h.getAudienceTargetInfoForView(this._routeId,e),n=null,i=null;t&&(n=t.get("audienceTargetInfoID"),i=t.get("audienceId")),I.event.trigger("action:remove-view-audience",{viewId:e,routeId:this._routeId,entityId:n,audienceId:i,routeType:this._routeType,spaPageId:this._spaPageId})},handleMakeViewDefault:function(e){I.event.trigger("action:update-default-view",{viewId:e,routeId:this._routeId,routeType:this._routeType,spaPageId:this._spaPageId,currentDefaultViewId:k.getDefaultViewIdForRoute(this._routeId)})},_onManageAudience:function(e){T(e.currentTarget).blur(),this.handleManageVisibility()},handleManageVisibility:function(e,t){Ki.openAudienceSelectorForPage(this._routeId,e,function(){t&&t(),this._refreshViewAfterVisibilityUpdate(e)}.bind(this))},handleDeleteView:function(t){var e=h.getViews().get(t).get(wr.NAME_KEY);A.sldsModal({title:PicassoWebServices.Labels.PicassoDialog.DeletePageVariationTitle,content:PicassoWebServices.Labels.PicassoDialog.DeletePageVariationConfirmationText.replace("{0}",e),yesText:PicassoWebServices.Labels.PicassoDialog.Delete,yesTextClassName:"slds-button_destructive",callback:function(e){e&&I.event.trigger("action:delete-view",{viewId:t,routeId:this._routeId,routeType:this._routeType,spaPageId:this._spaPageId,successCallback:function(){t===I.getAppState().getCurrentViewId()&&I.event.trigger("action:navigate-to-page",{viewId:k.getDefaultViewIdForRoute(this._routeId),routeId:this._routeId})}.bind(this)})}.bind(this)})},_onCreateAssociatedPage:function(){var e=new Ir({hideFooter:!0,contentView:"PageWizardStepChoosePage",routeId:this._routeId,routeType:this._routeType,pageType:P.NEW_PAGE_WIZARD.STANDARD,pageVariationMode:!0});A.showDialog(e,{className:"slds-vex-theme cb-Dialog--PageWizard"})},_closeAuraPanels:function(){this._auraPanels.forEach(function(e){e.close()})},remove:function(){this.$el.remove(),this._closeAuraPanels(),this.stopListening()}}),Dr=PicassoWebServices.Labels.CommBuilderDataProviderSettings,Ar=".".concat(D.SPINNER_CLASSNAME),kr={sfdc_cms__recordDataProvider:P.DATA_PROVIDER.RECORD,sfdc_cms__apexDataProvider:P.DATA_PROVIDER.APEX},Nr={sfdcExpressionKey:"",definition:"sfdc_cms__recordDataProvider",attributes:{}},xr=Backbone.View.extend({_html:'\n        <div class="slds-p-around_x-large cb-DataProviders-header">\n            <h3 class="slds-text-heading_x-small test-help-text">'.concat(Dr.ContentDescription,' </h3>\n        </div>\n\n        <div class="slds-p-left_x-large slds-p-right_x-large slds-p-bottom_x-large js-data-provider-list-container inherited">').concat(D.spinner,'</div>\n        <div class="slds-p-around_x-large js-data-provider-list-container configured">').concat(D.spinner,"</div>\n        ").trim(),events:{addDataProvider:"_onConfigureNewDataProvider",removedataprovider:"_onDelete",viewdataprovider:"_onView"},initialize:function(e){this.routeId=e.routeId,this.viewId=e.viewId},render:function(){return this.$el.html(this._html),this._createEditorConfig(),this._renderDataProviders(),this},_createEditorConfig:function(){var i=this;$P.auraRun(function(){$A.createComponent("es_block_builder:dataProviderConfigEditorWrapper",{contentTypeFullyQualifiedName:"sfdc_cms__view",designConfigTarget:"lightningCommunity",nameChangeHandler:i._validateSdfcExpressionKey.bind(i),saveHandler:i._onSave.bind(i),fetchDataHandler:i._onFetchDataFromDataHandler.bind(i),getDataProviderBlockHandler:i._onGetDataProviderBlock.bind(i)},function(e,t,n){e&&(i.editorConfigCmp=e,$A.render(e))})})},_onDelete:function(t){t.stopPropagation();var e=this.configuredDataProviders.filter(function(e){return e.componentAttributes.sfdcExpressionKey!==(null==(e=t.detail)||null==(e=e.dp)?void 0:e.id)});this._triggerUpsertAction(e,null==(e=t.detail)||null==(e=e.dp)?void 0:e.id,Dr.SuccessTextOnDpDelete,Dr.FailureTextOnDpDelete)},_onView:function(t){t.stopPropagation();var e=this.configuredDataProviders.find(function(e){return e.componentAttributes.sfdcExpressionKey==(null==(e=t.detail)||null==(e=e.dp)?void 0:e.id)}),n=this._convertToUemFormat(e);if(n.definition==P.DATA_PROVIDER.APEX_FQN)for(var i=0;i<this.dataTableDPConfig.length;i++)if(this.dataTableDPConfig[i].sfdcExpressionKey==n.sfdcExpressionKey){n.attributes.apexClass=this.dataTableDPConfig[i].source;break}this.editorConfigCmp.set("v.dpConfig",n),this.editorConfigCmp.set("v.editorMode","View"),this.editorConfigCmp.set("v.description",Dr.ViewDataProviderEditorDescription),this.editorConfigCmp.openModal()},_onGetDataProviderBlock:function(n){n.stopPropagation(),h.GetDataProviderBlockPromise(n.detail.dataProvider).then(function(e){var t;null!=(t=n.detail)&&t.successCallback(e)}).catch(function(){var e;null!=(e=n.detail)&&e.errorCallback()})},_onFetchDataFromDataHandler:function(t){h.GetDataProviderDataPromise(t.detail.dataProvider).then(function(e){t.detail.successCallback(e)})},_onConfigureNewDataProvider:function(e){this.editorConfigCmp.set("v.dpConfig",Nr),this.editorConfigCmp.set("v.editorMode","Edit"),this.editorConfigCmp.set("v.description",Dr.DataProviderEditorDescription),this.editorConfigCmp.openModal()},_onSave:function(e){var t=this._convertToDbFormat(e.detail.dataProvider);this._triggerUpsertAction(this.configuredDataProviders.concat([t]),e.detail.dataProvider.sfdcExpressionKey,Dr.SuccessTextOnDpAdd,Dr.FailureTextOnDpAdd,e.detail.successCallback,e.detail.errorCallback)},_convertToDbFormat:function(e){var t={};return t[P.DATA_PROVIDER.COMPONENT_NAME]=kr[e.definition],t[P.DATA_PROVIDER.COMPONENT_ATTRIBUTES]=m({},e.attributes),t[P.DATA_PROVIDER.COMPONENT_ATTRIBUTES][P.DATA_PROVIDER.EXPRESSION_KEY]=e.sfdcExpressionKey,t},_convertToUemFormat:function(e){var t={};return t.definition=b.invert(kr)[e[P.DATA_PROVIDER.COMPONENT_NAME]],t.attributes=m({},e[P.DATA_PROVIDER.COMPONENT_ATTRIBUTES]),t.sfdcExpressionKey=e[P.DATA_PROVIDER.COMPONENT_ATTRIBUTES][P.DATA_PROVIDER.EXPRESSION_KEY],t},_triggerUpsertAction:function(e,t,n,i,s,a){var o=this;I.event.trigger("action:upsert-page-level-data-providers",{routeId:this.viewId,dataProviders:e,successCallback:function(e){o._updateComponents(o.viewId),s&&s(),o._updateConfiguredDpTable(e),o._upsertActionSuccessToast(n,t)},errorCallback:function(){a&&a(),o._upsertActionFailuresToast(i)}})},_upsertActionSuccessToast:function(e,t){w.success({message:e.replace("{0}",t),duration:w.DURATION_MEDIUM,canDismiss:!0})},_upsertActionFailuresToast:function(e){w.error({message:e,duration:w.DURATION_MEDIUM,canDismiss:!0})},_updateComponents:function(e){f.getCanvasComponentsForViewAsync(e,function(){},!0)},_updateConfiguredDpTable:function(e){this.configuredDataProviders=JSON.parse(h.getViews().get(this.viewId).get("ViewDataProviders"));var e=this._formatToListData(e),t=this._getListComponent();t&&t.set("v.configuredDps",e)},_getListComponent:function(){var e=this.$(".configured builder_framework-data-provider-configuration-list-ui");return e[0]?$A.componentService.getAttributeProviderForElement(e[0]):null},_validateSdfcExpressionKey:function(t){var e=this.configuredDataProviders.map(function(e){return{expressionKey:e[P.DATA_PROVIDER.COMPONENT_ATTRIBUTES][P.DATA_PROVIDER.EXPRESSION_KEY]}}),n=this.defaultDataProviders.map(function(e){return{expressionKey:e[P.DATA_PROVIDER.EXPRESSION_KEY]}}),e=e.concat(n).find(function(e){return e.expressionKey!==t.detail.initialExpressionKey&&e.expressionKey===t.detail.currentExpressionKey});t.detail.setCustomValidity(e?Dr.DataNameInUse:"")},_renderDataProviders:function(){var t=this;h.GetGlobalAndDefaultDataProvidersPromise(this.routeId).then(function(e){t._fetchGlobalDPSuccessCallback(e)}),h.GetConfiguredDataProvidersDataProvidersPromise(this.viewId).then(function(e){t.dataTableDPConfig=e,t._fetchConfiguredDPSuccessCallback(e)}),this.configuredDataProviders=JSON.parse(h.getViews().get(this.viewId).get("ViewDataProviders"))},_fetchGlobalDPSuccessCallback:function(e){this.defaultDataProviders=e,this._createComponent(Dr.InheritedDataProviders,".js-data-provider-list-container.inherited",e,!1,!1,!0,Dr.DefaultDataProvidersHelpText)},_fetchConfiguredDPSuccessCallback:function(e){this._createComponent(Dr.ConfiguredDataProviders,".js-data-provider-list-container.configured",e,!0,!1,!1,Dr.ConfiguredDataProvidersHelpText)},_createComponent:function(e,i,t,n,s,a,o){var r=this,l=this._formatToListData(t);$P.auraRun(function(){$A.createComponent("builder_framework:dataProviderConfigurationListUi",{configuredDps:l,listTitle:e,showAddDataProvider:n,showSearch:s,disableActions:a,maxDataProviderNodesAllowed:10,helpText:o},function(e,t,n){e&&($A.render(e,r.$(i)[0]),$A.afterRender(e),r.$(Ar).hide())})})},_fetchGlobalDPErrorCallback:function(){w.error({message:Dr.FetchDefaultDataProvidersErrorMsg,duration:w.DURATION_MEDIUM,canDismiss:!0})},_formatToListData:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=[],n=0;n<e.length;n++){var i={id:e[n][P.DATA_PROVIDER.EXPRESSION_KEY],name:e[n][P.DATA_PROVIDER.EXPRESSION_KEY],source:e[n].source,sourceType:e[n].sourceType,expression:"{!".concat(e[n][P.DATA_PROVIDER.EXPRESSION_KEY],".*}")};t.push(i)}return t},_getEntityNameFromRoute:function(){var e=h.getRoutes().get(this.routeId);return 0===e.get(P.PROP.ROUTE_TYPE_KEY).indexOf("detail-")?e.get("EntityAPIName"):""}});function Rr(e,i){return e.map(function(n){return new Promise(function(t,e){PicassoWebServices.PicassoDebug.GetComponentData(n,!1,function(e){i.push(e.properties),t()})})})}var jr,Br=PicassoWebServices.Labels.CommBuilderPageManagement,Or=PicassoWebServices.Labels.CommBuilderDataProviderSettings.Data,Mr=Backbone.View.extend({_routeId:null,_itemRoutes:[],_detailContentView:null,_variationsContentView:null,_dataProvidersContentView:null,_contentTemplate:function(e){var t=e.isOOTB,e=e.contentHtml;return'<div class="cb-PageManager js-pm-content-details'.concat(t?" cb-PageManager-isOOTB":"",'">\n            ').concat(e,"\n        </div>").trim()},_contentContainerTemplate:function(e){var t=e.showPageVariations,n=e.hasAssociatedViews,e=e.showDataProvidersTab;return'<div class="cb-PageManager-tabsContainer slds-tabs_default">\n            <ul class="cb-PageManager-tabsNav slds-tabs_default__nav" role="tablist">\n                <li data-id="detail" class="cb-PageManager-tabsNavItem slds-tabs_default__item js-pm-tab-item" role="presentation">\n                    <a href="javascript:void(0)" class="cb-PageManager-tabsNavItemLink slds-tabs_default__link" role="tab">'.concat(Br.StandardPropertiesTabContainer,"</a>\n                </li>\n                ").concat(t&&n?'<li data-id="variations" class="cb-PageManager-tabsNavItem slds-tabs_default__item js-pm-tab-item" role="presentation">\n                        <a href="javascript:void(0)" class="cb-PageManager-tabsNavItemLink slds-tabs_default__link" role="tab">'.concat(Br.AssociatedPagesTitle,"</a>\n                    </li>"):"","\n                ").concat(e?'<li data-id="data" class="cb-PageManager-tabsNavItem slds-tabs_default__item js-pm-tab-item" role="presentation">\n                        <a href="javascript:void(0)" class="cb-PageManager-tabsNavItemLink slds-tabs_default__link" role="tab">'.concat(Or,"</a>\n                    </li>"):"","\n            </ul>\n        </div>\n        ").concat(D.buttonIcon({icon:"chevronleft",buttonClassName:"cb-PageManager-close js-close-manager",svgClassName:"cb-PageManager-closeIcon",label:"".concat(PicassoWebServices.Labels.General.Close)}),'\n        <div class="cb-PageManager-tabContent cb-PageManager-contentDetail js-pm-tab-content js-pm-detail-view-content" data-id="detail" role="tabpanel"></div>\n        <div class="cb-PageManager-tabContent cb-PageManager-contentVariations js-pm-tab-content js-pm-variations-view-content" data-id="variations" role="tabpanel"></div>\n        <div class="cb-PageManager-tabContent cb-PageManager-contentDetail js-pm-tab-content js-pm-data-providers-view-content" data-id="data" role="tabpanel"></div>').trim()},events:{"click .js-pm-tab-item:not(.slds-is-active)":"_onTabClick","click .js-close-manager":"_closePageManager"},initialize:function(e){this.options=e||{},this._activeTabId=this.options.activeTabId,this._extractDataFromViewOptions(this.options),"function"==typeof e.closePageManagerCallback&&(this.closePageManagerCallback=e.closePageManagerCallback)},render:function(){return this._renderView(),this},_renderView:(jr=F(V().mark(function e(){var t,n,i,s;return V().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:0,i=I.AccessControl(P.PERMISSIONS.SITES_DATA_PROVIDER_EDITOR_ENABLED),s=this._getViewRoute(),n=this._hasAssociatedViews(s),t=this._contentContainerTemplate({showPageVariations:I.AccessControl(P.PERMISSIONS.PAGE_VARIATIONS)&&!I.getAppState().isHomePageIdentityTemplate()&&!s.isAllowedInStaticSite(),hasAssociatedViews:n,showDataProvidersTab:i}),this.$el.html(this._contentTemplate({contentHtml:t,isObject:s.isObjectRoute(),isExtObject:s.isExtObjectRoute(),isOOTB:this._hasOOTBRoute(),isOnlyBaseUrlEditable:s.isOnlyBaseUrlEditable(),isPageDeletable:!this._hasOOTBRoute()})),this._showContent(n,i),this._selectTab(this._activeTabId||"detail");case 9:case"end":return e.stop()}},e,this)})),function(){return jr.apply(this,arguments)}),refresh:function(e){var t=this._routeId,n=this._activeTabId;e&&(T.extend(this.options,e),this._extractDataFromViewOptions(this.options)),t===this._routeId?this._activeTabId=n:this._activeTabId=null,this.render()},_extractDataFromViewOptions:function(e){e.data&&(this._routeId=e.data.id,this._itemRoutes=e.data.routes,this._routeId=e.data.id,this._selectedRouteId=e.selectedRouteId)},_showContent:function(e,t){e&&(this._variationsContentView&&this._variationsContentView.remove(),this._variationsContentView=new Lr({el:this.$(".js-pm-variations-view-content"),routeId:this._routeId,parent:this}).render()),t&&(this._dataProvidersContentView&&this._dataProvidersContentView.remove(),this._dataProvidersContentView=new xr({el:this.$(".js-pm-data-providers-view-content"),routeId:this._routeId,viewId:this.options.data.viewId,parent:this}).render()),this._detailContentView&&this._detailContentView.remove(),this._detailContentView=new Mo({el:this.$(".js-pm-detail-view-content"),routeId:this._routeId,selectedRouteId:this._selectedRouteId,viewId:this.options.data.viewId,parent:this}).render()},_selectTab:function(e){T(".js-pm-content-details").toggleClass("cb-PageManager-expand","detail"!==e),this._detailContentView.$(".js-input-required").popover("destroy");var t=this.$('.js-pm-tab-item[data-id="'+e+'"]'),n=this.$('.js-pm-tab-content[data-id="'+e+'"]'),i=this.$(".js-pm-tab-content.slds-is-active"),s=this.$('.js-pm-tab-content[data-id="'+e+'"]');0<i.length?i.fadeOut(25,function(){this.$(".js-pm-tab-item").removeClass("slds-is-active"),i.removeClass("slds-is-active"),0<s.length&&s.fadeIn(100,function(){s.addClass("slds-is-active"),t.addClass("slds-is-active")})}.bind(this)):(n.show().addClass("slds-is-active"),t.addClass("slds-is-active"))},_onTabClick:_.debounce(function(e){e=T(e.currentTarget).attr("data-id");this._activeTabId=e,this._selectTab(e)},125),clear:function(){this._variationsContentView&&(this._variationsContentView.remove(),this._variationsContentView=null),this._detailContentView&&(this._detailContentView.remove(),this._detailContentView=null),this._dataProvidersContentView&&(this._dataProvidersContentView.remove(),this._dataProvidersContentView=null)},getItemRoutes:function(){return this._itemRoutes},_closePageManager:function(){this.closePageManagerCallback()},_hasOOTBRoute:function(){var t,n=!1;return _.some(this._itemRoutes,function(e){if((t=h.getRoutes().get(e.id))&&t.isOOTB())return n=!0}),n},_getViewRoute:function(){return h.getRoutes().get(this._itemRoutes[0].id)},_hasAssociatedViews:function(e){return!e.isGenericObjectRoute()}}),Vr=PicassoWebServices.Labels.CommBuilderPageManagement,$r=Backbone.View.extend({className:"cb-PageMenuSearchResults",_pageSearchResultsListTemplate:function(e){return'<ul class="cb-PageMenuSearchResults-list js-pm-search-results-list">\n                '.concat(e,'\n            </ul>\n            <div class="cb-PageMenuSearchResults-error js-pm-search-results-error">').concat(Vr.NoSearchResult,"</div>").trim()},_pageSearchResultsListItemTemplate:function(e){return'<li>\n                <a class="cb-PageMenuSearchResults-listItem js-pm-search-results-list-item" data-viewid="'.concat(e.viewId,'" data-routeid="').concat(e.id,'" data-name="').concat(e.routeName,'" tabindex="1">\n                    <div class="cb-PageMenuSearchResults-listItemText">\n                        <div class="cb-PageMenuSearchResults-listItemBreadcrumbs js-pm-search-results-list-item-breadcrumbs">').concat(e.breadcrumbs,'</div>\n                        <div class="cb-PageMenuSearchResults-listItemName js-pm-search-results-list-item-name">').concat(e.name,"</div>\n                    </div>\n                    ").concat(e.supportsViewCrud?e.pageMenuActionMenuTriggerTemplate:"","\n                </a>\n            </li>").trim()},events:{"click .js-pm-search-results-list-item":"_onClickItem"},initialize:function(e){this.options=e||{},this._searchResultItems=this.options.searchResultItems},render:function(){return this._renderResultsList(),this},refresh:function(e){this._searchResultItems=e,this._renderResultsList()},remove:function(){return this.$el.empty().off(),this.stopListening(),this},_renderResultsList:function(){var e=this._getResultsListItemsHtml();this.$el.html(this._pageSearchResultsListTemplate(e)),this._updateNoSearchResultsError()},_getResultsListItemsHtml:function(){return _.map(this._searchResultItems,function(e){return this._pageSearchResultsListItemTemplate(e)}.bind(this)).join("")},_updateNoSearchResultsError:function(){this.$(".js-pm-search-results-error").toggleClass("hidden",0<this._searchResultItems.length)},_onClickItem:function(e){var t=e.currentTarget.dataset,n=t.routeid,i=t.viewid,t=t.name,s=this.$(".js-pm-action-menu-trigger");C.isClickedInsideEl(s,e)?this.trigger("action-menu-trigger-clicked",n,t):(this.trigger("search-results-item-clicked",n,i),this.remove())}}),Ur=PicassoWebServices.Labels.CommBuilderPageManagement,t=PicassoWebServices.Labels.PicassoDialog,Wr=".".concat(D.SPINNER_CLASSNAME),Fr=Backbone.View.extend({_html:'\n        <div class="slds-modal__header cb-MovePageDialog-header">\n            <h2 class="slds-text-heading_medium cb-MovePageDialog-heading test-heading">'.concat(Ur.MovePageDialogTitle,'</h2>\n            <h3 class="slds-text-heading--x-small cb-MovePageDialog-subHeading test-help-text">').concat(Ur.MovePageDialogDisabledNodesHelpText,'</h3>\n        </div>\n\n        <div class="cb-MovePageDialog-pagePicker js-page-picker-container">').concat(D.spinner,'</div>\n\n        <div class="slds-modal__footer">\n            <button class="js-cancel slds-button slds-button_neutral slds-float--left">\n                ').concat(t.Cancel,'\n            </button>\n            <button class="js-save slds-button slds-button_brand" disabled>\n                ').concat(Ur.MovePageDialogMoveButton,"\n            </button>\n        </div>").trim(),events:{"click .js-save":"save","click .js-cancel":"cancel"},initialize:function(e){this.movingNodeId=e.movingNodeId,this.representativeRoute=e.representativeRoute,this.parentRouteId=this.representativeRoute.get("ParentId"),this.rootRouteId=e.rootRouteId,this.updatedNodeData=this.processNodeDataForPagePicker(e.nodeData),this.onSaveCallback=e.onSaveCallback},shouldShowSEOWarning:function(){return!!!T.cookie(this.getCookieKeyForSEOWarning())&&(this.representativeRoute.isPublicRoute()||I.getAppState().getCurrentSite().isCommunityPublic()&&this.representativeRoute.getAuthState()===P.PROP.ROUTE_AUTH_USE_PARENT)},shouldDisableRoot:function(e,t){if(!e.parent){if(!t.parent)return!0;if(c.isFolderNode(t)&&c.hasChildren(e))return(1!=e.children.length||e.children[0].id!==t.id)&&c.hasConflictingRouteSegment(t.children[0],e);if(!c.isFolderNode(t)){if(!c.isFolderNode(e)&&!c.isParameterizedNode(e))return c.hasConflictingRouteSegment(e,t);if(c.hasChildren(t))return c.hasConflictingRouteSegment(c.hasChildren(e)?e.children[0]:e,t)}}return!1},shouldDisableNode:function(e,t,n,i){return e.level>i||e.id===t.id||e.id===t.parentId||c.isErrorNode(e)||c.isHomeNode(e)||c.isFolderNode(e)||c.isObjectNode(e)||c.isCmsContentNode(e)||c.isParameterizedNode(e)||c.isLoginRoute(e.routes)||c.hasConflictingChild(e,t)||c.hasConflictingFolderNode(n,e,t)||c.isServiceNotAvailableNode(e)},processNodeDataForPagePicker:function(i){var s=this,a=this,o=i.find(function(e){return e.id===a.movingNodeId}),r=P.PAGE_MENU.MAX_STANDARD_PAGE_DEPTH-(o.descendantTreeHeight+1);return i.map(function(e){var t=!1,n={name:e.id,label:e.name,parentName:e.parentId,level:e.level,routeSegment:e.routeSegment};return s.shouldDisableNode(e,o,i,r)&&(t=!0),!a.rootDisabled&&a.shouldDisableRoot(e,o,i)&&(a.rootDisabled=!0),n.disabled=t,n})},render:function(){return this.$el.html(this._html),this.addListeners(),this.renderPagePicker(),this},renderPagePicker:function(){var i=this,e=I.getAppState().getCurrentSite().get("name");$P.auraRun(function(){$A.createComponent("community_builder:pagePicker",{selectedPage:i.parentRouteId,pages:i.updatedNodeData,rootLabel:e},function(e,t,n){e&&setTimeout(function(){$A.render(e,i.$(".js-page-picker-container")[0]),$A.afterRender(e),i.$(Wr).hide(),i.$(".js-cancel").focus()},0)})})},addListeners:function(){this.$(".js-page-picker-container").on("pageselected",this.onSelection.bind(this))},removeListeners:function(){this.$el.off()},getCookieKeyForSEOWarning:function(){return I.getAppState().getNetworkId()+"_suppress_move_page_seo_warnings"},suppressSEOWarnings:function(e){return e&&T.cookie(this.getCookieKeyForSEOWarning(),e),!!T.cookie(this.getCookieKeyForSEOWarning())},save:function(){var n=this;this.$(".js-save").prop("disabled",!0),this.shouldShowSEOWarning()?A.sldsModal({title:Ur.MovePageDialogSEOWarningTitle,content:Ur.MovePageDialogSEOWarning,className:"cb-MovePageDialog-seoWarningDialog",yesText:Ur.MovePageDialogMoveButton,checkbox:{label:Ur.MovePageDialogSEOWarningSuppressText,alignment:"left"},callback:function(e,t){e&&(t&&n.suppressSEOWarnings(!0),n.onSaveCallback(n.selectedId),setTimeout(function(){A.closeDialog()}))}}):(this.onSaveCallback(this.selectedId),A.closeDialog())},cancel:function(){A.closeDialog()},destroy:function(){this.removeListeners()},onSelection:function(e){var e=e.originalEvent.detail.name,t=this.$(".js-save");t.prop("disabled",!1),e===P.ROUTE.ROOT_SELECTION_MARKER?this.rootDisabled?t.prop("disabled",!0):(this.selectedId=null,t.text(Ur.MovePageDialogMoveToRootButton)):e===this.parentRouteId?t.prop("disabled",!0):(this.selectedId=e,t.text(Ur.MovePageDialogMoveButton))}}),Hr=PicassoWebServices.Labels.CommBuilderPageManagement,Gr=PicassoWebServices.Labels.PicassoDialog,zr=P.PROP,Kr=P.PAGE_ACTIONS,Yr=P.PAGE_MENU.MAX_STANDARD_PAGE_DEPTH,qr=Yr-1;var Xr=Backbone.View.extend({className:"cb-PageActionMenu js-page-action-menu",_pageActionMenuTemplate:function(e){return'<ul class="slds-dropdown__list cb-PageActionMenu-list" role="menu" aria-label="'.concat(Hr.ShowMore,'">\n                ').concat(e.map(function(e){if(e.isVisible())return'<li role="presentation" class="'.concat(_.isEmpty(e.locator)?"":e.locator,' cb-PageActionMenu-menuItem js-page-action-menu-item slds-dropdown__item" data-value="').concat(e.key,'">\n                            <a class="cb-PageActionMenu-menuItemLink" ').concat(e.isDisabled?"aria-disabled=".concat(e.isDisabled," disabled"):"",' href="javascript:void(0);" role="menuitem">\n                                <span class="cb-PageActionMenu-menuItemLinkContent slds-truncate">\n                                    <svg class="slds-icon slds-icon-text-default slds-m-right_x-small slds-icon_x-small" aria-hidden="true">\n                                        <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/').concat(e.icon.sprite,"-sprite/svg/symbols.svg#").concat(e.icon.name,'"></use>\n                                    </svg>\n                                    ').concat(e.label,"\n                                </span>\n                                ").concat(e.isDisabled?D.bsTooltipIcon({placement:"top",className:"cb-PageActionMenu-actionDisabledTooltip",content:e.disabledLabel}):"","\n                            </a>\n                        </li>")}).join(""),"\n            </ul>").trim()},_referencesToPageOnDeleteTemplate:function(e){return" "+"".concat(Gr.DeletePageConfirmationNavText,"<br><br>\n            <ul>\n                ").concat(e.map(function(e){return"<li>".concat(e.first," - <strong>").concat(e.second,"</strong></li>")}).join(""),"\n            </ul>").trim()},events:{"click .js-page-action-menu-item":"_onClickItem"},initialize:function(i){var s=this,e=(this._route=h.getRoutes().get(i.id),this._itemRoutes=i.routes,this._nodeData=i.nodeData,!!this._route&&k.isBaseUrlSegmentInUseAmongSiblings(this._route,this._route.getRouteSegment())),t=c.getNonDeletableDescendantNodes(i),n=(t[0]||{}).name;this._menuItemsConfig=[{locator:"js-page-manager",key:"PageManager",label:Hr.ActionPageSettings,icon:{sprite:"utility",name:"settings"},isVisible:function(){return i.availableActions.includes(Kr.SETTINGS)},isDisabled:!1,action:function(){s.trigger("showPageManager")}},{locator:"js-add-subpage",key:"AddSubpage",label:Hr.ActionAddSubpage,icon:{sprite:"utility",name:"add"},isVisible:function(){return i.availableActions.includes(Kr.CREATE_SUBPAGE)},isDisabled:e||i.nodeLevel>=Yr,disabledLabel:e?Hr.SubpageConflictTooltip:Hr.ActionDisabledTooltip,action:function(){var e=i.id;s._onAddSubpage(e,i.nodeLevel)}},{locator:"js-move-page",key:"MovePage",label:Hr.ActionMovePage,icon:{sprite:"utility",name:"breadcrumbs"},isVisible:function(){return!i.isNodeFolder&&i.availableActions.includes(Kr.MOVE)},isDisabled:i.descendantTreeHeight>=qr,disabledLabel:Hr.ActionDisabledTooltip,action:function(){s._onMovePage({movingNodeId:i.id,movingRouteId:i.id})}},{locator:"js-move-pages",key:"MovePages",label:Hr.ActionMovePages,icon:{sprite:"utility",name:"breadcrumbs"},isVisible:function(){return i.isNodeFolder?i.availableActions.includes(Kr.MOVE):!!i.isSearchResultsView&&i.availableFolderActions.includes(Kr.MOVE)},action:function(){var e=i,t=i.id,n=i.id,t=(i.isSearchResultsView?(c.isCmsContentNode(i)||c.isObjectNode(i))&&(e=i.parent,t=i.parentId):n=i.children[0].id,{movingNodeId:t,movingRouteId:n});c.isCmsContentFolderNode(e)?t.isCmsContentFolderNode=!0:c.isObjectFolderNode(e)&&(t.isObjectFolderNode=!0,t.keyPrefix=e.keyPrefix),s._onMovePage(t)}},{locator:"js-delete-page",key:"DeletePage",label:Hr.ActionDeletePage,icon:{sprite:"utility",name:"delete"},isVisible:function(){return!i.isNodeFolder&&i.availableActions.includes(Kr.DELETE)},isDisabled:0<t.length,disabledLabel:(e=void 0===n?"":n,n=t.length,t=L.format(Hr.ActionDeletePageDisabledTooltipSingular,e),e=L.format(Hr.ActionDeletePageDisabledTooltipPlural,e,n-1),1<n?e:t),action:function(){s._onDeletePage(!1)}},{locator:"js-delete-pages",key:"DeletePages",label:Hr.ActionDeletePages,icon:{sprite:"utility",name:"delete"},isVisible:function(){return i.isNodeFolder?i.availableActions.includes(Kr.DELETE):!!i.isSearchResultsView&&i.availableFolderActions.includes(Kr.DELETE)},action:function(){i.nodeFolderType===P.PAGE_MENU.FOLDER.TYPE.CONTENT?s._onDeletePage(!1):s._onDeletePage(!0)}}],this.render()},render:function(){return this.$el.html(this._pageActionMenuTemplate(this._menuItemsConfig)),this.$('[data-toggle="tooltip"]').tooltip(),this},_onAddSubpage:function(e,t){e=new Ir({hideFooter:!0,contentView:"PageWizardStepChooseType",parentId:e,parentLevel:t,pageVariationMode:!1});A.showDialog(e,{className:"slds-vex-theme cb-Dialog--PageWizard test-dialog-page-wizard"}),this.trigger("closePageActionMenu")},_onMovePage:function(e){var t=e.movingNodeId,n=e.movingRouteId,i=e.isCmsContentFolderNode,s=e.isObjectFolderNode,a=e.keyPrefix,e=i||s?h.getRoutes().get(n):this._route,i=new Fr({movingNodeId:t,representativeRoute:e,nodeData:this._nodeData,onSaveCallback:function(e){e={newParentRouteId:e};s&&(e.keyPrefix=a),e.selectedRouteId=n,I.event.trigger("action:move-route",e)}});A.showDialog(i,{className:"slds-vex-theme cb-Dialog--MovePage test-dialog-move-page"})},_onDeletePage:function(n){var i=this._getViewRoute(),e=i.get(zr.ROUTE_URL_KEY);PicassoWebServices.CommNavigation.GetNavigationMenuLabelsForUrl(e,function(e){var t="",e=e.NavigationMenuItems;e&&0<e.length&&(t=this._referencesToPageOnDeleteTemplate(e)),n?this._onObjectDeleteHelper(PicassoWebServices.Labels.CommBuilderPageManagement.ObjectDeleteConfirmationText+t,PicassoWebServices.Labels.CommBuilderPageManagement.ObjectDeleteConfirmationTitle):this._onDeleteHelper(PicassoWebServices.Labels.PicassoDialog.DeletePageConfirmationText+t,PicassoWebServices.Labels.PicassoDialog.DeletePageConfirmationTitle,i)}.bind(this)),this.trigger("closePageActionMenu")},_onObjectDeleteHelper:function(e,t){A.sldsModal({title:t,content:e,yesText:PicassoWebServices.Labels.PicassoDialog.Delete,yesTextClassName:"slds-button_destructive",callback:function(e){var t;e&&(t=_.map(this._itemRoutes,"id"),I.event.trigger("action:delete-routes",{routeIds:t,successCallback:function(){_.includes(t,I.getAppState().getCurrentRouteId())&&I.event.trigger("action:navigate-to-page",{url:P.ROUTE.HOME_ROUTE_URL})}.bind(this)}))}.bind(this)})},_onDeleteHelper:function(e,t,n){A.sldsModal({content:e,title:t,yesText:PicassoWebServices.Labels.PicassoDialog.Delete,yesTextClassName:"slds-button_destructive",callback:function(e){e&&I.event.trigger("action:delete-routes",{routeIds:[n.id],successCallback:function(){var t=I.getAppState().getCurrentRouteId();h.getRoutes().some(function(e){return e.id===t})||I.event.trigger("action:navigate-to-page",{url:P.ROUTE.HOME_ROUTE_URL})}})}})},_getObjectUrlPrefix:function(){var e,t="";return t=0<this._itemRoutes.length&&(e=this._getViewRoute())?e.get(P.PROP.ROUTE_URL_KEY).split("/")[1]:t},_getViewRoute:function(){return h.getRoutes().get(this._itemRoutes[0].id)},_onClickItem:function(e){var t=e.currentTarget.getAttribute("data-value"),n=_.find(this._menuItemsConfig,function(e){return e.key===t});n&&!n.isDisabled&&n.action(),e.stopPropagation()}}),Jr="js-cb-popover",Qr={className:"",successCallback:null,destroyCallback:null,horizontalOffset:0,verticalOffset:0,dismissSelector:"",dismissSelectorLabel:"",nubbinPosition:null,offsetTriggerHeight:!0,offsetTriggerWidth:!0,windowScrollHandler:null,trapFocus:!1};function Zr(e){var m={};function n(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}function i(){l()}function s(){l()}function a(e){var t=m.view.contains(e.target),n=m.trigger.contains(e.target);(t||n)&&(t=e,!(n=m.options.dismissSelector?m.view.querySelector(m.options.dismissSelector):void 0)||!n.contains(t.target)&&n!==t.target)||l()}function o(e){e=e.keyCode;P.KEYCODE.ESCAPE===e&&l()}function r(e){var t=document.querySelector("."+Jr);t&&t.contains(e.target)||l()}function l(){document.removeEventListener("mousedown",m.documentMousedownHandler),document.removeEventListener("keydown",m.documentKeydownHandler),_.forEach(m.bootstrapDropdownEls,function(e){e.removeEventListener("mousedown",m.bootstrapDropdownMousedownHandler)}),window.removeEventListener("blur",m.windowBlurHandler),window.removeEventListener("scroll",m.windowScrollHandler,!0);var e=m.element&&m.element.parentNode;e&&e.removeChild(m.element),m.options.destroyCallback&&m.options.destroyCallback()}function c(e){var t,n,i,s,a,o,r,l,c,d,u,p,g,h;e&&(m.trigger=e),"top"===m.options.nubbinPosition?(e=m.trigger,t=m.element,s=m.options,r=document.documentElement,c=(i=e.getBoundingClientRect()).top+r.scrollTop,i=i.left+r.scrollLeft,a=e.offsetWidth,e=e.offsetHeight,d=t.scrollWidth,u=t.scrollHeight,n=r.clientWidth,r=r.clientHeight,"top"===(o=s.nubbinPosition)&&(g=i+(s.offsetTriggerWidth?a:0)+s.horizontalOffset+-16),p=c+(s.offsetTriggerHeight?e:0)+s.verticalOffset,l=!1,r<p+u&&(l=!0,p=c-u-s.verticalOffset+(s.offsetTriggerHeight?0:e)),r=!1,n<g+d&&(r=!0,g=i-d+(s.offsetTriggerWidth?0:a)-s.horizontalOffset+16),(c={popoverEl:t,nubbinPosition:o,swapNubbinHorizontally:r,swapNubbinVertically:l}).nubbinPosition&&(u=c.swapNubbinVertically?"slds-nubbin--bottom":"slds-nubbin--top",u+=c.swapNubbinHorizontally?"-right":"-left",m.currentNubbinClass&&c.popoverEl.classList.remove(m.currentNubbinClass),c.popoverEl.classList.add(u),m.currentNubbinClass=u),t.style.position="absolute",t.style.top=p+"px",t.style.left=g+"px"):(e=m.trigger,n=m.element,i=m.options,d=document.documentElement,s=(a=e.getBoundingClientRect()).top+d.scrollTop,a=a.left+d.scrollLeft,o=e.offsetWidth,e=e.offsetHeight,r=n.scrollWidth,l=n.scrollHeight,c=d.clientWidth,d=d.clientHeight,u=i.nubbinPosition,p=-16,"left-top"===u?p=-16:"left"===u&&(p=-8),t="left"===u?s-l/2+e/2:s+(i.offsetTriggerHeight?e:0)+i.verticalOffset+p,g=a+(i.offsetTriggerWidth?o:0)+i.horizontalOffset,h=!1,c<g+r&&(h=!0,g=a-r-i.horizontalOffset+(i.offsetTriggerWidth?0:o)),c=!1,d<t+l&&(c=!0,t=s-l+(i.offsetTriggerHeight?0:e)-i.verticalOffset-p),(e={popoverEl:n,nubbinPosition:u,swapNubbinHorizontally:h,swapNubbinVertically:c}).nubbinPosition&&(h=e.swapNubbinHorizontally?"slds-nubbin--right":"slds-nubbin--left",e.swapNubbinVertically?h+="-bottom":"left-top"===e.nubbinPosition&&(h+="-top"),m.currentNubbinClass&&e.popoverEl.classList.remove(m.currentNubbinClass),e.popoverEl.classList.add(h),m.currentNubbinClass=h),n.style.position="absolute",n.style.top=t+"px",n.style.left=g+"px")}return e.view&&e.trigger?(m.view=e.view,m.trigger=e.trigger,m.options=_.assign({},Qr,e.options),{show:function(){var e,t=["slds-popover",Jr,m.options.className],t='<div class="{0}" role="dialog"><div class="slds-popover__body js-cb-popover-body"></div></div>'.replace("{0}",t.join(" "));m.element=n(t),m.element.querySelector(".js-cb-popover-body").appendChild(m.view),m.options.dismissSelector&&(t=m.element.querySelector(m.options.dismissSelector))&&(e=n('<span class="slds-assistive-text">'+m.options.dismissSelectorLabel+"</span>"),t.appendChild(e)),document.body.appendChild(m.element),c(),m.documentMousedownHandler=a,m.documentKeydownHandler=o,document.addEventListener("mousedown",m.documentMousedownHandler),document.addEventListener("keydown",m.documentKeydownHandler),m.bootstrapDropdownEls=document.querySelectorAll('[data-toggle="dropdown"]'),m.bootstrapDropdownMousedownHandler=i,_.forEach(m.bootstrapDropdownEls,function(e){e.addEventListener("mousedown",m.bootstrapDropdownMousedownHandler)}),m.windowBlurHandler=s,window.addEventListener("blur",m.windowBlurHandler),m.options.windowScrollHandler?m.windowScrollHandler=m.options.windowScrollHandler:m.windowScrollHandler=r,window.addEventListener("scroll",m.windowScrollHandler,!0),m.focusManager=new kn({container:m.element,focusFirst:!0,trapFocus:m.options.trapFocus}).initialize(),m.options.successCallback&&m.options.successCallback()},reposition:c,destroy:l}):null}function el(e){return e.parent?el(e.parent):e}function tl(e){for(var t=[e],n=e.getLevel();0<t.length;){var i=t.shift(),n=Math.max(n,i.getLevel());t.push.apply(t,Q(i.children.filter(function(e){return e.is_open})))}return n}var nl,il,sl,al=P.PROP,ol=PicassoWebServices.Labels.CommBuilderPageManagement,rl=PicassoWebServices.Labels.PicassoDialog,ll=P.GLOBAL_SELECTOR.PAGE_MANAGER,cl="cb-DropdownMenu-menu_wide",dl=Backbone.View.extend({_currOpenedNodeId:null,_homeRouteId:null,className:"js-page-menu cb-PageMenu slds-dropdown-trigger icon-down dropdown",_pageMenuTriggerHtml:'<button type="button" class="cb-PageMenu-toggle dropdown-toggle js-pm-selected js-page-menu-button"></button>\n        <span class="js-pm-settings-cog">\n            <svg aria-hidden="true" class="cb-PageMenu-cogIcon" data-toggle="tooltip" data-placement="bottom" title="'.concat(ol.PagePropertiesTooltip,'">\n                <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#settings"></use>\n            </svg>\n        </span>\n        <div class="slds-navigation-list--vertical page-dropdown-menu js-pm-menu cb-DropdownMenu-menu slds-nubbin--top"></div>'),_pageMenuTemplate:function(e){return'<header class="cb-DropdownMenu-header">\n                <div title="'.concat(ol.Pages,'">').concat(ol.Pages,"</div>\n                ").concat(D.buttonIcon({buttonClassName:"cb-PageMenu-close js-pm-close",svgClassName:"cb-PageMenu-closeIcon",icon:"close",label:"".concat(rl.Close)}),'\n            </header>\n            <div class="cb-PageMenu-search">\n                <label for="js-page-menu-search-input" class="slds-form-element__label slds-assistive-text">').concat(ol.SearchPlaceholder,'</label>\n                <input id="js-page-menu-search-input" type="text" class="js-pm-search-input cb-PageMenu-searchInput\n                    form-control slds-input" maxlength="100" placeholder="').concat(ol.SearchPlaceholder,'"/>\n                <span class="icon-utility-search cb-PageMenu-searchIcon"></span>\n                <div class="icon-utility-clear cb-PageMenu-clearSearchIcon js-pm-clear-search-icon hidden"></div>\n            </div>\n            <div class="cb-PageMenu-searchResults js-pm-search-results hidden"></div>\n            <div class="cb-PageMenu-treeContainer js-pm-tree-container">\n                <div class="cb-PageMenu-tree js-pm-tree"></div>\n            </div>\n            ').concat(e?D.buttonWithIcon({buttonClassName:"cb-PageMenu-addPage js-pm-add-page",buttonVariantClassName:"slds-button_brand",svgClassName:"slds-icon_x-small slds-icon-text-default cb-PageMenu-addPageIcon",icon:"add",label:"".concat(ol.AddPage)}):"",'\n            <div class="cb-PageMenu-pageManager ').concat(ll,'"></div>').trim()},_pageMenuActionMenuTriggerTemplate:function(e){return"".concat(D.buttonIcon({buttonClassName:"cb-PageMenu-threeDots js-pm-action-menu-trigger hidden",buttonAttributes:'data-toggle="tooltip" data-placement="top" data-name="'.concat(e,'"'),svgClassName:"slds-button__icon_large cb-PageMenu-threeDotsIcon",icon:"threedots",label:"".concat(ol.PageActionsTooltip)}))},_buttonIconSmallSvgTemplate:function(e){e=e.icon;return'<svg class="slds-button__icon slds-button__icon_small" aria-hidden="true">\n            <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#'.concat(e,'"></use>\n        </svg>').trim()},events:{"input .js-pm-search-input":"_onSearch","click .js-pm-clear-search-icon":"_onClearSearch","click .js-pm-add-page":"_onClickAddPage","click .js-pm-close":"_close","click .js-pm-settings-cog":"_onClickCog","click .js-pm-selected":"_onClickTrigger"},initialize:function(e){this.listenTo(I.event,"state:page-change-success",this._handleRouteChange),this.listenTo(I.event,"state:page-change-start",this._handleRouteChange),this.listenTo(I.event,"state:routes-properties-updated",this._handleRoutesPropertiesChanged),this.listenTo(I.event,"state:routes-base-urls-updated",this._handleRoutesBaseUrlsChanged),this.listenTo(I.event,"state:routes-deleted",this._handleRoutesDeleted),this.listenTo(I.event,"state:route-created",this._handleRoutesCreated),this.listenTo(I.event,"state:route-moved",this._handleRoutesMoved),this.listenTo(I.event,"state:view-deleted",this._handleViewDeleted),this.listenTo(I.event,"state:default-view-updated",this._handleDefaultViewUpdated),this.listenTo(j.getAppEvent(),"close-page-menu",this._close),T("body").on("click",function(e){this._shouldClose(e)&&this._close()}.bind(this)),this.render(),ha.getDataObjects(function(e){this._dataObjects=e,this._homeRouteId=k.getHomePageHomeRoute().id,this._renderContent();var e=I.getAppState().get("currentViewId"),t=I.getAppState().get("currentRouteId");this._setCurrentPage(t,e)}.bind(this))},render:function(){return this.$el.html(this._pageMenuTriggerHtml),this},_renderContent:function(){var e=I.AccessControl(P.PERMISSIONS.PAGE_EDIT)&&I.getAppState().supportViewCrud(),e=this._pageMenuTemplate(e);this.$(".js-pm-menu").html(e),this._renderPageMenuTree(),this.$el.tooltip({selector:'[data-toggle="tooltip"]',container:".js-page-menu",delay:{show:200,hide:0}}),this.$('[data-toggle="pill-tooltip"]').tooltip({container:"body",delay:0,template:'<div class="tooltip pill-tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})},_renderPageMenuTree:function(){var e=this._initTreeData();this._pageMenuTree=this._getPageMenuTree(),this._pageMenuTree.tree({data:e,animationSpeed:"fast",closedIcon:T(this._buttonIconSmallSvgTemplate({icon:"chevronright"})),openedIcon:T(this._buttonIconSmallSvgTemplate({icon:"chevrondown"})),keyboardSupport:!0,onCreateLi:function(e,t,n){this._onCreateNode(e,t)}.bind(this),slide:!0}),this._pageMenuTree.on("tree.click",function(e){e.preventDefault(),this._onClickNode(e)}.bind(this)),this._pageMenuTree.on("tree.open",function(e){this._onOpenNode(e)}.bind(this)),this._pageMenuTree.on("tree.close",function(e){this._onCloseNode(e)}.bind(this))},_onClickNode:function(e){var t=e.node,e=e.click_event,n=this.$(".js-pm-action-menu-trigger");C.isClickedInsideEl(n,e)?this._handleShowPopoverMenu(t):t.isNodeFolder||(n=t.viewId,e=t.id,this._setCurrentPage(e,n),I.event.trigger("action:navigate-to-page",{viewId:n,routeId:e}),this._close())},_onOpenNode:function(e){var t,e=e.node;1===e.getLevel()&&this._currOpenedNodeId!==e.id&&((t=this._getTreeNodeById(this._currOpenedNodeId))&&this._getPageMenuTree().tree("closeNode",t),this._currOpenedNodeId=e.id),(4<=e.getLevel()||4<=tl(e))&&this._togglePageMenuWidened(!0)},_onCloseNode:function(e){tl(el(e.node))<4&&this._togglePageMenuWidened(!1)},_onCreateNode:function(e,t){var n=t.find(".jqtree-title"),i=t.find(".jqtree-element");t.addClass("cb-PageMenu-node test-pm-node"),t.attr("data-name",e.name),i.addClass("cb-PageMenu-nodeElement"),i.before('<div class="cb-PageMenu-nodeBackground"></div>'),n.addClass("cb-PageMenu-nodeTitle test-pm-list-item"),this._addNodeBadge(e,n),e.isNodeFolder?(t.addClass("cb-PageMenu-nodeFolder test-pm-list-item-folder-container"),e.nodeFolderType&&(n.after('<span class="cb-PageMenu-nodeBadge test-pm-node-badge">'.concat(e.nodeFolderType,"</span>")),this._shouldShowActionMenuTriggerOnNodeFolder(e))&&n.after(this._pageMenuActionMenuTriggerTemplate(e.name))):(t.addClass("test-pm-list-item-container"),e.supportsViewCrud&&n.before(this._pageMenuActionMenuTriggerTemplate(e.name))),this._homeRouteId===e.id&&n.before(D.icon({icon:"home",svgClassName:"cb-PageMenu-homeIcon"}))},_addNodeBadge:function(e,t){_.isEmpty(e.routeTypeFlags)||(e.routeTypeFlags.isSnaRoute?this._renderAvailabilityPageMenuPill(t,"test-pm-sna-title","test-pm-sna-badge",ol.ServiceNotAvailablePageMenuTooltip):e.routeTypeFlags.isTmrRoute&&this._renderAvailabilityPageMenuPill(t,"test-pm-tmr-title","test-pm-tmr-badge",ol.TooManyRequestsPageMenuTooltip))},_renderAvailabilityPageMenuPill:function(e,t,n,i){e.addClass(t),e.after('<span class="cb-PageMenu-nodeBadge '.concat(n,'">\n                ').concat(P.PAGE_MENU.BADGE.AVAILABILITY.NAME,"\n            </span>\n            ").concat(D.tooltipButtonIcon({buttonClassName:"slds-m-left_xx-small",svgClassName:"cb-PageMenu-availabilityIcon",tooltipToggle:"pill-tooltip",tooltipPlacement:"right",tooltipLabel:"".concat(i)})))},_shouldShowActionMenuTriggerOnNodeFolder:function(e){return e.supportsViewCrud&&0<e.availableActions.length},_togglePageMenuWidened:function(e){e?this.$(".js-pm-menu").addClass(cl):this.$(".js-pm-menu").removeClass(cl)},_contractPageMenuWidth:function(e){tl(el(this._getTreeNodeById(e)))<4&&this._togglePageMenuWidened(!1)},_initTreeData:function(){var e=this._buildNodesData();return this._constructTreeData(e)},_constructTreeData:function(n){var i=[];return n.forEach(function(t){var e;(t.parentId?((e=n.find(function(e){return e.id===t.parentId})).children||(e.children=[]),(t.parent=e).children):i).push(t)}),this._updateNodeDataLevelAndDescendantTreeHeight(i),i},_updateNodeDataLevelAndDescendantTreeHeightRecursively:function(e){var t=this;e.level=e.parent?e.parent.level+1:1,e.children&&0!==e.children.length&&e.children.forEach(function(e){t._updateNodeDataLevelAndDescendantTreeHeightRecursively(e)}),e.children||(e.descendantTreeHeight=0),e.parent&&(!e.parent.descendantTreeHeight||e.parent.descendantTreeHeight<e.descendantTreeHeight+1)&&(e.parent.descendantTreeHeight=e.descendantTreeHeight+1)},_buildNodesData:function(){var i=[],s=[],a=[],o=null,r=[],l=[],c=[];return this._parentNodeFolderIdByIdMap=new Map,h.getRoutes().each(function(e){var t=this._createNodeData(e,e.getViewId()),n=e.get(al.ROUTE_PAGE_ID_KEY)===E.getSite().get("loginpage");if(e.isLoginRoute()&&!n)this._createNodeFolderAsParent(i,t,l,P.PAGE_MENU.FOLDER.NAME.LOGIN,null);else if(e.isObjectRoute()){n=e.getRouteKeyPrefix();if(n)return void this._createObjectNodeFolderAsParent(t,a,r,s,n)}else if(e.isGenericObjectRoute())t.keyPrefix=P.ROUTE.GENERIC_OBJECT_KEY_PREFIX_MARKER,this._createNodeFolderAsParent(i,t,c,P.PAGE_MENU.FOLDER.NAME.GENERIC_OBJECT,P.PAGE_MENU.FOLDER.TYPE.OBJECT),c[0].routes.push(t.routes[0]);else if(e.isManagedContentRoute())i.push(this._createContentNodeFolderAsParent(t));else if(e.isOOTB()&&k.isHomePageHomeRoute(e))return void(o=t);i.push(t)}.bind(this)),this._updateObjectNodesData(i,a,r,s),i=_.sortBy(i,function(e){return e.name.toLowerCase()}),o&&i.unshift(o),this._nodesDataByIdMap=new Map,this._addToNodesDataByIdMap(i),this._nodesData=i},_buildNodesDataForNewRoutes:function(e){var t=null,n=null,i=e[0],s=this._createNodeData(i,i.getViewId());return n=i.isObjectRoute()||i.isManagedContentRoute()?(e=(i=this._buildNodesDataForNewRoutesWithNodeFolder(e,s)).nodeFolder,i=i.nodesData,[t=e].concat(Q(i))):[t=s],{nodeToAdd:t,nodesDataToAdd:n}},_buildNodesDataForNewRoutesWithNodeFolder:function(e,t){var n=e[0],i=null,s=[];return n.isObjectRoute()?(i=this._createObjectNodeFolderData(t,n.getRouteKeyPrefix()),s=this._createObjectNodesDataAsChildren(e,i),this._addDataObjectInUse(n.getRouteKeyPrefix())):n.isManagedContentRoute()&&(i=this._createContentNodeFolderAsParent(t),s.push(t)),(i.children=s).forEach(function(e){e.parent=i}),{nodeFolder:i,nodesData:s}},_createNodeFolderAsParent:function(e,t,n,i,s){0===n.length&&(i=this._createNodeFolderData(i,s,t),n.push(i),e.push(i)),t.parentId=n[0].id},_createObjectNodeFolderAsParent:function(e,t,n,i,s){var a=_.find(i,{keyPrefix:s});a?(a.routes.push({id:e.routes[0].id,routeType:e.routes[0].routeType}),e.parentId=_.find(n,{keyPrefix:s}).id):(a=this._createObjectNodeFolderData(e,s),n.push(a),e.parentId=a.id,i.push({keyPrefix:s,routes:[{id:e.routes[0].id,routeType:e.routes[0].routeType}]})),t.push(e)},_createContentNodeFolderAsParent:function(e){var t;if($P.isManagedContentAuthoringEnabled)return t=e.contentTypeLabel,(t=this._createNodeFolderData(t,P.PAGE_MENU.FOLDER.TYPE.CONTENT,e)).routes=e.routes,e.parentId=t.id,t},_createObjectNodeFolderData:function(e,t){var n=_.find(this._dataObjects,function(e){return e.KeyPrefix===t}),n=n?n.Label:this._getObjectLabelFromDetailPage(e);return this._createNodeFolderData(n,P.PAGE_MENU.FOLDER.TYPE.OBJECT,e)},_createObjectNodesDataAsChildren:function(e,t){var n=this,i=[],s=[];return e.forEach(function(e){e=n._createNodeData(e,e.getViewId());s.push(e.routes[0]),e.routes=s,e.parentId=t.id,i.push(e)}),t.routes=s,i},_getObjectLabelFromDetailPage:function(e){e=e.name;return e.substring(0,e.lastIndexOf(" "))},_updateObjectNodesData:function(t,e,n,i){n=e.concat(n);_.each(n,function(e){e.routes=_.find(i,{keyPrefix:e.keyPrefix}).routes,t.push(e)}.bind(this)),this._setDataObjectsInUse(e)},_setDataObjectsInUse:function(e){e=_.toArray(_.groupBy(e,"keyPrefix")).map(function(e){return{keyPrefix:e[0].keyPrefix}});I.getAppState().set("dataObjects",e)},_addDataObjectInUse:function(e){I.getAppState().getDataObjects().push({keyPrefix:e})},_deleteDataObjectInUse:function(t){var e=I.getAppState().getDataObjects();e.splice(e.findIndex(function(e){return e.keyPrefix===t}),1)},_createNodeData:function(e,t){var n=e.id,i=E.getSite().get("homepage"),s=e.get(al.ROUTE_PAGE_ID_KEY),i=s===i,a=e.get(al.ROUTE_URL_KEY).replace(e.get(al.PARENT_URL_KEY),"");return t=t||this._getFirstSortedRouteViewId(e),{id:n,parentId:e.get(al.PARENT_ID_KEY),viewId:t,pageId:s,routeSegment:a,routeTypeFlags:{isSnaRoute:e.isSnaRoute(),isTmrRoute:e.isTmrRoute(),isAllowedInStaticSite:e.isAllowedInStaticSite()},hasParams:C.urlRequiresParameter(e.get(al.ROUTE_URL_KEY)),name:e.get(al.NAME_KEY),nodeFolderType:null,isNodeFolder:!1,keyPrefix:e.getRouteKeyPrefix(),contentTypeLabel:e.get(al.CONTENT_TYPE_LABEL),availableActions:e.get(al.PAGE_ACTIONS_KEY),availableFolderActions:e.get(al.FOLDER_ACTIONS_KEY),supportsViewCrud:I.AccessControl(P.PERMISSIONS.PAGE_EDIT)&&(i?I.getAppState().supportViewCrud():I.getAppState().isLoginPageAura()),routes:[{id:n,routeType:e.get(al.ROUTE_TYPE_KEY)}]}},_createNodeFolderData:function(e,t,n){var i=n.id,s=n.parentId,a=n.keyPrefix,o=n.availableFolderActions,n=n.supportsViewCrud,s={id:this._generateUUID(),parentId:s,name:e,nodeFolderType:t,isNodeFolder:!0,keyPrefix:a,availableActions:o,supportsViewCrud:n,routes:[]};return this._parentNodeFolderIdByIdMap.set(i,s.id),s},_getFirstSortedRouteViewId:function(e){return k.sortRouteViewsByName(e)[0].id},_onClearSearch:function(){this._clearSearch(),this._scrollSelectedNodeIntoView()},_clearSearch:function(){this.$(".js-pm-search-input").val(""),this.$(".js-pm-clear-search-icon").toggleClass("hidden",!0),this._popover&&this._popover.destroy(),this._pageMenuSearchResults&&(this.$(".js-pm-search-results").toggleClass("hidden"),this.$(".js-pm-tree-container").toggleClass("hidden"),this.stopListening(this._pageMenuSearchResults),this._pageMenuSearchResults.remove(),this._pageMenuSearchResults=null)},_onSearch:_.debounce(function(){var i=T.trim(this.$(".js-pm-search-input").val()).toLowerCase(),e=this.$(".cb-PageMenu-node"),s=[],a=this;this.$(".js-pm-clear-search-icon").toggleClass("hidden",0===i.length),0===i.length?this._clearSearch():(e.each(function(e,t){var n,t=a._getTreeNodeByElement(t);a._isValidAndMatchesSearchTerm(t,i)&&((n={id:t.id,routeName:t.name,viewId:t.viewId,breadcrumbs:c.constructStyledPath({segments:this._getParentNamesForNode(t),delimiter:"&nbsp;>&nbsp;",segmentClass:"cb-PageMenuSearchResults-listItemBreadcrumb js-pm-search-results-list-item-breadcrumb"}),supportsViewCrud:t.supportsViewCrud,pageMenuActionMenuTriggerTemplate:a._pageMenuActionMenuTriggerTemplate(t.name)}).name=t.name.replace(new RegExp(i,"gi"),function(e){return"<mark>".concat(e,"</mark>")}),s.push(n))}.bind(a)),this._pageMenuSearchResults?this._pageMenuSearchResults.refresh(s):(this._pageMenuSearchResults=new $r({el:this.$(".js-pm-search-results"),searchResultItems:s}).render(),this.listenTo(this._pageMenuSearchResults,"action-menu-trigger-clicked",function(e,t){this._handleSearchResultsItemActionMenuTriggerClicked(e,t)}).bind(this),this.listenTo(this._pageMenuSearchResults,"search-results-item-clicked",function(e,t){this._handleSearchResultsItemClicked(e,t)}).bind(this),this.$(".js-pm-search-results").toggleClass("hidden"),this.$(".js-pm-tree-container").toggleClass("hidden")))},200),_isValidAndMatchesSearchTerm:function(e,t){var n=e.name;return!e.isNodeFolder&&0<=n.toLowerCase().indexOf(t)},_getParentNamesForNode:function(e){if(n=e.parent){for(var t=[n.name],n=n.parent;n&&0<n.name.length;)t.unshift(n.name),n=n.parent;return t}return[]},_handleSearchResultsItemClicked:function(e,t){I.event.trigger("action:navigate-to-page",{viewId:t,routeId:e}),this._close()},_handleSearchResultsItemActionMenuTriggerClicked:function(e,t){this._handleShowPopoverMenuOnSearchResultsItem(e,t)},_handleShowPopoverMenu:function(e){var t=this._getSelectedTreeNode();e.id===t.id&&this._popover?this._popover.destroy():(this._getPageMenuTree().tree("selectNode",null),this._getPageMenuTree().tree("selectNode",e,{mustToggle:!1,mustSetFocus:!1}),t='.jqtree-selected .js-pm-action-menu-trigger[data-name="'.concat(e.name,'"]'),this._showPopoverMenu(e.id,t,!1))},_handleShowPopoverMenuOnSearchResultsItem:function(e,t){e===this._currentSearchResultItem&&this._popover?this._popover.destroy():(this._currentSearchResultItem=e,t='.js-pm-search-results .js-pm-action-menu-trigger[data-name="'.concat(t,'"]'),this._showPopoverMenu(e,t,!0))},_showPopoverMenu:function(e,t,n){this.$(".js-pm-menu").removeClass("show");t=this.$(t),e=this._createPageActionMenuView(e,n),n=this._onPopoverScrollHandler.bind(this,t,n);this._popover=Zr({view:e.$el[0],trigger:t[0],options:{className:"cb-PageActionMenu-panel",nubbinPosition:"left",offsetTriggerHeight:!1,horizontalOffset:20,windowScrollHandler:n,destroyCallback:function(){this._popover=null}.bind(this)}}),this._popover.show()},_createPageActionMenuView:function(e,t){var n=this._getNodeDataById(e),e=this._getTreeNodeById(e).getLevel(),t=new Xr(m(m({},n),{},{isSearchResultsView:t,nodeLevel:e,nodeData:this._nodesData}));return this.listenToOnce(t,"showPageManager",function(){this.$(".js-pm-menu").addClass("show"),this._showPageManager(n),this._popover.destroy()}.bind(this)),this.listenToOnce(t,"closePageActionMenu",function(){this._popover.destroy()}.bind(this)),t},_onPopoverScrollHandler:function(e,t){this._isScrolledIntoView(e,t)?this._popover.reposition(e[0]):this._popover.destroy()},_isScrolledIntoView:function(e,t){var t=T(t?".js-pm-search-results":".js-pm-tree-container")[0].getBoundingClientRect(),n=t.height,t=t.top,e=e[0].getBoundingClientRect(),t=e.top-t;return t+e.height<=n&&0<=t},_onClickCog:function(){this.$el.hasClass("open")||this._onClickTrigger(),this.$(".js-pm-menu").addClass("show");var e=this._getCurrentPageRouteId();this._showPageManager(this._getNodeDataById(e))},_showPageManager:function(e){var t=this._getCurrentPageRouteId();this._pageManager?this._pageManager.refresh({data:e,selectedRouteId:t}):this._pageManager=new Mr({el:this.$("."+ll),data:e,selectedRouteId:t,closePageManagerCallback:this._handlePageManagerClosed.bind(this)}).render()},_handlePageManagerClosed:function(e){this.$(".js-pm-menu").removeClass("show")},_onClickAddPage:function(){var e=new Ir({hideFooter:!0,contentView:"PageWizardStepChooseType",pageVariationMode:!1});A.showDialog(e,{className:"slds-vex-theme cb-Dialog--PageWizard test-dialog-page-wizard"})},_onClickTrigger:function(){j.getAppEvent().trigger("close-left-panel"),this._clearState(),this.$el.toggleClass("open"),this.$el.hasClass("open")&&this._selectTreeNodeByIdAndScrollIntoView(this._getCurrentPageRouteId())},_close:function(){this.$el.removeClass("open"),this._clearState()},_shouldClose:function(e){return this._isClickOutsidePageMenu(e)&&!this._isDialogOpen()&&!this._isOnboardingEvent(e)&&!ta.isActive(e)},_clearState:function(){this.$(".js-pm-menu").removeClass("show"),this._pageManager&&this._pageManager.clear(),this._getPageMenuTree().tree("selectNode",null),this._clearSearch(),this._popover&&this._popover.destroy()},_handleRouteChange:function(e){var t=e.viewId,e=e.routeId;this._setCurrentPage(e,t)},_handleRoutesBaseUrlsChanged:function(e,t){var n=this;e.forEach(function(e){n._updateRouteSegmentPrefixInNodeData(e,t)})},_handleRoutesPropertiesChanged:function(e){var i=this,t=J(e,1)[0],n=t.id,t=t.props;t&&t.Name&&this._handleRoutesNameChanged(n,t.Name),e.forEach(function(e){var t,n=e.id,e=e.props;e.Name?n===(t=i._getCurrentPageRouteId())&&i._setCurrentPage(t,i._getCurrentPageViewId):e.RouteUrl&&i._updateRouteSegmentInNodeData(n,e.RouteUrl.substring(e.RouteUrl.lastIndexOf("/")))}),this._pageMenuSearchResults&&this._onSearch()},_handleRoutesNameChanged:function(e,t){var n=this._getNodeDataById(e);n.name=t,this._updateTreeNode(e,{name:t}),this._shouldUpdateTreeNodeAlphabeticalPosition(e)&&this._moveTreeNodeAlphabetically(e,n.parentId),this._selectTreeNodeByIdAndScrollIntoView(e)},_handleRoutesCreated:function(e){var t=e.newRouteModels,e=e.routeId,n=t[0].get(al.PARENT_ID_KEY),t=this._buildNodesDataForNewRoutes(t,n),i=t.nodeToAdd,t=t.nodesDataToAdd;i.parentId=n,i.parent=this._getNodeDataById(n),this._addTreeNodeAlphabetically(i,n),this._selectTreeNodeByIdAndScrollIntoView(e),this._addNodesData(t),this._addNodeDataChildren(n,i.id)},_handleRoutesMoved:function(e){var t=e.selectedRouteId,e=e.newParentRouteId,n=this._parentNodeFolderIdByIdMap.has(t)?this._parentNodeFolderIdByIdMap.get(t):t,e=null===e?"":e,i=this._getNodeDataById(n).parentId;this._moveTreeNodeAlphabetically(n,e),this._selectTreeNodeByIdAndScrollIntoView(t,!0),this._contractPageMenuWidth(t),this._updateNodeDataForMove(n,e,i),this._pageMenuSearchResults&&this._onSearch()},_handleRoutesDeleted:function(e){var t=J(e,1)[0],t=this._parentNodeFolderIdByIdMap.has(t)?this._parentNodeFolderIdByIdMap.get(t):t,n=this._getCurrentPageRouteId();h.getRoutes().some(function(e){return e.id===n})||(n=this._homeRouteId),this._deleteTreeNode(t),this._selectTreeNodeByIdAndScrollIntoView(n),this._contractPageMenuWidth(n);var i=this._getNodeDataById(t).parentId,e=(this._deleteNodesData(e),this._deleteNodeDataChildren(i,t),this._getNodeDataById(n));this.$(".js-pm-menu").hasClass("show")&&this._showPageManager(e),this._pageMenuSearchResults&&this._onSearch()},_handleViewDeleted:function(e){var t=e.routeId,e=e.viewId,n=this._getNodeDataById(t);n.viewId===e&&(e=(e=h.getRoutes().get(t)).getViewId()||this._getFirstSortedRouteViewId(e),n.viewId=e,this._updateTreeNode(t,{viewId:e}))},_handleDefaultViewUpdated:function(e){var t=e.routeId,e=e.viewId;this._getNodeDataById(t).viewId=e,this._updateTreeNode(t,{viewId:e})},_getNodeDataById:function(e){return this._nodesDataByIdMap?this._nodesDataByIdMap.get(e):null},_getRootNodeDataById:function(e){return el(this._getNodeDataById(e))},_getSelectedNodeData:function(){var e=this._getSelectedTreeNode().id;return this._getNodeDataById(e)},_addNodesData:function(e){var t=this._nodesData.shift();this._insertItemsIntoSortedArray(this._nodesData,e),this._nodesData.unshift(t),this._addToNodesDataByIdMap(e)},_addToNodesDataByIdMap:function(e){var t=this;e.forEach(function(e){t._nodesDataByIdMap.set(e.id,e)})},_addChildNodeDataToParent:function(e,t){this._isRootId(e)||(t=this._getNodeDataById(t),(e=this._getNodeDataById(e)).children?this._insertItemsIntoSortedArray(e.children,[t]):e.children=[t])},_deleteNodesData:function(n){var i=this;n.forEach(function(e){var t;i._parentNodeFolderIdByIdMap.has(e)&&(t=i._parentNodeFolderIdByIdMap.get(e),n.push(t),(t=i._getNodeDataById(t).keyPrefix)&&i._deleteDataObjectInUse(t),i._parentNodeFolderIdByIdMap.delete(e)),i._deleteItemFromArrayById(i._nodesData,e),i._deleteFromNodesDataById(e)})},_deleteChildNodeDataFromParent:function(e,t){this._isRootId(e)||(e=this._getNodeDataById(e))&&e.children&&this._deleteItemFromArrayById(e.children,t)},_deleteItemFromArrayById:function(e,t){var n;Array.isArray(e)&&e.length&&(n=e.findIndex(function(e){return e.id===t}),e.splice(n,1))},_deleteFromNodesDataById:function(e){this._nodesDataByIdMap.delete(e)},_insertItemsIntoSortedArray:function(e,t){var n=this,i=e.findIndex(function(e){return 0<n._compareObjectNames(e,t[0])});-1===i?e.push.apply(e,Q(t)):e.splice.apply(e,[i,0].concat(Q(t)))},_compareObjectNames:function(e,t){return e.name.localeCompare(t.name)},_updateParentInNodeData:function(e,t){e=this._getNodeDataById(e);e.parentId=t,this._isRootId(t)?delete e.parent:e.parent=this._getNodeDataById(t)},_updateRouteSegmentPrefixInNodeData:function(e,t){e=this._getNodeDataById(e);e.routeSegment=t+e.routeSegment.substring(e.routeSegment.indexOf(":")-1)},_updateRouteSegmentInNodeData:function(e,t){this._getNodeDataById(e).routeSegment=t},_updateNodeDataForMove:function(e,t,n){this._updateParentInNodeData(e,t),this._addNodeDataChildren(t,e),this._deleteNodeDataChildren(n,e)},_deleteNodeDataChildren:function(e,t){this._isRootId(e)||(this._deleteChildNodeDataFromParent(e,t),t=this._getRootNodeDataById(e),this._updateNodeDataLevelAndDescendantTreeHeight([t]))},_addNodeDataChildren:function(e,t){this._addChildNodeDataToParent(e,t);e=this._getRootNodeDataById(t);this._updateNodeDataLevelAndDescendantTreeHeight([e])},_updateNodeDataLevelAndDescendantTreeHeight:function(e){e={level:0,children:Q(e)};this._updateNodeDataLevelAndDescendantTreeHeightRecursively(e)},_getPageMenuTree:function(){return this._pageMenuTree||this.$(".js-pm-tree")},_getRootTreeNode:function(){return this._getPageMenuTree().tree("getTree")},_getRootTreeNodeData:function(){return this._getRootTreeNode().getData()},_getTreeNodeById:function(e){return this._getPageMenuTree().tree("getNodeById",e)},_getTreeNodeByElement:function(e){return this._getPageMenuTree().tree("getNodeByHtmlElement",e)},_getSelectedTreeNode:function(){return this._getPageMenuTree().tree("getSelectedNode")},_selectTreeNodeById:function(e){e=this._getTreeNodeById(e);return this._getPageMenuTree().tree("selectNode",e,{mustToggle:!1,mustSetFocus:!1}),e},_scrollSelectedNodeIntoView:function(){var e=this._getSelectedTreeNode();e&&this._getPageMenuTree().tree("scrollToNode",e)},_selectTreeNodeByIdAndScrollIntoView:function(e,t){e=this._selectTreeNodeById(e);e&&(t&&!this._isRootId(e.parentId)&&this._getPageMenuTree().tree("openNode",e.parent),this._getPageMenuTree().tree("scrollToNode",e))},_addTreeNode:function(e,t,n){n?this._getPageMenuTree().tree("addNodeBefore",e,n):(n=this._getTreeNodeById(t),this._getPageMenuTree().tree("appendNode",e,n))},_addTreeNodeAlphabetically:function(e,t){var n=this._getTreeNodeToPlaceBefore(e,t).siblingTreeNodeToPlaceBefore;this._addTreeNode(e,t,n)},_moveTreeNode:function(e,t,n,i){n?this._pageMenuTree.tree("moveNode",e,n,"before"):Array.isArray(i)&&i.length?(n=i.pop(),this._pageMenuTree.tree("moveNode",e,n,"after")):(i=this._getTreeNodeById(t),this._pageMenuTree.tree("moveNode",e,i,"inside")),this._updateTreeNode(e.id,{parentId:t})},_moveTreeNodeAlphabetically:function(e,t){var n=this._getTreeNodeById(e),i=this._getTreeNodeToPlaceBefore(n,t),s=i.siblingTreeNodeToPlaceBefore,i=i.siblingTreeNodes;this._isRootId(t)||this._isRootId(n.parentId)?this._moveTreeNode(n,t,s,i):((i=m({},n)).parentId=t,this._deleteTreeNode(e),this._addTreeNode(i,t,s))},_updateTreeNode:function(e,t){e=this._getTreeNodeById(e);this._getPageMenuTree().tree("updateNode",e,t)},_deleteTreeNode:function(e){e=this._getTreeNodeById(e);this._getPageMenuTree().tree("removeNode",e)},_getTreeNodeToPlaceBefore:function(e,t){var n;return t&&!this._isRootId(t)?n=Q(this._getTreeNodeById(t).children):(n=Q(this._getRootTreeNode().children)).shift(),{siblingTreeNodeToPlaceBefore:this._getSiblingTreeNodeAlphabeticallyAfter(n,e),siblingTreeNodes:n}},_getSiblingTreeNodeAlphabeticallyAfter:function(e,t){var n=this;return e.find(function(e){return n._compareObjectNames(t,e)<0})},_shouldUpdateTreeNodeAlphabeticalPosition:function(e){var e=this._getTreeNodeById(e),t=e.getPreviousSibling(),n=e.getNextSibling();return!!(t&&this._compareObjectNames(e,t)<0||n&&0<this._compareObjectNames(e,n))},_setCurrentPage:function(e,t){var e=this._getNodeDataById(e)||{},n=e.id,i=e.name,e=e.supportsViewCrud;n&&(this._selectTreeNodeById(n),i=_.escape(i),this.$(".js-pm-selected").html(i).data("viewid",t).data("routeid",n).prop("title",i),this.$(".js-pm-settings-cog").toggleClass("slds-hide",!e))},_getCurrentPageRouteId:function(){return this.$(".js-pm-selected").data("routeid")},_getCurrentPageViewId:function(){return this.$(".js-pm-selected").data("viewid")},_showAlert:function(e){j.getAppEvent().trigger("show-alert",{title:ol.NoParamDataDialogTitle,message:e})},_isOnboardingEvent:function(e){return T(".hopscotch-bubble").is(":visible")||"hopscotch-nav-button next hopscotch-next"===e.target.getAttribute("class")},_isDialogOpen:function(){return A.isDialogOpen()||this._isAuraDialogOpen()||this._isTextEditorDialogOpen()||this._isLWCModalOpen()},_isAuraDialogOpen:function(){return 0<T(".cb-modal").length},_isTextEditorDialogOpen:function(){return 0<T(".cb-TextEditor-dialog").length},_isLWCModalOpen:function(){return 0<T("lightning-overlay-container").find(".slds-modal").length},_isClickOutsidePageMenu:function(e){return 0===this.$el.find(e.target).length},_isRootId:function(e){return""===e},_generateUUID:function(){return"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/[x]/g,function(){return(16*Math.random()|0).toString(16)})}}),e=PicassoWebServices.Labels.PageVariationsMenu,ul=P.PROP,pl=Backbone.View.extend({className:"cb-PageVariations btn-group slds-dropdown-trigger icon-down dropdown js-page-variations",events:{"click .js-page-variations-item-link":"_onClickPageVariation"},pageVariationsTemplate:_.template('<button type="button" data-toggle="dropdown" class="dropdown-toggle js-page-variations-button">'+e.PageVariations+'</button><ul class="dropdown-menu js-page-variation-menu cb-DropdownMenu-menu slds-nubbin--top"><li class="cb-DropdownMenu-header"><span>'+e.PageVariations+'</span></li><ul class="js-page-variation-list cb-PageVariations-list"></ul></ul>'),itemTemplate:_.template('<li class="cb-PageVariations-item slds-dropdown__item js-page-variations-item"><a class="cb-PageVariations-itemLink js-page-variations-item-link"data-viewid="{{=viewId}}" data-routeid="{{=routeId}}" href="#" title="{{- name}}"><span class="slds-icon_container cb-PageVariations-checkmark {{= isSelected ? "js-variation-selected" : "slds-hidden" }} js-page-variations-checkmark"><svg aria-hidden="true" class="cb-PageVariations-checkmarkIcon slds-icon slds-icon_x-small"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#check"></use></svg><span class="slds-assistive-text">{{- name}}</span></span>{{- name}}</a></li>'),initialize:function(e){this.listenTo(I.event,"state:view-deleted",this._handleViewDeleted),this.listenTo(I.event,"state:view-created",this._handleViewCreated),this.listenTo(I.event,"state:page-change-start",this._handleNavigateToBookmark),this.listenTo(I.event,"state:page-change-success",this._handleRouteChangeSuccess),this.listenTo(I.event,"state:view-properties-updated",this._handleViewPropertiesChanged),this.render()},render:function(){var e=I.getAppState().getCurrentRouteId(),t=I.getAppState().getCurrentViewId();return this.$el.on("show.bs.dropdown",function(){j.getAppEvent().trigger("close-left-panel")}),this._renderMenu(e,t),this},_createPageVariationItem:function(e,t,n){return{name:t.get(ul.NAME_KEY),viewId:t.id,routeId:e.get("id"),isSelected:n}},_createPageVariationItems:function(e,t){var n=h.getRoutes().get(e),e=n.getViews(),i=t||n.getViewId();return _.map(e,function(e){var t=e.id===i;return this._createPageVariationItem(n,e,t)}.bind(this))},_getPageVariationItem:function(e){return _.find(this._pageVariationItems,{viewId:e})},_getSelectedItem:function(){var e=this.$(".js-page-variations-button").data("viewid");return this._getPageVariationItem(e)},_handleViewCreated:function(e){var t,e=e.routeId;e===I.getAppState().getCurrentRouteId()&&(t=I.getAppState().getCurrentViewId(),this._renderMenu(e,t))},_handleViewDeleted:function(e){var t=e.routeId,e=e.viewId;t===I.getAppState().getCurrentRouteId()&&(e===(e=this._getSelectedItem().viewId)&&(e=k.getDefaultViewIdForRoute(t)),this._renderMenu(t,e))},_handleNavigateToBookmark:function(e){var t=e.viewId,e=e.routeId;this._renderMenu(e,t)},_handleRouteChangeSuccess:function(e){var t=this._getSelectedItem();t&&e.viewId===t.viewId||this._renderMenu(e.routeId,e.viewId)},_handleViewPropertiesChanged:function(e,t){var n=I.getAppState().getCurrentRouteId(),e=h.getRoutes().getRouteForView(e)[0];t.Name&&n===e.id&&(t=I.getAppState().getCurrentViewId(),this._renderMenu(n,t))},_hasMultiplePageVariations:function(e){e=h.getRoutes().get(e);return!!e&&1<e.getViews().length},_initItems:function(e,t){this._pageVariationItems=this._createPageVariationItems(e,t),this._orderItems(this._pageVariationItems)},_onClickPageVariation:function(e){var t=e.currentTarget,n=T(t).data("viewid"),t=T(t).data("routeid");I.event.trigger("action:navigate-to-page",{viewId:n,routeId:t}),this._updateSelectedButton(n),this._setMenuItemSelected(n),this._renderMenuHtml(),e.preventDefault()},_orderItems:function(e){e.sort(function(e,t){return e.name.localeCompare(t.name)})},_renderMenu:function(e,t){this._hasMultiplePageVariations(e)?(this.$el.html(this.pageVariationsTemplate()),this._initItems(e,t),this._updateSelectedButton(t),this._renderMenuHtml()):this.$el.empty()},_renderMenuHtml:function(){var t=[];_.each(this._pageVariationItems,function(e){t.push(this.itemTemplate(e))}.bind(this)),this.$(".js-page-variation-list").html(t.join(""))},_setMenuItemSelected:function(t){_.each(this._pageVariationItems,function(e){e.isSelected=e.viewId===t})},_updateSelectedButton:function(e){var e=this._getPageVariationItem(e),t=_.escape(e.name);this.$(".js-page-variations-button").html(t).data("viewid",e.viewId).data("routeid",e.routeId).prop("title",t)}}),gl=PicassoWebServices.Labels.CommunityBuilder,hl=Backbone.View.extend({tagName:"div",className:"cb-RefreshPage js-refresh-page",events:{"click .js-refresh-page-button":"_onRefreshPage"},initialize:function(){this.refreshButtonOptions={buttonClassName:"cb-RefreshPage-button js-refresh-page-button",buttonAttributes:'data-toggle="tooltip" data-placement="bottom"',svgClassName:"cb-RefreshPage-icon",label:gl.Refresh,icon:"refresh"},this.listenTo(I.event,"state:no-component-errors",function(e){e&&this._onRefreshPage()}.bind(this)),this.render()},render:function(){return this.$el.append(D.buttonIcon(this.refreshButtonOptions)),this.$('[data-toggle="tooltip"]').tooltip(),this},_onRefreshPage:function(e){e&&(e.preventDefault(),e.target.blur()),I.event.trigger("action:refresh-current-page")}}),ml=(PicassoWebServices.Labels.CommunityBuilder,Backbone.View.extend({tagName:"div",className:"cb-CopilotPanelTrigger js-copilot-panel-trigger",events:{"click .js-copilot-panel-trigger":"_onClick"},initialize:function(){var t=this;this.copilotPanelTriggerOptions={buttonClassName:"cb-CopilotPanel-Trigger js-copilot-panel-trigger slds-button_icon-border-filled",buttonAttributes:'data-toggle="tooltip" data-placement="bottom" aria-pressed="false"',svgClassName:"cb-CopilotPanelTrigger-icon",label:"Copilot",icon:"einstein"},this.listenTo(j.getAppEvent(),"float-panel-closed",function(e){e===P.FLOATING_PANEL.COPILOT_PANEL&&t._handleCopilotPanelClosed()}),this.render()},render:function(){return this.$el.append(D.buttonIcon(this.copilotPanelTriggerOptions)),this.$('[data-toggle="tooltip"]').tooltip(),this},_onClick:function(e){e&&(e.preventDefault(),e.target.blur(),(e=T(e.currentTarget)).toggleClass("slds-is-selected"),e.hasClass("slds-is-selected")?(e.prop("aria-pressed","false"),j.getAppEvent().trigger("open-copilot-panel")):(e.prop("aria-pressed","true"),j.getAppEvent().trigger("close-copilot-panel")))},_handleCopilotPanelClosed:function(){T(".js-copilot-panel-trigger").removeClass("slds-is-selected")}})),vl=PicassoWebServices.Labels.PicassoStudio,bl=Backbone.View.extend({tagName:"div",className:"slds-dropdown-trigger slds-dropdown-trigger_click cb-PreviewNewTab slds-border_left",events:{"click .js-preview-as-auth":"_previewInNewTabAuth","click .js-preview-as-guest:not(.is-disabled)":"_previewInNewTabGuest","click .js-preview-new-tab-button":"_showDropdown"},_previewDropdown:_.template("".concat(D.buttonIcon({buttonClassName:"slds-button_neutral js-preview-new-tab-button",svgClassName:"cb-PreviewNewTab-previewIcon js-preview-icon",label:"".concat(vl.PreviewAs),icon:"preview"}),'\n        <div class="slds-dropdown slds-dropdown_{{= alignment }} slds-dropdown_x-small js-preview-dropdown">\n            <ul class="dropdown__list js-preview-dropdown-menu" role="menu"></ul>\n        </div>').trim()),_previewHeaderItem:'<li class="slds-dropdown__item slds-truncate menu__header"><span>'+vl.PreviewAs+"</span></li>",_previewItemUser:_.template('<li class="slds-dropdown__item"><a href="javascript:void(0)" class="js-preview-as-{{= user }} js-preview" {{= tooltip}}><span class="slds-truncate">{{= label }}</span><span class="slds-icon slds-icon-text-default slds-icon_x-small icon-utility-new_window"></span></a></li>'),initialize:function(){this.listenTo(I.event,"state:routes-properties-updated",this.render),this.listenTo(I.event,"state:community-privacy-updated",this.render),this.render(),T(document).click(function(e){0===this.$el.has(e.target).length&&this._hideDropdown()}.bind(this)),window.addEventListener("blur",function(){this._hideDropdown()}.bind(this))},render:function(){this.$el.html(this._previewDropdown({alignment:I.AccessControl(P.PERMISSIONS.PAGE_EDIT)?"left":"center"}));var e=this.$(".js-preview-dropdown-menu");e.append(this._previewHeaderItem),e.append(this._previewItemUser({user:"auth",label:vl.AuthenticatedUser,tooltip:_.escape()}));var t=!_.some(h.getRoutes().models,function(e){return!e.isLoginRoute()&&e.isPublicRoute()})&&!I.getAppState().getCurrentSite().isCommunityPublic(),n=T(this._previewItemUser({user:"guest",label:vl.GuestUser,tooltip:t?'title="'+vl.InactivePreviewAsGuestUserTooltip+'"':_.escape()}));return t&&n.find(".js-preview-as-guest").addClass("is-disabled"),e.append(n),this},_showDropdown:function(){this.$el.toggleClass("slds-is-open")},_hideDropdown:function(){this.$el.removeClass("slds-is-open")},_previewInNewTabAuth:function(){window.open(I.getAppState().getSitePreviewUrl(),vl.Preview)},_previewInNewTabGuest:function(){window.open(I.getAppState().getAnonymousPreviewUrl(),vl.Preview)}}),fl=Backbone.View.extend({tagName:"div",className:"cb-UndoRedo button-group slds-border_left",events:{"click .js-undo:not(.is-disabled)":"_undo","click .js-redo:not(.is-disabled)":"_redo"},initialize:function(){this.undoButtonOptions={buttonClassName:"cb-UndoRedo-button js-undo ".concat(I.getAppState().get("hasUndoStack")?"":" is-disabled"),buttonAttributes:'data-toggle="tooltip" data-placement="bottom"',svgClassName:"cb-UndoRedo-icon",label:PicassoWebServices.Labels.ContentEditor.Undo,icon:"undo"},this.redoButtonOptions={buttonClassName:"cb-UndoRedo-button js-redo ".concat(I.getAppState().get("hasRedoStack")?"":" is-disabled"),buttonAttributes:'data-toggle="tooltip" data-placement="bottom"',svgClassName:"cb-UndoRedo-icon",label:PicassoWebServices.Labels.ContentEditor.Redo,icon:"redo"},this.render(),this.listenTo(I.getAppState(),"change:hasUndoStack",this._onChangeUndoStack),this.listenTo(I.getAppState(),"change:hasRedoStack",this._onChangeRedoStack)},render:function(){return this.$el.append(D.buttonIcon(this.undoButtonOptions)).append(D.buttonIcon(this.redoButtonOptions)),this.$('[data-toggle="tooltip"]').tooltip(),this},_onChangeUndoStack:function(){this.$(".js-undo").toggleClass("is-disabled")},_onChangeRedoStack:function(){this.$(".js-redo").toggleClass("is-disabled")},_undo:function(){I.event.trigger("action:remove-all-component-errors"),PicassoWebServices.ManageSiteCommon.LinearUndo(I.getAppState().getCurrentPageId(),this._handleResult.bind(this,"undo"))},_redo:function(){I.event.trigger("action:remove-all-component-errors"),PicassoWebServices.ManageSiteCommon.LinearRedo(I.getAppState().getCurrentPageId(),this._handleResult.bind(this,"redo"))},_handleResult:function(e,t){y.hasProcessedErrorInResults(t)||I.handleUndoRedoResult(e,t)}}),_l=PicassoWebServices.Labels.CommBuilderPageManagement,Sl=Backbone.View.extend({tagName:"div",className:"slds-dropdown-trigger slds-dropdown-trigger_click cb-ResolutionPicker slds-border_left",events:{"click .js-fluid.is-selected":"_hideDropdown","click .js-tablet.is-selected":"_hideDropdown","click .js-phone.is-selected":"_hideDropdown","click .js-fluid:not(.is-selected)":"_onClickFluid","click .js-tablet:not(.is-selected)":"_onClickTablet","click .js-phone:not(.is-selected)":"_onClickPhone","click .js-resolution-button":"_toggleDropdown"},resolutionDropDown:_.template('<button class="slds-button slds-button_neutral cb-ResolutionPicker-button js-resolution-button"><span class="slds-icon cb-ResolutionPicker-icon js-resolution-icon {{= icon }}"></span><span class="slds-assistive-text">'+PicassoWebServices.Labels.LiveResize.ResolutionPicker+'</span></button><div class="slds-dropdown js-resolution-dropdown"><ul class="dropdown__list js-resolution-dropdown-menu" role="menu"></ul></div>'),resolutionHeaderItem:_.template('<li class="slds-dropdown__item slds-truncate menu__header"><span>'+PicassoWebServices.Labels.LiveResize.ResolutionPicker+"</span></li>"),resolutionItem:_.template('<li class="slds-dropdown__item"><a href="javascript:void(0)" class="js-{{= id }} js-{{= type }}"><p class="slds-truncate"><span class="slds-icon slds-icon-text-default slds-icon_x-small {{= icon }}"></span>{{= label }}</p></a></li>'),mobileWorkspaceWelcomeDialogTemplate:_.template('<div class="cb-MobileWorkspaceWelcomeDialog-body-header-text">{{= contentHeaderText }}</div>{{ _.each(tiles, function(tile) { }}<article class="slds-tile slds-media"><div class="slds-media__figure"><span class="slds-icon_container" title="{{= tile.title }}"><svg class="slds-icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#{{= tile.icon }}"></use> </svg></span></div><div class="slds-media__body"><h3 class="slds-tile__title slds-truncate" title="{{= tile.title }}">{{= tile.title }}</h3><div class="slds-tile__detail"><dl class="slds-list_horizontal slds-wrap"><dt class="tile-content-body" title="{{= tile.title}}"> {{= tile.body }}</dt></dl></div></div></article>{{ }); }}'),initialize:function(){this.render(),this.$previewWorkarea=T("#sitePreviewWorkarea"),T(document).click(function(e){0===this.$el.has(e.target).length&&this._hideDropdown()}.bind(this)),window.addEventListener("blur",function(){this._hideDropdown()}.bind(this))},render:function(){var n=I.getAppState().get("currentResolution"),i=(this.$el.html(this.resolutionDropDown({icon:n.get("icon")})),this.$(".js-resolution-dropdown-menu"));return i.append(this.resolutionHeaderItem()),this.collection.each(function(e){var t=T(this.resolutionItem(e.toJSON()));e===n&&t.find("a").addClass("is-selected"),i.append(t)}.bind(this)),this},_getCookieKeyForMobileExperienceDialogBoxDisplay:function(){return I.getAppState().getNetworkId()+"_suppress_mobile_visibility_dialog"},savePreferenceForDialogDisplay:function(){T.cookie(this._getCookieKeyForMobileExperienceDialogBoxDisplay(),!1)},_shouldShowDialog:function(){var e=!!T.cookie(this._getCookieKeyForMobileExperienceDialogBoxDisplay());return I.AccessControl(P.PERMISSIONS.PAGE_EDIT)&&Vn.isMobileExperienceEnabled()&&!e},_onClickFluid:function(e){e.preventDefault(),this.$previewWorkarea.parent().removeClass("phone-preview"),this._setResolution(this.$(".js-fluid"),P.LIVE_RESIZE_BREAKPOINT.FLUID)},_onClickTablet:function(e){this.$previewWorkarea.parent().removeClass("phone-preview"),e.preventDefault(),this._setResolution(this.$(".js-tablet"),P.LIVE_RESIZE_BREAKPOINT.TABLET)},_buildMobileWorkspaceWelcomeDialogContent:function(){var e=[{title:_l.MobileWorkspaceWelcomeDialogAlertSection0Title,body:_l.MobileWorkspaceWelcomeDialogAlertSection0Body,icon:"hide"},{title:_l.MobileWorkspaceWelcomeDialogAlertSection1Title,body:_l.MobileWorkspaceWelcomeDialogAlertSection1Body,icon:"preview"}];return this.mobileWorkspaceWelcomeDialogTemplate({tiles:e,contentHeaderText:_l.MobileWorkspaceWelcomeDialogAlertContentHeaderText})},_onClickPhone:function(e){e.preventDefault(),this._setResolution(this.$(".js-phone"),P.LIVE_RESIZE_BREAKPOINT.PHONE);var n=this;this._shouldShowDialog()&&A.sldsModal({title:_l.MobileWorkspaceWelcomeDialogAlertTitle,content:n._buildMobileWorkspaceWelcomeDialogContent(),className:"cb-MobileWorkspaceWelcomeDialog",isSingleButton:!0,checkbox:{label:_l.MobileWorkspaceWelcomeDialogDontShowAgain},callback:function(e,t){e&&t&&n.savePreferenceForDialogDisplay()}})},_hideDropdown:function(){this.$el.removeClass("slds-is-open")},_toggleDropdown:function(){this.$el.toggleClass("slds-is-open")},_setResolution:function(e,t){var n=gt.get(t);I.getAppState().set("currentResolution",n),this.$(".js-resolution-icon").removeClass("icon-utility-desktop icon-utility-phone_portrait icon-utility-tablet_portrait").addClass(n.get("icon")),this.$(".js-resolution:not(.js-"+t+")").removeClass("is-selected"),e.addClass("is-selected"),this._hideDropdown()}}),Cl=Backbone.View.extend({tagName:"button",className:"cb-Button",initialize:function(e){this.options=e||{},this.render()},render:function(){return this.$el.addClass(this.options.classes).attr({title:this.options.title}).prop("type","button").append(this.options.text),this}}),yl=Backbone.View.extend({tagName:"div",className:"cb-Preview slds-border_left",initialize:function(){this.previewButtonOptions={text:'<span class="icon-utility-preview hide-desktop"></span><span class="hide-mobile">'+PicassoWebServices.Labels.PicassoStudio.Preview+'</span><span class="slds-assistive-text">'+PicassoWebServices.Labels.PicassoStudio.Preview+"</span>",className:"cb-Preview slds-button slds-button_neutral js-preview-button",events:{click:this._preview.bind(this)},title:PicassoWebServices.Labels.PicassoStudio.Preview,attributes:{"data-toggle":"tooltip","data-placement":"bottom-right"}},this.listenTo(j.getAppEvent(),"select-preview-mode",this._preview),this.render()},render:function(){return this.$el.append(new Cl(this.previewButtonOptions).el),this.$('[data-toggle="tooltip"]').tooltip(),this},_preview:function(){var e=I.getAppState().get("workspaceMode");e!==P.workspace.PREVIEW&&(j.getAppEvent().trigger("workspace-preview-change",e),I.getAppState().set("workspaceMode",P.workspace.PREVIEW),j.getAppEvent().trigger("preview-switcher-select"))}}),Tl=Backbone.View.extend({className:"cb-TextArea",_template:_.template('<div class="slds-form-element">\n            <label class="slds-form-element__label cb-TextArea-label js-text-area-label" for="textarea-id-{{= id}}">{{= label}}</label>\n            {{ if (labelTooltipTemplate) { }}\n                {{= labelTooltipTemplate }}\n            {{ } }}\n            <div class="slds-form-element__control">\n                <textarea id="textarea-id-{{= id}}" maxlength="{{= maxLength}}" placeholder="{{= placeholderText}}" class="slds-textarea js-text-area"></textarea>\n            </div>\n            <div class="cb-TextArea-characterCounter" id="character-counter">\n                <span class="cb-TextArea-currentCount" id="current-count">0</span>\n                <span>&nbsp;/&nbsp;</span>\n                <span id="max-length">{{= maxLength}}</span>\n            </div>\n        </div>'.trim()),_labelTooltipTemplate:function(e){return e?D.tooltipButtonIcon({tooltipPlacement:"right",tooltipLabel:e}):""},events:{"input .js-text-area":"_onTextAreaChange"},initialize:function(e){this.options=e},render:function(){var e=this.options,t=e.id,n=e.label,i=e.labelTooltip,s=e.placeholderText,e=e.maxLength,a=this._labelTooltipTemplate(i);return this.$el.html(this._template({id:t,label:n,labelTooltipTemplate:a,placeholderText:s,maxLength:e})),i&&this.$('[data-toggle="tooltip"]').tooltip(),this},_onTextAreaChange:function(e){e=e.target.value.length;this.$("#character-counter #current-count").text(e)},value:function(){return this.$(".js-text-area").val().trim()}}),i=0,Pl=1,Il=2,El=PicassoWebServices.Labels.PublishDialog,wl=/.*my.*\.site.com.*/g,Ll=Backbone.View.extend({className:"cb-PublishDlg",_template:_.template('\n        <div class="slds-modal__header">\n            <h2 class="slds-text-heading_medium js-pub-title">'.concat(El.CommPublishTitle,'</h2>\n        </div>\n        <div class="cb-PublishDlg-main cb-PublishDlg-content slds-modal__content slds-p-around_x-large js-pub-main-content js-pub-screen">\n            <div class="cb-PublishDlg-mainText js-pub-main-text">').concat(El.CommPublishContent,'</div>\n        </div>\n        <div class="cb-PublishDlg-progress cb-PublishDlg-content slds-modal__content slds-p-around_x-large js-pub-publishing-indicator js-pub-screen">\n            <img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="cb-PublishDlg-progressIcon"/>\n            <span class="cb-PublishDlg-progressText">').concat(El.CommPublishing,'</span>\n        </div>\n        <div class="cb-PublishDlg-success cb-PublishDlg-content slds-modal__content slds-p-around_x-large js-pub-success-message js-pub-screen">\n            <img src="/sfsites/assets/Images/publishConfirmation.png" class="cb-PublishDlg-success-image" />\n            <span class="cb-PublishDlg-successText test-pub-success-text">').concat(El.CommPublishAllSuccess,'</span>\n        </div>\n        <div class="cb-PublishDlg-error cb-PublishDlg-content slds-modal__content slds-p-around_x-large js-pub-error-message js-pub-screen"></div>\n        <div class="slds-modal__footer js-pub-footer">\n            <button class="slds-button slds-button_neutral js-close">').concat(PicassoWebServices.Labels.PicassoDialog.Cancel,'</button>\n            <button class="slds-button slds-button_brand js-publish">').concat(El.Publish,"</button>\n        </div>").trim()),_addCustomDomainTemplate:_.template('\n        <div class="slds-modal__header">\n            <h2 class="slds-text-heading_medium">'.concat(El.CommPublishCustomDomainPromptTitle,'</h2>\n        </div>\n        <div class="cb-PublishDlg-content slds-modal__content slds-p-around_x-large">\n            <div class="cb-PublishDlg-customDomainText js-custom-domain-text"></div>\n            <div>').concat(El.CommPublishCustomDomainPromptHelp,'</div>\n        </div>\n        <div class="slds-modal__footer">\n            <button class="slds-button slds-button_neutral js-close">').concat(PicassoWebServices.Labels.PicassoDialog.Cancel,'</button>\n            <button class="slds-button slds-button_brand cb-PublishDlg-newWindowButton js-open-setup-domains">').concat(El.CommPublishCustomDomainPromptAction,"</button>\n        </div>").trim()),_siteUrlTemplate:_.template('\n        <div class="cb-PublishDlg-publishToUrl test-pub-to-url">{{= publishToUrlLabel }}</div>\n        <div class="cb-PublishDlg-siteUrlContainer slds-p-around--medium js-site-url-container">\n            <div class="cb-PublishDlg-siteUrl">\n                '.concat(D.iconWithAlt({svgClassName:"cb-PublishDlg-siteUrlIcon slds-icon_x-small slds-icon-text-default",icon:"world",label:"URL"}),'\n                <span class="cb-PublishDlg-siteUrlText test-pub-site-url-text">{{= siteUrl }}</span>\n            </div>\n        </div>').trim()),_defaultCdnDomainHtml:'<div class="cb-PublishDlg-defaultCdnDomainInfo test-pub-default-cdn-info">'.concat(El.CommPublishDefaultCdnDomainText,"</div>"),_useDefaultCdnDomainHtml:'<div class="cb-PublishDlg-useDefaultCdnDomainInfo test-pub-use-default-cdn-info">'.concat(El.CommPublishUseDefaultCdnDomainText,"</div>"),_changeDescriptionHtml:'<div class="cb-PublishDlg-changeDescription js-pub-change-description"></div>',publishState:i,events:{"click .js-close":"_close","click .js-publish":"_publish","click .js-open-setup-domains":"_openSetupDomains"},initialize:function(){this.listenTo(I.event,"state:site-published",this._handlePublishSuccess),this.listenTo(I.event,"state:publish-error",this._handlePublishError),this.listenTo(I.event,"state:publish-warning",this._handlePublishWarning)},render:function(){return this._renderContent(),this},_renderContent:function(){var t=this;I.AccessControl(P.PERMISSIONS.MRT_PUBLISH)?E.hasCloudflareDomainPromise().done(function(e){e.hasCloudflareDomain?t._showPublishDialog():t._showAddCustomDomainPrompt()}):this._showPublishDialog()},_showPublishDialog:function(){var e=E.getSite().get("isActive"),t=new String(E.getSite().get("communityLiveSiteUrl"));this.$el.html(this._template()),this.$(".js-pub-main-content").prepend(this._siteUrlTemplate({siteUrl:t?t.replace(/^https?:\/\//,""):"",publishToUrlLabel:e?El.CommPublishToUrl:El.Publish})),this._shouldShowDefaultCdnDomainInfo(t)?this.$(".js-pub-main-text").before(this._defaultCdnDomainHtml):t.includes("force.com")&&this.$(".js-pub-main-text").after(this._useDefaultCdnDomainHtml),this._addChangeDescriptionTextArea(),this.$(".js-pub-screen").hide(),this.$(".js-pub-main-content").show(),setTimeout(function(){this.$(".js-publish").focus()})},_addChangeDescriptionTextArea:function(){this.$(".js-pub-main-text").before(this._changeDescriptionHtml),this.changeDescriptionTextArea=new Tl({id:"pubishDescription",label:El.CommPublishChangeDescriptionLabel,labelTooltip:El.CommPublishChangeDescriptionLabelTooltip,placeholderText:El.CommPublishChangeDescriptionPlaceholder,maxLength:200}),this.$(".js-pub-change-description").append(this.changeDescriptionTextArea.render().el)},_showAddCustomDomainPrompt:function(){this.$el.html(this._addCustomDomainTemplate()),this.$(".js-custom-domain-text").html(El.CommPublishCustomDomainPromptContent)},_showWarningMessage:function(e){var t=this.$(".js-pub-error-message");this.$(".js-pub-screen").hide(),this.$(".js-pub-footer").hide(),t.html(e),t.show()},_publish:function(){var e;this.publishState===Il?this._close():this.publishState!==Pl&&(e=(e=this.changeDescriptionTextArea.value())?El.CommPublishChangeDescription.replace("{0}",e):El.CommPublishNote.replace("{0}",I.getAppState().get("currentSite").get("name")).replace("{1}",Date()),this.$(".js-pub-screen").hide(),this.$(".js-pub-publishing-indicator").show(),this.$(".js-pub-title").text(El.Publishing),this.publishState=Pl,this.$(".js-pub-footer").hide(),I.event.trigger("action:publish-site",{note:e}))},_openSetupDomains:function(){window.open(E.getSite().get("domainsUrl"),"_blank"),this._close()},_close:function(){A.closeDialog()},_handlePublishSuccess:function(){var e=this.$(".js-publish");this.$(".js-pub-screen").hide(),this.$(".js-pub-success-message").show(),this.publishState=Il,e.html(El.GotIt).show(),this.$(".js-close").hide(),this.$(".js-pub-footer").show()},_handlePublishWarning:function(e){this._showWarningMessage(e)},_handlePublishError:function(e){this._close(),A.sldsPromptAlert({content:e.PublishErrorContent,title:e.PublishErrorTitle,className:"publishErrorDialog"})},_shouldShowDefaultCdnDomainInfo:function(e){return I.AccessControl(P.PERMISSIONS.IS_DEFAULT_CDN_ENABLED)&&I.AccessControl(P.PERMISSIONS.IS_ENHANCED_DOMAINS_ENABLED)&&e.match(wl)}}),Dl=PicassoWebServices.Labels.PublishDialog,Al=Backbone.View.extend({tagName:"div",className:"cb-SiteActions slds-border_left",events:{"click .js-publish-button":"_publish"},initialize:function(){this.publishButtonOptions={text:'<span class="icon-publish-cloud hide-desktop"></span><span class="hide-mobile">'+Dl.Publish+'</span><span class="slds-assistive-text">'+Dl.Publish+"</span>",className:"cb-SiteActions-publish slds-button slds-button_neutral js-publish-button",title:Dl.Publish,attributes:{"data-toggle":"tooltip","data-placement":"bottom"}},this.render()},render:function(){return this.$el.append(new Cl(this.publishButtonOptions).el),this.$('[data-toggle="tooltip"]').tooltip(),this},_publish:function(){A.showDialog(new Ll,{className:"slds-vex-theme",contentClassName:"cb-Dialog js-dialog cb-PublishDlg-modal"})}}),kl="action:set-active-language",Nl="state:base-language-updated",xl="state:site-language-active-updated",Rl=new ot,jl=new lt;function Bl(e){var t="";return e.LanguageCountryCode&&(t="_"+e.LanguageCountryCode),b.escape(e.LanguageCode+t)}function Ol(e,n){var i;return b.each(e,function(e,t){e.ComponentID===n&&(i=t)}),i}ve(function(e){e.Languages&&(nl=e.Languages.Languages)}),g.getLanguageContainerModel=function(){return Rl},g.getSiteLanguageCollection=function(){return jl},g.getBaseLanguage=function(){var e=nl.BaseLanguageCode.split("_");return{Name:nl.BaseLanguageLabel,LanguageLabel:nl.BaseLanguageLabel,LanguageCode:e[0],LanguageCountryCode:1<e.length?e[1]:"",LanguageFullCode:nl.BaseLanguageCode,ComponentID:P.LANGUAGES.BASE_LANG_ID}},g.getSiteLanguages=function(){return nl.List},g.getSiteLanguageByCode=function(t){return b.find(g.getSiteLanguages(),function(e){return Bl(e)===t})},g.getSiteLanguageById=function(t){return b.find(g.getSiteLanguages(),function(e){return e.ComponentID===t})},g.getAvailableLanguageByCode=function(t){return b.find(g.getAvailableLanguages(),function(e){return Bl(e)===t})},g.getActiveSiteLanguages=function(){var t=[];return nl.List.forEach(function(e){e.LanguageActive&&t.push(e)}),t},g.getSiteLanguageFullCode=Bl,g.getAvailableLanguagesPromise=function(){var t=T.Deferred();return il?t.resolve(il):PicassoWebServices.Language.GetAvailableLanguages(function(e){il=b.chain(e.Languages).sortBy("Name").map(function(e){return{Name:e.Name,LanguageCountryCode:e.LanguageCountryCode,LanguageCode:e.LanguageCode,LanguageFullCode:Bl(e),LanguageLabel:(n=(t=e).Name,t.LanguageCountryCode&&(n+=" (".concat(t.LanguageCountryCode,")")),n),IsRecommendedLanguage:e.IsRecommendedLanguage};var t,n}).value(),sl=new Map,il.forEach(function(e){sl.set(e.LanguageFullCode,e)}),t.resolve(il)}),t.promise()},g.getAvailableLanguages=function(){return il},g.isLanguageEnabled=function(e){return sl.has(e)},g.getActiveLanguage=function(){return b.find(nl.List,function(e){return e.ComponentID===nl.ActiveLanguageId})||g.getBaseLanguage()},I.event.on("action:update-base-language",function(t){var n=t.BaseLanguageCode,i=t.BaseLanguageLabel;PicassoWebServices.ManageSiteCommon.SetComponentProperties(nl.LanguageContainerId,{BaseLanguageCode:n,BaseLanguageLabel:i},nl.LanguageContainerId,function(e){nl.BaseLanguageCode=n,nl.BaseLanguageLabel=i,I.event.trigger(kl,{id:P.LANGUAGES.BASE_LANG_ID,shouldReopenSettingsPanelAfterIframeReloads:!0}),I.event.trigger(Nl,nl.BaseLanguageLabel),t.successCallback&&t.successCallback()})}),I.event.on("action:update-base-language-label",function(t){var n=t.successCallback();PicassoWebServices.ManageSiteCommon.SetComponentProperties(nl.LanguageContainerId,t,nl.LanguageContainerId,function(e){nl.BaseLanguageLabel=t.BaseLanguageLabel,I.event.trigger("state:base-language-label-updated",nl.BaseLanguageLabel),n&&n()})}),I.event.on("action:remove-site-language",function(t){PicassoWebServices.Language.RemoveLanguage(t.id,function(e){e.Languages?(nl=e.Languages,I.event.trigger("state:site-language-removed",t.id),t.successCallback&&t.successCallback()):t.errorCallback&&t.errorCallback()})}),I.event.on(kl,function(e){var t=e.id,n=e.successCallback,i=e.errorCallback,s=e.shouldReopenSettingsPanelAfterIframeReloads;PicassoWebServices.Language.SetActiveLanguageId(t,"",function(e){e.success?(nl=e.Languages.Languages,y.processJSONResponse(e),I.event.trigger("state:active-language-updated",{shouldReopenSettingsPanelAfterIframeReloads:s}),n&&n()):i&&i()})}),I.event.on("action:move-site-language",function(i){var e=nl.LanguageContainerId;PicassoWebServices.ManageSiteCommon.MoveItem(i.itemId,e,i.insertBeforeId,null,null,e,e,function(e){var t,n;e&&e.error?i.errorCallback&&i.errorCallback():(t=Ol(e=nl.List,i.itemId),t=e.splice(t,1),n=i.insertBeforeId?Ol(e,i.insertBeforeId):e.length,e.splice(n,0,t[0]),nl.List=e,I.event.trigger("state:site-language-moved"))})}),I.event.on("action:update-site-language-metadata",function(i,s){var e=nl.LanguageContainerId;PicassoWebServices.ManageSiteCommon.SetComponentProperties(i,s,e,function(e){var t,n=Ol(nl.List,i);for(t in s)s.hasOwnProperty(t)&&(nl.List[n][t]=s[t]);s.hasOwnProperty("LanguageLabel")?I.event.trigger("state:site-language-display-label-updated",{id:i,newLabel:s.LanguageLabel}):s.hasOwnProperty("LanguageActive")&&I.event.trigger(xl,{shouldReopenSettingsPanelAfterIframeReloads:!0})})}),I.event.on("action:set-site-language-active-metadata",function(n,i){var s=i.isLanguageActive;PicassoWebServices.Language.SetLanguageActive(n,s,function(e){var t=Ol(nl.List,n);nl.List[t].LanguageActive=s,!1===i.isLanguageActive&&e.Languages.List.forEach(function(e){var t=Ol(nl.List,e.ComponentID);nl.List[t].FallbackLanguageID=e.FallbackLanguageID}),I.event.trigger(xl,{shouldReopenSettingsPanelAfterIframeReloads:!0})})}),I.event.on("action:upsert-site-languages",function(e){var t=e.languages,n=e.successCallback;PicassoWebServices.Language.UpsertLanguages(t,function(e){e.Languages&&(nl=e.Languages,I.event.trigger("state:site-languages-upserted"),n)&&n()})}),I.event.on("action:change-default-language",function(t){PicassoWebServices.Language.ChangeDefaultLanguage(t.newDefaultLanguageAndCountryCode,function(e){e.Languages&&(nl=e.Languages,t.successCallback&&t.successCallback(),I.event.trigger(Nl))})}),I.event.on("action:export-site-translations",function(e){var t=e.languages.toString(),n=e.successCallback,i=e.errorCallback;PicassoWebServices.Language.ExportLanguages(t,function(e){e.success?n&&n():i&&i(e.ErrorCode)})});var Ml=Backbone.View.extend({tagName:"div",className:"slds-dropdown-trigger cb-LanguagePicker js-dropdown-trigger js-language-picker slds-border_left",menuDropdown:_.template("".concat(D.buttonIcon({buttonClassName:"slds-button_neutral js-language-button",svgClassName:"cb-LanguagePicker-triggerIcon",label:"".concat(PicassoWebServices.Labels.Languages.LanguageTitle),icon:"world"}),'\n        <div class="slds-dropdown js-dropdown">\n            <ul class="dropdown__list js-dropdown-menu" role="menu">\n                <li><ul class="cb-LanguagePicker-dropdownContent js-dropdown-content"></ul></li>\n            </ul>\n        </div>').trim()),templateAddMoreLink:_.template('<li class="slds-dropdown__item slds-has-divider--top-space"><a href="javascript:void(0);" class="js-add-more-languages">{{=title }}</a></li>'),templateHeaderItem:_.template('<li class="slds-dropdown__item slds-truncate menu__header"><span>'+PicassoWebServices.Labels.Languages.LanguageTitle+"</span></li>"),templateLanguageItem:_.template('<li class="slds-dropdown__item">{{ if(LanguageCountryCode) { }}<a href="javascript:void(0)" class="cb-LanguagePicker-languageItem slds-truncate js-language-link" data-lang-code="{{- LanguageCode }}_{{- LanguageCountryCode}}" data-lang-value="{{= ComponentID }}">{{- LanguageLabel }}</a>{{ } else { }}<a href="javascript:void(0)" class="cb-LanguagePicker-languageItem slds-truncate js-language-link" data-lang-code="{{- LanguageCode }}" data-lang-value="{{= ComponentID }}">{{- LanguageLabel }}</a>{{ } }}</li>'),events:{"click .js-language-link:not(.is-selected)":"onClickLanguage","mouseover .js-language-button":"onMouseOverLanguageButton","click .js-add-more-languages":"onAddMoreLanguages"},initialize:function(){this.listenTo(I.event,"state:base-language-label-updated",this._updateBaseLanguageLabel);this.listenTo(I.event,["state:base-language-updated","state:site-language-removed","state:site-language-moved","state:site-language-display-label-updated","state:site-languages-upserted","state:site-language-added","state:active-language-updated"].join(" "),this._handleLanguageUpdate),this.render()},onClickLanguage:function(e){e.preventDefault();e=T(e.target).attr("data-lang-value");I.event.trigger("action:set-active-language",{id:e,errorCallback:function(){A.sldsPromptAlert({title:PicassoWebServices.Labels.PicassoDialog.Error,content:PicassoWebServices.Labels.Languages.SetActiveError})}}),this._hidePicker()},onMouseOverLanguageButton:function(){this.$(".js-dropdown").removeAttr("style")},onAddMoreLanguages:function(e){this._hidePicker(),j.getAppEvent().trigger("open-app-nav",P.LEFT_PANEL.SETTINGS),j.getAppEvent().trigger("settings-show-section","languages")},templateLanguageItems:function(e){var t=this,n="";return e.forEach(function(e){n+=t.templateLanguageItem(e)}),n},render:function(){var e,t=g.getSiteLanguages();return 0===t.length?this.$el.empty().hide():(this.$el.html(this.menuDropdown()),t=((e=this.$(".js-dropdown-content")).append(this.templateHeaderItem()),this._baselang=g.getBaseLanguage(),e.append(this.templateLanguageItem(this._baselang)),e.append(this.templateLanguageItems(t)),I.AccessControl(P.PERMISSIONS.LANGUAGE_EDIT)&&e.append(this.templateAddMoreLink({title:PicassoWebServices.Labels.Languages.AddLanguage})),g.getActiveLanguage()),this._activeLanguageId=t.ComponentID,this.$('.js-language-link[data-lang-value="'+this._activeLanguageId+'"]').addClass("language-selected"),this._hidePicker(),this.$el.show()),this},_updateBaseLanguageLabel:function(e){this.$('.js-language-link[data-lang-value="'+g.getBaseLanguage().ComponentID+'"]').text(_.escape(e))},_handleLanguageUpdate:function(){this.render()},_hidePicker:function(){this.$(".js-dropdown").css("visibility","hidden")}}),Vl=Backbone.View.extend({tagName:"div",className:"cb-BackToBuilder slds-border_left",initialize:function(){this.backToBuilderButtonOptions={text:'<span class="js-back-to-builder-label">'+PicassoWebServices.Labels.CommunityBuilder.BackToBuilder+'</span><span class="slds-assistive-text">'+PicassoWebServices.Labels.CommunityBuilder.BackToBuilder+"</span>",className:"slds-button js-back-to-builder-button cb-BackToBuilderButton",events:{click:this._backToBuilder.bind(this)},title:PicassoWebServices.Labels.CommunityBuilder.BackToBuilder,attributes:{"data-toggle":"tooltip","data-placement":"bottom-right"}},this.listenTo(j.getAppEvent(),"workspace-preview-change",this._updatePreviousWorkspace),this.render()},render:function(){return this.$el.append(new Cl(this.backToBuilderButtonOptions).el),this.$('[data-toggle="tooltip"]').tooltip(),this},_updatePreviousWorkspace:function(e){this.previousWorkspace=e},_backToBuilder:function(e){I.getAppState().get("workspaceMode")===P.workspace.PREVIEW&&(I.getAppState().set("workspaceMode",this.previousWorkspace),e.stopPropagation())}}),$l=PicassoWebServices.Labels.GuardrailsHelpMenu,Ul=Backbone.View.extend({_count:0,_muted:!1,_mutePreference:void 0,helpMenuItem:_.template('<li class="{{= muted }} slds-dropdown__item">\n            <a href="javascript:void(0)" class="{{= id }}">\n                <p class="slds-truncate">\n                    {{= label }}\n                </p>\n                {{ if( showCount ) { }}\n                    <div class="guardrails-badge-count slds-badge slds-badge_inverse">\n                        {{= count }}\n                    </div>\n                {{ } }}\n            </a>\n        </li>'),perfMenuItem:_.template('<li class="{{= muted }} slds-dropdown__item">\n            <a href="javascript:void(0)" class="{{= id }}">\n                <p class="slds-truncate">\n                    {{= label }}\n                </p>\n                {{ if( showPerfBadge ) { }}\n                    <div class="badge perf-menu-icon">\n                        {{ if( isModerate ) { }}\n                        <span class="slds-icon_container">\n                            '.concat(D.icon({icon:"warning",sprite:"utility",svgClassName:"slds-icon_x-small slds-icon-text-warning"}),'\n                        </span>\n                        {{ } }}\n                        {{ if( isPoor ) { }}\n                        <span class="slds-icon_container">\n                            ').concat(D.icon({icon:"error",sprite:"utility",svgClassName:"slds-icon_x-small slds-icon-text-error"}),"\n                        </span>\n                        {{ } }}\n                    </div>\n                {{ } }}\n            </a>\n        </li>")),initialize:function(){this._mutePreference=new We("communities-builder")},render:function(){var i=this,e=(this._muted=this._mutePreference.isMuted(),[]);return I.AccessControl(P.PERMISSIONS.SITES_PREDICTION_SERVICE_ENABLED)&&e.push({type:"perf",muted:"",id:"js-guardrail-view-perfPanel",label:$l.Analyze,showPerfBadge:this._perfResults&&(this._perfResults.isPoorPerf||this._perfResults.isModeratePerf),isPoor:this._perfResults&&this._perfResults.isPoorPerf,isModerate:this._perfResults&&this._perfResults.isModeratePerf}),e.push({type:"tips",muted:this._getMutedClasses(this._muted),id:"js-guardrail-view-tips",label:$l.View,showCount:0<this._count,count:this._count}),e.push({type:"tips",muted:"",id:"js-guardrail-mute-tips",label:this._muted?$l.Unmute:$l.Mute,showCount:!1,count:this._count}),e.forEach(function(e){var t,n=i.$el.find(".".concat(e.id));"tips"===e.type?t=i.helpMenuItem(e):"perf"===e.type&&(t=i.perfMenuItem(e)),0<n.length?n.parent().replaceWith(t):i.$el.append(t)}),this},events:{"click .js-guardrail-mute-tips":"_toggleTips","click .js-guardrail-view-tips":"_viewTips","click .js-guardrail-view-perfPanel":"_viewPerfPanel"},_toggleTips:function(e){var t=this._mutePreference.isMuted();this._mutePreference.toggleMute(!t),this._muted=!t,this._muted&&o.trigger("mute-guardrails"),this.$el.trigger("close-dropdown"),this.$el.trigger($.Event("update-analyzer-count",{count:this._count,muted:this._muted})),this.render()},_viewTips:function(e){o.trigger("show-guardrails-tips"),this.$el.trigger("close-dropdown")},_viewPerfPanel:function(e){o.trigger("show-guardrails-perfPanel"),this.$el.trigger("close-dropdown")},_getMutedClasses:function(e){return e?"guardrails-is-disabled":""},updateCount:function(e){this._count=e,this.render()},updatePerfResult:function(e){this._perfResults=e,this.render()}}),Wl=PicassoWebServices.Labels.CommunityBuilder,n=PicassoWebServices.Labels.ManageSite,Fl=Backbone.View.extend({className:" cb-AppHeaderHelp slds-dropdown-trigger slds-dropdown-trigger_click js-app-header-help slds-border_left",events:{"click .js-help-button":"_toggleDropdownMenu","click .js-help-onboarding":"_goToOnBoardingTour","click .js-help-whatsnew":"_goToWhatsNewNotification","click .js-help-dynamiclayoutonboarding":"_goToDynamicLayoutTour","click .js-help-helpwindow":"_goToHelp","update-guardrails-menu":"_updateGuardrailsMenu","update-analyzer-count":"_updateAnalyzerCount","update-guardrails-perfMenu":"_updateGuardrailsPerfMenu"},helpDropdown:_.template('<button class="slds-button slds-button_icon slds-button_neutral js-help-button" title="'.concat(n.Help,'">\n            <svg class="slds-button__icon cb-AppHeaderHelp-triggerIcon" aria-hidden="true">\n                <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/action-sprite/svg/symbols.svg#question_post_action"></use>\n            </svg>\n            <div class="js-analyzer-count"></div>\n            <span class="slds-assistive-text">').concat(n.Help,'</span>\n        </button>\n        <div class="slds-dropdown slds-dropdown_{{= alignment }} js-help-dropdown">\n            <ul class="dropdown__list js-help-dropdown-menu role="menu">\n                <li class="slds-dropdown__item slds-truncate menu__header">\n                    <span>').concat(n.Help,"</span>\n                </li>\n            </ul>\n        </div>").trim()),helpMenuItem:_.template('<li class="slds-dropdown__item"><a href="javascript:void(0)" class="{{= id }}"><p class="slds-truncate">{{= label }}</p></a></li>'),analyzerCount:_.template('<div class="badge analyzer-notification-badge helpMenuNotificationCount">\n            {{ if( showCount ) { }}\n                <div class="count slds-badge slds-badge_inverse">\n                    {{= count }}\n                </div>\n            {{ } }}\n        </div>'),initialize:function(){this.render(),T(document).click(function(e){0===this.$el.has(e.target).length&&this._closeDropdownMenu()}.bind(this)),window.addEventListener("blur",function(){this._closeDropdownMenu()}.bind(this)),this.listenTo(I.event,"state:page-change-success",this._handleRouteChangeSuccess)},render:function(){var e,t=this,n=(this.$el.html(this.helpDropdown({alignment:I.AccessControl(P.PERMISSIONS.PAGE_EDIT)?"left":"right"})),this.$(".js-help-dropdown-menu"));[{id:"js-help-onboarding",label:Wl.ShowGuidedTour,isVisible:I.AccessControl(P.PERMISSIONS.HELP_GUIDED_TOUR)},{id:"js-help-whatsnew",label:Wl.WhatsNew,isVisible:I.AccessControl(P.PERMISSIONS.HELP_WHATS_NEW)},{id:"js-help-dynamiclayoutonboarding",label:Wl.DynamicLayoutTour,isVisible:this._shouldShowDynamicLayoutTour()},{id:"js-help-helpwindow",label:Wl.Help,isVisible:!!E.getSite().get("helpMenuUrl")}].filter(function(e){return e.isVisible}).forEach(function(e){n.append(t.helpMenuItem(e))}),I.AccessControl(P.PERMISSIONS.IS_GUARDRAILS_ENABLED)&&(n.append('<li class="slds-has-divider_top-space" role="separator"></li>'),e=new Ul({el:n}),this._guardrailsHelpMenu&&(e._count=this._guardrailsHelpMenu._count,e._muted=this._guardrailsHelpMenu._muted,I.AccessControl(P.PERMISSIONS.SITES_PREDICTION_SERVICE_ENABLED))&&(e._perfResults=this._guardrailsHelpMenu._perfResults),this._guardrailsHelpMenu=e,this._guardrailsHelpMenu.render(),this._guardrailsHelpMenu.$el.on("close-dropdown",function(){t._closeDropdownMenu()}),this.$(".js-analyzer-count").html(this.analyzerCount({showCount:0<this._guardrailsHelpMenu._count,count:this._guardrailsHelpMenu._count})))},_handleRouteChangeSuccess:function(){this.render()},_goToOnBoardingTour:function(){j.getAppEvent().trigger("start-tour"),this._closeDropdownMenu()},_goToDynamicLayoutTour:function(){j.getAppEvent().trigger("dynamic-layout-tour-selected"),this._closeDropdownMenu()},_goToHelp:function(){var e=E.getSite().get("helpMenuUrl");e&&window.open(e,"","width=700,height=600,resizable=yes,toolbar=yes,status=no,scrollbars=yes,menubar=yes,directories=no,location=no,dependant=no"),this._closeDropdownMenu()},_goToWhatsNewNotification:function(){j.getAppEvent().trigger("show-notification-whats-new"),this._closeDropdownMenu()},_toggleDropdownMenu:function(){this.$el.toggleClass("slds-is-open")},_closeDropdownMenu:function(){this.$el.removeClass("slds-is-open")},_shouldShowDynamicLayoutTour:function(){return k.hasDynamicLayout(I.getAppState().getCurrentViewId())&&!E.getSite().isWebApp()},_updateGuardrailsMenu:function(e){this._guardrailsHelpMenu&&null!=e.count&&null!=e.count&&(this._guardrailsHelpMenu.updateCount(e.count),this.$(".js-analyzer-count").html(this.analyzerCount({showCount:0<this._guardrailsHelpMenu._count,count:this._guardrailsHelpMenu._count})))},_updateAnalyzerCount:function(e){this._guardrailsHelpMenu&&null!=e.count&&null!=e.count&&null!=e.muted&&null!=e.muted&&this.$(".js-analyzer-count").html(this.analyzerCount({showCount:0<e.count,count:e.count}))},_updateGuardrailsPerfMenu:function(e){this._guardrailsHelpMenu&&null!=e.perfResults&&null!=e.perfResults&&I.AccessControl(P.PERMISSIONS.SITES_PREDICTION_SERVICE_ENABLED)&&this._guardrailsHelpMenu.updatePerfResult(e.perfResults)}}),Hl=P.FADE_TIME,Gl=Backbone.View.extend({tagName:"div",className:"cb-Header js-app-header",attributes:{tabindex:-1},templateHeaderHtml:'<ul class="cb-Header-menuList left js-header-left">\n            <li class="builder-menu js-head-menu-container"></li>\n            <li class="pages-menu nav-menu"></li>\n            <li class="page-variations-menu nav-menu"></li>\n            <li class="refresh-page"></li>\n            <li class="copilot-panel-trigger"></li>\n        </ul>\n        <ul class="cb-Header-menuList right js-header-right">\n            <li class="undo-redo"></li>\n            <li class="preview-new-tab"></li>\n            <li class="resolution-picker"></li>\n            <li class="language"></li>\n            <li class="help"></li>\n            <li class="preview"></li>\n            <li class="publish"></li>\n            <li class="back-to-builder"></li>\n        </ul>',defaults:{},initialize:function(e){this.defaults=I.AccessControl(P.PERMISSIONS.PAGE_EDIT)?{showUndoRedo:I.AccessControl(P.PERMISSIONS.UNDO_REDO),showResolutionPicker:!0,showBookmarks:!0,showPreview:!0,showSiteActions:I.AccessControl(P.PERMISSIONS.PUBLISH),showLanguages:!0,showHelp:!0,showPreviewNewTab:!1,showBackToBuilder:!1}:{showUndoRedo:!1,showResolutionPicker:!0,showBookmarks:!0,showPreview:!1,showSiteActions:!1,showLanguages:!0,showHelp:!0,showPreviewNewTab:!0,showBackToBuilder:!1},this._parentToViewMap={},this._parentToViewMap[".pages-menu"]=new dl,I.getAppState().supportViewCrud()&&(this._parentToViewMap[".page-variations-menu"]=new pl),this._parentToViewMap[".refresh-page"]=new hl,I.AccessControl(P.PERMISSIONS.EINSTEIN_COPILOT)&&(this._parentToViewMap[".copilot-panel-trigger"]=new ml),this._parentToViewMap[".preview-new-tab"]=new bl,this._parentToViewMap[".undo-redo"]=new fl,this._parentToViewMap[".resolution-picker"]=new Sl({collection:gt}),this._parentToViewMap[".preview"]=new yl,this.defaults.showSiteActions&&(this._parentToViewMap[".publish"]=new Al),this._parentToViewMap[".language"]=new Ml,this._parentToViewMap[".back-to-builder"]=new Vl,this._parentToViewMap[".help"]=new Fl},show:function(e){var t={},n={},e=(e&&(t={showUndoRedo:!1,showBackToBuilder:!0,showSiteActions:!1,showPreview:!1,showPreviewNewTab:!0,showHelp:!1}),_.extend(n,this.defaults,t),this._getClassStatusMap(n));_.each(e,function(e,t){t=T("."+t);e?this._animateExpand(t):this._animateCollapse(t)}.bind(this)),n.showBookmarks?(this.$(".pages-menu").fadeIn(Hl),this.$(".page-variations-menu").fadeIn(Hl)):(this.$(".pages-menu").fadeOut(Hl),this.$(".page-variations-menu").fadeOut(Hl))},render:function(){var n=this,e=(n.$el.html(this.templateHeaderHtml),this._getClassStatusMap(this.defaults)),e=(_.each(e,function(e,t){e||this.$("."+t).hide()}.bind(this)),$P.orgHasCommunityWorkspaces?["siteforceBuilder:cmcHubMenuWrapper",{networkIdFromContext:I.getAppState().getNetworkId(),activeWorkspace:{devName:"builder",displayLabel:""}}]:["siteforceBuilder:siteLinkDropdown",{siteName:I.getAppState().get("currentSite").get("name"),class:"slds-dropdown-trigger icon-down js-app-header-sitelink"}]);return this._createAuraComponents([e],function(e){n._render(e,n.$(".builder-menu")),_.each(n._parentToViewMap,function(e,t){n._render(e,n.$(t))})}),n},_getClassStatusMap:function(e){return{"undo-redo":e.showUndoRedo,"resolution-picker":e.showResolutionPicker,preview:e.showPreview,publish:e.showSiteActions,help:e.showHelp,language:e.showLanguages,"preview-new-tab":e.showPreviewNewTab,"back-to-builder":e.showBackToBuilder}},_createAuraComponents:function(e,t){$P.auraRun(function(){$A.createComponents(e,function(e){t.apply(this,e)})})},_render:function(e,t){$A.util.isComponent(e)?($A.render(e,t[0]),$A.afterRender(e)):t.html(e.el)},_animateCollapse:function(e){"none"!==e.css("display")&&e.css("overflow","hidden").css("white-space","nowrap").data("width",e.width()).data("prop-width",e[0].style.width).animate({width:0,opacity:0},{duration:Hl,queue:!1,complete:function(){e.hide()}})},_animateExpand:function(e){"none"===e.css("display")&&(void 0===e.data("width")&&e.fadeOut(0).show().data("width",e.width()).hide().data("prop-width",e[0].style.width).css({overflow:"hidden",whiteSpace:"nowrap",width:0}),e.show().animate({width:e.data("width")+"px",opacity:1},{duration:Hl,queue:!1,complete:function(){e.css({width:e.data("prop-width"),overflow:"visible",whiteSpace:"normal"}).data("width",e.width())}}))}}),zl=Backbone.View.extend({className:"cb-LeftPanel-container js-left-panel-container",template:_.template('<div class="cb-LeftPanel-header"><div class="cb-LeftPanel-headerTitleOption">{{ if (hasHeaderOptionView) { }}<div class="cb-LeftPanel-headerOption js-left-panel-header-option"></div>{{ } else { }}<div class="cb-LeftPanel-headerTitle slds-truncate slds-text-heading_small" title="{{=title}}">{{=title}}</div>{{ } }}</div><div class="cb-LeftPanel-headerCloseButton"><button class="slds-button slds-button_icon js-close" title="'+PicassoWebServices.Labels.AppNav.Close+'"><svg aria-hidden="true" class="slds-icon cb-LeftPanel-closeIcon"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#close"></use></svg><span class="slds-assistive-text">'+PicassoWebServices.Labels.AppNav.Close+'</span></button></div></div><div class="{{= isFixedHeight ? "cb-LeftPanel-fixedHeightView" : "cb-LeftPanel-dynamicHeightView"}}  js-left-panel-view"></div>'),events:{"click .js-close":function(){this.close(!0)}},initialize:function(e){this.options=e,this._view=e.view,this.listenTo(j.getAppEvent(),"close-left-panel",this.close),!0===this.options.closeOnComponentSelect&&this.listenTo(j.getAppEvent(),"select-aura-component",function(e){e.keepLHSOpen||this.close()}),!0===this.options.closeOnComponentDeselect&&this.listenTo(j.getAppEvent(),"unselect-aura-component",this.close),this.render()},render:function(){var e=this.options.headerOptionView;return this.$el.append(this.template({title:this.options.title,hasHeaderOptionView:!!e,isFixedHeight:this.options.isFixedHeight})),this.options.classNames&&this.$el.addClass(this.options.classNames),this.$(".js-left-panel-view").append(this._view.el),this._view.show(),e&&this.$(".js-left-panel-header-option").append(e.el),this},close:function(e){this.$el.is(":visible")&&(this.hide(),this.trigger("close",{isManualClose:e}))},show:function(e){this._view.show(),this.$el.fadeIn(P.FADE_TIME,e),this.$el.show(),this.$(".js-close").focus(),this.options.view._activeView&&this.options.view._activeView.trigger("state:left-panel-shown")},hide:function(){var e=this.options.headerOptionView;e&&e.hide&&e.hide(),this._view.hide(),this.$el.fadeOut(P.FADE_TIME),this.$el.hide()}}),Kl=Backbone.View.extend({className:"cb-ComponentPalettePanel js-component-palette",initialize:function(){var e=this;this._viewId=I.getAppState().getCurrentViewId(),this.listenTo(I.event,"state:page-change-success",this._handleRouteChangeSuccess),this.listenTo(I.event,"state:page-change-start",this._handlePageBookmarksChange),this.listenTo(I.event,"state:locker-service-enabled-state-updated",this._refresh),this.listenTo(I.event,"state:upgradeflows-loaded",this.render),j.getAppEvent().on("page:reload-component-palette",function(){e._refresh()}),this.render()},render:function(){var t,e=Qe.isAllUpgradeFlowsFetched();this.$el.html(D.spinner),e&&(t=this)._viewId&&$P.auraRun(function(){$A.createComponent("siteforceBuilder:communityBuilderComponentPalettePanel",{template:I.getAppState().getCurrentPageTemplate().getDevName(),view:h.getViews().get(t._viewId).get("ViewType"),params:{disableItems:!v.isLockerServiceEnabled(),tags:h.getRoutes().get(I.getAppState().getCurrentRouteId()).get("ConfigurationTags")}},function(e){t.$el.empty(),$A.render(e,t.el),$A.afterRender(e)})})},show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")},_handleRouteChangeSuccess:function(e){this._handleRefresh(e.viewId)},_handlePageBookmarksChange:function(e){e=e.viewId;this._handleRefresh(e)},_handleRefresh:function(e){this._viewId!==e&&e&&(this._viewId=e,this._refresh())},_refresh:function(){var e=this.$(".siteforceBuilderCommunityBuilderComponentPalettePanel");e[0]&&(e=$A.componentService.getAttributeProviderForElement(e[0]))&&e.destroy(),this.render()}}),hr=PicassoWebServices.Labels.ThemeEditor;var Yl=Backbone.View.extend({className:"cb-CurrentBrandingSet slds-text-color_weak slds-truncate slds-m-top_medium test-current-branding-set",_template:_.template("<span>"+hr.BrandingSet+'</span><span class="cb-CurrentBrandingSet-name js-current-branding-set-name" title="{{= name }}">{{= name }}</span>'),events:{"click .js-current-branding-set-name":"_onClickBrandingSetName"},initialize:function(e){this.listenTo(I.event,["state:preview-site-branding-set-updated","state:default-branding-set-updated","state:preview-scoped-branding-set-updated","state:branding-set-duplicated","state:branding-set-renamed","state:branding-set-deleted","state:branding-set-created"].join(" "),this.render)},render:function(){var e=l.getPreviewBrandingSet();return e&&(N.isBrandingSetEditorEnabled()&&1<l.getAllBrandingSets().length?this.$el.html(this._template({name:e.name})).show():this.$el.html("").hide(),this.$el.attr("data-id",e.id)),this},destroy:function(){this.remove()},_onClickBrandingSetName:function(){this.trigger("branding-set-name-clicked")}}),mr=PicassoWebServices.Labels.ThemeEditor;var ql=Backbone.View.extend({className:"cb-CurrentScopedBrandingSet slds-text-color_weak slds-wrap slds-m-top_medium test-current-branding-set",_template:_.template("\n        <span>\n            ".concat(mr.CurrentlyEditing,'\n        </span>\n        <span class="cb-CurrentScopedBrandingSet-name js-current-branding-set-name" title="{{= name }}">\n            {{= name }}\n        </span>').trim()),events:{"click .js-current-branding-set-name":"_onClickBrandingSetName"},initialize:function(e){e&&(this._brandingField=e.brandingField);this.listenTo(I.event,["state:preview-site-branding-set-updated","state:default-branding-set-updated","state:branding-set-duplicated","state:branding-set-renamed","state:branding-set-deleted","state:branding-set-created","state:preview-scoped-branding-set-updated"].join(" "),this.render)},render:function(){var e=l.getCurrentPreviewScopedBrandingSet()||l.getPreviewBrandingSet();return e&&(N.isBrandingSetEditorEnabled()&&1<l.getAllBrandingSets().length&&e.type===P.BRANDING_SET_TYPE.SCOPED?this.$el.html(this._template({name:e.name})).show():this.$el.html("").hide(),this.$el.attr("data-id",e.id)),this},destroy:function(){this.remove()},_onClickBrandingSetName:function(){this.trigger("branding-set-name-clicked")}}),Xl=Fe.Model.extend({initialize:function(e){},sync:function(e,t,n){}}),fr=PicassoWebServices.Labels.UploadDialog,Jl=Backbone.View.extend({className:"cb-FilePicker js-file-picker",largeVariantTemplate:_.template('<div class="js-file-picker-drop-region cb-FilePicker-dropRegion {{= filePickerClass }}">\n            <div class="cb-FilePicker-sectionUpperDiv {{= filePickerSectionClass }}">\n                <div>\n                    <i class="cb-FilePicker-uploadIcon icon-utility-upload"></i>\n                    <div class="cb-FilePicker-dropRegionDesc">{{=dragHereText}}</div>\n                    <div class="cb-FilePicker-seperatorDesc">'.concat(fr.OrSeperator,'</div>\n                </div>\n            </div>\n            <form class="js-form" name="uploadForm" action="{{=uploadUrl}}\n                {{ if (encodedImageSizeReductionFactor) { }}\n                {{= encodedImageSizeReductionFactor}}\n                {{ } }}\n                " method="POST" enctype="multipart/form-data">\n                <label class="cb-FilePicker-selectFileLabel">{{=selectFileText}}\n                    <input class="js-choose-file-btn cb-FilePicker-fileInput" type="file" name="file">\n                </label>\n                <input class="js-file-submit-btn cb-FilePicker-uploadButton" type="submit" value="').concat(fr.Upload,'">\n                <input type="hidden" name="{{= csrfTokenName }}" value="{{= csrfTokenValue }}">\n            </form>\n        </div>').trim()),smallVariantTemplate:_.template('<div class="slds-form-element">\n            <div class="slds-form-element__control">\n                <div class="slds-file-selector slds-file-selector_files">\n                    <div class="slds-file-selector__dropzone js-file-picker-drop-region">\n                        <form class="js-form" name="uploadForm" action="{{=uploadUrl}}\n                            {{ if (encodedImageSizeReductionFactor) { }}\n                            {{= encodedImageSizeReductionFactor}}\n                            {{ } }}\n                            \'" method="POST" enctype="multipart/form-data">\n                            <input type="file" class="slds-file-selector__input slds-assistive-text js-choose-file-btn" accept="{{= supportedFileExtensionsString }}" id="file-upload-input" aria-describedby="error" aria-labelledby="file-selector-label" />\n                            <label class="slds-file-selector__body" for="file-upload-input" id="file-selector-label">\n                                <span class="slds-button slds-button_neutral">\n                                    <svg class="slds-button__icon slds-button__icon_left" aria-hidden="true">\n                                        <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/action-sprite/svg/symbols.svg#upload"></use>\n                                    </svg>{{=selectFileText}}\n                                </span>\n                                <span class="slds-file-selector__text slds-medium-show">{{= dragHereText }}</span>\n                            </label>\n                            <input class="js-file-submit-btn cb-FilePicker-uploadButton" type="submit" value="'.concat(fr.Upload,'">\n                            <input type="hidden" name="{{= csrfTokenName }}" value="{{= csrfTokenValue }}">\n                        </form>\n                    </div>\n                </div>\n            </div>\n            <div class="slds-form-element__help cb-FilePicker-small-file-type-error js-file-type-error slds-hidden" id="error">{{= fileFormatNotSupportedMessage }}</div>\n        </div>').trim()),events:{"submit .js-form":"_onFormSubmit","change .js-choose-file-btn":"_onChooseFileChange","dragover .js-file-picker-drop-region":"_onDragEnter","dragleave .js-file-picker-drop-region":"_onDragLeave","drop .js-file-picker-drop-region":"_onDrop","load .js-upload-frame":"_onUploadFrameLoad"},initialize:function(e){this.options=e||{},this.options.variant=e.variant||null,this.options.title=e.title||null,this.options.filePickerSectionClass=e.filePickerSectionClass||null,this.options.logoImgUrl=e.logoImgUrl||null,this.options.encodedImageSizeReductionFactor=e.encodedImageSizeReductionFactor||null,this.options.overwriteFiles=e.overwriteFiles||null,this.options.csrfTokenName=$P.csrfTokenName,this.options.csrfTokenValue=$P.uploadCsrfToken,this.supportedFileExtensions=e.supportedFileExtensions||[],this.options.supportedFileExtensionsString=this._getSupportedFileExtensionString(),this.options.fileFormatNotSupportedMessage=e.fileFormatNotSupportedMessage,"function"==typeof e.uploadSuccessCallback&&(this._uploadSuccessCallback=e.uploadSuccessCallback),"function"==typeof e.uploadErrorCallback&&(this._uploadErrorCallback=e.uploadErrorCallback),"function"==typeof e.uploadCancelCallback&&(this._uploadCancelCallback=e.uploadCancelCallback),this.render()},render:function(){return this._isSmallVariant()?(this.$el.html(this.smallVariantTemplate(this.options)),this.$(".js-file-type-error").addClass("slds-hidden")):this.$el.html(this.largeVariantTemplate(this.options)),this},close:function(){this._uploadCancelCallback&&this._uploadCancelCallback(),this.remove()},destroy:function(){this._uploadCancelCallback&&this._uploadCancelCallback()},_getSupportedFileExtensionString:function(){var t=[];return this.supportedFileExtensions.forEach(function(e){t.push(".".concat(e))}),t.join()},_onFormSubmit:function(e){var t=this.$(".js-form"),n="upload-frame",i=T("<iframe></iframe>");i.addClass("js-upload-frame cb-FilePicker-uploadFrame"),i.attr("name",n),t.attr("target",n),t.append(i),i.on("load",this._onUploadFrameLoad.bind(this)),this._uploadStart()},_highlightDropRegion:function(e){this._isSmallVariant()?this.$(".js-file-picker-drop-region").toggleClass("slds-has-drag-over",e):this.$(".js-file-picker-drop-region").toggleClass("is-active",e)},_onDragEnter:function(e){e.preventDefault(),this._highlightDropRegion(!0)},_onDragLeave:function(e){e.preventDefault(),this._highlightDropRegion(!1)},_onDrop:function(e){e.preventDefault(),this._highlightDropRegion(!1);var t=e.dataTransfer||e.originalEvent&&e.originalEvent.dataTransfer,e=e.target.files||t&&t.files;e&&0<e.length&&(t=e[0],this._isValidFileType(t.name)?this._uploadFile(t):this._handleInvalidFileType())},_onUploadFrameLoad:function(){var e=this.$(".js-upload-frame").contents()[0].body,e=T(e).text();this._processUploadResponse(e)},_processUploadResponse:function(e){e=JSON.parse(e);e.hasOwnProperty("SUCCESS")&&("true"===e.SUCCESS?this._uploadSuccessCallback&&(this.options.closeDialog?(this._uploadSuccessCallback(e),A.closeDialog()):this._uploadSuccessCallback(e)):"false"===e.SUCCESS&&e.hasOwnProperty("ERROR_MESSAGE")&&(this.options.closeDialog?(this._uploadCompleted(),A.closeDialog(),this._displayError(e.ERROR_MESSAGE)):this._uploadErrorCallback&&this._uploadErrorCallback(e)))},_uploadFile:function(e){var t=this,n=(this._isSmallVariant()&&this.$(".js-file-type-error").addClass("slds-hidden"),this.options.uploadUrl+"&upload=a");this.options.encodedImageSizeReductionFactor&&(n+=this.options.encodedImageSizeReductionFactor),T.ajax({type:"POST",url:n,data:e,processData:!1,headers:{"x-upload-check":"draganddrop","content-type":"xhr_multipart/form-data","x-upload-file-name":encodeURIComponent(e.name),"x-upload-file-size":e.size}}).always(function(e){t._processUploadResponse(e)}),this._uploadStart()},_onChooseFileChange:function(){var e,t=this.$(".js-choose-file-btn");t.prop("files")&&0<t.prop("files").length&&(e=t.prop("files")[0],this._isValidFileType(e.name)?this._uploadFile(e):this._handleInvalidFileType(),t.val(""))},_isValidFileType:function(e){e=e.split(".").pop().toLowerCase();return-1!==T.inArray(e,this.supportedFileExtensions)},_handleInvalidFileType:function(){this._isSmallVariant()?this.$(".js-file-type-error").removeClass("slds-hidden"):this._displayError(this.options.fileFormatNotSupportedMessage)},_displayError:function(e){A.sldsAlert(e)},_uploadCompleted:function(){this.trigger("upload-completed")},_uploadStart:function(){this.trigger("upload-start")},_closeDialog:function(){A.closeDialog()},_isSmallVariant:function(){return this.options.variant&&this.options.variant===P.FILE_PICKER_VARIANT.SMALL}}),Ql=PicassoWebServices.Labels.ImagePickerDialog,Zl=["jpeg","jpg","png","gif","bmp","ico","svg"],ec=Backbone.View.extend({tagName:"div",className:"cb-ImagePicker",template:_.template('<h2 class="cb-Dialog-title">{{= title}}</h2><div class="cb-ImagePicker-content js-file-picker-content clearfix"><div class="js-progress-indicator cb-ImagePicker-progress"><div class="cb-ImagePicker-progressContent"><img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="cb-ImagePicker-progressContentIcon"></img><span class="cb-ImagePicker-progressContentDesc">'+PicassoWebServices.Labels.UploadDialog.Uploading+'</span></div></div>{{ if (logoImgUrl) { }}<div class="cb-ImagePicker-logoSection cb-ImagePicker-section"><div class="cb-ImagePicker-sectionUpperDiv"><div><img src="{{= logoImgUrl }}" class="cb-ImagePicker-logoThumbnail" title="" alt="{{= logoImgUrl }}"></div></div><label class="js-select-logo cb-ImagePicker-selectFileLabel">'+Ql.UseCompanyLogo+"</label></div>{{ } }}</div>"),events:{"click .js-select-logo":"_onSelectLogo"},initialize:function(e){var t=e.logoImgUrl||void 0,n=(this._filePickerOpts=_.extend({dragHereText:Ql.DragImageHere,selectFileText:Ql.SelectImage,encodedImageSizeReductionFactor:e.encodedImageSizeReductionFactor||null,supportedFileExtensions:Zl,fileFormatNotSupportedMessage:Ql.fileFormatNotSupportedMessage,uploadUrl:"/sfsites/upload?branding=true",closeDialog:!0,filePickerClass:t?"cb-ImagePicker-section":"cb-ImagePicker-section cb-ImagePicker-section--full"},e),this._uploadSuccessCallback=e.uploadSuccessCallback,this);"function"==typeof e.uploadSuccessCallback&&(this._filePickerOpts.uploadSuccessCallback=function(e){e.hasOwnProperty("FILEURL")&&n._uploadSuccessCallback(e.FILEURL)}),"function"==typeof e.uploadCancelCallback&&(this._filePickerOpts.uploadCancelCallback=e.uploadCancelCallback),this._imagePickerOpts={title:Ql.UploadImage,logoImgUrl:tc.addPathPrefix(t)}},render:function(){this.$el.html(this.template(this._imagePickerOpts));var e=new Jl(this._filePickerOpts);return this.listenTo(e,"upload-start",this._showProgressIndicator),this.listenTo(e,"upload-completed",this._hideProgressIndicator),this.$(".js-file-picker-content").append(e.render().$el),this},_onSelectLogo:function(){this._uploadSuccessCallback&&this._uploadSuccessCallback(this.logoImgUrl)},_showProgressIndicator:function(){this.$(".js-progress-indicator").show()},_hideProgressIndicator:function(){this.$(".js-progress-indicator").hide()}}),tc={openAssetPicker:function(e){this.isContentAssetMode()?$P.auraRun(function(){$A.createComponent("forceContent:assetPicker",{shareWithIds:[I.getAppState().getNetworkId()],assetRenderHeight:e.imageSizeReductionFactor&&e.imageSizeReductionFactor.height,assetRenderWidth:e.imageSizeReductionFactor&&e.imageSizeReductionFactor.width,onAssetSelected:e.uploadSuccessCallback,onCancel:e.uploadCancelCallback,imageExtensions:["jpg","jpeg","png","bmp","gif","svg","svgz"],imageMimeTypes:["image/jpeg","image/bmp","image/gif","image/png","image/svg+xml"]},function(e){e.open()})}):(e.imageSizeReductionFactor&&(e.encodedImageSizeReductionFactor="&imgSizeReductionFactor="+encodeURIComponent(JSON.stringify({quality:e.imageSizeReductionFactor.quality||-1,width:e.imageSizeReductionFactor.width||-1,height:e.imageSizeReductionFactor.height||-1}))),A.showDialog(new ec(e)))},isContentAssetMode:function(){var e=I.getAppState().getCurrentPageTemplate();return $P.isContentAssetEnabled&&I.getAppState().templateSupportsNewFeatures(e)},addPathPrefix:function(t){var e,n,i;return t&&(i=t,e=$P.assetBasePaths&&0<$P.assetBasePaths.filter(function(e){return 0===t.indexOf(e)}).length,n=(n=P.CMS_MEDIA_BASE_PATHS)&&0<n.filter(function(e){return 0===t.indexOf(e)}).length,e||n?i="/sfsites/c"+t:E.getSite().isWebApp()&&(i=E.getSite().get("livePreviewUrl")+t),i)}},nc=PicassoWebServices.Labels.ColorPaletteGenerator;function ic(e){var t,n=N.getParentBrandingDefProperty(e),e=(e.field===P.BRANDING_FIELD.BUTTONS?t=N.isDerivedProperty(e)?ac.BasedOnStyle:ac.DefaultsToStyle:e.field===P.BRANDING_FIELD.COLOR&&(t=ac.DefaultsToPanel,i="".concat(is({field:n.field})," > ").concat(ss({tab:n.page}))),os({id:n.name})),i=i||as({subfield:n.subfield});return L.format(t,e,i)}var sc=Backbone.View.extend({className:"cb-PaletteGenerator slds-truncate slds-text-align--center slds-m-top_medium js-palette-generator",events:{"click .js-palette-generator-trigger":"_onClickUpload"},initialize:function(){this._colorThief=new ColorThief,this.render()},render:function(){this.$el.html(D.buttonWithIcon({buttonClassName:"cb-PaletteGenerator-btn js-palette-generator-trigger",buttonVariantClassName:"slds-button_neutral slds-button_stretch",svgClassName:"cb-PaletteGenerator-btnIcon",label:nc.TriggerText,icon:"upload"}))},destroy:function(){this.remove()},_onClickUpload:function(){var e=l.getPreviewBrandingSet().values.CompanyLogo||"";tc.openAssetPicker({title:nc.UploadImageDialogTitle,logoImgUrl:e,uploadSuccessCallback:this._onImageUploaded.bind(this)})},_apply:function(e){var t=l.getPreviewBrandingSet().values,t=$P.cbMetadata.getColorCalc(this.model,t),e=Ri(e,t),t=I.getAppState().getCurrentPreviewSiteBrandingSetId();I.event.trigger("action:update-branding-set-values",{id:t,values:e,eventSource:this})},_onImageUploaded:function(e){var s=T('<img src="'+tc.addPathPrefix(e)+'" style="visibility:hidden"></img>').appendTo("body"),a=this;s.on("load",function(){var e,n,i,t=a._colorThief.getPalette(this,5,5);s.remove(),A.closeDialog(),a._apply((e=a.model,n=t,t=$P.cbMetadata.getColorSwatch(e),e=$P.cbMetadata.getMainColors(e),i=_.map(t[0].palette,function(e){return _.clone(e)}),_.each(e,function(e,t){t<n.length&&(t=n[t],(t=tinycolor("rgb("+t[0]+", "+t[1]+", "+t[2]+")")).isLight()&&t.darken(),_.find(i,{name:e}).value=t.toHexString())}),i))})}}),ac=PicassoWebServices.Labels.ThemeEditor,t=Backbone.View.extend({tagName:"div",className:"rhs_secondary propertyEntry",template:function(e){var t,n=e.name,i=e.tooltipLabel,s=e.label,a=e.showResetToDefault,o=e.linkedProperty,r=e.showLinkIcon,l=e.page,e=e.field,n=(n=n,t=o,e===P.BRANDING_FIELD.BUTTONS?ac.RestoreDefaultColor:t&&N.isDerivedProperty(t)?L.format(ac.ResetToDefaultGenerated,"<strong>".concat(os({id:n}),"</strong>")):t?L.format(ac.ResetToLinkedDefault,"<strong>".concat(os({id:t.name}),"</strong>"),ss({tab:t.page})):ac.RestoreDefault);return'\n        <div class="cb-ColorPicker">\n            <label class="cb-ColorPicker-label slds-text-body--small slds-truncate">\n                '.concat(s,"\n                ").concat((t=i)?D.tooltipButtonIcon({buttonClassName:"cb-PicklistEditor-tooltip",tooltipToggle:"description-tooltip",tooltipPlacement:"right",tooltipLabel:t}):"","\n            </label>\n            ").concat(o?(s=o,i=r,t=l,t=(o=e)===P.BRANDING_FIELD.BUTTONS?ic(s):(o=ac.LinkedToColor,N.isDerivedProperty(r=s)&&(o=ac.BasedOn,r=N.getParentBrandingDefProperty(s)),t&&t===s.page&&(o=ac.LinkedToColorOnTab),L.format(o,os({id:r.name}),ss({tab:r.page}))),'<div class="cb-ColorPicker-iconContainer js-color-picker-link '.concat(i?"":"slds-hide",'">\n        <div data-toggle="linked-tooltip" data-html="true" title="').concat(t,'" class="test-color-picker-link-joined" tabindex="0">\n            ').concat(D.icon({svgClassName:"cb-Color-icon slds-icon_xx-small",icon:"link"}),'\n            <span class="slds-assistive-text">').concat(t,"</span>\n        </div>\n    </div>").trim()):"",'\n            <button data-html="true" title="').concat(n,'" data-toggle="reset-tooltip" data-placement="top" class="cb-ColorPicker-resetToDefault slds-button js-reset-to-default icon-utility-undo ').concat(a?"":"slds-hide",'">\n                <span class="slds-assistive-text">').concat(n,'</span>\n            </button>\n            <a class="cb-ColorPicker-input-anchor js-color-picker-anchor" href="#">\n                <input class="cb-ColorPicker-input" type="text" tabindex="0" />\n            </a>\n        </div>').trim()},events:{"click .js-reset-to-default":"_handleResetToDefault","keyup .js-color-picker-anchor":function(e){e.keyCode===P.KEYCODE.ENTER&&this.$input.spectrum("show")}},initialize:function(e){this.options=e,this.render(),this.$input=this.$(".cb-ColorPicker-input"),this.listenTo(this.model,"change:value",this.update),this.listenTo(j.getAppEvent(),"select-aura-component",this.hide),this.listenTo(j.getAppEvent(),"unselect-aura-component",this.hide),T(window).on("blur.cbColorEditor",this.hide),this._initializeSpectrum()},render:function(){var e=this._shouldShowResetToDefault(),t=N.isCssVariableReference(this.model.get("cpdValue")),e=m(m({},this.model.toJSON()),{},{showResetToDefault:e,linkedProperty:t?N.getBrandingPropertyFromCssVarReference({cssVarReference:this.model.get("cpdValue")}):void 0,showLinkIcon:N.isCssVariableReference(this.model.get("value"))});this.$el.append(this.template(e)),this.initTooltips()},initTooltips:function(){this.$('[data-toggle="reset-tooltip"]').tooltip({container:"body"}),this.$('[data-toggle="linked-tooltip"]').tooltip({container:"body",template:'<div class="cb-ColorPicker-tooltip tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}),this.$('[data-toggle="description-tooltip"]').tooltip({container:".cb-ThemeEditor"})},destroy:function(){this.$input.spectrum("destroy"),T(window).off("blur.cbColorEditor"),this.remove()},hide:function(){this.$input&&this.$input.spectrum&&this.$input.spectrum("hide")},update:function(){this._updateColorTileAndColorInput(),this._updateShowResetToDefault(),this._updateLinkIconVisibility()},_initializeSpectrum:function(){this.$input.spectrum({color:this._getColorValue(),showInput:!0,showAlpha:!0,preferredFormat:"rgb",showButtons:!1,replacerClassName:"js-color-picker-tile cb-ColorPicker-tile js-color-picker-tile",containerClassName:"js-color-picker-container",show:_.bind(this._onShowColorPicker,this),hide:_.bind(this._onHideColorPicker,this),move:_.bind(this._onMoveColorPicker,this)}),this.$input.on("dragstop.spectrum",_.bind(this._onColorPickerDragStop,this))},_onShowColorPicker:function(){var e=this.$input.spectrum("container"),t=e.position(),n=this.$(".js-color-picker-tile").width();e.css("left",t.left-e.width()+n),this.$colorInput=e.find(".sp-input"),this.$colorInput.on("blur.sp-input",this._onColorInputBlurHandler.bind(this)).on("keyup.sp-input",this._onColorInputKeydownHandler.bind(this))},_onHideColorPicker:function(){this.$colorInput.off(".sp-input")},_handleResetToDefault:function(){this.model.save("value",this.model.get("cpdValue"))},_getColorValue:function(){var e=this.model.get("value");return N.isCssVariableReference(e)&&(e=N.resolveCssVariableReference(e)),e=_s.isBrandExpression(e)?_s.getResolvedBrandValueFromExpression(e).getValue():e},_updateColorTileAndColorInput:function(){var e=this._getColorValue();this.$colorInput=this.$colorInput||this.$input.spectrum("container").find(".sp-input"),this.$colorInput&&(this.$colorInput.val(e),this.$input.spectrum("set",e))},_updateShowResetToDefault:function(){var e=this.$(".js-reset-to-default");this._shouldShowResetToDefault()?e.removeClass("slds-hide"):e.hasClass("slds-hide")||e.addClass("slds-hide")},_updateLinkIconVisibility:function(){var e=this.$(".js-color-picker-link");0<e.length&&(N.isCssVariableReference(this.model.get("value"))?e.removeClass("slds-hide"):e.addClass("slds-hide"))},_shouldShowResetToDefault:function(){return this.options.resetToDefaultEnabled&&!tinycolor.equals(this.model.get("cpdValue"),this.model.get("value"))},_onMoveColorPicker:function(e){this.$colorInput.val(e.toRgbString())},_onColorPickerDragStop:function(e,t){this._saveColor(t.toRgbString())},_saveColor:function(e){this.model.get("value")!==e&&this.model.save("value",e)},_onColorInputKeydownHandler:function(e){e.keyCode===P.KEYCODE.TAB?this._checkValidColor()||(this._restoreColorInputValue(),this._removeErrorState()):e.keyCode===P.KEYCODE.ENTER?this._checkValidColor()?this._removeErrorState():this._enableErrorState():e.keyCode===P.KEYCODE.ESCAPE?(this._restoreColorValueAndDefocus(),this._removeErrorState()):"rgb"===(e=this.$colorInput.val()).substr(0,3)?")"===e.slice(-1)&&this._processColorInput():7<=e.length&&this._processColorInput()},_processColorInput:function(e){this._checkValidColor()?this._removeErrorState():this._enableErrorState()},_onColorInputBlurHandler:function(e){this._checkValidColor()||this._restoreColorInputValue(),this._removeErrorState()},_checkValidColor:function(){var e=this.$colorInput.val(),e=tinycolor(e),t=e.isValid();return t&&(e=e.toRgbString(),this._saveColor(e)),t},_restoreColorValueAndDefocus:function(){this._restoreColorInputValue(),this._defocusColorInput()},_restoreColorInputValue:function(){this.$input.spectrum("set",this.model.get("value"))},_defocusColorInput:function(){this.$colorInput.blur()},_enableErrorState:function(){this.$colorInput.addClass("is-invalid")},_removeErrorState:function(){this.$colorInput.removeClass("is-invalid")}}),oc=P.CMS_MEDIA_BASE_PATHS[0];function rc(e){function t(e){var t={items:[{targetId:s,contentId:e.contentId}]};n(e),a===P.CMS_CONTENT_TYPE.IMAGE&&PicassoWebServices.ManageSiteCommon.CreateManagedContentReferences(t)}var n=e.successCallback,i=e.cancelCallback,s=e.targetId,e=e.contentType,a=void 0===e?P.CMS_CONTENT_TYPE.IMAGE:e;$P.auraRun(function(){$A.createComponent("communitySetup:cmsMediaPicker",{onContentSelectorSuccess:t,onContentSelectorCancel:i,targetId:s,contentType:a},function(e){e.find("contentselector").launch(e)})})}function lc(e){return e&&""!=e?oc+"/"+e:""}var cc=Backbone.View.extend({tagName:"div",className:"propertyEntry",labelTemplate:_.template('<label for="{{= id }}_input" class="propertyLabel" style="display: block;">{{= label }}</label>'),imageTemplate:_.template('<div id="{{- id }}" class="js-image-content cb-ImageProperty-wrapper cb-ImageProperty-wrapper--image" title="{{- url }}"><div class="cb-ImageProperty-overlay"><i class="cb-ImageProperty-uploadIcon icon-utility-upload"></i></div><div class="cb-ImageProperty-thumbnailAlign"></div><img class="js-thumbnail cb-ImageProperty-thumbnail" src="{{- url }}" title="{{- url }}" alt="{{- url }}"></img></div><a class="js-image-clear cb-ImageProperty-clear">{{= clearLabel}}</a>'),tooltipTemplate:function(e){e=e.tooltipLabel;D.tooltipButtonIcon({buttonClassName:"cb-Branding-infoIcon",buttonAttributes:'data-container=".cb-ThemeEditor"',tooltipPlacement:"right",tooltipLabel:e})},placeholderTemplate:_.template('<div id="{{- id }}" class="js-image-content cb-ImageProperty-wrapper" title="'+PicassoWebServices.Labels.ImagePickerDialog.UploadImage+'"><div class="cb-ImageProperty-overlay cb-ImageProperty-overlay--placeholder"><i class="cb-ImageProperty-uploadIcon icon-utility-upload"></i></div><div class="js-placeholder cb-ImageProperty-placeholder"><i class="cb-ImageProperty-placeholderIcon icon-utility-image"></i></div></div>'),events:{"click .js-image-content":"_onClickThumbnail","click .js-image-clear":"_onClickClear"},initialize:function(e){this.options=e,this.listenTo(this.model,"change",this.render),this.render()},render:function(){var e=this.model.toJSON(),t=this.labelTemplate(e),n=this._hasTooltipText();n&&(t=T(t).append(T(this.tooltipTemplate(e)))),this.$el.html(t),this._hasImageValue()?this.$el.append(this.imageTemplate({id:e.id,url:tc.addPathPrefix(e.value),clearLabel:os({id:"Remove"})})):this.$el.append(this.placeholderTemplate(e)),n&&this.$('[data-toggle="tooltip"]').tooltip()},destroy:function(){this.remove()},_hasImageValue:function(){return!_.isEmpty(this.model.get("value"))},_hasTooltipText:function(){return!_.isEmpty(this.model.get("tooltipLabel"))},_getImageSizeReductionFactor:function(){var e,t=I.getAppState().getCurrentPageTemplate(),n=null;return t&&(t=t.getDevName(),e=this.$el.attr("data-name"),t)&&e&&(t=$P.cbMetadata.templates[t],_.isUndefined(t)||(n=t[e])),n},_onClickThumbnail:function(){var e;this.shouldUseCMSMedia()?(e=I.getAppState().getNetworkId(),rc({successCallback:this._onCMSMediaUploaded.bind(this),targetId:e})):tc.openAssetPicker({uploadSuccessCallback:this._onImageUploaded.bind(this),imageSizeReductionFactor:this._getImageSizeReductionFactor()})},shouldUseCMSMedia:function(){return E.getSite().get("isWebApp")},_onClickClear:function(){this.model.save("value","")},_onImageUploaded:function(e){this.model.save("value",e),A.closeDialog()},_onCMSMediaUploaded:function(e){e=lc(e.contentKey);this.model.save("value",e)}}),dc=Backbone.View.extend({errorOptions:{message:"",title:PicassoWebServices.Labels.PicassoDialog.Error},template:b.template('<h1 class="cb-Dialog-title js-dialog-error-title">{{=title}}</h1><div class="js-pub-main-content js-pub-screen cb-Dialog-content js-dialog-error-content">{{=message}}</div><div class="cb-Dialog-buttons"><input type="button" class="cb-Dialog-button-primary cb-Dialog-button js-close js-dialog-error-close-button" value="'+PicassoWebServices.Labels.PicassoDialog.Close+'"/></div>'),events:{"click .js-close":"_close"},initialize:function(e){null!=e.message&&(this.errorOptions.message=e.message),null!=e.title&&(this.errorOptions.title=e.title),null!=e.destroy&&(this.errorOptions.destroy=e.destroy)},render:function(){return this.$el.html(this.template(this.errorOptions)),this},destroy:function(){this.errorOptions.destroy&&this.errorOptions.destroy()},_close:function(){A.closeDialog()}}),e=Backbone.View.extend({tagName:"div",className:"propertyEntry unitEditor",template:_.template('<div><label class="propertyLabel">{{= label }}</label></div><div class="slds-grid"><input class="slds-size_3-of-5 unitEditorValue" type="text" autocomplete="off"/><div class="slds-size_2-of-5"><select class="slds-size_1-of-1"><option value="">{{= noUnitLabel }}</option><option value="px">{{= pixelLabel }}</option><option value="pt">{{= pointLabel }}</option><option value="%">%</option><option value="em">em</option></select></div></div>'),events:{"keyup input":"onKeyUp","blur input":"onBlur","change select":"onChange"},initialize:function(e){this.options=e,this.LABELS=PicassoWebServices.Labels,this.render()},render:function(){var e=this.model.get("value")||"",t={label:this.model.get("label"),noUnitLabel:this.LABELS.PropertySnippetsTag.NoUnit,pixelLabel:this.LABELS.PropertySnippetsTag.Pixels,pointLabel:this.LABELS.PropertySnippetsTag.Point},t=(this.$el.append(this.template(t)),parseFloat(e)),n="";isNaN(t)?t="":n=e.replace(t,""),this.$el.data("prevUnitNum",t),this.$("input").val(t),this.$("select").val(n),this.$("select").select2({minimumResultsForSearch:-1})},onKeyUp:function(e){e.keyCode===P.KEYCODE.ENTER&&this.$("input").blur()},onPropChanged:function(){},onBlur:function(){var e,t=this.$("input"),n="",i=this.$("select").val(),i=(i&&(n=i),t.val()),s=this.$el.data("prevUnitNum");""!==i&&isNaN(i)?(A.showDialog(new dc({message:this.LABELS.SiteGlobalProperties.RequiredCPDNumericValue,title:this.LABELS.ContentEditor.Warning})),t.val(s)):(e=L.isNullEmptyOrWhitespace(i))?t.val(s):(this.model.save("value",e?"":i+n),this.$el.data("prevUnitNum",i))},onChange:function(){var e=this.$("input").val();L.isNullEmptyOrWhitespace(e)||this.model.save("value",e+this.$("select").val())},destroy:function(){this.remove()}}),uc="default",pc=Backbone.View.extend({tagName:"div",className:"propertyEntry picklistEditor",template:_.template('<label class="propertyLabel">{{= label }}{{= tooltipTemplate }}</label><select class="picklist"></select>'),tooltipTemplate:function(e){return D.tooltipButtonIcon({buttonClassName:"slds-m-left_xx-small",buttonAttributes:'data-container=".cb-ThemeEditor"',tooltipPlacement:"right",tooltipLabel:e})},events:{"change select":"onChange"},initialize:function(){this.render()},render:function(){for(var e,t,n,i,s=[],a=this.model.toJSON(),o=!_.isEmpty(a.tooltipLabel),r=(o&&(d=this.tooltipTemplate(a.tooltipLabel)),this.$el.append(this.template({label:a.label,tooltipTemplate:d})),o&&this.$('[data-toggle="tooltip"]').tooltip(),this.$("select")),l=this.model.get("cpdValue").split(","),c=0;c<l.length;++c)-1<l[c].indexOf(":")?(n=l[c].split(":"),i=us({id:a.name,value:n[0]}),3===n.length?e=t=n[1]:n[1]===uc?e=t=n[0]:t=n[1]):(i=l[c],t=l[c]),r.append('<option value="'+t+'" title="'+i+'">'+i+"</option>"),s.push(t);e&&r.val(e);var d=this.model.get("value");d&&d!==e&&0<=s.indexOf(d)&&r.val(d),r.select2({minimumResultsForSearch:5}),this.$(".propertyLabel").attr("for",this.$(".select2-focusser").attr("id"))},onChange:function(){var e=this.$("select"),t="";e.find("option").each(function(){t+=T(this).text()+":"+T(this).val(),T(this).is(":selected")&&(t+=":"+uc),t+=","}),(t=0<t.length?t.substring(0,t.length-1):t)&&this.model.save("value",t)},destroy:function(){this.remove()}}),gc=PicassoWebServices.Labels.CustomFontDialog,hc=Backbone.View.extend({_template:function(e,t){t=gc.Description.replaceAll("{0}",e).replaceAll("{1}",t),e=gc.InputPlaceholder.replaceAll("{0}",e);return'\n            <div class="slds-modal__header">\n                <h2 class="slds-text-heading_medium">'.concat(gc.Title,'</h2>\n            </div>\n            <div class="slds-modal__content slds-p-around--medium">\n                <div class="slds-m-bottom--medium">\n                    ').concat(t,'\n                </div>\n                <div class="slds-form-element">\n                    <div class="slds-form-element__control">\n                        <input type="text" class="js-input slds-input" placeholder="').concat(e,'" maxlength="').concat("140",'"/>\n                    </div>\n                </div>\n            </div>\n            <div class="slds-modal__footer">\n                <button class="js-cancel slds-button slds-button_neutral">').concat(gc.Cancel,'</button>\n                <button class="js-save slds-button slds-button_brand" disabled>').concat(gc.Save,"</button>\n            </div>").trim()},events:{"click .js-save":"_save","keyup .js-input":"_onInputKeyup","click .js-cancel":"_cancel"},saveCallback:null,initialize:function(e){this.saveCallback=e.saveCallback,this.render()},render:function(){return this.$el.html(this._template(N.isCustomCssEnabled()?gc.CssEditor:gc.HeadMarkup,E.getSite().isWebApp()?gc.CustomizeFontHelpUrlLwr:gc.CustomizeFontHelpUrlAura)),setTimeout(function(){this.$(".js-input").focus()}.bind(this),"100"),this},_isValidEnterKey:function(e){return e.which===P.KEYCODE.ENTER&&!this.$(".js-save").prop("disabled")},_onInputKeyup:function(e){this._isValidEnterKey(e)?this._save():(e=0<this.$(".js-input").val().trim().length,this.$(".js-save").prop("disabled",!e))},_save:function(){this.saveCallback&&this.saveCallback(_.escape(this.$(".js-input").val())),A.closeDialog()},_cancel:function(){A.closeDialog()}}),mc="&family=",vc=new Set,bc=[],fc="";function _c(n){var i=[],s=fc.length,a=[];b.forEach(n,function(e,t){a.push(e+":ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900"),((s+=e.length+mc.length)>P.URL.MAX_ALLOWED_LENGTH||t===n.length-1)&&(i.push(a),a=[],s=fc.length)});for(var e,t,o=0,r=i;o<r.length;o++)e=r[o].join(mc),t=void 0,e="".concat(fc,"?family=").concat(e),(t=document.createElement("link")).href=e,t.rel="stylesheet",document.head.appendChild(t)}ve(function(){bc=[],I.AccessControl(P.PERMISSIONS.IS_GOOGLE_FONTS_ENABLED)&&PicassoWebServices.CommBranding.GetGoogleFontsInfo(function(e){e.googleFontsList&&e.stylesheetUrl&&(fc=e.stylesheetUrl,(e=e).googleFontsList.items)&&(b.forEach(e.googleFontsList.items,function(e){bc.push({value:e.family,label:e.family,type:P.FONT_TYPES.GOOGLE})}),I.event.trigger("action:update-font-store"))})}),ze.getAllFonts=function(){return bc},ze.loadFontStyles=function(e){e=b.chain(e).filter(function(e){return e.type==P.FONT_TYPES.GOOGLE&&!vc.has(e.text)&&(vc.add(e.text),!0)}).map(function(e){return e.text}).value();0<e.length&&_c(e)};var Sc="Salesforce Sans",Cc=PicassoWebServices.Labels.BrandingPicklistValuesLWR.FontFamily_DefaultSystemFont,yc=PicassoWebServices.Labels.BrandingPicklistValuesLWR.FontFamily_UseBaseFontFamily,Tc=["Arial","Comic Sans MS","Courier","Courier New","cursive","Geneva","Georgia","Helvetica","Lucida Grande","Monaco","monospace","sans-serif","serif","Times","Times New Roman","Verdana","Zapf Chancery"],Pc=[];function Ic(){Pc.sort(function(e,t){return e.label.toLowerCase().localeCompare(t.label.toLowerCase())})}function Ec(){return E.getSite().get("hostedFonts")}ve(function(e){if(I.AccessControl(P.PERMISSIONS.THEME_OOTB_FONTS)){var t=[],e=e&&e.CurrentSite&&e.CurrentSite.hostedFonts?e.CurrentSite.hostedFonts:Ec(),t=b.map(e,function(e){return{value:e.FontFamily,label:e.FontFamily}}),e=b.map(Tc,function(e){return{value:e,label:e}});Pc=t.concat(e),Ic()}else{Pc=[{label:Cc,value:"var(--dxp-g-root-font-family)",type:P.FONT_TYPES.SYSTEM},{label:yc,value:"var(--dxp-s-html-font-family)",type:P.FONT_TYPES.SYSTEM}];for(var t=l.getAllBrandingSets(P.BRANDING_SET_TYPE.APP)[0],n=l.getBrandingSetPropertyDefs(t.def),i=t.values,s=0;s<n.length;s++){var a=n[s];if(a.type&&P.BRANDING_TYPE.FONT===a.type.name&&(i[a.name]&&i[a.name]===Sc)){Pc.push({label:Sc,value:Sc});break}}}}),Ge.getAllFonts=function(){return Pc},Ge.getFont=function(t){return b.find(Pc,function(e){return e.value===t})},Ge.getHostedFonts=Ec,Ge.loadFontStyles=function(e){ze.loadFontStyles(e)},I.event.on("action:add-custom-font",function(e){Pc.push({value:e.value,label:e.label}),Ic(),I.event.trigger("state:fonts-updated")}),I.event.on("action:update-font-store",function(){Pc.push.apply(Pc,Q(ze.getAllFonts())),I.event.trigger("state:loaded-google-fonts")});var wc,Lc="".concat(P.FONT_TYPES.GOOGLE,":"),Dc=function(e){return e&&e.startsWith(Lc)},Ac=function(e){return e.replace(1<arguments.length&&void 0!==arguments[1]?arguments[1]:Lc,"")},kc=PicassoWebServices.Labels.CustomFontDialog,Nc=PicassoWebServices.Labels.BrandingPicklistValuesLWR.FontFamily_UseBaseFontFamily,xc=!1;function Rc(){var e=_.map(Ge.getHostedFonts(),function(e){return n=(t=e).FontFamily,i=e.FontStyle,s=e.FontWeight,a=e.Name,t=e.Url,"@font-face {\n                font-family: '".concat(n,"';\n                font-style: ").concat(i,";\n                font-weight: ").concat(s,";\n                src: local('").concat(a,"'), url(").concat(t,");\n            }").trim();var t,n,i,s,a});T("head").append('<style type="text/css">'+e.join("\r\n")+"</style>")}function jc(e){Ge.getFont(e)||Dc(e)||I.event.trigger("action:add-custom-font",{value:e,label:"".concat(e," (").concat(kc.Custom,")")})}var i=Backbone.View.extend({tagName:"div",className:"propertyEntry",template:function(e){return'<label class="propertyLabel">'.concat(e,"</label>")},fontSelectorTemplate:function(){return'<input class="fontSelector js-font-select" type="hidden" tabindex="-1" title="">'},itemTemplate:function(e,t,n){return'<option value="'.concat(e,'" ').concat(n?"selected":"",">").concat(t,"</option>")},customFontActionTemplate:function(e){return'<div class="cb-FontEditor-addCustomFont js-custom-font">'.concat(e,"</div>")},customFontActionButtonTemplate:function(e){return'<button class="cb-FontEditor-addCustomFontButton slds-button slds-button_brand js-custom-font">'.concat(e,"</button>")},initialize:function(e){this.options=e,I.AccessControl(P.PERMISSIONS.THEME_OOTB_FONTS)&&!xc&&(Rc(),xc=!0),I.event.on("state:branding-set-values-updated",function(){this.render()}.bind(this)),I.event.on("state:preview-site-branding-set-updated",function(){this.render()}.bind(this)),I.event.on("state:loaded-google-fonts",function(){this.render()}.bind(this)),jc(this.model.get("value")),this.render()},render:function(){var e,t,i=this,l=(this.$el.html(this.template(L.htmlEncode(this.model.get("label")))),wc=Ge.getAllFonts(),this.$(".propertyLabel").after(i.fontSelectorTemplate()),E.getSite().isWebApp()),c=l&&"BaseFont"===this.model.get("id");return this.$("input").select2({query:function(t){for(var e=_.filter(wc,function(e){return(!c||e.label!==Nc)&&0<=e.label.toUpperCase().indexOf(t.term.toUpperCase().trim())}),n=50*(t.page-1),i=Math.min(50+n,e.length),s=[],a=n;a<i;a++){var o=e[a].label,r=e[a].type,o={id:e[a].value,text:o,type:r};s.push(o),l&&a+1<i&&r===P.FONT_TYPES.SYSTEM&&e[a+1].type!==P.FONT_TYPES.SYSTEM&&s.push({separator:!0})}Ge.loadFontStyles(s),t.callback({results:s,more:i<e.length})},formatSelection:function(e,t){var n=L.htmlEncode(e.text);return i.isStylableFont(e)&&t.attr("style",'font-family: "'.concat(n.replace(/;/g,""),'"')),n},formatResult:function(e,t){var n=L.htmlEncode(e.text);return i.isStylableFont(e)&&t.attr("style",'font-family: "'.concat(n.replace(/;/g,""),'"')),n},containerCssClass:"cb-FontEditor-select",dropdownCssClass:"cb-FontEditor-dropdown",minimumResultsForSearch:10,formatSearching:function(){return kc.SearchingMessage},formatLoadMore:function(){return kc.LoadMoreMessage}}),this.$("input").change(this.onChangeFont.bind(this)),""!=i.model.get("value")&&(e=i.model.get("value"),t=Ge.getFont(Ac(e)))&&(this.$("input").select2("data",{id:t.value,text:t.label,type:t.type}),Dc(t=e))&&(t=Ac(t),Ge.loadFontStyles([{text:t,type:P.FONT_TYPES.GOOGLE}])),this.$(".propertyLabel").attr("for",this.$(".select2-focusser").attr("id")),this.$("input").select2("container").find(".select2-drop").append(this.customFontActionTemplate(kc.UseCustomFont)),this.$el.find(".js-custom-font").click(this.onSelectCustomFont.bind(this)),this},onSelectCustomFont:function(e){this.$("input").select2("close"),A.showDialog(new hc({saveCallback:function(e){this.model.save("value",e),jc(e),this.render()}.bind(this)}),{className:"slds-vex-theme slds-vex-theme--medium"})},onChangeFont:function(e){var t;e.added&&(t=e.val,(t=e.added.type===P.FONT_TYPES.GOOGLE?"".concat(e.added.type,":").concat(e.val):t)!==this.model.get("value"))&&this.model.save("value",t)},isStylableFont:function(e){return e.text&&P.FONT_TYPES.SYSTEM!==e.type},destroy:function(){this.remove()}}),ot=Backbone.View.extend({tagName:"div",className:"propertyEntry cb-SliderProperty",checkboxTemplate:function(e,t,n){return'\n            <div class="cb-SliderProperty-checkbox slds-form-element '.concat(n?"checked":"",'">\n                <div class="slds-form-element__control">\n                    <div class="slds-checkbox">\n                        <input type="checkbox" class="js-show-slider-checkbox" name="options" id="').concat(e,'" value="').concat(e,'" ').concat(n?"checked":"",'/>\n                        <label class="slds-checkbox__label" for="').concat(e,'">\n                            <span class="slds-checkbox_faux"></span>\n                            <span class="slds-form-element__label">').concat(t,"</span>\n                        </label>\n                    </div>\n                </div>\n            </div>").trim()},sliderWrapperHtml:function(e,t,n){return'<div class="cb-SliderProperty-sliderContainer test-slider-container">\n        <div class="slds-form-element__label">\n            <span class="cb-SliderProperty-sliderLabel test-slider-label">'.concat(e,"</span>\n            ").concat(n,'\n            <div class="cb-SliderProperty-sliderRangeLabel test-slider-range-label">').concat(t,'</div>\n        </div>\n        <div class="cb-SliderProperty-slider js-slider" aria-label="').concat(e," ").concat(t,'"></div>\n    </div>')},tooltipTemplate:function(e){return e?D.tooltipButtonIcon({buttonClassName:"slds-m-left_x-small cb-SliderProperty-tooltip test-slider-tooltip",buttonAttributes:'data-container=".js-theme-editor"',tooltipPlacement:"right",tooltipLabel:e}):""},events:{"change .js-show-slider-checkbox":"handleCheckboxChange"},initialize:function(e){this.options=e,this.render()},render:function(){var e=this.model.toJSON();this.shouldShowSlider=!0,this.shouldShowCheckbox(e)&&(this.shouldShowSlider=e.value!==e.editorAttributes.uncheckedValue,this.renderCheckbox(e)),this.shouldShowSlider&&this.renderSliderContainer(e)},renderCheckbox:function(e){var t,n;this.$el.html(this.checkboxTemplate(e.name,(e={id:e.name,label:e.label},t=e.id,e=e.label,(n=gs())["".concat(t,"_slider_checkbox")]||L.format(n.fallback_slider_checkbox_label,e)),this.shouldShowSlider))},renderSliderContainer:function(e){var t=e.label,n=e.editorAttributes,i=n.min,s=n.max,n=n.unit,i=Number(i).toLocaleString(),s=Number(s).toLocaleString(),i="(".concat(i).concat("–").concat(s).concat(n?" "+n:"",")"),s=this.tooltipTemplate(rs({id:e.name}));this.$el.append(this.sliderWrapperHtml(t,i,s)),s&&this.$('[data-toggle="tooltip"]').tooltip(),this.addListeners(),this.renderSlider(e)},renderSlider:function(e){var t=this,n=e.editorAttributes,i=n.min,s=n.max,a=n.step,n=n.unit,o=e.value.replace(n,"");$P.auraRun(function(){$A.createComponent("lightning:slider",{label:e.label,min:i,max:s,step:a,value:o},function(e){e&&($A.render(e,t.$(".js-slider")[0]),$A.afterRender(e))})})},shouldShowCheckbox:function(e){return"true"===e.editorAttributes.showCheckbox&&e.editorAttributes.uncheckedValue},addListeners:function(){this.$(".js-slider").on("change",this.handleSliderChange.bind(this))},removeListeners:function(){this.$el.off()},handleSliderChange:_.debounce(function(e){this.model.save("value",e.target.value+this.model.attributes.editorAttributes.unit)},C.DEBOUNCE_INTERVAL),handleCheckboxChange:function(e){var t;!0===e.target.checked?(e=this.model.attributes.editorAttributes,t=(Number(e.max)+Number(e.min))/2,this.model.save("value",t+e.unit)):(this.model.save("value",this.model.attributes.editorAttributes.uncheckedValue),(t=this.$(".lightningSlider"))[0]&&(e=$A.componentService.getAttributeProviderForElement(t[0]))&&e.destroy()),this.render()},destroy:function(){this.removeListeners(),this.remove()}}),Bc={};function Oc(e,t){var n=e.Errors,e=e.SocialLinksInfo;n?I.event.trigger(t,{details:n}):(Bc=e||{},I.event.trigger("state:social-links-info-updated"))}I.event.on("action:load-social-links-info",function(){PicassoWebServices.CommBrandingSocialLinks.GetSocialLinksInfo(function(e){Oc(e,"state:social-links-info-load-has-error")})}),I.event.on("action:update-social-links-info",function(){var e=Bc;PicassoWebServices.CommBrandingSocialLinks.UpdateSocialLinksInfo(e,function(e){Oc(e,"state:social-links-info-update-has-error")})}),Je.getSocialLinks=function(){var e;return null==(e=Bc.contentBody)?void 0:e.links};var Mc="url",Vc="sprite",$c="contentReference",Uc=$c,Wc={facebook:{label:"Facebook",url:"https://www.facebook.com/",icon:{type:Vc,name:"facebook"}},instagram:{label:"Instagram",url:"https://www.instagram.com/",icon:{type:Vc,name:"instagram"}},linkedin:{label:"LinkedIn",url:"https://www.linkedin.com/",icon:{type:Vc,name:"linkedin"}},twitter:{label:"Twitter",url:"https://twitter.com/",icon:{type:Vc,name:"twitter"}},youtube:{label:"YouTube",url:"https://www.youtube.com/",icon:{type:Vc,name:"youtube"}},custom:{label:"Custom",url:"",icon:{type:$c,contentKey:""}}};function Fc(e){return Wc[e]||{}}function Hc(){return Object.keys(Wc||{}).map(function(e){return{label:Fc(e).label,value:e}})}function Gc(e){var t=Fc(e).label;return{label:void 0===t?"":t,source:function(e){e=Fc(e).url;return{type:Mc,url:void 0===e?"":e}}(e),icon:{name:void 0===(t=Fc(e).label)?"":t,source:function(e){var e=Fc(e).icon||{},t=e.type,t=void 0===t?"":t,n=e.name,n=void 0===n?"":n,e=e.contentKey,e=void 0===e?"":e;{if(t!==$c)return{type:Vc,spriteNameOrUrl:n};return{type:$c,reference:{contentKey:e}}}}(e)}}}function zc(e){return e.icon||{}}function Kc(e){return zc(e).source||{}}function Yc(e){return e.source||{}}function qc(e){return Yc(e).url}function Xc(e){return Kc(e).type}function Jc(e){return Kc(e).spriteNameOrUrl}function Qc(e){return(null==(e=Kc(e).reference)?void 0:e.contentKey)||""}var Zc=PicassoWebServices.Labels.BrandingSocialLinksLWR,n=Backbone.View.extend({className:"cd-Editor-socialLinks slds-is-relative",template:function(){return'\n            <div class="cd-Editor-socialLinks-links js-Editor-socialLinks-links"></div>\n            <div class="cd-Editor-socialLinks-add-section js-Editor-socialLinks-add-section slds-m-top_medium"></div>\n            <div class="cb-Editor-socialLinks-spinner js-Editor-socialLinks-spinner">\n                '.concat($P.viewTypes.CommonTemplates.spinner,"\n            </div>\n        ").trim()},socialLinkTemplate:function(e){var t=e.socialLink,e=e.index,n=t.label,t=qc(t);return'\n            <div class="js-Editor-socialLinks-item slds-grid slds-grid_vertical-align-center slds-p-bottom_medium slds-border_bottom slds-m-top_medium" data-index="'.concat(e,'">\n                <div class="slds-no-flex slds-m-right_x-small">\n                    ').concat($P.viewTypes.CommonTemplates.icon({svgClassName:"cb-Editor-socialLinks-item-dndHandle js-Editor-socialLinks-item-dndHandle slds-icon_x-small",icon:"rows"}),'\n                </div>\n                <div class="slds-col slds-grid slds-grid_vertical-align-center">\n                    <div class="slds-no-flex js-Editor-socialLinks-item_icon cb-Editor-socialLinks-item_icon slds-align_absolute-center slds-m-right_x-small">\n                    </div>\n                    <div class="slds-col">\n                        ').concat(this.inputTemplate({label:n,placeholder:n,value:t}),'\n                    </div>\n                    <div class="slds-no-flex slds-m-left_x-small">\n                        ').concat($P.viewTypes.CommonTemplates.buttonIcon({icon:"close",buttonClassName:"js-Editor-socialLinks-delete",label:"Delete"}),"\n                    </div>\n                </div>\n            </div>\n        ").trim()},svgIconTemplate:function(e){var t=e.className,n=e.iconLabel,e=e.iconName;return'\n            <svg class="'.concat(t,' social-icon slds-icon" aria-hidden="true">\n                <use xlink:href="').concat("/sfsites/assets/icons/social/flat-sprite/svg/symbols.svg","#").concat(e,'"></use>\n            </svg>\n            <span class="slds-assistive-text">').concat(n,"</span>\n        ").trim()},inputTemplate:function(e){var t=e.label,n=e.placeholder,e=e.value,i="js-socialLink-".concat(t.toLowerCase(),"-").concat(L.uuid());return'\n            <div class="slds-form-element">\n                <label class="slds-form-element__label" for="'.concat(i,'">').concat(t,'</label>\n                <div class="slds-form-element__control">\n                    <input type="text" id="').concat(i,'" placeholder="').concat(n,'" required="" class="slds-input js-Editor-socialLinks-link-input" value="').concat(e,'"/>\n                </div>\n                <div class="slds-form-element__help cb-Editor-socialLinks-link-input-help js-Editor-socialLinks-link-input-help"></div>\n            </div>\n        ').trim()},events:{"blur .js-Editor-socialLinks-link-input":"_onSocialLinkInputBlur","click .js-Editor-socialLinks-delete":"_onSocialLinkDelete","change .js-Editor-socialLink-select":"_onAddSocilaLink"},_showLoader:function(){this.$(".js-Editor-socialLinks-spinner").show()},_hideLoader:function(){this.$(".js-Editor-socialLinks-spinner").hide()},_getHtmlFromString:function(e){return T(T.parseHTML(e))},_getSocialLinksElem:function(){return this.$(".js-Editor-socialLinks-links")},_getSocialLinkElemByIndex:function(e){return this.$('.js-Editor-socialLinks-item[data-index="'.concat(e,'"]'))},_getParentSocialLinkElem:function(e){return T(e).closest(".js-Editor-socialLinks-item")},_getSocialLinkElemIndex:function(e){return this._getParentSocialLinkElem(e).data("index")},_showOrHideErrorMessages:function(e){var t=this._socialLinks[e],n=!function(e){var t;switch(Xc(e)){case Vc:t=Jc(e);break;case $c:t=Qc(e);break;default:t=""}return t}(t),t=!qc(t),e=this._getSocialLinkElemByIndex(e),i=e.find(".js-Editor-socialLinks-link-input-help");e.addClass("slds-has-error"),n&&t?i.text(Zc.SocialLinkUrlAndIconErrorMessage):n?i.text(Zc.SocialLinkIconErrorMessage):t?i.text(Zc.SocialLinkUrlErrorMessage):e.removeClass("slds-has-error")},_createSvgIconElem:function(e){var t=zc(e).name,e=Jc(e),t=this.svgIconTemplate({className:e,iconLabel:t,iconName:e});return this._getHtmlFromString(t)},_onCustomIconChanged:function(e){var t;e&&(t=e.get("id"),e=e.get("value"),t=this._getSocialLinkElemIndex("#".concat(t)),Kc(this._socialLinks[t]).reference.contentKey=e,this._showOrHideErrorMessages(t),this._updateSocialLinksInfo())},_createImageIconElem:function(e){var t="social-links-cust-icon-".concat(L.uuid()),e=Qc(e),t=new Xl({id:t,name:t,label:"",tooltipLabel:"",cpdValue:"",value:e});return this.listenTo(t,"change",this._onCustomIconChanged),new cc({model:t}).$el},_createIconElem:function(e){return Xc(e)!==Uc?this._createSvgIconElem(e):this._createImageIconElem(e)},_createSocialLinkElem:function(e,t){t=this.socialLinkTemplate({socialLink:e,index:t}),t=this._getHtmlFromString(t),e=this._createIconElem(e);return t.find(".js-Editor-socialLinks-item_icon").append(e),t},_onSocialLinkInputBlur:function(e){var e=e.currentTarget,t=e.value,e=this._getParentSocialLinkElem(e),n=e.data("index"),i=this._socialLinks[n],s=qc(i),i=(Yc(i).url=t,this._showOrHideErrorMessages(n),e.data("new"));t&&(i||t!==s)&&this._updateSocialLinksInfo()},_onSocialLinkDelete:function(e){var e=this._getParentSocialLinkElem(e.currentTarget),t=e.data("index");this._socialLinks.splice(t,1),e.remove(),this._updateSocialLinksInfo()},_hasValidSocialLinks:function(){return!this.$(".slds-has-error").length},_updateSocialLinksInfo:function(){this._hasValidSocialLinks()&&(this._showLoader(),I.event.trigger("action:update-social-links-info",{socialLinks:this._socialLinks}))},_focusOnNewSocialLink:function(){var e=this;requestAnimationFrame(function(){e.$(".js-Editor-socialLinks-link-input").last().focus()})},_getSelectedSocialLinkPicklistValue:function(e){e=/(\w+):(default)/.exec(e);return e&&e[1]},_onSocialLinkPicklistValueChanged:function(e){var t;e&&(e=this._getSelectedSocialLinkPicklistValue(e.get("value")))&&(this._showLoader(),e=Gc(e),(t=this._createSocialLinkElem(e,this._socialLinks.length)).attr("data-new",!0),this._getSocialLinksElem().append(t),this._socialLinks.push(e),this._renderSocialLinkPicklist(),this._focusOnNewSocialLink(),this._hideLoader())},_getSocialLinkPicklistValues:function(){return"".concat(Zc.SocialLinksAddPicklistSelectOption,":,")+Hc().map(function(e){var t=e.label,e=e.value;return"".concat(t,":").concat(e)}).join(",")},_renderSocialLinkPicklist:function(){var e;this._picklistEditor?(this._picklistEditor.model.set("value",this._getSocialLinkPicklistValues()),this._picklistEditor.$el.empty(),this._picklistEditor.render()):(e=new Xl({id:"social-links-picklist",name:"social-links-picklist",label:Zc.SocialLinksAddPicklistLabel,tooltipLabel:"",cpdValue:this._getSocialLinkPicklistValues()}),this.listenTo(e,"change",this._onSocialLinkPicklistValueChanged),this._picklistEditor=new pc({model:e}),this.$(".js-Editor-socialLinks-add-section").html(this._picklistEditor.$el))},_updateSocialLinksOrder:function(){var t=this,n=[],i=(this.$(".js-Editor-socialLinks-links .js-Editor-socialLinks-item").each(function(e){var t=T(this);n.push(t.data("index")),t.data("index",e),t.attr("data-index",e)}),this._socialLinks.splice(0));n.forEach(function(e){t._socialLinks.push(i[e])}),i.length=0,this._updateSocialLinksInfo()},_enableDnd:function(){this.$(".js-Editor-socialLinks-links").sortable({axis:"y",helper:function(e,t){return T('<div class="cb-Editor-socialLinks-dndHelper slds-grid slds-grid_vertical-align-center">\n                        '.concat(t.html(),"\n                    </div>"))},handle:".js-Editor-socialLinks-item-dndHandle",containment:this.$(".js-Editor-socialLinks-links"),placeholder:"cb-Editor-socialLinks-dndPlaceholder js-Editor-socialLinks-dndPlaceholder slds-m-top_medium slds-border_bottom slds-p-bottom_medium",update:this._updateSocialLinksOrder.bind(this)})},_renderSocialLinks:function(){var n=this,i=this._getSocialLinksElem().empty();this._socialLinks.map(function(e,t){e=n._createSocialLinkElem(e,t);i.append(e)}),this._enableDnd()},_showErrorToast:function(e){e={message:"",details:e.details,duration:null,canDismiss:!0};w.error(e),this._hideLoader()},_handleSocialLinksInfoUpdate:function(){this._socialLinks=Je.getSocialLinks(),this._socialLinks&&(this._renderSocialLinks(),this._renderSocialLinkPicklist()),this._hideLoader()},_loadSocialLinksInfo:function(){this._showLoader(),I.event.trigger("action:load-social-links-info")},_addListeners:function(){this.listenTo(I.event,"state:social-links-info-updated",this._handleSocialLinksInfoUpdate),this.listenTo(I.event,"state:social-links-info-load-has-error",this._showErrorToast),this.listenTo(I.event,"state:social-links-info-update-has-error",this._showErrorToast)},initialize:function(){this._socialLinks=[],this._addListeners(),this._loadSocialLinksInfo(),this.render()},render:function(){return this.$el.html(this.template()),this}}),ed="multi-unit-slider:unit-change",hr=Backbone.View.extend({tagName:"div",className:"propertyEntry cb-MultiUnitSliderProperty",sliderWrapperHtml:function(e,t,n){return'<div class="cb-MultiUnitSliderProperty-wrapper js-multi-unit-slider-container">\n                    '.concat(t?"".concat(n,'<div class="js-radio-button-group-container slds-p-bottom_medium"></div>'):"","\n                    ").concat(e,'\n                    <div class="js-slider-container"></div>\n                </div>').trim()},tooltipTemplate:function(e){return e?D.tooltipButtonIcon({buttonClassName:"cb-MultiUnitSliderEditor-tooltip js-theme-layout-info",tooltipPlacement:"top",tooltipLabel:e}):""},initialize:function(){this.render()},render:function(){var e=this.model.toJSON(),t=this.tooltipTemplate((t=(t={id:e.name}).id,gs()["".concat(t,"_multi_unit_slider_radio_button_group_description")])),n=this.tooltipTemplate(rs({id:e.name}));this.$el.append(this.sliderWrapperHtml(n,!this._hasAlternativeUnitSource(),t)),(n||t)&&this.$('[data-toggle="tooltip"]').tooltip({container:".cb-ThemeEditor"}),this.addListeners(),this.renderSlider(e)},renderSlider:function(t){var e,n,i=this,s=t.label,a=(e=(e={id:t.name}).id,gs()["".concat(e,"_multi_unit_slider_radio_button_group_label")]||"Unit Of Measure"),o=[];this._getEditorAttributes("config").forEach(function(e){t.value.includes(e.unit)&&(n=e),o.push({label:us({id:t.name,value:e.unit}),value:e.unit})});var r=n.unit,l=(this.model.set("unit",r,{silent:!0}),t.value.replace(r,"")),c=ds({label:s,config:n});$P.auraRun(function(){i._getEditorAttributes("unitSource")||i.auraRenderRadioButtonGroup(a,o,r,i),i.auraRenderSliderComponent(c,n,l,i)}),setTimeout(function(){i._triggerUnitChangeEvent(r)},0)},auraRenderRadioButtonGroup:function(e,t,n,i){$A.createComponent("lightning:radioGroup",{label:e,options:t,value:n,type:"button"},function(e){e&&($A.render(e,i.$(".js-radio-button-group-container")[0]),$A.afterRender(e))})},auraRenderSliderComponent:function(e,t,n,i){var s=t.min,a=t.max,t=t.step;$A.createComponent("lightning:slider",{label:e,min:s,max:a,step:t,value:n},function(e){e&&($A.render(e,i.$(".js-slider-container")[0]),$A.afterRender(e))})},addListeners:function(){this.$(".js-slider-container").on("change",this.handleSliderChange.bind(this)),this.$(".js-radio-button-group-container").on("change",this.handleRadioButtonGroupChange.bind(this)),this._hasAlternativeUnitSource()&&this.listenTo(o,ed,this.handleRadioButtonGroupChange.bind(this))},removeListeners:function(){this.$el.off()},handleSliderChange:_.debounce(function(e){this.model.save("value","".concat(e.target.value).concat(this.model.get("unit")))},C.DEBOUNCE_INTERVAL),handleRadioButtonGroupChange:function(e){var t,n,i,s;e.sourceId&&e.sourceId!==this._hasAlternativeUnitSource()||(t=(e.target||e).value,n=this.model.get("unit"),t!==n&&(null!=(e=this.model.get("value"))&&(e=e.replace(n,"")),this._getEditorAttributes("config").forEach(function(e){n===e.unit?i=e:t===e.unit&&(s=e)}),e=_.isUndefined(i)?s.min:e*(+s.max/+i.max),this.updateSlider(s,e),this.model.set("unit",t,{silent:!0}),this.model.save("value","".concat(e).concat(t)),this._triggerUnitChangeEvent(t)))},updateSlider:function(t,n){var i=this.$("lightning-slider")[0],s=ds({label:this.model.get("label"),config:t});$P.auraRun(function(){var e=$A.getComponent(i);e&&(e.set("v.value",n),e.set("v.label",s),e.set("v.min",t.min),e.set("v.max",t.max),e.set("v.step",t.step))})},destroy:function(){this.removeListeners(),this.remove()},_hasAlternativeUnitSource:function(){return this._getEditorAttributes("unitSource")},_getEditorAttributes:function(e){var t=this.model.get("editorAttributes");return void 0===e?t:t[e]},_triggerUnitChangeEvent:function(e){o.trigger(ed,{sourceId:this.model.id,value:e})}}),td={Color:t,Image:cc,Unit:e,Picklist:pc,Font:i,Slider:ot,SocialLinks:n,MultiUnitSlider:hr};var nd=".cb-VerticalNav-content",id=".slds-nav-vertical__item",sd=_.template('<div class="cb-VerticalNav-container {{= className }}">\n        <div class="cb-VerticalNav-items">\n            <nav class="slds-nav-vertical">\n                <ul>\n                    {{ _.each(items, function(item) { }}\n                        <li class="'.concat("slds-nav-vertical__item",' {{= item.isActive ? "slds-is-active" : ""}} {{= item.itemClassName ? item.itemClassName : "" }}">\n                            <a class="slds-nav-vertical__action" href="javascript:void(0)">{{= item.label }}</a>\n                        </li>\n                    {{ }) }}\n                </ul>\n            </nav>\n        </div>\n        <div class="').concat("cb-VerticalNav-contentContainer",'">\n        </div>\n    </div>')),ad=_.template('<div class="'.concat("cb-VerticalNav-content",' {{= isActive ? "slds-show" : "slds-hide" }}  {{= contentClassName }}" role="nav-content"></div>'));var od=PicassoWebServices.Labels.ThemeEditor,rd=P.BRANDING_COMPONENT.NAV,ld=P.BRANDING_PAGE.LOGIN,cd={getSectionName:function(e){var t=e.page,n=e.component,e=e.subfield;return e?as({subfield:e}):t===ld?od.LoginPages:n===rd?od.Navigation:od.General},getCategoryName:function(e){var e=e.category;return e?(e=void 0===(e=(e={category:e}).category)?"":e,ps()["".concat(e,"_category")]||e):od.General},getGroupName:function(e){var e=e.group;return e?(e=void 0===(e=(e={group:e}).group)?"":e,ps()["".concat(e,"_group")]||e):od.General},getTabName:function(e){e=e.page;return e?ss({tab:e}):od.General},sortPropertiesByTabName:function(e){var s=this,a=[],o=[];return e.forEach(function(e){var t=s.getTabName(e),n=e.page||"general",i=_.find(a,{tabName:t});if(!i){if(t===od.General)return void o.push(e);a.push(i={tabName:t,id:n,properties:[]})}i.properties.push(e)}),o.length&&a.length&&this._fixupPropertiesWithoutAssignedTab(a,o),a},_fixupPropertiesWithoutAssignedTab:function(e,t){var n=this,e=e[e.length-1].properties,i=e.length?e[0].page:null,s=(t.forEach(function(e){e.page=i,e.subfield=null}),e.findIndex(function(e){return n.getSectionName(e)!==od.General}));e.splice.apply(e,[s,0].concat(Q(t)))},sortPropertiesByCategoryName:function(e){var s=this,a=[];return e.forEach(function(e){var t=s.getCategoryName(e),n=e.category||"general",i=_.find(a,{categoryName:t});i||a.push(i={categoryName:t,id:n,properties:[]}),i.properties.push(e)}),a},groupPropertiesByGroupName:function(e){e=_.groupBy(e,this.getGroupName);return _.entries(e).map(function(e){e=J(e,2);return{groupName:e[0],properties:e[1]}})},sortPropertiesBySectionAndGroup:function(e){var s=this,e=_.groupBy(e,this.getSectionName),e=_.values(e).flat(),a=[];return e.forEach(function(e){var t=s.getSectionName(e),n=s.getGroupName(e),i=_.find(a,{sectionName:t,groupName:n});i||a.push(i={sectionName:t,groupName:n,properties:[]}),i.properties.push(e)}),a.flatMap(function(e){return e.properties})},sortAndFilterPropertiesBySectionName:function(e){var i=this,t=e.properties,s=e.currentField,a=e.currentBrandingSet,o=[],n=[];return t.forEach(function(e){var t,n;i._shouldShowPropertyInEditor({property:e,currentField:s,currentBrandingSet:a})&&(t=i.getSectionName(e),(n=_.find(o,{sectionName:t}))||o.push(n={sectionName:t,properties:[]}),n.properties.push(e))}),o.forEach(function(e){n=n.concat(e.properties)}),n},_shouldShowPropertyInEditor:function(e){var t=e.property,n=e.currentField,e=e.currentBrandingSet;return n===t.field&&!N.isDerivedProperty(t)&&N.isPropertyVisibleForBrandingSet(t,e)&&!this._isLoginPropertyAndLoginPageIsMissing(t)&&!("color"===t.field&&"notifications"===t.subfield)},_isLoginPropertyAndLoginPageIsMissing:function(e){return e.page===ld&&!E.getSite().get("loginpage")}},mr=[{label:cs("buttonPrimary"),class:"slds-button slds-button_brand primary-btn-preview"},{label:cs("buttonSecondary"),class:"slds-button slds-button_outline-brand secondary-btn-preview"},{label:cs("buttonTertiary"),class:"slds-button tertiary-btn-preview"}],dd={buttonColor:mr,buttonText:mr,buttonSize:[{label:cs("buttonStandard"),class:"slds-button slds-button_brand"},{label:cs("buttonSmall"),class:"slds-button slds-button_brand dxp-button-small"},{label:cs("buttonLarge"),class:"slds-button slds-button_brand dxp-button-large"}]},ud={buttons:{component:Backbone.View.extend({_headerTemplate:_.template('<div class="cb-BrandingPropertiesEditor-previewHeader">{{= headerText}}</div>'),render:function(e){return this._headerText=e,this._buttonPreviewOption=dd[l.getCategoryInfo()],this._renderButtons(),this},_renderButtons:function(){var n;this.$el.append(this._headerTemplate({headerText:this._headerText})),this._buttonPreviewOption&&(n='<div class="preview-card-container">',this._buttonPreviewOption.forEach(function(e,t){t='\n                    <div class="slds-card slds-card-preview'.concat(t,'">\n                        <div class="slds-card__body slds-card__body_inner slds-text-align_center cb-BrandingPropertiesEditor-previewButton">\n                            <button class="').concat(e.class,'">').concat(Ji["".concat("button","_previewContent")]||"",'</button>\n                        </div>\n                        <footer class="slds-card__footer slds-text-align_left">\n                            <span>').concat(e.label,"</span>\n                        </footer>\n                    </div>").trim();n+=t}),n+="</div>",this.$el.append(n.trim()))},destroy:function(){this.remove()}}),title:Ji["".concat("button","_previewHeader")]||""}},pd=function(e){return!!ud[e]},gd=function(e){return ud[e]},hd=function(e,s){var a={},e=_s.getResolvedBrandValues(e);return Object.entries(e).forEach(function(e){var t,e=J(e,2),n=e[0],i=e[1],e=s.find(function(e){return e.name===n});e&&("Image"===(null==(t=e.type)?void 0:t.name)?e.tokens.forEach(function(e){a[e]=getComputedStyle(document.documentElement).getPropertyValue(e)}):"Font"===(null==(t=e.type)?void 0:t.name)?e.tokens.forEach(function(e){a[e]=i.replace("google:","")}):e.tokens.forEach(function(e){a[e]=i}))}),a},md=Backbone.View.extend({className:"js-branding-properties-editor-content-preview slds-col cb-BrandingPropertiesEditor-preview",initialize:function(e){this._field=e,this._preview=gd(this._field),this.listenTo(I.event,"state:branding-set-values-updated",this.render)},render:function(){return pd(this._field)?this.$el.empty().append((new this._preview.component).render(this._preview.title).$el):this.$el.empty(),this},destroy:function(){this.remove()}}),vd=PicassoWebServices.Labels.ThemeEditor,bd=P.BRANDING_FIELD.COLOR,fd=P.BRANDING_FIELD.IMAGE,_d=P.BRANDING_PROP.FAV_ICON,Sd=P.FAV_ICON_ASSET_REF;var Cd=Backbone.View.extend({className:"js-branding-properties-editor cb-BrandingPropertiesEditor",templateHtml:'\n        <div class="slds-grid">\n            <div class="slds-col js-branding-properties-editor-container">\n                <div class="js-branding-properties-editor-header slds-p-horizontal_medium"></div>\n                <div class="js-branding-properties-editor-content slds-p-horizontal_medium slds-p-bottom_medium"></div>\n            </div>\n        </div>'.trim(),fieldDescriptionHtml:_.template('<span class="cb-BrandingPropertiesEditor-fieldDescription">{{= description}}</span>'),uncollapsibleSectionHtml:'<div class="cb-BrandingPropertiesEditor-uncollapsibleSection js-uncollapsible-section"></div>',collapsibleSectionHtml:'<ul class="slds-accordion js-accordion"></ul>',collapsibleSectionListItemTemplate:_.template('\n        <li class="slds-accordion__list-item">\n            <section class="js-accordion-section-collapsible slds-accordion__section {{= isOpen ? "slds-is-open" : ""}}" data-section="{{= devName }}">\n                <div class="slds-accordion__summary">\n                    <h3 class="slds-accordion__summary-heading">\n                        <button aria-controls="{{= id }}" aria-expanded="true" class="slds-button slds-button_reset slds-accordion__summary-action js-accordion-section">\n                            <span class="slds-accordion__summary-content cb-BrandingPropertiesEditor-collapsibleSectionName" title="{{= sectionName }}">{{= sectionName }}</span>\n                            <svg class="slds-accordion__summary-action-icon slds-button__icon" aria-hidden="true">\n                                <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#switch"></use>\n                            </svg>\n                        </button>\n                    </h3>\n                </div>\n                <div class="slds-accordion__content js-accordion-content" id="{{= id }}">\n                {{ if (sectionDescription) { }}\n                    <span class="cb-BrandingPropertiesEditor-collapsibleSectionDescription">{{= sectionDescription }}</span>\n                {{ } }}\n                </div>\n            </section>\n        </li>'.trim()),groupHeadingTemplate:_.template('<h3 class="cb-GroupHeading">\n            {{= groupName }}\n            {{ if (tooltip) { }}\n                '.concat((fr="{{= tooltip}}",D.tooltipButtonIcon({buttonClassName:"cb-GroupHeading-tooltip",tooltipToggle:"description-tooltip",tooltipPlacement:"right",tooltipLabel:fr})),"\n            {{ } }}\n        </h3>").trim()),events:{"click .js-accordion-section":"_handleSectionClick"},initialize:function(e){this._field=e.field,this._editors=[],this._currentBrandingSetView=N.isScopedBrandingSetManagementEnabled()?new ql({brandingField:this._field}):new Yl,this._setupData(),this._setupListeners(),this._brandingPreviewContainer=new md(this._field),this.$el.attr("data-field",this._field),this.listenTo(j.getAppEvent(),"theme-editor-action:show-detail",this._handleThemeEditorChange)},_handleThemeEditorChange:function(e){e===P.BRANDING_SET_TYPE.SCOPED?(this.$(".cb-VerticalNav-items").addClass("slds-hide"),this.$(".cb-VerticalNav-contentContainer").addClass("shift-left")):e===P.BRANDING_SET_TYPE.APP&&(this.$(".cb-VerticalNav-items").removeClass("slds-hide"),this.$(".cb-VerticalNav-contentContainer").removeClass("shift-left"))},render:function(){return this.$el.html(this.templateHtml),this._renderHeader(),this._renderContent(),this._renderPreview(),this.initTooltips(),this},initTooltips:function(){this.$('[data-toggle="description-tooltip"]').tooltip({container:".cb-ThemeEditor"})},show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")},_handleSectionClick:function(e){T(e.target.closest("section")).toggleClass("slds-is-open")},_setupData:function(){this._templateModel=I.getAppState().getCurrentPageTemplate(),this._currentBrandingSet=l.getPreviewBrandingSet(),this._currentPreviewScopedBrandingSet=l.getCurrentPreviewScopedBrandingSet(),this._currentBrandingSet&&(this._currentBrandingDefs=l.getBrandingSetPropertyDefs(this._currentBrandingSet.def))},_setupListeners:function(){var i=this;this.listenTo(this._currentBrandingSetView,"branding-set-name-clicked",function(){i.trigger("branding-set-name-clicked")}),this.listenTo(this,"navigate",function(e){var t=e.tab,n=e.section,e=e.category;e&&(e=i.$(".js-branding-VerticalNav-item-".concat(e)))&&!e.hasClass("slds-is-active")&&e.click(),t&&(e=i.$(".js-branding-tab-".concat(t)))&&0<e.length&&!e.hasClass("slds-is-active")&&e.click(),n&&(t=i.$('.js-accordion-section-collapsible[data-section="'.concat(n,'"]')))&&0<t.length&&!t.hasClass("slds-is-open")&&(i.$(".js-accordion-section-collapsible").removeClass("slds-is-open"),t.addClass("slds-is-open"))}),this.listenTo(I.event,"state:branding-set-values-updated",function(e,t,n){i!==e?i._reload():i._updateEditorsWithCssVariableReferences(n)}),this.listenTo(I.event,"state:preview-site-branding-set-updated",function(){i._reload(),i._renderPreview()}),this.listenTo(I.event,"state:preview-scoped-branding-set-updated",function(){i._reload(),i._renderPreview()})},_reload:function(){this._setupData(),this._renderContent()},_renderHeader:function(){this.$(".js-branding-properties-editor-header").append(this._currentBrandingSetView.render().$el)},_renderPreview:function(e){l.setCategoryInfo(e),pd(this._field)&&this.$(".js-branding-properties-editor-container").after(this._brandingPreviewContainer.render().$el)},_renderContent:function(){this._cleanupEditors();var e,t=this.$(".js-branding-properties-editor-content").empty();this._currentBrandingSet&&(e=cd.sortAndFilterPropertiesBySectionName({properties:this._currentBrandingDefs,currentField:this._field,currentBrandingSet:this._currentBrandingSet}),this._shouldDisplayCategoryLayout(e)?this._renderPropertiesInCategories(e,t):this._shouldDisplayTabbedLayout(e)?this._renderPropertiesInTabs(e,t):this._renderProperties(e,t)),this.trigger("post-render",t.is(":empty"))},_shouldDisplayCategoryLayout:function(e){return N.isBrandingSetEditorCategoryLayoutEnabled()&&this._hasAtLeastNUniqueValuesForMetadataProperty(e,"category",1)},_shouldDisplayGroupLayout:function(e){return N.isBrandingSetEditorGroupLayoutEnabled()&&this._hasAtLeastNUniqueValuesForMetadataProperty(e,"group",1)},_shouldDisplayTabbedLayout:function(e){return N.isBrandingSetEditorTabbedLayoutEnabled()&&this._hasAtLeastNUniqueValuesForMetadataProperty(e,"page",2)},_renderProperties:function(e,t){var n;0!==e.length&&(this._field===fd&&this._updateImageTypeProperties(e),n=void 0===(n=(n={field:this._field}).field)?"":n,(n=ps()["".concat(n,"_field_description")])&&t.append(this.fieldDescriptionHtml({description:n})),this._shouldDisplayCollapsibleSections(e)?this._renderPropertiesInCollapsibleSections(e,t):this._renderPropertiesInUncollapsibleSection(e,t),this._shouldAddColorPaletteGenerator())&&(this._colorPaletteGen=new sc({model:this._templateModel}),t.append(this._colorPaletteGen.$el))},_shouldDisplayCollapsibleSections:function(e){return!N.isSubfieldMetadataPropertyEnabled()||this._hasAtLeastNUniqueValuesForMetadataProperty(e,"subfield",2)},_renderPropertiesInUncollapsibleSection:function(e,i){var s=this,e=(i.append(this.uncollapsibleSectionHtml),cd.groupPropertiesByGroupName(e)),a=1===e.length&&e[0].groupName===vd.General;e.forEach(function(e){var t,n=e.groupName,e=e.properties;a||(t=0<e.length?ls(e[0]):"",s._appendGroup(n,t,i.find(".js-uncollapsible-section"))),e.forEach(function(e){return s._appendProperty(e,i.find(".js-uncollapsible-section"))})})},_renderPropertiesInCollapsibleSections:function(e,t){var s,a=this,o="",r=vd.General,l=(t.append(this.collapsibleSectionHtml),t.find(".js-accordion"));(e=this._shouldDisplayGroupLayout(e)?cd.sortPropertiesBySectionAndGroup(e):e).forEach(function(e,t){var n=cd.getSectionName(e),i=cd.getGroupName(e);n!==o&&(r=vd.General,n=(n=o=n)||PicassoWebServices.Labels.SiteGlobalProperties.BlankSection,s=T(a.collapsibleSectionListItemTemplate({isOpen:0===t,sectionName:n,id:(t=n,L.replaceSpaces(t,"-")),devName:e.subfield,sectionDescription:(n=void 0===(n=(n={subfield:e.subfield}).subfield)?"":n,ps()["".concat(n,"_subfield_description")]||"")})),l.append(s)),i!==r&&(r=i,t=ls(e),a._appendGroup(r,t,s.find(".js-accordion-content"))),a._appendProperty(e,s.find(".js-accordion-content"))})},_renderPropertiesInCategories:function(e,t){var n,i,a=this,e=cd.sortPropertiesByCategoryName(e),e=(this.$el.addClass("has-nav-content"),e.map(function(e,t){var n=e.categoryName,i=e.id,s=e.properties;return{label:n,itemClassName:"cb-BrandingPropertiesEditor-VerticalNav-item test-".concat(i," js-branding-VerticalNav-item-").concat(i),contentClassName:"cb-BrandingPropertiesEditor-VerticalNav-content",id:i,content:function(e){return this._renderProperties(s,e),e}.bind(a),isActive:0===t}}));i={items:e,className:"cb-BrandingPropertiesEditor-VerticalNav-container",onNavItemClick:function(e){a._renderPreview(e)}},(n=t).append(sd(_.extend({className:""},i))),_.each(i.items,function(e){n.find(".cb-VerticalNav-contentContainer").append(ad(_.extend({isActive:!1,contentClassName:""},e)))}),n.find(nd).each(function(e){i.items[e].view=i.items[e].content(T(this))}),n.on("click",id,function(e){var e=T(e.currentTarget),e=(n.find(id).removeClass("slds-is-active"),e.addClass("slds-is-active"),e.index()),t=(n.find(nd).addClass("slds-hide").removeClass("slds-show").eq(e).addClass("slds-show").removeClass("slds-hide"),i.items[e].view);t&&t.trigger&&t.trigger("focus"),i.onNavItemClick(i.items[e].id)})},_renderPropertiesInTabs:function(e,t){var a=this;ho(t,{items:cd.sortPropertiesByTabName(e).map(function(e,t){var n=e.tabName,i=e.id,s=e.properties;return{label:n,tabClassName:"cb-BrandingPropertiesEditor-tabItem test-".concat(i," js-branding-tab-").concat(i),contentClassName:"cb-BrandingPropertiesEditor-tabContent",content:function(e){return this._renderProperties(s,e),e}.bind(a),isActive:0===t}}),className:"cb-BrandingPropertiesEditor-tabContainer"})},_isSocialLinksEnabled:function(){return I.AccessControl(P.PERMISSIONS.IS_SOCIAL_LINKS_ENABLED)},_shouldAddSubfieldToImageTypeProperties:function(){return this._isSocialLinksEnabled()},_updateImageTypeProperties:function(e){this._shouldAddFavIcon()&&e.push(this._getFavIconProperty()),this._isSocialLinksEnabled()&&e.push(this._getSocialLinksProperty()),this._shouldAddSubfieldToImageTypeProperties()&&e.forEach(function(e){e.subfield=e.subfield||"general"})},_getFavIconProperty:function(){var e=lc(this._templateModel.get(Sd)),t=os({id:_d});return{field:fd,label:t,name:_d,defaultValue:e,updateProperty:function(e){var t,n,i;e&&(e=e.get("value"),L.isNullEmptyOrWhitespace(e)||(e=!(t=e)||-1===(n=t.indexOf(oc))?null:(i=oc.length+1,t.substring(n+i))),I.event.trigger("action:update-fav-icon-asset-ref",{value:e}))},type:{name:"Image"}}},_getSocialLinksProperty:function(){return{field:fd,subfield:"socialLinks",type:{name:"SocialLinks"}}},_isNonColorExpressionProp:function(e,t){return _s.isBrandExpression(e)&&!N.isColorProperty(t)},_getPropertyValue:function(e){var t=e.defaultValue;return this._currentPreviewScopedBrandingSet&&this._currentPreviewScopedBrandingSet.values.hasOwnProperty(e.name)?t=this._currentPreviewScopedBrandingSet.values[e.name]:this._currentBrandingSet.values.hasOwnProperty(e.name)&&(t=this._currentBrandingSet.values[e.name],this._isNonColorExpressionProp(t,e))&&(t=_s.getResolvedBrandValueFromPropName(e.name).getValue()),t},_getDefaultValue:function(e){var t,n=e.defaultValue;return this._currentPreviewScopedBrandingSet||(t=_s.getResolvedBrandValueFromPropName(e.name))&&(n=N.isColorProperty(e)?t.getExpression():t.getValue(),e.type.name===P.BRANDING_TYPE.PICKLIST)&&(n=e.defaultValue.split(",").map(function(e){e=e.includes(":default")?e.replace(":default",""):e;return e=e.split(":")[1]===n?"".concat(e,":default"):e}).join(",")),n},_appendProperty:function(e,t){var o,n,i,s,a;e&&(s=(o=this)._getPropertyValue(e),a=e.type.name,i=os({id:e.name,label:e.label}),n={name:e.name,label:i,value:{value:s},rawType:a,section:e.section,showLabel:!0,showRequired:!1,resetToDefaultEnabled:this._isResetToDefaultEnabled(e)},i=new Xl({id:e.name,name:e.name,label:i,page:e.page,field:e.field,tooltipLabel:rs({id:e.name}),value:s,cpdValue:this._getDefaultValue(e),editorAttributes:e.type.attributes,propType:a}),this.listenTo(i,"change",e.updateProperty||function(e){var t,n,i,s,a;e&&(n=e.get("name"),i=e.get("value"),e=e.get("propType"),e=e,n=[{name:n=n,value:i=i}],i=(t=o)._currentBrandingSet.values,t._currentBrandingSet.brandsource&&(i=_s.getResolvedBrandValues(i)),a=t._currentBrandingSet.id,t._currentPreviewScopedBrandingSet&&e===P.BRANDING_TYPE.COLOR&&(i=t._currentPreviewScopedBrandingSet.values,a=t._currentPreviewScopedBrandingSet.id),e===P.BRANDING_TYPE.IMAGE?s=$P.cbMetadata.getImageCalc(t._templateModel):e===P.BRANDING_TYPE.COLOR&&(s=$P.cbMetadata.getColorCalc(t._templateModel,i)),s&&(n=Ri(n,s)),I.event.trigger("action:update-branding-set-values",{id:a,values:n,eventSource:t,propType:e,successCallback:function(){t._currentBrandingSet=l.getPreviewBrandingSet(),t._currentPreviewScopedBrandingSet=l.getCurrentPreviewScopedBrandingSet()}}))}),s=i,i=(e=td[(a=n).rawType])?((e=new e(m({model:s},a))).$el.attr("data-name",a.name),e.$el.attr("data-type",a.rawType),e):null,this._editors.push(i),t.append(i.$el))},_appendGroup:function(e,t,n){e=this.groupHeadingTemplate({groupName:e,tooltip:t});n.append(e)},_updateEditorsWithCssVariableReferences:function(e){var n=this,e=(this._currentPreviewScopedBrandingSet&&e===P.BRANDING_TYPE.COLOR?this._currentPreviewScopedBrandingSet:this._currentBrandingSet).values;Object.entries(e).filter(function(e){e=J(e,2),e[0],e=e[1];return N.isCssVariableReference(e)}).map(function(e){var e=J(e,2),t=e[0];e[1];return t}).forEach(function(t){var e=_.find(n._editors,function(e){return e.model.id===t});e&&e.model.get("propType")===P.BRANDING_TYPE.COLOR&&e.update()})},_shouldAddColorPaletteGenerator:function(){return this._field===bd&&!_.isEmpty($P.cbMetadata.getColorSwatch(this._templateModel))},_shouldAddFavIcon:function(){return E.getSite().get("isWebApp")&&this._field===fd},_isResetToDefaultEnabled:function(e){return E.getSite().get("isWebApp")&&N.isColorProperty(e)},_hasAtLeastNUniqueValuesForMetadataProperty:function(e,t,n){e=new Set(e.map(function(e){return e[t]}));return e.delete(null),e.delete(void 0),e.delete(""),e.size>=n},_cleanupEditors:function(){_.each(this._editors,function(e){e.destroy&&e.destroy()}),this._editors.length=0,this._colorPaletteGen&&(this._colorPaletteGen.destroy(),this._colorPaletteGen=null),this._favIconPaletteGen&&(this._favIconPaletteGen.destroy(),this._favIconPaletteGen=null)},destroy:function(){this._cleanupEditors(),this._currentBrandingSetView.destroy(),this.remove()}}),yd=Backbone.View.extend({className:"cb-ThemeLayoutPropertiesEditor test-theme-layout-properties-editor",initialize:function(e){this._themeLayoutId=e.themeLayoutId,this.listenTo(I.event,"state:aura-component-updated",this._handleAuraCmpUpdated),this.listenTo(I.event,"state:theme-layout-updated",this.render)},render:function(){var n;return this._cleanUp(),this._themeLayoutId?(this.$el.html(D.spinner),n=this,$P.auraRun(function(){$A.createComponent("markup://visualEditor:componentPropertiesEditor",{connectorType:"communityBuilderComponent",itemId:n._themeLayoutId,context:n._themeLayoutId,params:{siteId:$P.siteId},showTitle:!1,validateAttributesOnInit:!1},function(e){e.addEventHandler("componentInitialized",function(e){e=e.getParam("values");n.trigger("post-render",$A.util.isEmpty(e))}),e.autoDestroy(!1);var t=n.$el.empty();$A.render(e,t[0]),$A.afterRender(e),e.addEventHandler("propertiesChanged",n._handlePropertiesChanged.bind(n))})})):this.trigger("post-render",!0),this},refresh:function(e){this._themeLayoutId=e,this.render()},destroy:function(){this._cleanUp(),this.remove()},_handleAuraCmpUpdated:function(e){var t=e.itemId;e.eventSource!==this&&t===this._themeLayoutId&&this.render()},_handlePropertiesChanged:function(e){if(e.getParam("arePropsValid")){var t,n=e.getParam("context"),i=e.getParam("props"),s={};for(t in i)i.hasOwnProperty(t)&&(s[t]=i[t].value);I.event.trigger("action:update-aura-component",{itemId:n,values:s,eventSource:this})}},_cleanUp:function(){var e=this.$(".visualEditorComponentPropertiesEditor")[0];e&&(e=$A.componentService.getAttributeProviderForElement(e))&&e.destroy()}}),t=PicassoWebServices.Labels.ThemeEditor,Td=P.PROP;var Pd=Backbone.View.extend({className:"cb-ThemeLayoutRefs test-theme-layout-refs-popover",template:_.template('<div class="slds-grid slds-grid--align-spread"><span class="slds-text-color_weak slds-m-bottom_x-small js-pages-affected-title">{{= title }}</span>{{= $P.viewTypes.CommonTemplates.buttonIcon({ buttonClassName: "slds-m-left_x-small slds-align-top js-close-btn", svgClassName: "slds-icon_x-small cb-ThemeLayoutRefs-closeIcon", icon: "close", label: "" }) }}</div><ul class="cb-ThemeLayoutRefs-list js-list"></ul>{{ if (displayShowAll) { }}<div class="cb-ThemeLayoutRefs-showAll slds-m-top_small js-show-all">'+t.ShowAll+"</div>{{ } }}"),listItemTemplate:_.template('<li class="cb-ThemeLayoutRefs-listItem slds-truncate slds-grid slds-p-top_small" title="{{- name }}"><span class="test-theme-layout-ref-page">{{- name }}</span>{{ if (showCurrentBadge) { }}<span class="slds-badge slds-p-horizontal_x-small slds-m-left_x-small">'+t.CurrentPage+"</span>{{ } }}</li>"),events:{"click .js-show-all":"_showAll"},render:function(){var e,t,n=this._getAllRefItemsSorted(),i=n.length,s=5<i&&!this._options.showAll;return s&&(n=n.slice(0,4)),this.$el.html(this.template({title:(i=i,e=this._options.pluralLabel,t=this._options.singularLabel,1<i||0===i?L.format(e,"<strong>"+i+"</strong>"):t),displayShowAll:s})),this._renderList(n),this},setThemeLayoutType:function(e,t){return this._themeLayoutType=e,this._options=t||{},this.render()},_renderList:function(e){e=_.map(e,function(e,t){e=e.get(Td.NAME_KEY);return this.listItemTemplate({name:e,showCurrentBadge:0===t&&this._options.showCurrentBadge})}.bind(this));this.$(".js-list").html(e.join(""))},_getAllRefItemsSorted:function(){var e=k.getViewsForThemeLayoutType(this._themeLayoutType),t=I.getAppState().getCurrentViewId(),n=this._options.showCurrentBadge,i=[];if(n){for(var s=0;s<e.length&&e[s].id!==t;++s);i=e.splice(s,1)}return e=e.sort(function(e,t){return e.get(Td.NAME_KEY).localeCompare(t.get(Td.NAME_KEY))}),i.concat(e)},_showAll:function(){this._renderList(this._getAllRefItemsSorted()),this.$(".js-show-all").hide()},destroy:function(){this.remove()}}),Id=PicassoWebServices.Labels.ThemeEditor,Ed=P.PROP,wd=Backbone.View.extend({className:"cb-ThemeSettingsEditor slds-border_top slds-p-top_medium slds-p-horizontal_medium slds-p-bottom_small js-theme-settings-editor",template:_.template('<div class="cb-ThemeSettingsEditor-refsContainer js-refs-container"><div class="js-current-theme-layout">{{= currentThemeLayout }}</div><div class="cb-ThemeSettingsEditor-refsTrigger js-refs-trigger">'+Id.ThemeLayoutAffectedPagesTrigger+'</div></div><div class="cb-ThemeSettingsEditor-propsContainer slds-m-top_medium js-props-container"></div>'),events:{"click .js-refs-trigger":"_openRefsPopover"},initialize:function(){this._viewId=I.getAppState().getCurrentViewId(),this._propsEditor=new yd({themeLayoutId:this._getThemeLayoutId()}),this._refsPopover=new Pd,this.listenTo(this._propsEditor,"post-render",function(e){this.trigger("post-render",e)}.bind(this)),this.listenTo(I.event,"state:view-properties-updated",this._handleViewPropUpdated),this.listenTo(I.event,"state:theme-layout-property-updated",this._refreshPropsEditor),this.listenTo(I.event,"state:theme-layout-deleted",this._refreshPropsEditor),this.listenTo(I.event,"state:page-change-start",this._handlePageChangeStart),this.listenTo(I.event,"state:page-change-success",this._handlePageChangeSuccess)},render:function(){var e=this._getCurrentThemeLayoutDescription(this._viewId);return this.$el.html(this.template({currentThemeLayout:e})),this.$(".js-props-container").append(this._propsEditor.render().el),this},show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")},destroy:function(){this._propsEditor.destroy(),this._refsPopover.destroy(),this.remove()},_openRefsPopover:function(e){e=T(e.currentTarget);Zr({view:this._refsPopover.setThemeLayoutType(this._getThemeLayoutType(),{pluralLabel:Id.ThemeLayoutAffectedPagesTitlePlural,singularLabel:Id.ThemeLayoutAffectedPagesTitleSingular,showCurrentBadge:!0}).$el[0],trigger:e[0],options:{dismissSelector:".js-close-btn",dismissSelectorLabel:PicassoWebServices.Labels.PicassoDialog.Close,className:"cb-ThemeLayoutRefs",horizontalOffset:10,offsetTriggerHeight:!1,nubbinPosition:"left-top"}}).show()},_handleViewPropUpdated:function(e,t){t[Ed.THEME_LAYOUT_TYPE_KEY]&&this._refreshPropsEditor()},_handlePageChangeStart:function(e){e=e.viewId;this._refreshPropsEditorIfViewChanged(e),this._refreshCurrentThemeLayoutDescription(e)},_handlePageChangeSuccess:function(e){this._refreshPropsEditorIfViewChanged(e.viewId)},_refreshPropsEditorIfViewChanged:function(e){e!==this._viewId&&(this._viewId=e,this._refreshPropsEditor())},_refreshPropsEditor:function(){this._propsEditor.refresh(this._getThemeLayoutId())},_refreshCurrentThemeLayoutDescription:function(e){this.$(".js-current-theme-layout").text(this._getCurrentThemeLayoutDescription(e))},_getCurrentThemeLayoutDescription:function(e){e=S.getThemeLayoutByViewId(e);return L.format(Id.CurrentThemeLayout,e.name)},_getThemeLayoutType:function(){var e=S.getThemeLayoutByViewId(this._viewId);return e&&e.type},_getThemeLayoutId:function(){var e=S.getThemeLayoutByViewId(this._viewId);return e&&e.themeLayoutId}}),e=PicassoWebServices.Labels.ChangeThemeWizard,Ld=Backbone.View.extend({className:"cb-ThemeTile js-theme-tile",template:_.template('<div class="cb-ThemeTile-imageContainer slds-box_border js-imageContainer" data-src="{{= imageUrl }}"></div><div class="cb-ThemeTile-header {{= isActive ? "is-active" : "" }} slds-grid slds-grid_align-spread"><header class="cb-ThemeTile-name slds-truncate test-theme-display-name">{{- displayName }}</header><span class="cb-ThemeTile-activeBadge slds-badge slds-badge_inverse">'+e.ActiveThemeBadge+"</span></div>"),events:{click:"_onViewDetails"},initialize:function(e){this._theme=e.theme},render:function(){return this.$el.html(this.template({displayName:this._theme.displayName,imageUrl:this._theme.imgUrls[0],isActive:this._theme.id===S.getCurrentTheme().id})),this},getDevName:function(){return this._theme.devName},getTileRenderInfo:function(){var e=this.$(".js-imageContainer")[0].getBoundingClientRect();return{height:e.height,width:e.width,top:e.top,left:e.left}},destroy:function(){this.remove()},_onViewDetails:function(){this.trigger("viewDetails")}}),Dd=PicassoWebServices.Labels.ChangeThemeWizard,Ad=Backbone.View.extend({className:"cb-ChangeThemeWizardList slds-container_fluid test-change-theme-wizard-list",themesListHtml:'<div class="cb-ChangeThemeWizardList-tiles js-tilesList slds-grid slds-wrap slds-grid--vertical-stretch"></div>',spinnerHtml:'<div role="status" class="slds-spinner slds-spinner_brand slds-spinner_medium js-spinner"><span class="slds-assistive-text">Loading</span><div class="slds-spinner__dot-a"></div><div class="slds-spinner__dot-b"></div></div>',render:function(){return this.$el.html(this.themesListHtml),this.$el.append(this.spinnerHtml),this._themeTiles&&this._renderTiles(),this},getTileRenderInfo:function(t){return _.find(this._themeTiles,function(e){return e.getDevName()===t}).getTileRenderInfo()},getSubtitle:function(){return Dd.ChangeThemeSubTitle},setThemes:function(e){this._themeTiles=this._createTiles(e),_.each(this._themeTiles,function(e){this.listenTo(e,"viewDetails",function(){this.trigger("viewThemeDetails",e.getDevName())}.bind(this))}.bind(this))},destroy:function(){_.each(this._themeTiles,function(e){e.destroy()}),this.remove()},_createTiles:function(e){return _.map(e,function(e){return new Ld({theme:e})})},_renderTiles:function(){var t=this.$(".js-tilesList"),s=(_.each(this._themeTiles,function(e){t.append(e.render().el)}),this._themeTiles.length),a=0;this.$(".js-imageContainer").each(function(e,t){var n=t.getAttribute("data-src"),i=new Image;i.onload=function(){t.style.backgroundImage="url("+n+")",++a===s&&this._animate()}.bind(this),i.onerror=function(){++a===s&&this._animate()}.bind(this),i.src=n}.bind(this))},_animate:function(){this.$(".js-spinner").velocity({opacity:0},{duration:300}),this.$(".js-theme-tile").velocity("transition.expandIn",{duration:600,stagger:200})},hide:function(){this.$el.addClass("hide")},show:function(){this.$el.removeClass("hide")}}),kd=PicassoWebServices.Labels.ChangeThemeWizard;var Nd=Backbone.View.extend({className:"cb-ChangeThemeWizardDetailsView js-change-theme-wizard-detail test-change-theme-wizard-detail",detailsTemplate:_.template('<div class="cb-ChangeThemeWizardDetailsView-tileImage slds-hide js-tile-image" style="background-image:url({{= imageUrl }});"></div><div class="cb-ChangeThemeWizardDetailsView-container js-detail-container slds-container--x-large slds-container--center">{{ if (isActive) { }}<div class="cb-ChangeThemeWizardDetailsView-activeMsgContainer slds-box js-active-msg">'+D.icon({icon:"info",svgClassName:"cb-ChangeThemeWizardDetailsView-infoIcon"})+'<span class="cb-ChangeThemeWizardDetailsView-activeMessage">'+kd.ThemeActiveMessage+'</span></div>{{ } }}<div class="slds-grid"><div class="cb-ChangeThemeWizardDetailsView-screenshotsContainer slds-grid slds-grid_vertical slds-grid_vertical-align-end js-theme-detail-screenshots">{{= screenshotsHtml}}</div><div class="cb-ChangeThemeWizardDetailsView-detailSection js-detail-section"><div class="cb-ChangeThemeWizardDetailsView-themeTitle slds-text-heading_large js-theme-title">{{- themeName }}</div><div class="cb-ChangeThemeWizardDetailsView-themeSubtitle slds-text-heading_small slds-text-color_weak slds-truncate js-theme-subtitle">{{- publisher }}</div><div class="slds-grid slds-m-top_large"><button type="button" class="cb-ChangeThemeWizardDetailsView-chooseButton slds-button slds-button--brand slds-truncate js-choose-theme {{= isActive ? "disabled" : ""}}" title="'+kd.ChooseThemeButton+'">'+kd.ChooseThemeButton+'</button><div class="cb-ChangeThemeWizardDetailsView-spinnerContainer slds-hide js-spinner-container"><div role="status" class="cb-ChangeThemeWizardDetailsView-spinner slds-spinner slds-spinner_brand slds-spinner_small"><span class="slds-assistive-text">'+kd.ChangingTheme+'</span><div class="slds-spinner__dot-a"></div><div class="slds-spinner__dot-b"></div></div></div></div><div class="cb-ChangeThemeWizardDetailsView-description slds-text-heading_small js-theme-detail-description">{{- themeDescription}}</div>{{ if (highlightsHtml) { }}<div class="cb-ChangeThemeWizardDetailsView-highlightsHeader slds-text-heading_medium">'+kd.Features+"</div><div>{{= highlightsHtml}}</div>{{ } }}</div></div></div>"),screenshotTemplate:_.template('<div class="cb-ChangeThemeWizardDetailsView-imageBody js-screenshot"><div class="cb-ChangeThemeWizardDetailsView-imageContainer" style="background-image:url({{= imageUrl }});"></div></div>'),highlightTemplate:_.template('<div class="cb-ChangeThemeWizardDetailsView-highlight slds-m-top_medium"><div>{{= icon}}<span class="cb-ChangeThemeWizardDetailsView-highlightName slds-text-heading_small">{{= name }}</span></div><div class="cb-ChangeThemeWizardDetailsView-highlightDesc slds-p-top_xx-small">{{= desc }}</div></div>'),confirmDlgSubtitleHtml:'<div class="cb-ChangeThemeWizardDetailsView-confirmChoiceSubtitle1">'+kd.ChooseVersionSubtitle1+'</div><div class="cb-ChangeThemeWizardDetailsView-confirmChoiceSubtitle2">'+kd.ChooseVersionSubtitle2+"</div>",events:{"click .js-choose-theme:not(.disabled)":"_onClickChoose"},initialize:function(e){this._service=e.service},render:function(){var e=_.map(this._selectedTheme.imgUrls,function(e){return this.screenshotTemplate({imageUrl:e})}.bind(this)),t=_.map(this._selectedTheme.highlights,function(e){return this.highlightTemplate({name:e.displayName,icon:(t=(t=e).icon)?D.icon({icon:t}):"",desc:e.description});var t}.bind(this));return this.$el.html(this.detailsTemplate({isActive:this._isActive,themeName:this._selectedTheme.displayName,publisher:kd.ByPublisher.replace("{0}",this._selectedTheme.publisher),themeDescription:this._selectedTheme.description,imageUrl:this._selectedTheme.imgUrls[0],screenshotsHtml:e.join(""),highlightsHtml:t.join("")})),this._isActive?this.$el.addClass("isActive"):this.$el.removeClass("isActive"),setTimeout(this._animate.bind(this),0),this},getSubtitle:function(){return kd.ThemeDetailSubTitle},hide:function(){this.$(".js-detail-container").addClass("slds-hide"),this.$(".js-tile-image").removeClass("slds-hide").velocity(this._getTileRect(),{duration:this.TILE_ANIMATION_DURATION,easing:"ease",complete:function(){this.$el.hide()}.bind(this)})},setTheme:function(e){this._selectedTheme=e,this._isActive=this._selectedTheme.id===S.getCurrentTheme().id},destroy:function(){this.remove()},_getTileRect:function(){var e=this._service.getTileRenderInfo(this._selectedTheme.devName);return{top:e.top-this._getElTop(),left:e.left,width:e.width,height:e.height}},_getElTop:function(){return this.el.getBoundingClientRect().top},_onClickChoose:function(){var e;this._selectedTheme.id&&this._selectedTheme.hasDefinition?(e=[{variantClassName:"slds-visual-picker_vertical",id:"cb-ChangeThemeWizardDetailsView-useOldVersion",value:"old",checked:!0,displayName:kd.UseOldVersion,description:kd.UseOldVersionDesc},{variantClassName:"slds-visual-picker_vertical",id:"cb-ChangeThemeWizardDetailsView-useNewVersion",value:"new",checked:!1,displayName:kd.UseNewVersion,description:kd.UseNewVersionDesc}],A.confirmChoice(kd.ChooseVersion,e,function(e,t){e?this._changeTheme("new"===t):this._toggleSpinner(!1)}.bind(this),{className:"slds-vex-theme slds-vex-theme--medium",hero:this.confirmDlgSubtitleHtml,yesText:kd.Choose})):this._changeTheme(!1)},_changeTheme:function(e){this._toggleSpinner(!0),this.trigger("change-theme-clicked"),I.event.trigger("action:swap-current-theme",{devName:this._selectedTheme.devName,resetToOriginal:e,successCallback:this._handleChangeThemeSuccess.bind(this),errorCallback:this._handleChangeThemeError.bind(this)})},_toggleSpinner:function(e){e?(this.$(".js-spinner-container").removeClass("slds-hide"),this.$(".js-choose-theme").addClass("disabled")):(this.$(".js-spinner-container").addClass("slds-hide"),this.$(".js-choose-theme").removeClass("disabled"))},_handleChangeThemeSuccess:function(){this.trigger("theme-change-success")},_handleChangeThemeError:function(e){this._toggleSpinner(!1),this.trigger("theme-change-error"),e&&A.sldsPromptAlert({content:e,title:PicassoWebServices.Labels.CommunityBuilder.ChangeThemeToastError})},_animate:function(){T(".cb-ChangeThemeWizard").animate({scrollTop:0},200,function(){this._animateContent()}.bind(this))},_animateContent:function(){var e=this.$(".js-tile-image"),t=(e.css(this._getTileRect()).removeClass("slds-hide"),this.$(".js-screenshot")),n=t.first(),i=n[0].getBoundingClientRect(),s=i.height+"px",a=i.width+"px";e.velocity({height:s,width:a,top:i.top-this._getElTop(),left:i.left},{duration:this.TILE_ANIMATION_DURATION,easing:"ease",complete:function(){n.css("opacity",1),e.addClass("slds-hide")}}),this.$(".js-active-msg").velocity("transition.slideDownIn",{delay:350,duration:450}),this.$(".js-detail-section").velocity("transition.slideDownBigIn",{delay:350,duration:450}),t.slice(1).velocity({opacity:1},{delay:350,duration:450})}}),xd=PicassoWebServices.Labels.ChangeThemeWizard,Rd=Backbone.View.extend({className:"cb-ChangeThemeWizard",template:_.template('<div class="js-wizard-container"><div class="cb-ChangeThemeWizard-header slds-container--x-large"><a class="cb-ChangeThemeWizard-backButton js-header-back-button" href="javascript:void(0)" title="'+xd.HeaderBackLink+'">'+D.icon({svgClassName:"cb-ChangeThemeWizard-headerLinkIcon",icon:"chevronleft"})+'<span class="cb-ChangeThemeWizard-backButtonLabel">'+xd.HeaderBackLink+'</span></a><a class="cb-ChangeThemeWizard-closeButton js-header-close-button" href="javascript:void(0)" title="'+xd.HeaderCloseLink+'">'+D.icon({svgClassName:"cb-ChangeThemeWizard-headerLinkIcon",icon:"close"})+'</a><div class="cb-ChangeThemeWizard-headerTitle slds-text-heading_large js-header-title">'+xd.ChangeThemeTitle+'</div><div class="cb-ChangeThemeWizard-headerSubTitle slds-text-heading_small slds-m-top_xx-small slds-text-color_weak js-header-subtitle">'+xd.ChangeThemeSubTitle+'</div></div><div class="cb-ChangeThemeWizard-content slds-container--x-large slds-container--center"><div class="cb-ChangeThemeWizard-sectionContainer js-section-container slds-hide"></div></div></div>'),events:{"click .js-header-close-button":"_close","click .js-header-back-button":"_back"},initialize:function(){this._previousSteps=[],this._listSection=new Ad;var e={getTileRenderInfo:function(e){return this._listSection.getTileRenderInfo(e)}.bind(this)};this._detailViewSection=new Nd({service:e}),S.getThemeDefinitionsPromise().done(function(e){this._themes=e,this._listSection.setThemes(e),this._currentStep===this._listSection&&this._listSection.render()}.bind(this)),this.listenTo(this._listSection,"viewThemeDetails",function(e){this._handleViewThemeDetails(e)}.bind(this)),this.listenTo(this._detailViewSection,"theme-change-success",function(e){this._close(e,!0)}),this.listenTo(this._detailViewSection,"change-theme-clicked",function(){this.$(".js-header-close-button").focus(),this.$(".js-header-back-button").css({visibility:"hidden"})}),this.listenTo(this._detailViewSection,"theme-change-error",function(){this.$(".js-header-back-button").css({visibility:"visible"})}),T("body").append(this.render().el)},render:function(){return this.$el.velocity({top:[0,"100%"]},{easing:"ease-in",duration:500,complete:function(){this.$el.html(this.template()),this._animate()}.bind(this)}),this},_animate:function(){T.Velocity.RunSequence([{elements:this.$(".js-header-title"),properties:"transition.slideDownIn",options:{duration:400,complete:function(){this._setContent(this._listSection)}.bind(this)}},{elements:this.$(".js-header-subtitle").add(".js-header-close-button"),properties:"transition.slideDownIn",options:{delay:200,duration:400,sequenceQueue:!1,complete:function(){this.$(".js-section-container").removeClass("slds-hide")}.bind(this)}}])},_handleViewThemeDetails:function(t){var e=_.find(this._themes,function(e){return e.devName===t});this._detailViewSection.setTheme(e),this._previousSteps.push(this._currentStep),this._currentStep.hide(),this._setContent(this._detailViewSection,!0)},_back:function(){var e,t;0<this._previousSteps.length&&(e=this._previousSteps.pop(),t=this._currentStep,this._setContent(e,!1),t.hide())},_close:function(e,t){this.$(".js-wizard-container").velocity("transition.slideDownBigOut",{duration:100}),this.$el.velocity({top:["100%",0]},{easing:"ease-out",duration:500,complete:function(){t&&w.success({message:xd.ThemeActivatedToastMessage,duration:w.DURATION_MEDIUM}),this._destroy()}.bind(this)})},_destroy:function(){this._listSection.destroy(),this._detailViewSection.destroy(),this.remove()},_setContent:function(e,t){this.$(".js-header-subtitle").html(e.getSubtitle());var n=this.$(".js-section-container");0<n.find(e.$el).length?(t&&e.render(),e.$el.show()):n.append(e.render().$el),this._currentStep=e,0<this._previousSteps.length?this.$(".js-header-back-button").velocity("transition.fadeIn",{delay:200,duration:300}).css({visibility:""}):(this.$(".js-header-back-button").css({visibility:"hidden"}),this._currentStep.show())}}),jd=null;var Bd={openNavMenuEditor:function(i){$P.auraRun(function(){var e=function(){var e,t={networkId:I.getAppState().get("currentSite").get("networkId"),isPublished:I.getAppState().get("currentSite").get("isActive")},n={hasSubMenus:!0,hasHome:!0,hasCustomBrands:!0,exitConfirmLabel:$A.get("$Label.navigationCustomMenuEditor.ExitMenuEditorConfirm"),unsavedChangesLabel:$A.get("$Label.navigationCustomMenuEditor.UnsavedChangesMenu"),deletePanelLabel:$A.get("$Label.navigationCustomMenuEditor.DeleteMenuItem"),deleteConfirmLabel:$A.get("$Label.navigationCustomMenuEditor.RemoveMenuEditorItemConfirm")};for(e in n)t[e]=n[e];return t}();$A.createComponent("communitySetup:navigationBarCustomEditor",e,function(e,t,n){$A.assert(e,"Failed to create navigation menu editor: "+n),$A.getEvt("markup://ui:createPanel").setParams({panelType:"modal",visible:!0,owner:$A.getRoot().getGlobalId(),panelConfig:{title:i.title,header:i.header,body:e,flavor:"cbDefault",useTransition:!1,showCloseButton:!0,closeDialogLabel:"",closeAction:function(){e.closeDialog()},returnFocusElementSelector:".js-nav-menu-edit"}}).fire()})})},openChangeThemeWizard:function(){jd&&T.contains(document.body,jd.el)||(jd=new Rd)}},Od=PicassoWebServices.Labels.ThemeEditor,Md=Backbone.View.extend({className:"cb-CurrentBrandSource slds-text-color_weak slds-truncate",_template:_.template('<span>\n            <div class="cb-CurrentBrandSource-title slds-p-bottom_xx-small">'.concat(Od.Brand,'</div>\n            <div class="slds-p-bottom_x-small">').concat(Od.SelectBrandDescription,'</div>\n            {{ if(!name) { }}\n            <button class="js-brand-cms-selector slds-button slds-button_brand">').concat(Od.SelectBrand,'</button>\n            {{ } else { }}\n            <div class="cb-CurrentBrandSource-editor slds-p-top_small">\n                <div class="cb-CurrentBrandSource-brand_name">\n                    <span class="cb-CurrentBrandSource-name" title="{{= name }}">\n                    {{= name }}\n                    </span>\n                </div>\n                ').concat(D.buttonIcon({buttonClassName:"js-unlink-brand",buttonVariantClassName:"slds-button_neutral",svgClassName:"slds-icon_x-small",icon:"clear",label:"".concat(Od.Remove)}),"\n            </div>\n            {{ } }}\n        </span>").trim()),events:{"click .js-brand-cms-selector":"_showCMSContentSelector","click .js-unlink-brand":"_unlinkBrand"},initialize:function(){this._currentBrandingSet=l.getPreviewBrandingSet(),this._brandingSetDefs=l.getBrandingSetPropertyDefs(this._currentBrandingSet.def);this.listenTo(I.event,["state:preview-site-branding-set-updated","state:preview-scoped-branding-set-updated"].join(" "),this.render)},render:function(){var e;return this._shouldRenderBrandSourceEditor()?this.$el.html(this._template({name:null==(e=this._currentBrandingSet.brandsource)?void 0:e.title})).show():this.$el.html("").hide(),this},_showCMSContentSelector:function(){var n=this;rc({successCallback:function(e){var t=e.contentKey;_s.getBrandingSetToBrandMap(t,n._currentBrandingSet.id).then(function(e){n._updateBrandSource(e,t)})},targetId:I.getAppState().getNetworkId(),contentType:P.CMS_CONTENT_TYPE.BRAND})},_unlinkBrand:function(){var n=this,e=L.format(Od.RemoveBrandConfirmContent,this._currentBrandingSet.name),t=L.format(Od.RemoveBrandConfirmTitle,this._currentBrandingSet.name);A.sldsConfirm(e,t,function(e){var t;e&&(n._currentBrandingSet=l.getPreviewBrandingSet(),e=_s.getPropertiesOnReset(n._currentBrandingSet.values,n._brandingSetDefs),t=_s.calculateDerivedColorProperties(e,n._brandingSetDefs,!0),I.event.trigger("action:unlink-brand-from-branding-set",{brandingSetId:n._currentBrandingSet.id,brandingSetValues:Object.assign({},e,t),successCb:function(){_s.resetBrandingSetToBrandMap()}}))},{yesText:Od.Reset,noText:Od.Cancel,yesTextClassName:"slds-button slds-button_destructive"})},_isBrandLinkEnabled:function(){return I.AccessControl(P.PERMISSIONS.BRAND_CONTENT_LINK)},_shouldRenderBrandSourceEditor:function(){return N.isBrandingSetEditorEnabled()&&!l.getCurrentPreviewScopedBrandingSet()&&this._isBrandLinkEnabled()},_showErrorMessage:function(e){e&&A.sldsPromptAlert({content:e,title:Od.Error})},_updateBrandSource:function(e,t){var e=e.BrandingSetToBrandMap,e=(_s.setBrandingSetToBrandMap(e),_s.applyBrandToBrandingSet(this._currentBrandingSet.values)),n=_s.calculateDerivedColorProperties(e,this._brandingSetDefs),e=Object.assign({},e,n);I.event.trigger("action:link-brand-in-branding-set",{contentKey:t,brandingSetId:this._currentBrandingSet.id,brandingSetValues:e,errorCallback:this._showErrorMessage})},destroy:function(){this.remove()}}),i=PicassoWebServices.Labels.ThemeEditor,Vd=P.BRANDING_FIELD,ot=PicassoWebServices.Labels.CommBuilderPageManagement,$d="buttons";function Ud(e){return D.icon({svgClassName:"slds-m-right_x-small cb-ThemeEditor-itemIcon",icon:e})}var Wd=Backbone.View.extend({className:"cb-ThemeEditor js-theme-editor",_template:_.template('\n        <div class="js-theme-editor-main-view">\n        <div class="js-current-brand-source"></div>\n        {{ if (!loading) { }}\n            <div class="spinner-container slds-spinner_container cb-ThemeEditor-loading">\n                <div role="status" class="slds-spinner slds-spinner_brand slds-spinner_medium js-spinner">\n                    <span class="slds-assistive-text">\n                        '.concat(ot.Loading,'\n                    </span>\n                    <div class="slds-spinner__dot-a"></div><div class="slds-spinner__dot-b"></div>\n                </div>\n            </div>\n        </div>\n        {{ } else {}}\n            {{= thumbnailContainer }}\n            <div class="cb-ThemeEditor-brandingSetName js-current-branding-container">\n            </div>\n            <div class="cb-ThemeEditor-guidanceText slds-hide">\n                ').concat(i.ColoPaletteGuidanceText,'\n            </div>\n            <div class="cb-ThemeEditor-listContainer slds-m-top--xx-small slds-m-bottom--small">\n                <ul class="js-list-container">\n                    {{= list }}\n                </ul>\n            </div>\n        </div>\n        <div class="cb-ThemeEditor-detailContainer js-detail-container" data-type="').concat("none",'">\n        </div>\n        {{ } }}').trim()),_thumbnailContainerTemplate:_.template('\n        <div class="cb-ThemeEditor-thumbnailContainer slds-panel slds-border--top slds-border--bottom slds-border--left slds-border--right slds-m-horizontal--small js-thumbnail-container">\n            <div class="cb-ThemeEditor-themeName slds-align_absolute-center slds-p-top--xx-small slds-p-bottom--xx-small">{{- themeName }}</div>\n            <div class="cb-ThemeEditor-thumbnailBorder slds-align_absolute-center">\n                <div class="cb-ThemeEditor-thumbnailImage" style="background-image:url({{= imgUrl }})"></div>\n            </div>\n            {{ if (isChangeThemeEnabled) { }}\n            <div class="cb-ThemeEditor-changeTheme slds-align_absolute-center slds-border--top slds-p-top--xx-small slds-p-bottom--xx-small js-change-theme">\n                <a class="cb-ThemeEditor-changeThemeLink slds-text-link--reset" href="javascript:void(0)">\n                    '.concat(i.ChangeTheme,"\n                </a>\n            </div>\n            {{ } }}\n        </div>").trim()),_listItemTemplate:_.template('\n        <li class="cb-ThemeEditor-listItem js-list-item" data-type="{{= type }}">\n            <a href="javascript:void(0);" class="cb-ThemeEditor-listItemTrigger slds-text-link--reset slds-text-color_default slds-grid slds-grid--align-spread">\n                <span class="slds-grid slds-grid_vertical-align-center cb-ThemeEditor-listItemInner">\n                    {{= icon }}\n                    <span class="cb-ThemeEditor-listItemInnerLabel slds-truncate">\n                        {{= label }}\n                    </span>\n                </span>\n                {{= $P.viewTypes.CommonTemplates.icon({ svgClassName: "cb-ThemeEditor-chevronIcon", icon: "chevronright" }) }}\n            </a>\n        </li>'.trim()),events:{"click .js-change-theme":"_showChangeThemeWizard","click .js-list-item":"_showDetail"},initialize:function(e){this._headerView=e.headerView,this.listenTo(this._headerView,"back",this._hideDetail),this.listenTo(I.event,"state:current-theme-updated",this._handleThemeChanged),this.listenTo(I.event,"state:branding-upgradeflow-sync",this._handleBrandingUpgradeFlowFetched),this.listenTo(j.getAppEvent(),"theme-editor-action:show-detail",this._handleShowDetail),this.listenTo(I.event,"state:brand-source-link-updated",this._handleThemeChanged),this.listenTo(I.event,"state:branding-set-values-updated",this._generateStyleMap);this.listenTo(I.event,["state:branding-set-values-updated","state:preview-scoped-branding-set-updated"].join(" "),this._generateStyleMap),this._initChildViews(),this.render()},_initChildViews:function(){this._currentBrandingSet=new(N.isScopedBrandingSetManagementEnabled()?ql:Yl),this._detailViewsMap={},this._isLWRBackedByCMSSite()&&(this._currentBrandSource=new Md),_.each(this._getConfigs(),function(e){e.brandingField&&(this._detailViewsMap[e.type]=new Cd({field:e.brandingField}))}.bind(this)),N.isThemeSettingEnabled()&&(this._detailViewsMap.settings=new wd),this._setupChildViewListeners()},_getConfigs:function(){return[{type:"color",brandingField:Vd.COLOR,get label(){return is({field:this.brandingField})},icon:Ud("color_swatch")},{type:"image",brandingField:Vd.IMAGE,get label(){return is({field:this.brandingField})},icon:Ud("image")},{type:"text",brandingField:Vd.TEXT,get label(){return is({field:this.brandingField})},icon:Ud("text_color")},{type:"siteSpacing",brandingField:Vd.SITE_SPACING,get label(){return is({field:this.brandingField})},icon:Ud("toggle_panel_left")},{type:$d,brandingField:Vd.BUTTONS,get label(){return is({field:this.brandingField})},icon:Ud("breadcrumbs")},{type:"forms",brandingField:Vd.FORMS,get label(){return is({field:this.brandingField})},icon:Ud("edit_form")},{type:"settings",get label(){return is({field:this.type})},icon:Ud("layout")}]},_setupChildViewListeners:function(){this.listenTo(this._currentBrandingSet,"branding-set-name-clicked",this._openBrandingSetPanel),this._forEachDetailView(function(e,t){this.listenTo(e,"post-render",function(e){this._handleDetailViewPostRender(t,e)}.bind(this)),this.listenTo(e,"branding-set-name-clicked",this._openBrandingSetPanel)})},_destroyChildViews:function(){this._currentBrandingSet.destroy(),this._currentBrandingSet=null,_.each(this._detailViewsMap,function(e){e.destroy()}),this._detailViewsMap={}},_handleThemeChanged:function(){this._destroyChildViews(),this._initChildViews(),this.render()},_handleBrandingUpgradeFlowFetched:function(){this._handleThemeChanged()},render:function(){var e=S.getCurrentTheme(),e=this._shouldShowThemeThumbnail(e)?this._thumbnailContainerTemplate({themeName:e.displayName,imgUrl:e.imgUrl,isChangeThemeEnabled:N.isBrandingSetEditorEnabled()&&$P.hasCommBuilderThemingPerm}):"",t=[],n=(_.each(this._getConfigs(),function(e){this._detailViewsMap[e.type]&&t.push(this._listItemTemplate(e))}.bind(this)),this.$el.html(this._template({thumbnailContainer:e,list:t.join(""),loading:Qe.isBrandingUpgradeFlowFetched()})),this._updateVisibleItemsClass(),this.$(".js-detail-container"));return this._forEachDetailView(function(e){e.render(),e.hide(),n.append(e.$el)}),this.$(".js-current-branding-container").append(this._currentBrandingSet.render().$el),this._isLWRBackedByCMSSite()&&this.$(".js-current-brand-source").append(this._currentBrandSource.render().$el),this._generateStyleMap(),this},_generateStyleMap:function(){var e,t,n;E.getSite().isWebApp()&&(t={},n=l.getCurrentPreviewScopedBrandingSet(),e=l.getPreviewBrandingSet(),t=n?m(m({},e.values),n.values):e.values,n=hd(t,l.getCurrentPreviewBrandingSetPropertyDefs()),this.$(".js-detail-container").css(n))},show:function(){this.$el.removeClass("hidden")},hide:function(){this._hidePopover(),this.$el.addClass("hidden")},_hidePopover:function(){var e=this._detailViewsMap[this._getCurrentDetailType()];e&&e.hidePopover&&e.hidePopover(),this._headerView.closeBrandingSetPanel()},_enterColorPaletteEditor:function(){var t=this,e=["color",$d];this.$(".cb-ThemeEditor-listItem").addClass("slds-hide"),this.$(".cb-ThemeEditor-guidanceText").removeClass("slds-hide"),e.forEach(function(e){return t.$(".cb-ThemeEditor-listItem[data-type=".concat(e,"]")).removeClass("slds-hide")})},_exitColorPaletteEditor:function(){this.$(".cb-ThemeEditor-listItem").removeClass("slds-hide"),this.$(".cb-ThemeEditor-guidanceText").addClass("slds-hide")},_hideDetail:function(e){this._hidePopover(),this._headerView.showNavTrigger(e);var e=this.$(".js-theme-editor-main-view"),t=this.$(".js-detail-container").attr("data-type","none");C.slideRightOut(e,t)},_isViewAlreadyVisible:function(e){return!this.$el.hasClass("hidden")&&this.$(".js-detail-container").attr("data-type")===e},_handleShowDetail:function(e,t){var n,i,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};e===P.BRANDING_SET_TYPE.SCOPED?(this._enterColorPaletteEditor(),this._headerView.closeBrandingSetPanel()):e===P.BRANDING_SET_TYPE.APP&&this._exitColorPaletteEditor(),t&&(e=s.tab,i=s.section,n=s.category,e=e||i||n,this._isViewAlreadyVisible(t)||(i=_.find(this._getConfigs(),{type:t}),this._headerView.showSubTitle(i.label),this._headerView.showNavTrigger(t),this._headerView.closeBrandingSetPanel(),this._forEachDetailView(function(e){e.hide()}),this._detailViewsMap[t].show(),n=this.$(".js-detail-container").attr("data-type",t),i=this.$(".js-theme-editor-main-view"),C.slideRightIn(n,i),this.show()),e)&&this._detailViewsMap[t].trigger("navigate",s)},_showDetail:function(e){e=T(e.currentTarget).data("type");this._handleShowDetail(void 0,e)},_handleDetailViewPostRender:function(e,t){var n=this.$(".js-list-item[data-type="+e+"]");t?(this._getCurrentDetailType()===e&&this._hideDetail(e),n.addClass("hidden")):n.removeClass("hidden"),this._updateVisibleItemsClass()},_updateVisibleItemsClass:function(){this.$(".js-list-item").removeClass("first-item").not(".hidden").first().addClass("first-item")},_forEachDetailView:function(e){_.each(this._detailViewsMap,e.bind(this))},_getCurrentDetailType:function(){return this.$(".js-detail-container").attr("data-type")},_openBrandingSetPanel:function(){this._headerView.openBrandingSetPanel()},_showChangeThemeWizard:function(){Bd.openChangeThemeWizard()},_shouldShowThemeThumbnail:function(e){return e&&!E.getSite().isWebApp()},_isLWRBackedByCMSSite:function(){return E.getSite().isWebApp()&&E.getSite().isInCmsStore()}}),Fd="state:no-component-errors",Hd=null;function Gd(){Hd=[],I.event.trigger(Fd)}ve(function(e){Hd=[]}),Ke.getAllComponentErrors=function(){return Hd},I.event.on("action:add-component-error",function(e){e.fqn&&(-1===Hd.indexOf(e.fqn)&&Hd.push(e.fqn),I.event.trigger("state:component-error",Hd))}),I.event.on("action:remove-component-error",function(t){0===(Hd=Hd.filter(function(e){return e!==t.fqn})).length&&I.event.trigger(Fd,!0)}),I.event.on("action:remove-all-component-errors",Gd),I.event.on("state:page-change-start",Gd);var zd=PicassoWebServices.Labels.CommBuilderPriorityPicker;var Kd={openPrioritySelectorForComponent:function(n,i){var e=[{variantClassName:"slds-visual-picker_vertical",id:"cb-PriorityPickerView-highest",value:"HIGHEST",checked:"HIGHEST"===n,displayName:zd.PriorityPickerHighestHeading,description:zd.PriorityPickerHighestDescription},{variantClassName:"slds-visual-picker_vertical",id:"cb-PriorityPickerView-high",value:"HIGH",checked:"HIGH"===n,displayName:zd.PriorityPickerHighHeading,description:zd.PriorityPickerHighDescription},{variantClassName:"slds-visual-picker_vertical",id:"cb-PriorityPickerView-neutral",value:"NEUTRAL",checked:!n||"NEUTRAL"===n,displayName:zd.PriorityPickerNeutralHeading,description:zd.PriorityPickerNeutralDescription}];A.confirmChoice(zd.PriorityPickerHeading,e,function(e,t){e&&t!==n&&i(t)}.bind(this),{className:"slds-vex-theme slds-vex-theme--medium",subTitle:zd.PriorityPickerSubHeading,yesText:zd.PriorityPickerAssignButton})}};function Yd(s){var a={toggleEl:null,containerEl:null,activeIndex:-1};function e(){return a.containerEl.querySelector(".js-picklist-items")}function o(){return a.containerEl.querySelectorAll(".js-picklist-item")}var r=_.template('<ul class="js-picklist-items {{- cssClass }}" role="listbox" role="listbox" id="{{- key }}">{{ _.forEach(items, function(item, index) { }}<li class="js-picklist-item" id="{{- key + "-" + index }}" role="option" data-index="{{- index }}" data-id="{{- item.id }}" aria-selected="{{- item.id === selected }}">{{= item.html }}</li>{{ }) }}</ul>'),l=L.uuid();function c(){a.containerEl&&a.toggleEl&&o()&&e()&&(a.containerEl.removeChild(e()),a.containerEl.setAttribute("aria-expanded",!1),a.containerEl.dataset.isopen=!1,a.toggleEl.removeEventListener("focusout",c),a.toggleEl.removeEventListener("blur",c),a.toggleEl.removeEventListener("keyup",u),a.toggleEl.removeAttribute("aria-activedescendant"),_.each(o(),function(e){e.removeEventListener("mousedown",d)}),s.onCloseCallback())}function d(e){t(e.currentTarget)}function t(e){e=e.getAttribute("data-id");s.onClickHandler(e)}function u(e){e=e.keyCode,P.KEYCODE.ESCAPE===e?c():P.KEYCODE.UP===e?a.activeIndex=a.activeIndex-1<=-1?o().length-1:a.activeIndex-1:P.KEYCODE.DOWN===e?a.activeIndex=a.activeIndex+1>o().length-1?0:a.activeIndex+1:P.KEYCODE.ENTER===e&&(-1!==a.activeIndex&&t(o()[a.activeIndex]),c()),e=o()[a.activeIndex];e?(_.each(o(),function(e){e.classList.remove("js-picklist-item--active"),e.classList.remove("cb-picklist-item--active"),e.setAttribute("aria-selected",!1)}),e.classList.add("js-picklist-item--active"),e.classList.add("cb-picklist-item--active"),e.setAttribute("aria-selected",!0),a.toggleEl.setAttribute("aria-activedescendant",e.id)):a.toggleEl.setAttribute("aria-activedescendant","")}return s=_.assign({},{items:[],cssClass:"",selected:"",onClickHandler:function(){},onOpenCallback:function(){},onCloseCallback:function(){}},s),{toggle:function(e,t){var n,i;e.parentElement&&"true"===e.parentElement.dataset.isopen?e.blur():(e.setAttribute("tabindex",0),e.focus(),e.setAttribute("aria-controls",l),n=r({items:s.items,cssClass:s.cssClass,key:l,selected:s.selected}),(i=document.createElement("div")).innerHTML=n.trim(),n=i.firstChild,(i=e.parentElement).appendChild(n),t&&(n.style.top="-"+n.offsetHeight+"px"),i.setAttribute("aria-owns",l),i.setAttribute("aria-expanded",!0),i.setAttribute("aria-haspopup","listbox"),i.dataset.isopen=!0,(a=_.assign({},a,{toggleEl:e,containerEl:i})).toggleEl.addEventListener("blur",c),a.toggleEl.addEventListener("focusout",c),a.toggleEl.addEventListener("keyup",u),_.each(o(),function(e){e.addEventListener("mousedown",d)}),s.onOpenCallback())}}}var qd=["tab1Type","tab2Type","tab3Type","tab4Type"];var Xd={getCmpsAndTriggerGuardrails:function(t,n){I.AccessControl(P.PERMISSIONS.IS_GUARDRAILS_ENABLED)&&f.getCanvasComponentsForViewAsync(n,function(e){Xd.triggerGuardrails(t,n,e)})},triggerGuardrails:function(e,t,n){I.AccessControl(P.PERMISSIONS.IS_GUARDRAILS_ENABLED)&&e.execute({viewId:t,components:n})},shouldTriggerGuardrailsOnPropChange:function(t){return I.AccessControl(P.PERMISSIONS.IS_GUARDRAILS_ENABLED)&&t&&b.some(qd,function(e){return b.has(t,e)})},updateGuardrailsViewInitializedStatus:function(e,t){I.AccessControl(P.PERMISSIONS.IS_GUARDRAILS_ENABLED)&&(e.isViewInitialized=t)}},Jd=function(){G(s,Se);var i=q(s);function s(e,t,n){return d(this,s),(e=i.call(this,e,n)).label=t,e}return a(s)}(),Qd=function(){G(s,Jd);var i=q(s);function s(e){d(this,s);var t,n=[];return e.contents&&Array.isArray(e.contents)&&e.contents.forEach(function(e){return n.push(new s(e))}),(t=i.call(this,e.id,e.label,n)).type="COMP",t.name=e.fqn,t.isVisible=e.isVisible,t}return a(s)}(),Zd=function(){G(s,Jd);var i=q(s);function s(e){d(this,s);var t,n=[];return Array.isArray(e.components)&&e.components.forEach(function(e){return n.push(new Qd(e))}),(t=i.call(this,e.id,"",n)).type="REGION",t.name=e.name,t.parent=e.parent,t.isInTheme=e.isThemeRegion,t}return a(s)}(),eu=function(){G(i,Jd);var n=q(i);function i(e){d(this,i);var t=[];return e.viewId||(e.viewId=""),Array.isArray(e)?e.forEach(function(e){return t.push(new Zd(e))}):e.components&&Array.isArray(e.components)&&e.components.forEach(function(e){return t.push(new Zd(e))}),(e=n.call(this,e.viewId,"pageLabel",t)).type="PAGE",e}return a(i)}(),tu=function(){G(t,Ce);var e=q(t);function t(){return d(this,t),e.apply(this,arguments)}return a(t,[{key:"updateModel",value:function(e){if(null==e)throw new Error("Model cannot be undefined or null!");this.model=e}},{key:"provide",value:function(){return this._pages=[new eu(this.model)],this._pages}}]),t}(),nu=function(){G(t,Se);var e=q(t);function t(){return d(this,t),e.call(this,"siteInfo")}return a(t,[{key:"updateViews",value:function(e){this.views=e||{}}},{key:"updateRoutes",value:function(e){this.routes=e||{}}}]),t}(),iu=function(){G(t,Ce);var e=q(t);function t(){return d(this,t),e.apply(this,arguments)}return a(t,[{key:"updateRoutes",value:function(e){if(null==e)throw new Error("Routes cannot be undefined or null!");this._routes=e}},{key:"updateViews",value:function(e){if(null==e)throw new Error("Views cannot be undefined or null!");this._views=e}},{key:"provide",value:function(){var e=new nu;return e.updateRoutes(this._routes),e.updateViews(this._views),[e]}}]),t}(),su=function(){G(t,Se);var e=q(t);function t(){return d(this,t),e.call(this,"layoutInfos")}return a(t,[{key:"updatePageLayouts",value:function(e){this.pageLayouts=e||[]}}]),t}(),au=function(){G(t,Ce);var e=q(t);function t(){return d(this,t),e.apply(this,arguments)}return a(t,[{key:"updatePageLayouts",value:function(e){if(null==e)throw new Error("pageLayouts cannot be undefined or null!");this._pageLayouts=e}},{key:"provide",value:function(){var e=new su;return e.updatePageLayouts(this._pageLayouts),[e]}}]),t}(),ou=["forceCommunity:flowCommunity","forceCommunity:richTextInline","forceCommunity:htmlBlock","forceCommunity:tabset","forceCommunity:section","community_builder:richTextEditor","community_builder:htmlEditor","community_layout:section"],ru=[],n=function(){G(t,Ie);var e=q(t);function t(){return d(this,t),e.apply(this,arguments)}return a(t,[{key:"invoke",value:function(n){var i=this,s=new Map;n.on("type=COMP",function(e){var t;i.shouldExclude(e.name)||((t=s.get(e.name)||[]).push(e),s.set(e.name,t))}),n.on("type=PAGE:exit",function(){s.forEach(function(e,t){1<e.length&&n.report(new Pe(e,[e.length,e[0].label],[],[]))})})}},{key:"shouldExclude",value:function(t){return!t||ou.includes(t)||ru.some(function(e){return t.match(e)})}}]),t}(),lu="COMMUNITY_PAGE",cu="SITE_INFO",du="PAGE_LAYOUT",uu="PERF_PREDICTION",pu="ANALYZE",gu={USABILITY:"Usability",FF_LARGE:"FormFactorLarge",FF_SMALL:"FormFactorSmall",RECORD_PAGE:"RecordPage",AURA_SITE:"AuraSite",LWR_SITE:"LWRSite"},hr={contextInfo:new ye(lu),name:"NoDuplicateComponents",title:"NoDupCompRule.Title",description:"NoDupCompRule.Description",owner:"Modern Apps Advisor",rule:n,tags:[gu.USABILITY,gu.FF_LARGE],triggers:[pu]},hu=(new me(hr.contextInfo,hr.name,hr.title,hr.description,hr.owner,hr.rule,hr.tags,void 0,hr.triggers),"{0}"),mr=function(){G(t,Ie);var e=q(t);function t(){return d(this,t),e.apply(this,arguments)}return a(t,[{key:"invoke",value:function(n){var i=n.getData(),s=n.getAdditionalData().get(du)[0],a=!1;n.on("name=forceCommunity:recordDetail:exit",function(e){var t;a||(a=!0,t=[],s.pageLayouts.forEach(function(e){60<e.numOfFields&&t.push(new Te(e.name,void 0,PicassoWebServices.Labels.DetailPanelFieldsCountRule.LayoutListEdit.replace(hu,e.name),PicassoWebServices.Labels.DetailPanelFieldsCountRule.LayoutListNumFields.replace(hu,e.numOfFields)))}),0<t.length&&n.report(new Pe([i],[60],void 0,t)))}),n.on("name=forceCommunity:recordHomeTabs:exit",function(e){var t;a||(a=!0,t=[],s.pageLayouts.forEach(function(e){60<e.numOfFields&&t.push(new Te(e.name,void 0,PicassoWebServices.Labels.DetailPanelFieldsCountRule.LayoutListEdit.replace(hu,e.name),PicassoWebServices.Labels.DetailPanelFieldsCountRule.LayoutListNumFields.replace(hu,e.numOfFields)))}),0<t.length&&n.report(new Pe([i],[60],void 0,t)))})}}]),t}(),fr=new Map;fr.set("pageType",["RecordPage"]);var t={contextInfo:new ye(lu,fr,[du]),name:"DetailPanelFieldsCount",title:"DetailPanelFieldsCountRule.Title",description:"DetailPanelFieldsCountRule.Description",owner:"Modern Apps Advisor",rule:mr,tags:[gu.USABILITY,gu.FF_LARGE,gu.RECORD_PAGE,gu.AURA_SITE],triggers:[pu]},mu=new me(t.contextInfo,t.name,t.title,t.description,t.owner,t.rule,t.tags,void 0,t.triggers),e=function(){G(t,Ie);var e=q(t);function t(){return d(this,t),e.apply(this,arguments)}return a(t,[{key:"invoke",value:function(n){var i=n.getAdditionalData().get(cu)[0];n.on("type=PAGE:exit",function(e){var t=_.map(i.routes.models,"id");250<=t.length&&n.report(new Pe(t,[t.length,250],[],[]))})}}]),t}(),ot={contextInfo:new ye(lu,void 0,[cu]),name:"LargeNumberOfRoutes",title:"LargeNumberOfRoutesRule.Title",description:"LargeNumberOfRoutesRule.Description",owner:"Modern Apps Advisor",rule:e,tags:[gu.USABILITY,gu.FF_LARGE],triggers:[pu]},vu=new me(ot.contextInfo,ot.name,ot.title,ot.description,ot.owner,ot.rule,ot.tags,void 0,ot.triggers),i=function(){G(t,Ie);var e=q(t);function t(){return d(this,t),e.apply(this,arguments)}return a(t,[{key:"invoke",value:function(n){var i=n.getAdditionalData().get(cu)[0];n.on("type=PAGE:exit",function(e){var t=_.map(i.views.models,"id");500<=t.length&&n.report(new Pe(t,[t.length,500],[],[]))})}}]),t}(),n={contextInfo:new ye(lu,void 0,[cu]),name:"LargeNumberOfViews",title:"LargeNumberOfViewsRule.Title",description:"LargeNumberOfViewsRule.Description",owner:"Modern Apps Advisor",rule:i,tags:[gu.USABILITY,gu.FF_LARGE,gu.AURA_SITE],triggers:[pu]},bu=new me(n.contextInfo,n.name,n.title,n.description,n.owner,n.rule,n.tags,void 0,n.triggers),fu=function(){G(t,Le);var e=q(t);function t(){return d(this,t),e.call(this,[new Ee(vu),new Ee(bu),new Ee(mu)])}return a(t)}(),_u=function(){function e(){d(this,e)}return a(e,[{key:"perfStart",value:function(){}},{key:"perfEnd",value:function(){}},{key:"markStart",value:function(){}},{key:"markEnd",value:function(){}},{key:"mark",value:function(){}},{key:"error",value:function(){}},{key:"interaction",value:function(){}}]),e}();function Su(e){var t=$.Deferred();return PicassoWebServices.Guardrails.GetRecordPageLayoutDetails(e,function(e){t.resolve(e)}),t.promise()}function Cu(e,t){var n=$.Deferred();return PicassoWebServices.Guardrails.GetEPTPrediction(e,t,function(e){n.resolve(e)}),n.promise()}var yu,Tu,Pu,Iu=function(){G(t,Be);var e=q(t);function t(){return d(this,t),e.apply(this,arguments)}return a(t,[{key:"visit",value:function(e){X(z(t.prototype),"visitNode",this).call(this,e,null)}}]),t}();function Eu(i,s,e){var t=new De,n=new Iu(function(e){t.enter(e)},function(e){t.exit(e)}),a={globalCounts:{},audienceCounts:{}};return t.subscribe("type=COMP",function(e){var t,n=f.getAudienceTargetInfoForComponent(i,e.id);(n=!n&&s?S.getAudienceTargetInfoForComponent(s,e.id):n)?(n="".concat(n.attributes.audienceId,"_").concat(n.attributes.audienceName),(t=a.audienceCounts[n]||{})[e.name]=t[e.name]?t[e.name]+1:1,a.audienceCounts[n]=t):e.isVisible&&(a.globalCounts[e.name]=a.globalCounts[e.name]?a.globalCounts[e.name]+1:1)}),n.visit(e),a}function wu(e){for(var t=0,n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}yu=T,Tu="waitForImages",Pu=(hr=new Image).srcset&&hr.sizes,yu.waitForImages={hasImageProperties:["backgroundImage","listStyleImage","borderImage","borderCornerImage","cursor"],hasImageAttributes:["srcset"]},yu.expr.pseudos["has-src"]=function(e){return yu(e).is('img[src][src!=""]')},yu.expr.pseudos.uncached=function(e){return!!yu(e).is(":has-src")&&!e.complete},yu.fn.waitForImages=function(){var s,a,t,o=0,r=0,l=yu.Deferred(),c=this,d=[],n=yu.waitForImages.hasImageProperties||[],i=yu.waitForImages.hasImageAttributes||[],u=/url\(\s*(['"]?)(.*?)\1\s*\)/g;if(yu.isPlainObject(arguments[0])?(t=arguments[0].waitForAll,a=arguments[0].each,s=arguments[0].finished):t=1===arguments.length&&"boolean"===yu.type(arguments[0])?arguments[0]:(s=arguments[0],a=arguments[1],arguments[2]),s=s||yu.noop,a=a||yu.noop,t=!!t,yu.isFunction(s)&&yu.isFunction(a))return this.each(function(){var e=yu(this);t?e.find("*").addBack().each(function(){var s=yu(this);s.is("img:has-src")&&!s.is("[srcset]")&&d.push({src:s.attr("src"),element:s[0]}),yu.each(n,function(e,t){var n,i=s.css(t);if(!i)return!0;for(;n=u.exec(i);)d.push({src:n[2],element:s[0]})}),yu.each(i,function(e,t){if(!s.attr(t))return!0;d.push({src:s.attr("src"),srcset:s.attr("srcset"),element:s[0]})})}):e.find("img:has-src").each(function(){d.push({src:this.src,element:this})})}),(r=0)===(o=d.length)&&(s.call(c),l.resolveWith(c)),yu.each(d,function(e,n){var t=new Image,i="load."+Tu+" error."+Tu;yu(t).one(i,function e(t){t=[r,o,"load"==t.type];if(r++,a.apply(n.element,t),l.notifyWith(n.element,t),yu(this).off(i,e),r==o)return s.call(c[0]),l.resolveWith(c[0]),!1}),Pu&&n.srcset&&(t.srcset=n.srcset,t.sizes=n.sizes),t.src=n.src}),l.promise();throw new TypeError("An invalid callback was supplied.")};var fr=PicassoWebServices.Labels.DockingPanel,Lu=Backbone.View.extend({_open:!1,_minimized:!0,_loading:!1,_shiftedVal:0,_dockingPanelTemplate:_.template('{{ if (_open) { }}\n            <div id="dockingPanelContainer" class="{{= _containerClasses }}">\n                <section\n                    id="dockerPanel" class="{{= _sectionClasses }}" role="dialog" \n                    aria-labelledby="dialog-heading-id-1" aria-describedby="dialog-content-id-1">\n                    <div id="panelHeader" class="dock-panel-header"></div>\n                    <div id="panelBody" class="dock-panel-body"></div>\n                </section>\n            </div>\n        {{ } }}'),_dockingPanelHeaderHTML:'<header class="slds-docked-composer__header slds-grid slds-shrink-none js-handle-header" aria-live="assertive">\n            <div id="panelHeaderContent"></div>\n            <div class="slds-col_bump-left slds-shrink-none">\n                '.concat(D.buttonIcon({buttonClassName:"js-minimize-button",label:"".concat(fr.Minimize),icon:"minimize_window",sprite:"utility"}),"\n                ").concat(D.buttonIcon({buttonClassName:"js-close-button",label:"".concat(fr.Close),icon:"close",sprite:"utility"}),"\n            </div>\n        </header>"),_dockingPanelBodyTemplate:_.template('{{ if (!_minimized) { }}\n            {{ if (_loading) { }}\n                <div style="height:6rem;position:relative">\n                    '.concat(D.spinner,'\n                </div>\n            {{ } else { }}\n                <div class="slds-docked-composer__body" id="dialog-content-id-1">\n                    <div id="panelBodyContent"></div>\n                </div>\n            {{ } }}\n        {{ } }}')),events:{"click .js-minimize-button":"handleMinimizeClick","click .js-close-button":"handleCloseClick","click .js-handle-header":"handleHeaderClick"},render:function(e,t){var n=this;return this.$el.html(this._dockingPanelTemplate({_open:this._open,_containerClasses:this._containerClasses(),_sectionClasses:"dock-panel slds-docked-composer slds-grid slds-grid_vertical"})),this.updatePanelHeader(e),this.updatePanelBody(t),this._container=this.$el.find("#dockingPanelContainer"),this._section=this.$el.find("#dockerPanel"),this.shiftPanel(this._shiftedVal),T(window).resize(_.debounce(function(){n.updateSectionCSS()},100)),this},updatePanelHeader:function(e){var t,n,i;this._panelHeaderContent=e,this._open&&(t=this.$el.find("#panelHeader"),i=(n=T(this._dockingPanelHeaderHTML)).find("#panelHeaderContent"),T(i).html(e),T(t).html(n))},updatePanelBody:function(e){var t,n,i;this._panelBodyContent=e,this._open&&(t=this.$el.find("#panelBody"),n=T(this._dockingPanelBodyTemplate({_minimized:this._minimized,_loading:this._loading})),this._minimized||this._loading||(i=n.find("#panelBodyContent"),T(i).html(e)),T(t).html(n),this.updateSectionCSS())},updateContainerCSS:function(){T(this._container).removeClass(),T(this._container).addClass(this._containerClasses())},updateSectionCSS:function(){T(this._section).removeClass(),T(this._section).addClass(this._sectionClasses()),this._transitionCSS()},open:function(){this._open||(this._open=!0,this.render(this._panelHeaderContent,this._panelBodyContent),this._transitionCSS(),this.trigger("dockingPanelOpened"))},close:function(){this._open&&(this._open=!1,this._minimized=!0,this.render(this._panelHeaderContent,this._panelBodyContent),this.trigger("dockingPanelClosed"))},_containerClasses:function(){return["slds-docked_container","foreground"].join(" ")},_sectionClasses:function(){var e=["dock-panel","slds-docked-composer","slds-grid slds-grid_vertical"];return this._open&&!this._minimized&&e.push("slds-is-open"),this._open&&this._minimized&&e.push("slds-is-closed"),e.join(" ")},_transitionCSS:function(){var t=this.$el.find("#panelHeader"),n=this.$el.find("#panelBody"),i=this._section,s=this;this._waitForElm("#panelBody").then(function(e){T(n).waitForImages(function(){var e;s._minimized?i&&i.get(0)&&(e=t.innerHeight()/T(window).height()*100,i.get(0).style.height=e+"vh"):i&&i.get(0)&&(e=(t.innerHeight()+n.innerHeight())/T(window).height()*100,i.get(0).style.height=e+"vh"),s.trigger("dockingPanelResized")})})},handleMinimizeClick:function(e){e.stopPropagation(),this.handleHeaderClick()},handleCloseClick:function(e){e.stopPropagation(),this.close()},handleHeaderClick:function(){this._open?(this._minimized=!this._minimized,this.updatePanelBody(this._panelBodyContent)):(this._minimized=!1,this.open()),this.updateSectionCSS()},setLoading:function(e){this._loading=e,this.updatePanelBody(this._panelBodyContent)},_waitForElm:function(i){return new Promise(function(t){if(document.querySelector(i))return t(document.querySelector(i));var n=new MutationObserver(function(e){document.querySelector(i)&&(t(document.querySelector(i)),n.disconnect())});n.observe(document.body,{childList:!0,subtree:!0})})},isOpen:function(){return this._open},isMinimized:function(){return this._minimized},shiftPanel:function(e){this._shiftedVal=e,this._open&&(T(this._container).get(0).style.right=this._shiftedVal+"vw")},minimizePanel:function(e){this.open&&(this._minimized=e,this.updatePanelBody(this._panelBodyContent),this.updateSectionCSS())}}),Du=Backbone.View.extend({_guardrailsResultsEmptyTemplate:_.template('<h2 class="slds-m-bottom_xx-small slds-text-title_bold">{{= _title }}</h2>\n         <div class="js-empty-results-card"></div>\n        '),_guardrailsCardContentTemplate:_.template('<div class="slds-align_absolute-center">\n            <div class="empty-state-container slds-text-align_center">\n                <img src="/sfsites/sfservice/builder/resources/images/emptyState.svg" alt="" />\n                <div class="empty-state-message slds-m-top_medium">{{= _message }}</div>\n            </div>\n        </div>'),render:function(e,t){this.$el.html(this._guardrailsResultsEmptyTemplate({_title:e})),this.$el.css({display:"block",margin:"0.75rem"});e=this._guardrailsCardContentTemplate({_message:t});return this._renderLightningCard(e),this},_renderLightningCard:function(t){$P.auraRun(function(){$A.createComponent("lightning:card",{},function(e){e&&($A.render(e,this.$(".js-empty-results-card")[0]),$(e.getElement()).find(".slds-card__body").html(t),$A.afterRender(e),this.trigger("emptyStateRendered"))}.bind(this))}.bind(this))}}),Au=Backbone.View.extend({_guardrailsResultTemplate:_.template('{{ if (_showEmptyState) { }}\n            <div class="js-show-empty-results-state"></div>\n        {{ } else { }}\n            {{ _.forEach(_items, function(_item, index) { }}\n                <div key="{{= _item.id }}">\n                    <div class="js-result-card-{{= _item.id }}"></div>\n                </div>\n            {{ }) }}\n        {{ } }}'),render:function(e){var t,n=e.items,i=e.emptyStateTitle,s=e.emptyStateMessage,a=e.listItemsExpandLabel,e=e.listItemsCollapeLabel,o=!n||0===n.length;return this.$el.html(this._guardrailsResultTemplate({_showEmptyState:o,_items:n})),o?(this._guardrailsResultsEmptyState=new Du({el:this.$el.find(".js-show-empty-results-state")}),(t=this)._guardrailsResultsEmptyState.once("emptyStateRendered",function(){t.trigger("guardrailsResultContainerRendered")}),this._guardrailsResultsEmptyState.render(i,s)):this._renderResultCards(n,a,e),this},_renderResultCards:function(e,t,n){var a=this,i=this,o=[];e.forEach(function(s){o.push(new Promise(function(i){$P.auraRun(function(){$A.createComponent("analyzer_framework:resultCard",{properties:s,listItemsExpandLabel:t,listItemsCollapeLabel:n},function(e,t,n){if("SUCCESS"!==t)throw new Error(n);e&&($A.render(e,this.$(".js-result-card-".concat(s.id))[0]),$A.afterRender(e),i())}.bind(this))}.bind(a))}))}),Promise.all(o).then(function(){i.trigger("guardrailsResultContainerRendered")})}}),ku=Backbone.View.extend({_guardrailsPerfContainerTemplate:_.template('{{ if (_showEmptyState) { }}\n            <div class="js-show-empty-results-state"></div>\n        {{ } else { }}\n            <div class="js-perf-results-container"></div>\n        {{ } }}'),render:function(e){var t=e.perfResults,n=e.emptyStateTitle,e=e.emptyStateMessage,i=(this._cleanUp(),!t);return this._emptyStateTitle=n,this._emptyStateMessage=e,this.$el.html(this._guardrailsPerfContainerTemplate({_showEmptyState:i})),this._renderPerfResults(t),this.perfResults=t,this},_renderPerfResults:function(e){var i=this;e?$P.auraRun(function(){$A.createComponent("guardrails:expBuilderPerfResultsContainer",{perfResults:e},function(e,t,n){if("SUCCESS"!==t)throw new Error(n);e.addEventHandler("panelRendered",function(e){i.trigger("perfResultContainerRendered")}),e.autoDestroy(!1),$A.render(e,this.$(".js-perf-results-container")[0]),$A.afterRender(e)}.bind(this))}.bind(this)):(this.$el.html(this._guardrailsPerfContainerTemplate({_showEmptyState:!0})),this._guardrailsResultsEmptyState=new Du({el:this.$el.find(".js-show-empty-results-state")}),this._guardrailsResultsEmptyState.once("emptyStateRendered",function(){i.trigger("perfResultContainerRendered")}),this._guardrailsResultsEmptyState.render(this._emptyStateTitle,this._emptyStateMessage))},_cleanUp:function(){var e=this.$(".guardrailsExpBuilderPerfResultsContainer")[0];e&&(e=$A.componentService.getAttributeProviderForElement(e))&&e.destroy()}}),Nu=PicassoWebServices.Labels.GuardrailsManager,xu=Backbone.View.extend({className:"cb-GuardrailsContainer",el:"#guardrailsContainer",_items:[],_needToFocus:!1,_mutePreference:void 0,_guardrailsManagerHTML:'<div id="guardrailsDockingPanel"></div>\n                            <div id="guardrailsPerfDockingPanel"></div>',_guardrailsManagerPanelHeaderTemplate:_.template('<div class="slds-media slds-media_center slds-no-space">\n        <div class="slds-media__figure slds-m-right_x-small">\n          <span class="slds-icon_container">\n            '.concat(D.icon({icon:"sossession",sprite:"standard",svgClassName:"slds-icon_small slds-icon-text-default"}),'\n          </span>\n        </div>\n        <div class="slds-media__body">\n          <h2 class="slds-truncate header" id="dialog-heading-id-1" title="').concat(Nu.Tips,'">\n            ').concat(Nu.Tips,'\n            {{ if( showCount ) { }}\n              <div class="badge-count slds-badge slds-badge_inverse">\n                  {{= count }}\n              </div>\n            {{ } }}\n          </h2>\n        </div>\n      </div>')),_guardrailsManagerPanelBodyHTML:'<div id="guardrailsResultsContainer"></div>',_guardrailsPerfPanelHeaderTemplate:_.template('<div class="slds-media slds-media_center slds-no-space">\n        <div class="slds-media__figure slds-m-right_x-small">\n          <span class="slds-icon_container">\n            '.concat(D.icon({icon:"lightning_component",sprite:"standard",svgClassName:"slds-icon_small slds-icon-text-default"}),'\n          </span>\n        </div>\n        <div class="slds-media__body">\n          <h2 class="slds-truncate header" id="dialog-heading-id-1" title="').concat(Nu.PerfAnalysis,'">\n            ').concat(Nu.PerfAnalysis,'\n            {{ if( showPerfBadge ) { }}\n                <div class="badge perf-panel-badge helpMenuNotificationCount">\n                    {{ if( isModerate ) { }}\n                        <div class="slds-badge slds-theme_warning">\n                            ').concat(Nu.ModeratePerf,'\n                        </div>\n                    {{ } }}\n                    {{ if( isPoor ) { }}\n                        <div class="slds-badge slds-theme_error">\n                            ').concat(Nu.PoorPerf,"\n                        </div>\n                    {{ } }}\n                </div>\n            {{ } }}\n          </h2>\n        </div>\n      </div>")),_guardrailsPerfPanelBodyHTML:'<div id="guardrailsPerfContents"></div>',events:{"show-guardrails-tips":"_handleOpenGuardrails","mute-guardrails":"_muteGuardrails","show-guardrails-perfPanel":"_handleOpenPerfGuardrails"},initialize:function(){this._mutePreference=new We("communities-builder")},render:function(e,t){this.$el.html(this._guardrailsManagerHTML);var n=this._guardrailsManagerPanelHeaderTemplate({showCount:0<e.length,count:e.length}),i=this._guardrailsManagerPanelBodyHTML,n=T(n).html(n),i=T(i).html(i);return this._guardrailsResultCardContainer=new Au({el:i}),this._guardrailsResultCardContainer.render({items:e,emptyStateTitle:Nu.EmptyStateTitle,emptyStateMessage:Nu.EmptyStateMessage,listItemsExpandLabel:Nu.ListItemsExpandLabel,listItemsCollapeLabel:Nu.ListItemsCollapseLabel}),this._dockingPanel=new Lu({el:this.$el.find("#guardrailsDockingPanel")}),this._dockingPanel.render(n,i),this.listenTo(this._dockingPanel,"dockingPanelOpened",this._setPanelShift),this.listenTo(this._dockingPanel,"dockingPanelClosed",this._setPanelShift),this.listenTo(this._dockingPanel,"dockingPanelResized",this._setPanelShift),this._items=e,I.AccessControl(P.PERMISSIONS.SITES_PREDICTION_SERVICE_ENABLED)&&(n=this._processPerfResults(t),i=this._guardrailsPerfPanelHeaderTemplate({showPerfBadge:t&&!n.isGoodPerf,isModerate:n.isModeratePerf,isPoor:n.isPoorPerf}),e=this._guardrailsPerfPanelBodyHTML,n=T(i).html(i),i=T(e).html(e),this._guardrailsPerfContainer=new ku({el:i}),this._guardrailsPerfContainer.render({perfResults:null,emptyStateTitle:Nu.EmptyPerfStateTitle,emptyStateMessage:Nu.EmptyPerfStateMessage}),this._perfDockingPanel=new Lu({el:this.$el.find("#guardrailsPerfDockingPanel")}),this._perfDockingPanel.render(n,i),this.listenTo(this._perfDockingPanel,"dockingPanelOpened",this._setPanelShift),this.listenTo(this._perfDockingPanel,"dockingPanelClosed",this._setPanelShift),this.listenTo(this._perfDockingPanel,"dockingPanelResized",this._setPanelShift),this._perfResults=t),this},updateResults:function(e){var t=this._mutePreference.isMuted(),n=this,i=(this._guardrailsResultCardContainer.once("guardrailsResultContainerRendered",function(){n._dockingPanel.updatePanelBody(n._guardrailsResultCardContainer.$el),n._setDockingPanelLoading(!1)}),this._guardrailsResultCardContainer.render({items:e,emptyStateTitle:Nu.EmptyStateTitle,emptyStateMessage:Nu.EmptyStateMessage,listItemsExpandLabel:Nu.ListItemsExpandLabel,listItemsCollapeLabel:Nu.ListItemsCollapseLabel}),this._guardrailsManagerPanelHeaderTemplate({showCount:0<e.length,count:e.length}));this._dockingPanel.updatePanelHeader(i),e&&0<e.length&&!this._dockingPanel._open&&(this._dockingPanel._minimized=t,this._dockingPanel.open()),this._items=e,o.trigger("update-guardrails-menu",this._items.length)},updatePerfResults:function(e){var t,n,i,s;I.AccessControl(P.PERMISSIONS.SITES_PREDICTION_SERVICE_ENABLED)&&(t=this._mutePreference.isMuted(),(n=this)._guardrailsPerfContainer.once("perfResultContainerRendered",function(){n._perfDockingPanel.updatePanelBody(n._guardrailsPerfContainer.$el),n._setPerfDockingPanelLoading(!1)}),this._guardrailsPerfContainer.render({perfResults:e,emptyStateTitle:Nu.EmptyPerfStateTitle,emptyStateMessage:Nu.EmptyPerfStateMessage}),i=this._processPerfResults(e),s=this._guardrailsPerfPanelHeaderTemplate({showPerfBadge:e&&!i.isGoodPerf,isModerate:i.isModeratePerf,isPoor:i.isPoorPerf}),this._perfDockingPanel.updatePanelHeader(s),!e||i.isGoodPerf||this._perfDockingPanel.isOpen()||(this._perfDockingPanel._minimized=t,this._perfDockingPanel.open()),this._perfResults=e,o.trigger("update-guardrails-perfMenu",i))},_handleOpenGuardrails:function(e){e.stopPropagation(),this._dockingPanel&&(this._dockingPanel.minimizePanel(!1),this._dockingPanel.open())},_handleCloseGuardrails:function(e){e.stopPropagation(),this._dockingPanel&&this._dockingPanel.close(),this._perfDockingPanel&&this._perfDockingPanel.close()},_handleOpenPerfGuardrails:function(e){e.stopPropagation(),this._perfDockingPanel&&I.AccessControl(P.PERMISSIONS.SITES_PREDICTION_SERVICE_ENABLED)&&(this._perfDockingPanel.minimizePanel(!1),this._perfDockingPanel.open())},_setDockingPanelLoading:function(e){this._dockingPanel&&this._dockingPanel.setLoading(e)},_setPerfDockingPanelLoading:function(e){this._perfDockingPanel&&I.AccessControl(P.PERMISSIONS.SITES_PREDICTION_SERVICE_ENABLED)&&this._perfDockingPanel.setLoading(e)},_setPanelShift:function(){var e;this._dockingPanel&&this._dockingPanel.isOpen()&&this._perfDockingPanel&&this._perfDockingPanel.isOpen()&&(e=this.$el.find("#guardrailsDockingPanel").find("#dockingPanelContainer").width()/T(window).width()*100,this._dockingPanel.shiftPanel(e)),!this._dockingPanel||!this._dockingPanel.isOpen()||this._perfDockingPanel&&this._perfDockingPanel.isOpen()||this._dockingPanel.shiftPanel(0)},_processPerfResults:function(e){var t=!0,n=!1,i=!1;if(e){var s,a=new Set,o=e.global,r=e.MAX_EPT_AUDIENCE,l=e.MIN_EPT_AUDIENCE,e=e.MEDIAN_EPT_AUDIENCE,c=(o&&o.predictedEPT&&a.add(o.predictedEPT),r&&r[Object.keys(r)[0]]&&(o=r[Object.keys(r)[0]].predictedEPT)&&a.add(o),l&&l[Object.keys(l)[0]]&&(r=l[Object.keys(l)[0]].predictedEPT)&&a.add(r),e&&e[Object.keys(e)[0]]&&(o=e[Object.keys(e)[0]].predictedEPT)&&a.add(o),se(a.entries()));try{for(c.s();!(s=c.n()).done;){var d=s.value;if(2500<d[0]){t=!1,d[0]<=6e3?n=!0:i=!0;break}}}catch(e){c.e(e)}finally{c.f()}}return{isGoodPerf:t,isModeratePerf:n,isPoorPerf:i}},_muteGuardrails:function(e){e.stopPropagation(),this._dockingPanel&&this._dockingPanel.minimizePanel(!0),this._perfDockingPanel&&I.AccessControl(P.PERMISSIONS.SITES_PREDICTION_SERVICE_ENABLED)&&this._perfDockingPanel.minimizePanel(!0)}}),mr=function(){function t(e){d(this,t),this.tagsToInclude=e||[],this.registry=new Me(new $e(this.tagsToInclude,[])),this._initPrimaryDataProviders(),this.registry.registerRules(new fu),this.engine=new Oe(this.registry,new _u),this.reportListener=this.handleReportItems,this.isViewInitialized=!1}return a(t,[{key:"execute",value:function(e){var n=this;if(void 0===this.isLWR&&(this.isLWR=E.getSite().isWebApp()),!e)return null;null==this._guardrailsManager&&(this._guardrailsManager=new xu,this._guardrailsManager.render([],null)),this.pageDataProvider.updateModel(e);var t=this._getAdditionalContexts(),e=this._updateAdditionalContexts(e,t);return this.isViewInitialized=!0,this._guardrailsManager._setDockingPanelLoading(!0),Promise.all(e).then(function(e){n.engine.execute([new ye(lu,void 0,t)],new Ue(n._getIncludedTags(),n._getExcludedTags(),[pu])).then(function(e){e=e._results;e&&e.forEach(function(e,t){return n.reportListener(e)})})}).finally(function(){n._guardrailsManager._setDockingPanelLoading(!1)})}},{key:"handleReportItems",value:function(e){e&&(e=this.processReport(e),this._guardrailsManager.updateResults(e))}},{key:"processReport",value:function(h){for(var m=this,v=[],b=0;b<h.length;b++)!function(){for(var e=h[b],t=e.name,n=m._fetchLabel(e.title),i=e.listItems,s=e.messageParams||[],a=m._fetchLabel(e.description),o=0;o<s.length;o++)a=a.replace("{".concat(o,"}"),s[o]);var r=e.data,l=(Array.isArray(r)||(r=[r]),void 0),r=(r.forEach(function(e){e=e.id||e;null==l?l=wu(e.toString()):l^=wu(e.toString())+2654435769+(l<<6)+(l>>2)}),"id_".concat(t,"_").concat(l||b)),c=[],e=e.scales;if(e&&e.value){var d=e.value.label,u=e.value.scales;if(u)for(var p,g=0;g<u.length;g++)p=u[g],c.push({id:"id_".concat(t,"_").concat(p.scaleInfo.id||g),scaleValue:p.scaleValue,scaleInfo:p.scaleInfo})}v.push({id:r,title:n,description:a,scales:{scales:c,label:d},listItems:i})}();return v}},{key:"_fetchLabel",value:function(e){for(var t=e.split("."),n=PicassoWebServices.Labels,i=0;i<t.length;i++)if(null==(n=n[t[i]]))return"";return n}},{key:"_initPrimaryDataProviders",value:function(){this.pageDataProvider=new tu,this.siteDataProvider=new iu,this.layoutDataProvider=new au,this.registry.addDataProvider(lu,this.pageDataProvider),this.registry.addDataProvider(cu,this.siteDataProvider),this.registry.addDataProvider(du,this.layoutDataProvider)}},{key:"_updateAdditionalContexts",value:function(d,e){var u=this,p=[];return e.forEach(function(e){switch(e){case uu:u._guardrailsManager._setPerfDockingPanelLoading(!0);var t=S.getThemeLayoutByViewId(d.viewId),n=null;null!=t&&(n=t.themeLayoutId),(t=u.isViewInitialized?new Promise(function(t){var e=Eu(d.viewId,n,u.pageDataProvider.provide()[0]);Cu(h.getRoutes().get(I.getAppState().getCurrentRouteId()).getRouteKeyPrefix(),e).then(function(e){u._guardrailsManager.updatePerfResults(e),t()})}):new Promise(function(t){var e=[];e.push(f.getComponentAudienceTargetInfosForViewPromise(d.viewId)),null!=n&&e.push(S.getComponentAudienceTargetInfosForThemeLayoutPromise(n)),Promise.all(e).then(function(){var e=Eu(d.viewId,n,u.pageDataProvider.provide()[0]);Cu(h.getRoutes().get(I.getAppState().getCurrentRouteId()).getRouteKeyPrefix(),e).then(function(e){u._guardrailsManager.updatePerfResults(e),t()})})})).finally(function(){u._guardrailsManager._setPerfDockingPanelLoading(!1)}),p.push(t);break;case cu:var i,s,t=Promise.resolve();u.isViewInitialized||(i=h.getRoutes(),s=h.getViews(),t=new Promise(function(e){u.siteDataProvider.updateRoutes(i),u.siteDataProvider.updateViews(s),e()})),p.push(t);break;case du:t=k.getFlattenedChildren([d]),c={recordDetails:[],recordInformationTabs:[]},t.forEach(function(e){e.fqn&&"forceCommunity:recordDetail"===e.fqn&&c.recordDetails.push({id:e.id,fqn:e.fqn}),e.fqn&&"forceCommunity:recordHomeTabs"===e.fqn&&c.recordInformationTabs.push({id:e.id,fqn:e.fqn})});var a,o=c;0<o.recordDetails.length||0<o.recordInformationTabs.length?(a=h.getRoutes().get(I.getAppState().getCurrentRouteId()).getRouteKeyPrefix(),0<o.recordDetails.length?(r=Su(a).then(function(e){e&&e.pageLayouts&&u.layoutDataProvider.updatePageLayouts(e.pageLayouts)}),p.push(r)):(r=d.viewId,o=o.recordInformationTabs,l=$.Deferred(),PicassoWebServices.Guardrails.CheckRecordInfoTabsForDetails(r,o,function(e){l.resolve(e)}),o=l.promise().then(function(e){if(!0===e)return Su(a).then(function(e){e&&e.pageLayouts&&u.layoutDataProvider.updatePageLayouts(e.pageLayouts)});u.layoutDataProvider.updatePageLayouts([])}),p.push(o))):u.layoutDataProvider.updatePageLayouts([])}var r,l,c}),p}},{key:"_getAdditionalContexts",value:function(){var e,t=[];return t.push(cu),this.isLWR||(I.AccessControl(P.PERMISSIONS.SITES_PREDICTION_SERVICE_ENABLED)&&t.push(uu),(e=h.getRoutes().get(I.getAppState().getCurrentRouteId()))&&e.isObjectDetailRoute()&&0<e.isObjectDetailRoute().length&&t.push(du)),t}},{key:"_getIncludedTags",value:function(){var e,t=[];return t.push(gu.FF_LARGE),t.push(gu.FF_SMALL),t.push(gu.USABILITY),this.isLWR?t.push(gu.LWR_SITE):(t.push(gu.AURA_SITE),(e=h.getRoutes().get(I.getAppState().getCurrentRouteId()))&&e.isObjectDetailRoute()&&0<e.isObjectDetailRoute().length&&t.push(gu.RECORD_PAGE)),t}},{key:"_getExcludedTags",value:function(){var e,t=[];return this.isLWR?t.push(gu.AURA_SITE):(t.push(gu.LWR_SITE),(e=h.getRoutes().get(I.getAppState().getCurrentRouteId()))&&e.isObjectDetailRoute()&&void 0!==e.isObjectDetailRoute()&&0!==e.isObjectDetailRoute().length||t.push(gu.RECORD_PAGE)),t}}]),t}(),Ru=PicassoWebServices.Labels.CommBuilderPageStructure,ju="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#chevrondown",Bu="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#chevronright",Ou="xlink:href",t="/sfsites/sfservice/builder/resources/external/slds/icons/standard-sprite/svg/symbols.svg#dashboard",Mu='data-toggle="tooltip" data-placement="bottom" title="" data-original-title="{0}"',Vu=["search","profileMenu"].concat(["tabsetConfig","sectionConfig","RenderPriority","system:IsVisible"]),$u=new mr(Object.values(gu)),Uu="VISIBLE",Wu=(u(e={},"ALL",Ru.DisplayedComponentsPicklistOptionAllComponents),u(e,Uu,Ru.DisplayedComponentsPicklistOptionVisibleComponents),u(e,"HIDDEN",Ru.DisplayedComponentsPicklistOptionHiddenComponents),e);var Fu=Fe.View.extend({tagName:"div",className:"cb-ComponentSelectionPanel js-pagestructure",viewId:void 0,headerTemplate:b.template('<div class="cb-pageStructureHeader"><strong class="slds-text-body_regular slds-m-right_xx-small">'+Ru.HiddenComponentCountLabel+'</strong><span class="slds-badge slds-badge_inverse slds-align-middle cb-hiddenComponentCountBadge">{{= hiddenCount}}</span>{{= getComboboxPicklistHtml()}}</div>'),componentTemplate:b.template('<div class="js-component-button cb-ComponentSelectionPanel-item cb-ComponentSelectionPanel-componentName" data-id="{{= id }}">{{- label }}</div>'),regionTemplate:b.template('<section class="cb-componentSection {{= isNested ? "cb-nestedSection js-nested-section" : "js-region-section"}} level-{{- depth}}" data-region-id="{{- id }}" data-region-title="{{- label }}" data-is-theme-region="{{- isThemeRegion }}">{{ if (isNested) { }}<li class="cb-sectionHeader cb-tabHeader js-collapse-region" data-fqn="{{- label }}" id="{{= id }}:c"><a href="javascript:void(0);" title="{{- label }}" class="cb-sectionHeaderAnchor js-sectionHeaderAnchor js-tab-button" data-tab-id="{{- tabId}}" data-region-key="{{- name }}"><svg aria-hidden="true" class="slds-icon slds-icon-text-default cb-sectionHeaderArrow js-section-header-arrow"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+ju+'"></use></svg><span class="cb-itemText slds-text-body--small">{{- label || name }}<i class="{{= (locked == true) ? \'icon-utility-lock\' : \'\' }}"></i></span></a></li>{{ } else { }}<h2 class="cb-sectionHeader js-collapse-region" data-fqn="{{- label }}" id="{{= id }}:c"><a href="javascript:void(0);" title="{{- label }}" class="cb-sectionHeaderAnchor js-sectionHeaderAnchor"><svg aria-hidden="true" class="slds-icon slds-icon-text-default cb-sectionHeaderArrow js-section-header-arrow"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+ju+'"></use></svg><span class="cb-sectionHeaderTitle slds-text-heading--label slds-truncate">{{- label }}<i class="{{= (locked == true) ? \'icon-utility-lock\' : \'\' }}"></i></span></a></h2>{{ } }}<span class="cb-sectionPanel"><ul class="cb-sectionItems js-section-items">{{= componentsHtml }}</ul></span></section>'),containerComponentTemplate:b.template('<section class="cb-componentSection cb-nestedSection js-nested-section" data-region-title="{{- label }}" data-id="{{= id }}" data-visible-mobile="{{= isVisible }}"><li class="cb-sectionItem js-sectionItem js-collapse-region" data-fqn="{{= fqn}}" data-id="{{= id }}" data-locked="{{= locked}}" {{= (priority) ? "data-priority=" + priority : "" }}  data-visible-mobile="{{= isVisible }}"><a href="javascript:void(0);"  class="cb-itemAnchor cb-NestedCmpHeader js-component-button js-sectionHeaderAnchor" data-id="{{= id }}"><svg aria-hidden="true" class="slds-icon slds-icon-text-default cb-sectionHeaderArrow js-section-header-arrow"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+ju+'"></use></svg><span class="cb-itemText slds-text-body--small" title="{{- label }}">{{- label }}</span>{{ if (!isThemeRegion && priority) { }}<span class="cb-componentPriority js-component-priority" tabindex="0"><svg aria-hidden="true" class="slds-icon slds-icon_small slds-icon-text-default cb-componentPriorityIcon"'+L.format(Mu,Ru.Priority+" {{= priorityName }}")+'><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+t+'"></use></svg><span class="slds-assistive-text">'+PicassoWebServices.Labels.CommBuilderPropertyEditor.EditPriority+'</span></span>{{ } }}</a>{{= componentActionsHtml }}</li><span class="cb-sectionPanel js-section-panel">{{= regionsHtml }}</span></section>'),leafComponentTemplate:b.template('<li class="cb-sectionItem js-sectionItem {{= hasError? "cb-sectionItem--broken" : "" }}" data-fqn="{{= fqn}}" data-id="{{= id }}" data-locked="{{= locked}}" {{ if (bundleId && auraId) { }} data-auraid={{- auraId }} data-bundleid={{- bundleId }} {{ } }} {{= (priority) ? "data-priority=" + priority : "" }}  data-visible-mobile="{{= isVisible }}"><a href="javascript:void(0);" class="cb-itemAnchor js-component-button" data-id="{{= id }}" data-tab-id="{{= tabId }}" data-region-key="{{= regionKey }}">{{ if (hasError) { }}<div class="cb-componentWarningIcon icon-utility-warning js-warning-icon"></div>{{ } }}<span class="cb-itemText slds-text-body fy--small {{= (bundleId && auraId) ? "cb-itemTruncate" : "" }}" title="{{- label }}">{{- label }}</span>{{ if (!isThemeRegion && priority) { }}<span class="cb-componentPriority js-component-priority" tabindex="0"><svg aria-hidden="true" class="slds-icon slds-icon_small slds-icon-text-default cb-componentPriorityIcon"'+L.format(Mu,Ru.Priority+" {{= priorityName }}")+'><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+t+'"></use></svg><span class="slds-assistive-text">'+PicassoWebServices.Labels.CommBuilderPropertyEditor.EditPriority+"</span></span>{{ } }}</a>{{= componentActionsHtml }}</li>"),themeRegionTemplate:b.template('<ul class="cb-sectionItems">{{ _.each(contents, function(cmp) { }}<li class="cb-sectionItem js-sectionItem" data-id="{{= cmp.id }}"><a href="javascript:void(0);" class="cb-itemAnchor cb-tabAnchor js-component-button" data-fqn="{{= cmp.fqn}}" data-id="{{= cmp.id }}" data-region-key="{{= cmp.name }}"><span class="cb-itemText slds-text-body--small" title="{{- cmp.label }}">{{- cmp.label }}</span></a></li>{{ }); }}</ul>'),componentActionsTemplate:function(e){function t(e){var t=e?Ru.DeveloperConsole:Ru.LWCDeveloperConsole;return'\n                <span class="cb-componentDevConsole '.concat(e?"js-component-dev-console":"js-open-lwc-editor",'" tabindex="0">\n                    <svg aria-hidden="true" class="slds-icon slds-icon-text-default cb-componentDevConsoleIcon" ').concat(L.format(Mu,t),'>\n                        <use xlink:href="').concat("/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#insert_tag_field",'"></use>\n                    </svg>\n                    <span class="slds-assistive-text">').concat(t,"</span>\n                </span>").trim()}var n=e.isNested,i=e.isVisible,s=e.isMobileTargetingEnabled,a=e.bundleId,e=e.auraId;return'\n        <div class="cb-componentActionContainer '.concat(n?"cb-componentActionContainerNested":"",'">\n            ').concat(I.AccessControl(P.PERMISSIONS.OPEN_DEV_CONSOLE)&&a&&e?t(!0):I.AccessControl(P.PERMISSIONS.LWC_IDE_LITE)&&a&&!e?t(!1):"","\n            ").concat(s?this._getShowHideActionHtml(i):"",'\n            <span class="cb-componentDelete js-component-delete" tabindex="0">\n                <svg aria-hidden="true" class="slds-icon slds-icon-text-default cb-componentDeleteIcon" ').concat(L.format(Mu,Ru.Delete),'>\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="').concat("/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#delete",'"></use>\n                </svg>\n                <span class="slds-assistive-text">').concat(Ru.Delete,"</span>\n            </span>\n        </div>").trim()},showHideActionTemplate:b.template('{{ if (isPhoneResolution) { }}<span class="cb-componentShowHide js-component-show-hide" tabindex="0">{{ if (isVisible) { }}<svg aria-hidden="true" class="slds-icon slds-icon-text-default cb-componentShowIcon"'+L.format(Mu,Ru.HideComponent)+'><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#preview"></use></svg><span class="slds-assistive-text">'+Ru.HideComponent+'</span>{{ } else { }}<svg aria-hidden="true" class="slds-icon slds-icon-text-default cb-componentHideIcon"'+L.format(Mu,Ru.ShowComponent)+'><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#hide"></use></svg><span class="slds-assistive-text">'+Ru.ShowComponent+'</span>{{ } }}</span>{{ } else if (!isVisible) { }}<span class="cb-componentHiddenInMobile" tabindex="0"><svg aria-hidden="true" class="slds-icon slds-icon-text-default cb-componentHiddenInMobileIcon"'+L.format(Mu,Ru.HiddenInMobile)+'><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#hide_mobile"></use></svg><span class="slds-assistive-text">'+Ru.HiddenInMobile+"</span></span>{{ } }}"),displayedComponentsPicklistItemTemplate:b.template('<div class="cb-displayedComponentsSelectionPicklistItem"><div class="{{- selected ? "cb-displayedComponentsSelectionPicklistItem--active" : "" }}">'+D.icon({icon:"check"})+'<span class="cb-displayedComponentsSelectionPicklistItemLabel">{{= label }}</span></div></div>'),events:{"click .js-component-button":"_onSelectComponent","click .js-tab-button":"_onSelectTab","click .js-sectionHeaderAnchor":"_onToggleSection","click .js-component-delete":"_onDeleteComponent","click .js-component-dev-console":"_onOpenDevConsole","click .js-open-lwc-editor":"_onOpenLwcEditor","click .js-component-priority":"_onClickPriority","click .js-component-show-hide":"_onComponentVisibilityChange","click .js-displayed-components-picklist-input":"_onDisplayedComponentsPicklistClick","keyup .js-displayed-components-picklist-input":"_onDisplayedComponentsPicklistKeyUp"},initialize:function(){this.listenTo(I.event,"state:page-change-success",this._handleRouteChangeSuccess),this.listenTo(I.event,"state:page-change-start",this._onChangingView),this.listenTo(I.event,"state:component-error",this._handleComponentError),this.listenTo(I.event,"state:routes-deleted",this._handleRoutesDeleted),this.listenTo(I.event,"state:view-deleted",this._handleViewDeleted),this.listenTo(j.getAppEvent(),"select-aura-component",this._onSelectItem),this.listenTo(j.getAppEvent(),"unselect-aura-component",this._onSelectItem.bind(this,{id:null})),this.listenTo(j.getAppEvent(),"canvas-state:initial-load-complete",this._updateThemeRegionPresence),I.getAppState().supportViewCrud()&&(this.listenTo(I.event,"state:active-resolution-updated",this._onCurrentResolutionChanged),this.listenTo(I.event,"state:aura-component-created",this._handleComponentAdded),this.listenTo(I.event,"state:aura-component-moved",this._handleComponentMoved),this.listenTo(I.event,"state:aura-component-deleted",this._handleComponentDeleted),this.listenTo(I.event,"state:aura-component-updated",this._handleComponentPropertiesChanged),this.listenTo(I.event,"state:aura-component-visibility-updated",this._handleComponentShownHidden),this.listenTo(I.event,"state:content-area-component-audience-updated",this._handleComponentAudienceUpdated),this.listenTo(I.event,"state:theme-layout-area-component-audience-updated",this._handleComponentAudienceUpdated)),this._setCurrentViewId(I.getAppState().getCurrentViewId()),this.render(this._getCurrentViewId())},render:function(e){return this.$el.html(D.spinner),this.$el.tooltip({selector:'[data-toggle="tooltip"]',delay:{show:200,hide:0}}),this._setDisplayedComponentsPicklistSelection("ALL"),this._renderComponentsFromView(e,function(){var e=null;this._currentSelectedItemId&&(e=this._currentSelectedItemId,this._currentSelectedItemId=null),this._selectItemHelper({itemId:e},!1)}),this},show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")},_renderComponentsFromView:function(i,s){var e=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];f.getCanvasComponentsForViewAsync(i,function(e){Xd.triggerGuardrails($u,i,e);var t,n="";this._setCurrentViewId(i),I.getAppState().isCurrentPageAura()&&I.getAppState().supportViewCrud()||E.getSite().isWebApp()?(this._mergeSections(e),e.forEach(function(e){n+=this._getRegionHtml(e,!1,0)}.bind(this))):e.forEach(function(e){n+=this.componentTemplate(e)}.bind(this)),Vn.isMobileExperienceEnabled()&&(t=0,I.getAppState().isMobileFormFactor()&&(t=k.getHiddenComponentCount(e),n=this.headerTemplate({hiddenCount:t,getComboboxPicklistHtml:this._getComboboxPicklistHtml.bind(this)})+n),this.trigger("hidden-component-count-changed",t)),this.$el.empty().html(n),s&&s.call(this)}.bind(this),e)},_getRegionHtml:function(t,e,n,i){var s=this,a=!!t.isThemeRegion,o=!!t.locked,e=b.extend(t,{label:t.label||t.name||"",isNested:e,isThemeRegion:a,tabId:i,depth:n}),r=k.getRegionContents(t).map(function(e){return s._getComponentHtml(e,o,a,i,t.name,n)}).join("");return this.regionTemplate(b.extend(e,{componentsHtml:r}))},_getComponentHtml:function(t,e,n,i,s,a){var o,r=this,l={auraId:null,bundleId:null,priority:null},c=Vn.isMobileExperienceEnabled()&&!n,c=e?"":this._getComponentActionsHtml(t,0<a,c),d=t.priority?PicassoWebServices.Labels.CommBuilderPriorityPicker[t.priority]:"",u=k.getRegionContents(t);return b.isEmpty(u)?(o=b.extend({},l,t,{hasError:(o=t.fqn,Ke.getAllComponentErrors().includes(o)),priorityName:d,locked:e,isThemeRegion:n,tabId:i,regionKey:s,componentActionsHtml:c}),this.leafComponentTemplate(o)):(i=b.extend({},l,t,{locked:e,priorityName:d,isThemeRegion:n,componentActionsHtml:c}),s=n&&e&&!E.getSite().isWebApp()?this.themeRegionTemplate({contents:u}):t.contents.map(function(e){return r._getRegionHtml(e,!0,a+1,t.id)}).join(""),this.containerComponentTemplate(b.extend(i,{componentActionsHtml:c,regionsHtml:s})))},_getComboboxPicklistHtml:function(){var e={formInputClassName:"js-displayed-components-picklist-input",formInputId:"displayed-components-picklist-input-id",label:Ru.DisplayedComponentsPicklistLabel,value:this._getDisplayedComponentsPicklistValue()};return D.comboboxPicklist(e)},_getComponentActionsHtml:function(e,t,n){t=b.extend({devConsoleAccess:I.AccessControl(P.PERMISSIONS.OPEN_DEV_CONSOLE),isNested:t,isMobileTargetingEnabled:n,getShowHideActionHtml:this._getShowHideActionHtml.bind(this)},e);return this.componentActionsTemplate(t)},_getShowHideActionHtml:function(e){e={isPhoneResolution:I.getAppState().isMobileFormFactor(),isVisible:e};return this.showHideActionTemplate(e)},_handleRouteChangeSuccess:function(e){e=e.viewId;e!==this._getCurrentViewId()&&this.render(e),this._updateThemeRegionPresence()},_updateThemeRegionPresence:function(){var e,n;0<Ke.getAllComponentErrors().length||(e=this._getCurrentViewId(),n=this,f.getCanvasComponentsForViewAsync(e,function(e){e=b.chain(e).filter("isThemeRegion").map("id");j.getLiveMode().areRegionsPresent(e,function(e){b.each(e,function(e,t){e||n.$('.js-region-section[data-region-id="'+t+'"]').addClass("hidden")})})}))},_onCurrentResolutionChanged:function(){this.render(this._getCurrentViewId())},_handleComponentAdded:function(e){this._renderComponentsFromView(this._getCurrentViewId(),function(){this._selectItemHelper({itemId:e},!1)},!1)},_handleComponentMoved:function(e){var t=e.itemId;this._renderComponentsFromView(this._getCurrentViewId(),function(){this._selectItemHelper({itemId:t},!1)})},_handleComponentDeleted:function(){this._renderComponentsFromView(this._getCurrentViewId(),function(){this._selectItemHelper({itemId:null},!0)})},_handleComponentPropertiesChanged:function(e){var t,n=e.itemId,e=e.props;(t=e)&&b.some(Vu,function(e){return b.has(t,e)})?this._renderComponentsFromView(this._getCurrentViewId(),function(){this._selectItemHelper({itemId:n},!1)}):Xd.shouldTriggerGuardrailsOnPropChange(e)&&Xd.getCmpsAndTriggerGuardrails($u,this._getCurrentViewId())},_handleComponentShownHidden:function(e,t){e=e.id;this._handleComponentPropertiesChanged({itemId:e,props:t})},_handleComponentError:function(){this._renderComponentsFromView(this._getCurrentViewId(),function(){this._selectItemHelper({itemId:null},!1)})},_setCurrentViewId:function(e){this._currentViewId=e},_getCurrentViewId:function(){return this._currentViewId},_setDisplayedComponentsPicklistSelection:function(e){this._displayedComponentsPicklistSelection=e,I.getAppState().isMobileFormFactor()&&Vn.isMobileExperienceEnabled()&&"ALL"!==e?e===Uu?(this.$el.removeClass("show-hidden-mobile"),this.$el.addClass("show-visible-mobile")):"HIDDEN"===e&&(this.$el.removeClass("show-visible-mobile"),this.$el.addClass("show-hidden-mobile"),this.$el.find(".js-nested-section[data-visible-mobile=true]").has(".cb-sectionItem[data-visible-mobile=false]").css("display","block")):(this.$el.removeClass("show-hidden-mobile"),this.$el.removeClass("show-visible-mobile")),this.$(".js-displayed-components-picklist-input").val(this._getDisplayedComponentsPicklistValue())},_getDisplayedComponentsPicklistSelection:function(){return this._displayedComponentsPicklistSelection},_onChangingView:function(e){var t=e.viewId;e.persistState&&this._handlePersistWorkspaceState(),Xd.updateGuardrailsViewInitializedStatus($u,!1),this.render(t)},_onSelectComponent:function(e){var e=T(e.currentTarget),t=e.data("id"),n=e.data("tab-id"),i=e.data("region-key");e.hasClass("is-selected")?j.getAppEvent().trigger("page-structure-component-reselected",{itemId:t,tabId:n,regionKey:i}):this._selectItemHelper({itemId:t,tabId:n,regionKey:i},!0)},_onOpenDevConsole:function(e){var e=T(e.currentTarget).closest(".js-sectionItem"),t=e.data("bundleid"),e=e.data("auraid"),e=L.format("?action=openFile&extent=AuraDefinition&Id={0}&AuraDefinitionBundleId={1}&DefType=COMPONENT&Format=XML",e,t),t=E.getSite().get("developerConsoleUrl");window.open(t+e,"DeveloperConsole","width=1000,height=800,resizable=yes,toolbar=no,status=no,scrollbars=yes,menubar=no,directories=yes,location=no,dependant=no",!1,!1)},_onOpenLwcEditor:function(e){e=T(e.currentTarget).closest(".js-sectionItem").data("fqn");yo(e)},_onDeleteComponent:function(e){e.stopPropagation();var e=T(e.currentTarget).closest(".js-sectionItem"),t=e.data("id"),n=e.data("fqn"),e=e.hasClass("cb-sectionItem--broken")&&1===this.$el.find('.js-sectionItem[data-fqn="'+n+'"]').length;j.getAppEvent().trigger("delete-canvas-item",t,{fqn:n,shouldRemoveFromCache:e})},_onComponentVisibilityChange:function(e){e.stopPropagation();var e=T(e.currentTarget).closest(".js-sectionItem"),t=e.data("id"),e=e.data("visible-mobile");I.event.trigger("action:update-aura-component-visibility",{itemId:t,isVisible:!e})},_onDisplayedComponentsPicklistKeyUp:function(e){0==this.$(".js-displayed-components-selection-picklist-items").length&&e.which===P.KEYCODE.DOWN&&this._onDisplayedComponentsPicklistClick(e)},_onDisplayedComponentsPicklistClick:function(e){var n=this;Yd({items:b.map(Wu,function(e,t){return{id:t,html:n.displayedComponentsPicklistItemTemplate({label:e,selected:t===n._getDisplayedComponentsPicklistSelection()})}}),cssClass:"cb-displayedComponentsSelectionPicklistItems js-displayed-components-selection-picklist-items",onClickHandler:function(e){n._setDisplayedComponentsPicklistSelection(e)},selected:this._getDisplayedComponentsPicklistSelection()}).toggle(e.currentTarget)},_onClickPriority:function(e){e.stopPropagation();var e=T(e.currentTarget).closest(".js-sectionItem"),t=e.data("id"),e=e.data("priority");Kd.openPrioritySelectorForComponent(e,function(e){I.event.trigger("action:update-aura-component",{itemId:t,values:{RenderPriority:e}})})},_onSelectTab:function(e){var e=T(e.currentTarget),t=e.data("tab-id"),e=e.data("region-key");j.getAppEvent().trigger("page-structure-component-selected",{tabId:t,regionKey:e})},_onToggleSection:function(e){this._toggleSectionHelper(T(e.currentTarget))},_onSelectItem:function(e){this._selectItemHelper({itemId:e.id},!1)},_selectItemHelper:function(e,t){this.$(".js-component-button").removeClass("is-selected");var n,i=null;(i=e.itemId?this.$('.js-component-button[data-id="'+e.itemId+'"]'):i)&&i[0]&&((!I.getAppState().isMobileFormFactor()||(n=i.closest(".js-sectionItem"))&&!0===n.data("visible-mobile"))&&i.addClass("is-selected"),I.getAppState().isCurrentPageAura()&&I.getAppState().supportViewCrud()&&this._makeItemVisibleInPageStructureHelper(i),t)&&j.getAppEvent().trigger("page-structure-component-selected",e)},_makeItemVisibleInPageStructureHelper:function(e){this._expandItemSectionInPageStructure(e);var t,n,i,s=T(this.el);0<s.length&&(t=s.height(),e=(n=e.position().top-s.position().top)+e.height(),i=s.scrollTop(),t<e?s.scrollTop(i+(e-t)+15):n<0&&s.scrollTop(i+n-15))},_expandItemSectionInPageStructure:function(e){var t=e.closest("section");0<t.length&&(e.hasClass("js-sectionHeaderAnchor")||0<(e=t.children(".cb-sectionPanel")).length&&0===e.not(".hidden").length&&this._toggleSectionHelper(t)),t.hasClass("js-nested-section")&&(e=t.parent().closest("section"),this._expandItemSectionInPageStructure(e))},_handlePersistWorkspaceState:function(){var e=this.$(".is-selected");this._currentSelectedItemId=e.data("id")},_toggleSectionHelper:function(e){var t;0<e.length&&(0<(t=e.find(".js-section-header-arrow use")).length&&(t.attr(Ou)===ju?t.attr(Ou,Bu):t.attr(Ou,ju)),0<(t=e.closest("section")).length)&&0<(e=t.children(".cb-sectionPanel")).length&&e.toggleClass("hidden")},_mergeToMatchedParentSection:function(e,t){for(var n=!1,i=0;i<e.length;i++){var s=e[i],a=t.components;if(s.name===t.parent){s.components=s.components||[],s.components.push.apply(s.components,a||[]),n=!0;break}}return!1===n&&(t.name=t.parent,t.parent=null,t.locked=!0,e.push(t)),n},_mergeSections:function(e){var t=e.length;if(1<t)for(var n=[],i=0;i<t;i++){var s=e[i];s.parent&&this._mergeToMatchedParentSection(n,s)&&(e.splice(i,1),t--,i--)}},_getDisplayedComponentsPicklistValue:function(){return Wu[this._getDisplayedComponentsPicklistSelection()]},_handleRoutesDeleted:function(){Xd.updateGuardrailsViewInitializedStatus($u,!1),Xd.getCmpsAndTriggerGuardrails($u,this._getCurrentViewId())},_handleViewDeleted:function(){Xd.updateGuardrailsViewInitializedStatus($u,!1),Xd.getCmpsAndTriggerGuardrails($u,this._getCurrentViewId())},_handleComponentAudienceUpdated:function(){Xd.getCmpsAndTriggerGuardrails($u,this._getCurrentViewId())}}),Hu=PicassoWebServices.Labels.CommBuilderPageStructure,Gu=["forceCommunity:tabset","forceCommunity:tabLayout"];function zu(){return Vn.isMobileExperienceEnabled()}function Ku(){return E.getSite().isWebApp()&&Vn.isResponsiveCmpVisibilityEnabled()}function Yu(){return I.AccessControl(P.PERMISSIONS.OPEN_DEV_CONSOLE)||I.AccessControl(P.PERMISSIONS.LWC_IDE_LITE)}function qu(t,e,n,i){var s,a,o,r=Ke.getAllComponentErrors().includes(t.fqn),n=(n=n,d=r,s=i,l=!!(a=t).fqn,o=n&&Gu.includes(n.fqn),l=l||o?"link":"label",c={label:a.label},d&&(c.iconName="utility:error",c.alternativeText=Hu.Error),"link"==l&&(o?(c.eventType="tablinkclick",c.eventValue={tabId:n.id,regionKey:a.name}):(c.eventType=s?"":"nodelinkclick",c.eventValue={itemId:a.id,tabId:n.tabId,regionKey:n.regionKey,isVisibleInLwr:a.isVisibleInLwr},c.labelTestHint=a.fqn)),d=[],a.locked&&d.push({type:"icon",attributes:{iconName:"utility:lock",alternativeText:Hu.Locked}}),a.priority&&(o=PicassoWebServices.Labels.CommBuilderPriorityPicker[a.priority],s="priority-".concat(o),d.push({type:"button-icon",attributes:{eventType:"priorityclick",eventValue:{itemId:a.id,priority:a.priority},iconName:"standard:dashboard",testHint:s,tooltip:"".concat(Hu.Priority," ").concat(o)}})),{type:l,attributes:c,decorators:d}),l=(a=t,s=i,!(o=e)||o.locked||!a.fqn||s?{}:{type:"button-icon",attributes:{alternativeText:Hu.Delete,eventType:"deletecomponentclick",eventValue:{itemId:a.id,fqn:a.fqn},iconName:"utility:delete",testHint:"component-delete"}}),c=(!!i||!1===t.isVisibleInLwr)&&Ku(),d={name:t.id,node:n,delete:l,hasError:r,isHidden:c},n=(t.fqn||(d.showToggle=!0),zu()&&(d.visibility=(o=t,(s=e)&&(s.locked||s.isThemeRegion)||o.isThemeRegion||"boolean"!=typeof o.isVisible?{}:I.getAppState().isMobileFormFactor()?(s=o.isVisible?Hu.HideComponent:Hu.ShowComponent,a=o.isVisible?"utility:preview":"utility:hide",n=!o.isVisible,l="component-visibility-".concat(o.isVisible?"hide":"show"),{type:"button-icon",attributes:{alternativeText:s,eventType:"togglecomponentclick",eventValue:{itemId:o.id,isVisible:n},iconName:a,testHint:l}}):o.isVisible?{}:{type:"helptext",attributes:{content:Hu.HiddenInMobile,testHint:"component-hidden-in-mobile",iconName:"utility:hide_mobile"}})),d.isHidden&&(d.responsivevisibility=(r=i,(s=t).isThemeRegion||"boolean"!=typeof s.isVisibleInLwr||r?{}:(r=Hu.ComponentHiddenOnDesktop,n="responsive-visiblity-icon-desktop",I.getAppState().isTabletFormFactor()?(r=Hu.ComponentHiddenOnTablet,n="responsive-visiblity-icon-tablet"):I.getAppState().isMobileFormFactor()&&(r=Hu.ComponentHiddenOnMobile,n="responsive-visiblity-icon-mobile"),{type:"button-icon",attributes:{iconName:"utility:hide",testHint:n,tooltip:r,eventType:"unhidecomponentclick",eventValue:{componentId:s.id,componentStyleProperties:{isVisible:!0}}}}))),Yu()&&(d.console=(l=(a=t).bundleId,o=t.auraId,a=t.fqn,(i=l&&o)||l&&!o?{type:"button-icon",attributes:{alternativeText:i?Hu.DeveloperConsole:Hu.LWCDeveloperConsole,eventType:"showdevconsoleclick",eventValue:{auraId:o,bundleId:l,fqn:a,isAura:i},iconName:"utility:insert_tag_field",testHint:i?"component-dev-console":"open-lwc-editor"}}:{})),k.getRegionContents(t));return Array.isArray(n)&&0!==n.length&&(r=t.fqn?e:t,Gu.includes(t.fqn)&&n.forEach(function(e){e.tabId=t.id,e.regionKey=e.name}),d._children=Xu(n,r,t,c)),d}function Xu(e,t,n,i){for(var s=[],a=0;a<e.length;a++)s.push(qu(e[a],t,n,i));return s}var Ju={columns:function(){var e=[{type:"node",fieldName:"node"}];return Yu()&&e.push({type:"action",fieldName:"console"}),zu()&&e.push({type:"action",fieldName:"visibility"}),Ku()&&e.push({type:"action",fieldName:"responsivevisibility"}),e.push({type:"action",fieldName:"delete"}),e},convertToTreeGrid:function(e){return Xu(e)}},Qu=PicassoWebServices.Labels.CommBuilderPageStructure,Zu=["search","profileMenu"].concat(["tabsetConfig","sectionConfig","RenderPriority","system:IsVisible","isVisible"]),ep=new mr(Object.values(gu)),tp="ALL",np="VISIBLE",ip=(u(ot={},tp,Qu.DisplayedComponentsPicklistOptionAllComponents),u(ot,np,Qu.DisplayedComponentsPicklistOptionVisibleComponents),u(ot,"HIDDEN",Qu.DisplayedComponentsPicklistOptionHiddenComponents),ot);var sp=Fe.View.extend({tagName:"div",className:"cb-ComponentSelectionPanel js-pagestructure",viewId:void 0,headerTemplate:b.template('\n        <div class="cb-pageStructureHeader">\n            <strong class="slds-text-body_regular slds-m-right_xx-small">\n                '.concat(Qu.HiddenComponentCountLabel,'\n            </strong>\n            <span class="slds-badge slds-badge_inverse slds-align-middle cb-hiddenComponentCountBadge">{{= hiddenCount}}</span>\n            {{= getComboboxPicklistHtml()}}\n        </div>').trim()),displayedComponentsPicklistItemTemplate:b.template('\n        <div class="cb-displayedComponentsSelectionPicklistItem">\n            <div class="{{- selected ? "cb-displayedComponentsSelectionPicklistItem--active" : "" }}">\n                '.concat(D.icon({icon:"check"}),'\n                <span class="cb-displayedComponentsSelectionPicklistItemLabel">\n                    {{= label }}\n                </span>\n            </div>\n        </div>').trim()),events:{"click .js-displayed-components-picklist-input":"_onDisplayedComponentsPicklistClick","keyup .js-displayed-components-picklist-input":"_onDisplayedComponentsPicklistKeyUp"},initialize:function(){this.listenTo(I.event,"state:page-change-success",this._handleRouteChangeSuccess),this.listenTo(I.event,"state:page-change-start",this._onChangingView),this.listenTo(I.event,"state:component-error",this._handleComponentError),this.listenTo(I.event,"state:routes-deleted",this._handleRoutesDeleted),this.listenTo(I.event,"state:view-deleted",this._handleViewDeleted),this.listenTo(j.getAppEvent(),"select-aura-component",this._onSelectItem),this.listenTo(j.getAppEvent(),"unselect-aura-component",this._onSelectItem.bind(this,{id:null})),I.getAppState().supportViewCrud()&&(this.listenTo(I.event,"state:active-resolution-updated",this._onCurrentResolutionChanged),this.listenTo(I.event,"state:aura-component-created",this._handleComponentAdded),this.listenTo(I.event,"state:aura-component-moved",this._handleComponentMoved),this.listenTo(I.event,"state:aura-component-deleted",this._handleComponentDeleted),this.listenTo(I.event,"state:aura-component-updated",this._handleComponentPropertiesChanged),this.listenTo(I.event,"state:aura-component-visibility-updated",this._handleComponentShownHidden),this.listenTo(I.event,"state:content-area-component-audience-updated",this._handleComponentAudienceUpdated),this.listenTo(I.event,"state:theme-layout-area-component-audience-updated",this._handleComponentAudienceUpdated),this.listenTo(I.event,"state:component-responsive-visibility-updated",this._handleComponentVisiblityToggle));var e=this.$el[0];e.addEventListener("nodelinkclick",this._onSelectComponent.bind(this)),e.addEventListener("tablinkclick",this._onSelectTab.bind(this)),e.addEventListener("deletecomponentclick",this._onDeleteComponent.bind(this)),e.addEventListener("togglecomponentclick",this._onComponentVisibilityChange.bind(this)),e.addEventListener("showdevconsoleclick",this._onClickDevConsole.bind(this)),e.addEventListener("priorityclick",this._onClickPriority.bind(this)),e.addEventListener("unhidecomponentclick",this._handleComponentUnhide.bind(this)),this._setCurrentViewId(I.getAppState().getCurrentViewId()),this.render(this._getCurrentViewId())},render:function(e){return this.$el.html(D.spinner),this._setDisplayedComponentsPicklistSelection(tp),this._renderComponentsFromView(e,function(){var e=null;this._currentSelectedItemId&&(e=this._currentSelectedItemId,this._currentSelectedItemId=null),this._selectItemHelper({itemId:e},!1)}),this},show:function(){this.$el.removeClass("hidden");var e=this.$el[0].querySelector("dxp_builder-multi-action-tree");null!=e&&e.showSelectedItem()},hide:function(){this.$el.addClass("hidden")},_renderComponentsFromView:function(o,r){var e=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];f.getCanvasComponentsForViewAsync(o,function(e){Xd.triggerGuardrails(ep,o,e),this._setCurrentViewId(o),(I.getAppState().isCurrentPageAura()&&I.getAppState().supportViewCrud()||E.getSite().isWebApp())&&(this._mergeSections(e),e.forEach(function(e){b.extend(e,{label:e.label||e.name||"",isNested:!1,isThemeRegion:!!e.isThemeRegion})}.bind(this)));var t,n="",i=(Vn.isMobileExperienceEnabled()&&(t=0,I.getAppState().isMobileFormFactor()&&(t=k.getHiddenComponentCount(e),n=this.headerTemplate({hiddenCount:t,getComboboxPicklistHtml:this._getComboboxPicklistHtml.bind(this)})),this.trigger("hidden-component-count-changed",t),this._updateDisplayedComponents(e)),Vn.isResponsiveCmpVisibilityEnabled()&&(t=k.hasResponsiveVisibilityHiddenComponents(e),delete ip[np],n='<div class="cb-pageStructureHeader">'.concat(this._getComboboxPicklistHtml(),"</div>"),this.trigger("responsive-hidden-components-loaded",t),e=this._getFilteredComponents(e)),Ju.columns()),s=Ju.convertToTreeGrid(e),a=(this.$el.empty().html(n),this.$el[0]);$P.auraRun(function(){$A.createComponent("dxp_builder:multiActionTree",{class:"cb-tableTree-compact",columns:i,items:s,expandedRows:"*",autoScroll:!0},function(e){e&&($A.render(e,a),$A.afterRender(e))})}),r&&r.call(this)}.bind(this),e)},_getComboboxPicklistHtml:function(){var e={formInputClassName:"js-displayed-components-picklist-input",formInputId:"displayed-components-picklist-input-id",label:Qu.DisplayedComponentsPicklistLabel,value:this._getDisplayedComponentsPicklistValue(),fullWidth:!0};return D.comboboxPicklist(e)},_handleRouteChangeSuccess:function(e){e=e.viewId;e!==this._getCurrentViewId()&&this.render(e),this._updateThemeRegionPresence()},_updateThemeRegionPresence:function(){var e;0<Ke.getAllComponentErrors().length||(e=this._getCurrentViewId(),f.getCanvasComponentsForViewAsync(e,function(e){var t=[];e.forEach(function(e){e.isThemeRegion&&t.push(e.id)}),j.getLiveMode().areRegionsPresent(t,function(t){var n=new Set(Object.keys(t).filter(function(e){return!t[e]})),e=this.$el[0].querySelector("dxp_builder-multi-action-tree");e&&(e.items=e.items.filter(function(e){return!n.has(e.name)}))})}))},_getFilteredComponents:function(e){return this._displayedComponentsPicklistSelection===tp?e:function t(e,n){return e.filter(function(e){return!1===e.isVisibleInLwr||(e.components?e.components=t(e.components):e.contents&&(e.contents=t(e.contents)),n)||e.components&&e.components.length||e.contents&&e.contents.length})}(e,!0)},_updateDisplayedComponents:function(e){var n=this;e.forEach(function(e){var t=k.getRegionContents(e).filter(function(e){var t;switch(n._displayedComponentsPicklistSelection){case np:t=!0===e.isVisible;break;case"HIDDEN":t=!1===e.isVisible;break;default:t=!0}return t});e.components?e.components=t:e.contents&&(e.contents=t)})},_onCurrentResolutionChanged:function(){this.render(this._getCurrentViewId())},_handleComponentAdded:function(e){this._renderComponentsFromView(this._getCurrentViewId(),function(){this._selectItemHelper({itemId:e},!1)},!1)},_handleComponentMoved:function(e){var t=e.itemId;this._renderComponentsFromView(this._getCurrentViewId(),function(){this._selectItemHelper({itemId:t},!1)})},_handleComponentDeleted:function(){this._renderComponentsFromView(this._getCurrentViewId(),function(){this._selectItemHelper({itemId:null},!0)})},_handleComponentPropertiesChanged:function(e){var t,n=e.itemId,e=e.props;(t=e)&&b.some(Zu,function(e){return b.has(t,e)})?this._renderComponentsFromView(this._getCurrentViewId(),function(){this._selectItemHelper({itemId:n},!1)}):Xd.shouldTriggerGuardrailsOnPropChange(e)&&Xd.getCmpsAndTriggerGuardrails(ep,this._getCurrentViewId())},_handleComponentShownHidden:function(e,t){e=e.id;this._handleComponentPropertiesChanged({itemId:e,props:t})},_handleComponentVisiblityToggle:function(e){this._handleComponentPropertiesChanged({itemId:e.componentId,props:e.componentStyleProperties})},_handleComponentError:function(){this._renderComponentsFromView(this._getCurrentViewId(),function(){this._selectItemHelper({itemId:null},!1)})},_setCurrentViewId:function(e){this._currentViewId=e},_getCurrentViewId:function(){return this._currentViewId},_setDisplayedComponentsPicklistSelection:function(e){this._displayedComponentsPicklistSelection=e,this.$(".js-displayed-components-picklist-input").val(this._getDisplayedComponentsPicklistValue())},_getDisplayedComponentsPicklistSelection:function(){return this._displayedComponentsPicklistSelection},_onChangingView:function(e){var t=e.viewId;e.persistState&&this._handlePersistWorkspaceState(),Xd.updateGuardrailsViewInitializedStatus(ep,!1),this.render(t)},_onSelectComponent:function(e){var t=e.target,e=e.detail.value;t.selectedItem===e.itemId?j.getAppEvent().trigger("page-structure-component-reselected",e):(t.selectedItem=e.itemId,j.getAppEvent().trigger("page-structure-component-selected",e))},_onClickDevConsole:function(e){var t,n,e=e.detail.value;e.isAura?(t=L.format("?action=openFile&extent=AuraDefinition&Id={0}&AuraDefinitionBundleId={1}&DefType=COMPONENT&Format=XML",e.auraId,e.bundleId),n=E.getSite().get("developerConsoleUrl"),window.open(n+t,"DeveloperConsole","width=1000,height=800,resizable=yes,toolbar=no,status=no,scrollbars=yes,menubar=no,directories=yes,location=no,dependant=no",!1,!1)):yo(e.fqn)},_onDeleteComponent:function(e){var e=e.detail.value,t=e.itemId,e=e.fqn;j.getAppEvent().trigger("delete-canvas-item",t,{fqn:e})},_onComponentVisibilityChange:function(e){var e=e.detail.value,t=e.itemId,e=e.isVisible;I.event.trigger("action:update-aura-component-visibility",{itemId:t,isVisible:e})},_onDisplayedComponentsPicklistKeyUp:function(e){0==this.$(".js-displayed-components-selection-picklist-items").length&&e.which===P.KEYCODE.DOWN&&this._onDisplayedComponentsPicklistClick(e)},_onDisplayedComponentsPicklistClick:function(e){var n=this;Yd({items:b.map(ip,function(e,t){return{id:t,html:n.displayedComponentsPicklistItemTemplate({label:e,selected:t===n._getDisplayedComponentsPicklistSelection()})}}),cssClass:"cb-displayedComponentsSelectionPicklistItems js-displayed-components-selection-picklist-items",onClickHandler:function(e){n._setDisplayedComponentsPicklistSelection(e),n._renderComponentsFromView(n._getCurrentViewId())},selected:this._getDisplayedComponentsPicklistSelection()}).toggle(e.currentTarget)},_onClickPriority:function(e){var e=e.detail.value,t=e.itemId,e=e.priority;Kd.openPrioritySelectorForComponent(e,function(e){I.event.trigger("action:update-aura-component",{itemId:t,values:{RenderPriority:e}})})},_onSelectTab:function(e){var t=e.target,e=e.detail.value;t.selectedItem=e.tabId,j.getAppEvent().trigger("page-structure-component-selected",e)},_onSelectItem:function(e){this._selectItemHelper({itemId:e.id},!1)},_selectItemHelper:function(e,t){var n=this.$el[0].querySelector("dxp_builder-multi-action-tree");n&&(n.selectedItem=e.itemId),t&&j.getAppEvent().trigger("page-structure-component-selected",e)},_handlePersistWorkspaceState:function(){var e=this.$el[0].querySelector("dxp_builder-multi-action-tree");this._currentSelectedItemId=e.selectedItem},_mergeToMatchedParentSection:function(e,t){for(var n=!1,i=0;i<e.length;i++){var s=e[i],a=t.components;if(s.name===t.parent){s.components=s.components||[],s.components.push.apply(s.components,a||[]),n=!0;break}}return!1===n&&(t.name=t.parent,t.parent=null,t.locked=!0,e.push(t)),n},_mergeSections:function(e){var t=e.length;if(1<t)for(var n=[],i=0;i<t;i++){var s=e[i];s.parent&&this._mergeToMatchedParentSection(n,s)&&(e.splice(i,1),t--,i--)}},_getDisplayedComponentsPicklistValue:function(){return ip[this._getDisplayedComponentsPicklistSelection()]},_handleRoutesDeleted:function(){Xd.updateGuardrailsViewInitializedStatus(ep,!1),Xd.getCmpsAndTriggerGuardrails(ep,this._getCurrentViewId())},_handleViewDeleted:function(){Xd.updateGuardrailsViewInitializedStatus(ep,!1),Xd.getCmpsAndTriggerGuardrails(ep,this._getCurrentViewId())},_handleComponentAudienceUpdated:function(){Xd.getCmpsAndTriggerGuardrails(ep,this._getCurrentViewId())},_handleComponentUnhide:function(e){var e=e.detail.value,t=e.componentId,e=e.componentStyleProperties;I.event.trigger("action:update-component-style",{componentId:t,componentStyleProperties:e,shouldRefreshPropertyPanel:!0})}}),ap=PicassoWebServices.Labels.CommBuilderSettings,i=PicassoWebServices.Labels.StudioStartWizard,op="DataCategoryGroupName",rp="TopLevelCategory",lp="CompanyName",cp="CPD",me=Backbone.View.extend({className:"cb-Settings-section cb-Settings-generalSection js-settings-general-section",catGroupTemplate:_.template('<div class="form-group cb-Settings-propertyGroup"><a href="{{= Link }}" target="_blank" title="'+i.TopicsLinkTooltip+'" class="cb-Settings-labelLinkWrapper"><span class="cb-Settings-labelLink cb-Settings-propertyLabel">{{= Label }}</span><span class="cb-Settings-labelLinkIcon icon-utility-new_window"></span></a><select {{= Disabled ? "disabled" : ""}} class="js-data-category-groups cb-Settings-propertyInput js-template-property-input" id="js-template-property-input-{{= Name}}" data-name="{{= Name}}">{{ _.each(Options, function(o) { }}<option value="{{= o.Value }}" {{= o.Selected ? "selected" : "" }}>{{= o.Label }}</option>{{ }); }}</select></div>'),inputTemplate:_.template('<div class="form-group cb-Settings-propertyGroup">{{ if (_.isEmpty(Link)) { }}<label class="cb-Settings-propertyLabel" for="js-template-property-input-{{= Name}}">{{= Label }}</label>{{ } else { }}<a href="{{= Link }}" target="_blank" title="'+i.TopicsLinkTooltip+'" class="cb-Settings-labelLinkWrapper"><span class="cb-Settings-labelLink cb-Settings-propertyValue">{{= Label }}</span><span class="cb-Settings-labelLinkIcon icon-utility-new_window"></span></a>{{ } }}<input type="text" {{= Disabled ? "disabled" : ""}} class="form-control cb-Settings-propertyInput js-template-property-input slds-input" id="js-template-property-input-{{= Name}}" data-name="{{= Name}}" data-type="{{= Type}}" value="{{- Value }}" data-native="{{= typeof(NativeProperty) != "undefined" ? 1 : 0 }}"></div>'),inputTemplateWithLoading:_.template('<div class="form-group cb-Settings-propertyGroup"><label title="{{= Tooltip}}" class="cb-Settings-propertyLabel" for="js-template-property-input-{{= Name}}">{{= Label }}</label><img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="cb-Settings-saveIndicator js-local-save-indicator hidden" /><input type="text" {{= Disabled ? "disabled" : ""}} class="form-control cb-Settings-propertyInput js-template-property-input slds-input" id="js-template-property-input-{{= Name}}" data-name="{{= Name}}" data-type="{{= Type}}" value="{{- Value }}" data-native="{{= typeof(NativeProperty) != "undefined" ? 1 : 0 }}"></div>'),propertiesTemplate:_.template('<hr class="cb-Settings-sectionDivider" /><div class="cb-Settings-sectionSubHeading">'+ap.CommunityPropertiesHeading+'<img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="cb-Settings-saveIndicator js-save-indicator hidden" /></div><form class="js-properties-section">{{= properties }}</form>'),communityTopicsTemplate:_.template('<div class="cb-Settings-formGroupHeader">'+ap.TopicsSubHeading+'</div><div class="cb-Settings-propertyGroup"><div class="cb-Settings-propertyLabel">'+i.SetNavTopicHeading+'</div><div class="cb-Settings-propertyValue">'+i.SetNavTopicDesc+'<div><a href="{{= navTopicUrl }}" target="_blank" title="'+i.TopicsLinkTooltip+'" class="cb-Settings-labelLinkWrapper js-settings-nav-topics-link"><span class="cb-Settings-labelLink">'+i.SetNavTopicLabel+'</span><span class="cb-Settings-labelLinkIcon icon-utility-new_window"></span></a></div></div></div><div class="cb-Settings-propertyGroup"><div class="cb-Settings-propertyLabel">'+i.SetFeatureTopicHeading+'</div><div class="cb-Settings-propertyValue">'+i.SetFeatureTopicDesc+'<div><a href="{{= featuredTopicUrl }}" target="_blank" title="'+i.TopicsLinkTooltip+'" class="cb-Settings-labelLinkWrapper js-settings-featured-topics-link"><span class="cb-Settings-labelLink">'+i.SetFeatureTopicLabel+'</span><span class="cb-Settings-labelLinkIcon icon-utility-new_window"></span></a></div></div></div>'),siteStatusTemplate:_.template('<div class="cb-Settings-propertyLabel">'+ap.SiteStatusFieldLabel+'</div>{{ if (isSiteMigratedToCMS && !isSitePublished) { }}<div class="cb-Settings-propertyValue js-settings-site-status-value">'+ap.CMSMigratedSitePublishedStatus+'</div>{{ } else if (isSiteRolledBackToSiteDotCom) { }}<div class="cb-Settings-propertyValue js-settings-site-status-value">'+ap.SiteDotComRolledBackSitePublishedStatus+'</div>{{ } else if (isSitePublished) { }}<span class="cb-Settings-publishedLabel cb-Settings-propertyValue">'+ap.SiteStatusPublished+': </span><a href="{{= liveSiteUrl }}" target="_blank" class="cb-Settings-propertyValue js-settings-site-status-value" title="'+ap.ViewLiveCommunitySiteTooltip+'">{{= liveSiteUrl }}</a>{{ } else { }}<div class="cb-Settings-propertyValue js-settings-site-status-value">'+ap.SiteStatusNotPublished+"</div>{{ } }}"),commPublicTemplate:_.template('<div class="cb-Settings-propertyLabel cb-Settings-propertyLabel--inlineBlock">'+ap.CommunityPublicHeading+"</div>"+D.tooltipButtonIcon({buttonClassName:"cb-Settings-propertyInputInfoIcon",tooltipPlacement:"right",tooltipLabel:"".concat(_.escape(ap.CommunityPublicHeadingTooltip))})+'<div class="slds-form-element"><div class="slds-form-element__control"><label class="slds-checkbox"><input type="checkbox" class="cb-Settings-communityPublicCheckbox js-comm-public" {{= isChecked}} /><span class="slds-checkbox_faux js-comm-public-checkbox--faux"></span><span class="slds-form-element__label cb-Settings-communityPublicLabel">'+ap.CommunityPublicLabel+"</span></label></div></div>"),preferredDomainTemplate:_.template('<div class="cb-Settings-propertyGroup" {{- domains.length < 2 ? "hidden" : "" }}><div class="cb-Settings-propertyLabel cb-Settings-propertyLabel--inlineBlock">'+ap.PreferredDomainLabel+"</div>"+D.tooltipButtonIcon({buttonClassName:"cb-Settings-propertyInputInfoIcon",buttonAttributes:'data-html="true"',tooltipPlacement:"right",tooltipLabel:"".concat(ap.PreferredDomainTooltip)})+'<div class="slds-form-element"><div class="slds-form-element__control"><select class="cb-Settings-propertyInput slds-select js-preferred-domain-select"><option value="none">'+ap.PreferredDomainDefaultOption+'</option>{{ _.each(domains, function(d) { }}<option value="{{- isCMSSite ? d.domainSiteId : d.domainId }}" {{- d.disabled ? "disabled" : "" }} {{- d.preferred ? "selected" : "" }}> {{- d.protocol + d.name + d.contextPath }}/</option>{{ }); }}</select></div></div></div>'),template:_.template('<h2 class="cb-Settings-sectionHeading">'+ap.GeneralSectionTitle+'</h2><div class="cb-Settings-sectionDescription">'+ap.GeneralSectionDesc+'</div><div class="cb-Settings-formGroupHeader">'+ap.CommunityDetailSubHeading+'</div><div class="cb-Settings-propertyGroup"><div class="cb-Settings-propertyLabel">'+ap.CommunityTemplateFieldLabel+'</div><div class="cb-Settings-propertyValue js-settings-community-template-name">{{- templateName }}</div></div><div class="cb-Settings-propertyGroup js-settings-auth-state">{{= commPublicHtml}}</div>{{= siteTitleHtml }}<div class="cb-Settings-propertyGroup js-settings-site-status">{{= siteStatusHtml }}</div><div class="cb-Settings-propertyGroup">{{= preferredDomainHtml }}</div><div class="cb-Settings-propertyGroup"><div class="cb-Settings-propertyLabel">'+ap.GuestUserProfileFieldLabel+'</div><div class="cb-Settings-propertyValue">'+ap.GuestUserProfileFieldHelpText+'</div><a class="cb-Settings-propertyValue js-settings-guest-user-profile-link" href="{{= guestUserProfileURL }}" target="_blank">{{- guestUserProfileName }}</a></div>{{= templateSpecificHtml }}'),events:{"change .js-data-category-groups":"_onChangeDataCategoryGroup","change .js-preferred-domain-select":"_onChangePreferredDomain","click .js-comm-public":"_onClickCommPublic"},getDataCategoryUrl:function(){return E.getSite().get("appServerUrl")+"/category/datacategorysetup.apexp"},initialize:function(){var e,t,n,i=this;this._currentTemplate=I.getAppState().getHomePageTemplate(),_.isUndefined(this._currentTemplate)||(this.listenTo(E.getSite(),"change:isActive",this._onSitePublishStatusChange),this.listenTo(h.getPages(),"reset",this._renderContent),e=this._getDataCategoryGroups(),t=this._getCustomPropertyValues(),(n=E.getDomainsPromise()).done(function(e){i._domains=e}),this.render(),T.when(e,t,n).done(function(){this._renderContent()}.bind(this)))},render:function(){return this.$el.html(D.spinner),this},_renderContent:function(){var e="",t=(I.getAppState().isSelfServiceTemplate(this._currentTemplate)?e+=this.propertiesTemplate({properties:this._buildCustomPropertiesHTML()}):I.getAppState().isCommunityTemplate(this._currentTemplate)&&(e+=this.communityTopicsTemplate({navTopicUrl:E.getSite().get("navigationalTopicUrl"),featuredTopicUrl:E.getSite().get("featuredTopicUrl")})),""),n=(I.getAppState().isCurrentPageAura()&&(t=this.inputTemplateWithLoading({Name:"AuraTitle",Label:ap.SiteTitle,Tooltip:ap.SiteTitleDesc,Value:I.getAppState().getHomePageTemplate().get("AuraTitle"),Disabled:!1,Type:"local",Link:""})),I.getAppState().getCurrentSite().isCommunityPublic()),i=this._getTemplateDisplayName();return this.$el.html(this.template({templateName:i,guestUserProfileName:E.getSite().get("guestusername"),guestUserProfileURL:E.getSite().get("guestuserurl"),siteStatusHtml:this.siteStatusTemplate({isSitePublished:E.getSite().get("isActive"),isSiteMigratedToCMS:E.getSite().get("isMigratedToCMS"),isSiteRolledBackToSiteDotCom:E.getSite().get("isRolledBackToSiteDotCom"),liveSiteUrl:E.getSite().get("communityLiveSiteUrl")}),commPublicHtml:I.getAppState().isCurrentPageAuthenticated()?this.commPublicTemplate({isChecked:n?"checked":""}):"",preferredDomainHtml:this.preferredDomainTemplate({domains:this._domains,isCMSSite:E.getSite().get("isInCmsStore")}),siteTitleHtml:t,templateSpecificHtml:e})),I.getAppState().isSelfServiceTemplate(this._currentTemplate)&&this.$(".js-data-category-groups").select2({minimumResultsForSearch:8}),this.$(".js-template-property-input").not(".js-data-category-groups").bind("change keyup",this._handlePropertyChange.bind(this)),this.$('[data-toggle="tooltip"]').tooltip(),this},_getTemplateDisplayName:function(){var e=$P.cbMetadata.templates[this._currentTemplate.getDevName()];return e?e.displayName:ap.UnknownTemplate},_getDataCategoryGroups:function(){var t=T.Deferred();return I.getAppState().isSelfServiceTemplate(this._currentTemplate)?PicassoWebServices.CommContent.GetDataCategoryGroups(function(e){this._dataCategoryGroups=e,t.resolve()}.bind(this)):t.resolve(),t.promise()},_getCustomPropertyValues:function(){var t=T.Deferred();return PicassoWebServices.ManageSiteCommon.GetCPDValues(I.getAppState().getCurrentPageId(),function(e){this._cpValues=e,t.resolve()}.bind(this)),t.promise()},_onSitePublishStatusChange:function(e){e={isSitePublished:e.get("isActive"),isSiteMigratedToCMS:e.get("isMigratedToCMS"),isSiteRolledBackToSiteDotCom:e.get("isRolledBackToSiteDotCom"),liveSiteUrl:E.getSite().get("communityLiveSiteUrl")};this.$(".js-settings-site-status").html(this.siteStatusTemplate(e))},_onPropertiesCancel:function(){_.each(this._userCustomizableTemplateProperties,function(e,t){t===op?this.$(".select2-container.js-data-category-groups").select2("val",e.DefaultValue):this.$('.js-template-property-input[data-name="'+t+'"]').val(e.DefaultValue)}.bind(this))},_savePropertyValues:function(){this.$(".js-save-indicator").removeClass("hidden");var n=[];this.$(".js-template-property-input").each(function(){var e=T(this).data("name"),t=T.trim(T(this).val());e&&t&&n.push({name:e,value:t,nativeProperty:T(this).attr("data-native")})}),PicassoWebServices.ManageSiteCommon.SetCPDValues(I.getAppState().getCurrentPageId(),n,I.getAppState().getCurrentPageId(),function(n){_.each(this._userCustomizableTemplateProperties,function(e,t){t=_.find(n.CustomProperties,{Name:t});t&&(e.DefaultValue=t.DefaultValue)}),setTimeout(function(){this.$(".js-save-indicator").addClass("hidden")}.bind(this),1e3),I.event.trigger("action:refresh-current-page")}.bind(this))},_saveLocalPropertyValues:function(e){this.$(".js-local-save-indicator").removeClass("hidden");var t=e.data("name"),e=T.trim(e.val());PicassoWebServices.ManageSiteCommon.UpdateProperty(I.getAppState().getCurrentPageId(),t,e,function(e){setTimeout(function(){this.$(".js-local-save-indicator").addClass("hidden")}.bind(this),1e3),I.event.trigger("action:refresh-current-page")}.bind(this))},_onClickCommPublic:function(e){e=T(e.currentTarget).prop("checked");I.event.trigger("action:update-community-privacy",{value:e})},_handlePropertyChange:function(e){var t=T(e.currentTarget),n=t.data("name"),i=t.data("type");e.keyCode===P.KEYCODE.ENTER||"blur"===e.type?i===cp?t.val()!==this._userCustomizableTemplateProperties[n].DefaultValue&&this._savePropertyValues():this._saveLocalPropertyValues(t):"change"===e.type&&(i===cp?this._savePropertyValues():this._saveLocalPropertyValues(t))},_onChangeDataCategoryGroup:function(e){var t=T(e.target).val(),e=_.find(this._dataCategoryGroups,function(e){return e.Name===t});this.$("#js-template-property-input-"+rp).val(e.TopCategoryName),this._userCustomizableTemplateProperties[rp].DefaultValue=e.TopCategoryName,this._savePropertyValues()},_onChangePreferredDomain:function(e){e=T(e.target).val();I.event.trigger("action:update-site-preferred-domain-id",{PreferredDomainId:e})},_getCpInfoLookup:function(){var n=this._getPageCPDValues(),i=null,e=_.map(this._dataCategoryGroups,function(e){var t=e.Name===n[op].DefaultValue;return t&&(i=e),{Value:e.Name,Label:e.Name,Selected:t}});return i||_.isEmpty(e)||(i=this._dataCategoryGroups[0],e[0].Selected=!0),n[op].Options=e,n},_buildCustomPropertiesHTML:function(){I.getAppState().getCurrentPage();var e=[],t=this._getCpInfoLookup(),n=t[op].Options,i=!1;return _.isEmpty(n)&&(PicassoWebServices.Labels.StudioText.None,i=!0),e.push(this.catGroupTemplate({Name:t[op].Name,Label:t[op].Label,Value:t[op].DefaultValue,Options:t[op].Options,Disabled:i,Link:this.getDataCategoryUrl()})),e.push(this.inputTemplate({Type:cp,Name:t[rp].Name,Label:t[rp].Label,Value:t[rp].DefaultValue,Disabled:i,Link:this.getDataCategoryUrl()})),e.push(this.inputTemplate({Type:cp,Name:t[lp].Name,Label:t[lp].Label,Value:t[lp].DefaultValue,Disabled:!1,Link:""})),e.join("")},_getPageCPDValues:function(){return this._userCustomizableTemplateProperties=T.extend(!0,{},$P.cbMetadata.templates[this._currentTemplate.getDevName()].properties),_.each(this._userCustomizableTemplateProperties,function(e,t){e=_.find(this._cpValues,{Name:e.Name});e&&(this._userCustomizableTemplateProperties[t].DefaultValue=e.DefaultValue)}.bind(this)),this._userCustomizableTemplateProperties}}),dp=PicassoWebServices.Labels.CommBuilderSettings,up=Backbone.View.extend({tagName:"div",className:"cb-DeveloperDlg showLoader",template:_.template('<div class="vex-dialog-message"><div class="cb-DialogPrompt-title js-title">{{= title }}</div><div class="cb-DialogPrompt-message js-message"><div class="cb-DeveloperDlg-progressContent"><img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="cb-DeveloperDlg-progressIcon"></img></div></div></div><div class="cb-DeveloperDlg-buttons vex-dialog-buttons"><button class="cb-Button vex-dialog-button vex-first vex-last js-close">'+dp.DevAreaDialogGotIt+"</button></div>"),_exportSuccessTemplate:_.template('<div class="cb-DeveloperDlg-desc">'+dp.DevAreaSuccessDescription+'<ul class="cb-DeveloperDlg-list"><li class="cb-DeveloperDlg-listItem">{{= detailLabel }}</li><li class="cb-DeveloperDlg-listItem">{{= ctaLabel }}</li></ul></div>'),_exportErrorTemplate:_.template('<div class="cb-DeveloperDlg-desc">{{= errorLabel}}</div><ul class="cb-ExportError-list">{{ _.each(failures, function(failure, i) { }}<li class="cb-DeveloperDlg-listItem"><span class="cb-ExportError-index">'+dp.DevAreaExportErrorCounterTitle.replace("{0}","{{= i+1}}")+':</span><span class="cb-ExportError-failure">{{- failure}}</span></li>{{ }); }}</ul>'),events:{"click .js-close":"_close"},initialize:function(e){this.options=e||{},this._info=e.info,this._imgUrls=e.imgUrls,this._type=e.type,this.listenTo(I.event,"state:template-exported",this.onTemplateExport),this.listenTo(I.event,"state:theme-exported",this.onThemeExport),"function"==typeof e.exportSuccessCallback&&(this.exportSuccessCallback=e.exportSuccessCallback)},render:function(){return"export-template"===this._type?(this.$el.append(this.template({title:dp.DevAreaExportTemplateLoader})),I.event.trigger("action:export-template",{imgUrls:this._imgUrls,info:this._info})):"export-theme"===this._type&&(this.$el.append(this.template({title:dp.DevAreaExportThemeLoader})),I.event.trigger("action:export-theme",{imgUrls:this._imgUrls,info:this._info})),this},onTemplateExport:function(e){e.success?this.onTemplateExportSuccess():this.onTemplateExportError(e)},onThemeExport:function(e){e.success?this.onThemeExportSuccess():this.onThemeExportError(e)},onTemplateExportSuccess:function(){this.onExportSuccess({headerLabel:dp.DevAreaExportTemplateSuccessHeader,detailLabel:dp.DevAreaExportTemplateSuccessDetail,ctaLabel:dp.DevAreaExportTemplateSuccessCTA})},onThemeExportSuccess:function(){this.onExportSuccess({headerLabel:dp.DevAreaExportThemeSuccessHeader,detailLabel:dp.DevAreaExportThemeSuccessDetail,ctaLabel:dp.DevAreaExportThemeSuccessCTA})},onExportSuccess:function(e){this.$el.removeClass("showLoader"),this.$el.addClass("cb-ExportSuccess"),this.$(".js-title").text(e.headerLabel),this.$(".js-message").html(this._exportSuccessTemplate({detailLabel:e.detailLabel,ctaLabel:e.ctaLabel.replace(/\{0\}/g,I.getAppState().get("currentSite").get("createPackageUrl"))})),this.exportSuccessCallback({name:this._info.masterLabel})},onTemplateExportError:function(e){this.onExportError(e,{errorLabel:dp.DevAreaExportTemplateErrorDescription})},onThemeExportError:function(e){this.onExportError(e,{errorLabel:dp.DevAreaExportThemeErrorDescription})},onExportError:function(e,t){this.$el.removeClass("showLoader"),this.$el.addClass("cb-ExportError"),this.$(".js-title").text(dp.DevAreaExportErrorHeader),this.$(".js-message").html(this._exportErrorTemplate({failures:e.failures,errorLabel:t.errorLabel})),this.$(".js-close").text(dp.DevAreaDialogOK)},_close:function(){A.closeDialog()}}),pp=PicassoWebServices.Labels.CommBuilderSettings,gp=Backbone.View.extend({tagName:"div",className:"cb-DeveloperDlg showLoader js-export-page-loader",template:_.template('<div class="vex-dialog-message js-export-page-all-messages"><div class="cb-DialogPrompt-title js-export-page-dialog-title">{{= title }}</div><div class="cb-DialogPrompt-message"><div class="cb-DeveloperDlg-progressContent"><img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="cb-DeveloperDlg-progressIcon"></img></div></div></div><div class="cb-DeveloperDlg-buttons vex-dialog-buttons"><button class="cb-Button vex-dialog-button vex-first vex-last js-close">'+pp.DevAreaDialogGotIt+"</button></div>"),_convertSuccessTemplate:_.template('<div class="cb-DeveloperDlg-desc">'+pp.DevAreaSuccessDescription+'<ul class="cb-DeveloperDlg-list"><li class="cb-DeveloperDlg-listItem">'+pp.DevAreaConvertSuccessDetail+'</li><li class="cb-DeveloperDlg-listItem">'+pp.DevAreaConvertSuccessCTA.replace(/\{0\}/g,"{{= url}}")+"</li></ul></div>"),_convertErrorTemplate:_.template('<div class="cb-DeveloperDlg-desc">'+pp.DevAreaConvertErrorDescription+'</div><ul class="cb-ExportError-list">{{ _.each(failures, function(failure, i) { }}<li class="cb-DeveloperDlg-listItem"><span class="cb-ExportError-index">'+pp.DevAreaExportErrorCounterTitle.replace("{0}","{{= i+1}}")+':</span><span class="cb-ExportError-failure">{{- failure}}</span></li>{{ }); }}</ul>'),events:{"click .js-close":"_close"},initialize:function(e){this.options=e||{},this._selectedViewId=e.selectedViewId,this.listenTo(I.event,"state:page-exported",this.onConvert)},render:function(){return this.$el.append(this.template({title:pp.DevAreaConvertLoader})),I.event.trigger("action:export-page",{viewId:this._selectedViewId}),this},onConvert:function(e){this.$el.removeClass("showLoader"),this.$el.removeClass("js-export-page-loader"),e.success?this.onConvertSuccess(e):this.onConvertError(e)},onConvertSuccess:function(e){this.$el.addClass("cb-ExportSuccess"),this.$(".cb-DialogPrompt-title").text(pp.DevAreaConvertSuccessHeader),this.$(".cb-DialogPrompt-message").html(this._convertSuccessTemplate({url:I.getAppState().get("currentSite").get("createPackageUrl")})),ya.getAllGlobalPages(null,!0)},onConvertError:function(e){this.$el.addClass("cb-ExportError"),this.$(".cb-DialogPrompt-title").text(pp.DevAreaExportErrorHeader),this.$(".cb-DialogPrompt-message").html(this._convertErrorTemplate({failures:e.failures})),this.$(".js-close").text(pp.DevAreaDialogOK)},_close:function(){A.closeDialog()}}),hp=["Record Detail","Record List","Related Record List"],mp=["extrelated-quip"],vp=["extdetail-cms"],s=PicassoWebServices.Labels.CommBuilderSettings,n=PicassoWebServices.Labels.StudioStartWizard,hr=PicassoWebServices.Labels.CommBuilderPageManagement,bp="&imgSizeReductionFactor="+encodeURIComponent(JSON.stringify({quality:50,width:1260,height:820})),fp=[{value:$P.cbMetadata.templateTypes.Sales,label:n.SalesType},{value:$P.cbMetadata.templateTypes.Service,label:n.ServiceType},{value:$P.cbMetadata.templateTypes.Marketing,label:n.MarketingType},{value:$P.cbMetadata.templateTypes.IT,label:n.ITType},{value:$P.cbMetadata.templateTypes.Commerce,label:n.CommerceType}],_p="export-template",Sp="export-page",Cp="export-theme",yp=C.createSharedDebounce(),fr=Backbone.View.extend({_exportedTemplateNames:[],_exportedThemeNames:[],_isTemplateNamesLoaded:!1,_isThemeNamesLoaded:!1,_pendingTemplateNameCheck:!1,_pendingThemeNameCheck:!1,_devContainerTemplate:function(e){var t=e.description,n=e.devTabs,e=e.devConsoleVisible;return'\n            <h2 class="cb-Settings-sectionHeading">'.concat(s.DeveloperSectionTitle,'</h2>\n            <div class="cb-Settings-sectionDescription">').concat(t,"</div>\n                ").concat(n,"\n                ").concat(e?D.button({buttonClassName:"cb-Developer-consoleButton js-open-developer-console",buttonVariantClassName:"slds-button_neutral slds-truncate",label:"".concat(s.DeveloperConsole)}):"",'\n                <div class="cb-DevSection-tabContentContainer js-settings-developer-section">\n            </div>').trim()},_devTabsTemplate:function(e){e=e.sections;return'\n            <div class="cb-DevSection-tabsContainer slds-tabs_default">\n                <ul class="cb-DevSection-tabsNav slds-tabs_default__nav" role="tablist">\n                    '.concat(e.map(function(e){return'<li data-id="'.concat(e.tabId,'" class="cb-DevSection-tabsNavItem slds-tabs_default__item js-sd-tab-item" role="presentation" data-id="').concat(e.tabId,'">\n                            <a href="javascript:void(0)" data-id="').concat(e.tabId,'" class="cb-DevSection-tabsNavItemLink slds-tabs_default__link" role="tab">').concat(e.tabLabel,"</a>\n                        </li>").trim()}).join(""),"\n                </ul>\n            </div>").trim()},_devSectionTemplate:_.template('<div class="cb-DevSection-tabContent js-sd-tab-content" data-id="{{= tabId}}" role="tabpanel">{{ if (showLoading) { }}<div class="spinner-container slds-spinner_container"><div role="status" class="slds-spinner slds-spinner_brand slds-spinner_medium js-spinner"><span class="slds-assistive-text">'+hr.Loading+'</span><div class="slds-spinner__dot-a"></div><div class="slds-spinner__dot-b"></div></div></div>{{ } else { }}<div class="cb-Settings-tabContentDescription">{{=header}}<a href="'+E.getSite().get("templateExportHelpUrl")+'" target="_blank" class="cb-DevSection-helpLink">'+s.DevAreaExportTemplateHelpLink+"</a></div>{{=html}}{{ } }}</div>"),_inputNameWithLoading:_.template('<div class="cb-Settings-propertyGroup"><label title="{{= Tooltip}}" class="cb-Settings-propertyLabel" for="js-template-property-input-{{= Name}}">{{= Label }}<span class="required">*</span></label><img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="cb-Settings-saveIndicator js-local-save-indicator hidden" /><input type="text" {{= Disabled ? "disabled" : ""}} class="form-control cb-Settings-propertyInput slds-input {{= NameInputJsSelector}} js-template-property-input slds-input" id="js-template-property-input-{{= Name}}" data-name="{{= Name}}" maxlength="30" data-type="{{= Type}}" value="{{- Value }}" data-native="{{= typeof(NativeProperty) != "undefined" ? 1 : 0 }}"><div class="cb-DevSection-inlineError js-name-error">'+s.DevAreaTemplateNameError+"</div></div>"),_inputPublisher:_.template('<div class="cb-Settings-propertyGroup"><label class="cb-Settings-propertyLabel" for="js-template-property-input-{{= Name}}">{{= Label }}<span class="required">*</span></label><input type="text" class="form-control cb-Settings-propertyInput slds-input {{= PublisherInputJsSelector}} js-template-property-input slds-input" id="js-template-property-input-{{= Name}}" data-name="{{= Name}}" maxlength="30" value="{{- Value }}"></div>'),_category:_.template('<div class="cb-Settings-propertyGroup"><label title="" class="cb-Settings-propertyLabel">'+s.DevAreaTemplateCategory+'<span class="required">*</span></label><select class="cb-Settings-propertySelect js-select-category" placeholder="'+s.DevAreaTemplateChooseCategory+'">{{ _.each(categories, function(cat) { }}<option value="{{=cat.value}}">{{=cat.label}}</option>{{ }); }}</select></div>'),_summary:_.template('<div class="cb-Settings-propertyGroup"><div class="cb-DevSection-summary"><label title="" class="cb-Settings-propertyLabel">'+s.DevAreaTemplateSummary+'<span class="required">*</span></label><div class="cb-DevSection-charCount cb-DevSection-highCount">255</div><textarea class="form-control slds-textarea js-input-limited js-summary" placeholder="{{= placeholderLabel}}"></textarea></div></div>'),_highlightsGroup:_.template('<div class="cb-Settings-formGroupHeader">'+s.DevAreaTemplateHighlights+'</div><div class="cb-Settings-formGroupDescription">{{= helpLabel}}</div><div class="cb-Settings-propertyGroup"><div class="cb-DevSection-highlightsGroup js-highlights-group">{{= highlightsFeature }}</div>'+D.button({buttonClassName:"cb-Settings-addHighlight js-add-highlight",buttonVariantClassName:"slds-button_neutral slds-truncate",label:"".concat(s.DevAreaTemplateAddHighlightButton)})+"</div>"),_highlightsFeature:_.template('<div class="js-highlight cb-DevSection-highlight"><label title="" class="cb-Settings-propertyLabel">{{ if (index === 0) { }} <span class="required">*</span> {{ } }}<span class="js-highlight-label">'+s.DevAreaTemplateHighlightTitle.replace(/\{0\}/g,"{{= index+1}}")+"</span>{{ if (index > 0) { }}"+D.buttonIcon({buttonClassName:"cb-DevSection-removeHighlightButton js-remove-highlight",svgClassName:"cb-DevSection-removeHighlightIcon",icon:"close",label:"".concat(PicassoWebServices.Labels.General.Close)})+'{{ } }}</label><div class="cb-Settings-propertyInput"><input type="text" class="cb-DevSection-highlightsTitle slds-input js-highlight-title js-template-property-input js-input-limited" placeholder="'+s.DevAreaTemplateHighlightTitlePlaceholder+'"></input><div class="cb-DevSection-charCount cb-DevSection-lowCount">16</div><textarea class="cb-DevSection-highlightsDescription slds-textarea js-input-limited js-highlight-content" placeholder="'+s.DevAreaTemplateHighlightDescPlaceholder+'"></textarea><div class="cb-DevSection-charCount cb-DevSection-highCount">255</div></div></div>'),_uploadImage:_.template('<div class="cb-Settings-propertyGroup"><label title="" class="cb-Settings-propertyLabel">'+s.DevAreaTemplateImage+'<span class="required">*</span></label>'+D.tooltipButtonIcon({buttonClassName:"cb-Settings-propertyInputInfoIcon",tooltipPlacement:"right",tooltipLabel:"".concat(_.escape(s.DevAreaTemplateImageHelp))})+'<div class="cb-Settings-propertyValue"><div>{{ _.each(indexes, function(i) { }}<div class="js-image js-upload-image cb-ImageProperty-wrapper cb-ImageProperty-multiple" data-index="{{=i}}" title="'+PicassoWebServices.Labels.ImagePickerDialog.UploadImage+'"><div class="cb-ImageProperty-overlay cb-ImageProperty-overlay--placeholder js-placeholder-icon"><i class="cb-ImageProperty-uploadIcon icon-utility-upload"></i></div><div class="js-placeholder cb-ImageProperty-placeholder"><i class="cb-ImageProperty-placeholderIcon icon-utility-image"></i></div></div>{{ }); }}<div class="cb-DevSection-inlineError js-image-error">'+s.DevAreaTemplateImageError+"</div></div></div></div>"),_imageTemplate:_.template('<img class="js-img" src="{{=imgUrl}}"/>'),_exportForm:_.template('<div class="slds-form--stacked">{{= infoHeader }}{{= name }}{{= publisher }}{{= categories}}{{= images}}{{= summary }}{{= highlights }}{{= exportButton }}</div>'),className:"cb-Settings-section cb-Settings-developerSection",events:{"click .js-export-template-bpo":"_onExportTemplate","click .js-export-page":"_onConvertPageToFlexipage","click .js-export-theme":"_onExportTheme","click .js-upload-image":"_onUploadImage","click .js-remove-image":"_onRemoveImage","click .js-sd-tab-item:not(.slds-is-active)":"_onTabClick","click .js-add-highlight":"_onAddHighlight","click .js-remove-highlight":"_onRemoveHighlight","change .js-template-name":function(e){yp(this._onUpdateTemplateName.bind(this,e),!0)},"input .js-template-name":function(e){yp(this._onUpdateTemplateName.bind(this,e),!1)},"change .js-theme-name":function(e){yp(this._onUpdateThemeName.bind(this,e),!0)},"input .js-theme-name":function(e){yp(this._onUpdateThemeName.bind(this,e),!1)},"change .js-template-publisher":function(){yp(this._onUpdateTemplatePublisher.bind(this),!0)},"input .js-template-publisher":function(){yp(this._onUpdateTemplatePublisher.bind(this),!1)},"change .js-theme-publisher":function(){yp(this._onUpdateThemePublisher.bind(this),!0)},"input .js-theme-publisher":function(){yp(this._onUpdateThemePublisher.bind(this),!1)},"click .js-open-developer-console":"_onOpenDeveloperConsole","keyup .js-input-limited":"_onKeyUp"},initialize:function(){this.listenTo(I.event,["state:route-created","state:routes-deleted","state:routes-properties-updated","state:view-created","state:view-deleted","state:view-properties-updated"].join(" "),this._handlePagesChanged),this._isExportSupported=(k.isCommunityBasedTemplate()||k.isNapiliBasedTemplate())&&$P.hasTemplateExportBPOPerm,this._selectedTabId=this._isExportSupported?_p:Sp,this.listenTo(I.event,"state:upgradeflows-loaded",this.render),this.render()},renderExportTemplateToBPOArea:function(){var e,t,n="";return Qe.needsUpgrade()?this._devSectionTemplate({tabId:_p,header:s.ExportTemplateNotAvailableCuzUpdate,helpText:'<a href="'.concat(E.getSite().get("templateExportHelpUrl"),'" target="_blank" class="cb-DevSection-helpLink">').concat(s.DevAreaExportTemplateHelpLink,"</a>"),html:"",showLoading:!1}):(e=this._inputNameWithLoading({Name:"TemplateName",Label:s.DevAreaTemplateName,Tooltip:"",Value:I.getAppState().getHomePageTemplate().get("AuraTitle"),Disabled:!1,Type:"local",Link:"",NameInputJsSelector:"js-template-name"}),t=this._inputPublisher({Name:"TemplatePublisher",Label:s.DevAreaPublisherName,Value:"",PublisherInputJsSelector:"js-template-publisher"}),n+=this._exportForm({tabId:_p,infoHeader:"<div class='cb-Settings-formGroupHeader'>"+s.DevAreaTemplateInfo+"</div>",name:e,publisher:t,categories:this._category({categories:fp}),images:this._uploadImage({indexes:Array.from(Array(3).keys())}),summary:this._summary({placeholderLabel:s.DevAreaTemplateSummaryPlaceholder}),highlights:this._highlightsGroup({highlightsFeature:this._highlightsFeature({index:0}),helpLabel:s.DevAreaTemplateHighlightHelp}),exportButton:"<button class='cb-Button cb-Button--primary cb-Button--settingsProperty cb-Button--exportTemplate js-export-template-bpo'>"+s.DevAreaExportTemplateButton+"</button>"}),this._handleGetAllExportedTemplateNames(),this._devSectionTemplate({tabId:_p,header:s.DevAreaExportTemplateBPOHeader,html:n,showLoading:!Qe.isAllUpgradeFlowsFetched()}))},renderConvertFlexipageArea:function(){var e=(e=(e="")+"<div class='js-export-page-container'>"+("<div class=' cb-Settings-propertyLabel'>"+s.DevAreaConvertDesc+"</div>"))+"<div><select class='cb-DevSection-pageOptions cb-Settings-propertySelect js-select-pages'></select>"+("<button class='cb-Button cb-Button--settingsProperty cb-Button--exportPage js-export-page'>"+s.DevAreaConvertButton+"</button></div>");return this._devSectionTemplate({tabId:Sp,header:s.DevAreaConvertToFlexi,html:e,showLoading:!1})},renderExportThemeArea:function(){var e,t,n="";return Qe.needsUpgrade()?this._devSectionTemplate({tabId:Cp,header:s.ExportThemeNotAvailableCuzUpdate,html:"",showLoading:!1}):(e=this._inputNameWithLoading({Name:"ThemeName",Label:s.DevAreaThemeName,Tooltip:"",Value:I.getAppState().getHomePageTemplate().get("AuraTitle"),Disabled:!1,Type:"local",Link:"",NameInputJsSelector:"js-theme-name"}),t=this._inputPublisher({Name:"ThemePublisher",Label:s.DevAreaPublisherName,Value:"",PublisherInputJsSelector:"js-theme-publisher"}),n+=this._exportForm({tabId:Cp,infoHeader:"<div class='cb-Settings-formGroupHeader'>"+s.DevAreaTemplateInfo+"</div>",name:e,publisher:t,categories:"",images:this._uploadImage({indexes:Array.from(Array(3).keys())}),summary:this._summary({placeholderLabel:s.DevAreaThemeSummaryPlaceholder}),highlights:this._highlightsGroup({highlightsFeature:this._highlightsFeature({index:0}),helpLabel:s.DevAreaThemeHighlightHelp}),exportButton:"<button class='cb-Button cb-Button--primary cb-Button--settingsProperty cb-Button--exportTemplate js-export-theme'>"+s.DevAreaExportTemplateButton+"</button>"}),this._handleGetAllExportedThemeNames(),this._devSectionTemplate({tabId:Cp,header:s.DevAreaExportThemeHeader,html:n,showLoading:!Qe.isAllUpgradeFlowsFetched()}))},_onOpenDeveloperConsole:function(){var e=E.getSite().get("developerConsoleUrl");window.open(e,"DeveloperConsole","width=1000,height=800,resizable=yes,toolbar=no,status=no,scrollbars=yes,menubar=no,directories=yes,location=no,dependant=no",!1,!1)},_onUploadImage:function(e){var t=this,n=T(e.currentTarget).data("index");A.showDialog(new ec({uploadSuccessCallback:function(e){t.$(".js-image-error").hasClass("cb-DevSection-exportInputError")&&(t.$(".js-upload-image").removeClass("cb-DevSection-exportInputError"),t.$(".js-image-error").removeClass("cb-DevSection-exportInputError"),t._checkEnableExport()),t.$(".js-placeholder-icon").eq(n).html('<i class="cb-ImageProperty-uploadIcon icon-utility-close"></i>'),t.$(".js-image").eq(n).addClass("js-remove-image").removeClass("js-upload-image"),t.$(".js-placeholder").eq(n).html(t._imageTemplate({imgUrl:e}))},encodedImageSizeReductionFactor:bp,fileFormatNotSupportedMessage:s.FileFormatNotSupportedMessage}))},_onRemoveImage:function(e){e=T(e.currentTarget).data("index");this.$(".js-placeholder-icon").eq(e).html('<i class="cb-ImageProperty-uploadIcon icon-utility-upload"></i>'),this.$(".js-placeholder").eq(e).html('<i class="cb-ImageProperty-placeholderIcon icon-utility-image"></i>'),this.$(".js-image").eq(e).addClass("js-upload-image").removeClass("js-remove-image")},_onAddHighlight:function(e){var t=this.$(".js-highlight").length;this.$(".js-highlights-group").append(this._highlightsFeature({index:t})),3===t&&this.$(".js-add-highlight").hide()},_onRemoveHighlight:function(e){var t=T(e.target).parents(".js-highlight").nextAll();_.each(t,function(e){var t=T(e).index();T(e).find(".js-highlight-label").text(s.DevAreaTemplateHighlightTitle.replace(/\{0\}/g,t))}),T(e.target).parents(".js-highlight").remove(),this.$(".js-add-highlight").is(":hidden")&&this.$(".js-add-highlight").show(),this._checkEnableExport()},_onTabClick:_.debounce(function(e){e=T(e.currentTarget).attr("data-id");this._selectTab(e)},125),_onKeyUp:function(e){var e=T(e.target),t=e.next(),n=t.hasClass("cb-DevSection-lowCount")?16-e.val().length:255-e.val().length;t.text(n),n<0&&(e.addClass("cb-DevSection-exportInputError"),t.addClass("cb-DevSection-exportInputError"),this.$(".js-export-template-bpo").addClass("cb-DevSection-exportError").text(s.DevAreaExportTemplateButtonError)),0<=n&&(t.hasClass("cb-DevSection-exportInputError")&&t.removeClass("cb-DevSection-exportInputError"),e.removeClass("cb-DevSection-exportInputError"),this._checkEnableExport())},_onUpdateTemplateName:function(e){this._onUpdateTemplateOrThemeName({nameSelector:".js-template-name",exportButtonSelector:".js-export-template-bpo",loaded:"_isTemplateNamesLoaded",nameCheck:"_pendingTemplateNameCheck",nameList:this._exportedTemplateNames.concat(this._exportedThemeNames)})},_onUpdateThemeName:function(e){this._onUpdateTemplateOrThemeName({nameSelector:".js-theme-name",exportButtonSelector:".js-export-theme",loaded:"_isThemeNamesLoaded",nameCheck:"_pendingThemeNameCheck",nameList:this._exportedThemeNames.concat(this._exportedTemplateNames)})},_onUpdateTemplatePublisher:function(){this._handleRemoveInputError(".js-template-publisher")},_onUpdateThemePublisher:function(){this._handleRemoveInputError(".js-theme-publisher")},_onUpdateTemplateOrThemeName:function(e){var t;this[e.loaded]?(t=this.$(e.nameSelector).val().trim(),e.nameList.indexOf(t)<0?(this.$(".js-name-error").removeClass("cb-DevSection-exportInputError"),this._handleRemoveInputError(e.nameSelector)):0<t.length&&(this.$(".js-name-error").addClass("cb-DevSection-exportInputError"),this.$(e.nameSelector).addClass("cb-DevSection-exportInputError"),this.$(e.exportButtonSelector).addClass("cb-DevSection-exportError").text(s.DevAreaExportTemplateButtonError))):(this.$(".js-local-save-indicator").removeClass("hidden"),this[e.nameCheck]=!0)},_handleRemoveInputError:function(e){0<this.$(e).val().trim().length&&(this.$(e).removeClass("cb-DevSection-exportInputError"),this._checkEnableExport())},_onExportTemplate:function(e){this._onExportTemplateOrTheme(e,{type:_p,nameInputJsSelector:".js-template-name",publisherInputJsSelector:".js-template-publisher",category:this.$(".js-select-category").select2("val"),validateInput:function(){return this._checkTemplateOrThemeInlineError({nameInputJsSelector:".js-template-name",publisherInputJsSelector:".js-template-publisher",exportButtonJsSelector:".js-export-template-bpo",nameList:this._exportedTemplateNames.concat(this._exportedThemeNames)})}.bind(this),exportSuccessCallback:"_handleTemplateExported"})},_onExportTheme:function(e){this._onExportTemplateOrTheme(e,{type:Cp,nameInputJsSelector:".js-theme-name",publisherInputJsSelector:".js-theme-publisher",category:"",validateInput:function(){return this._checkTemplateOrThemeInlineError({nameInputJsSelector:".js-theme-name",publisherInputJsSelector:".js-theme-publisher",exportButtonJsSelector:".js-export-theme",nameList:this._exportedThemeNames.concat(this._exportedTemplateNames)})}.bind(this),exportSuccessCallback:"_handleThemeExported"})},_onExportTemplateOrTheme:function(e,t){var n;T(e.target).hasClass("cb-DevSection-exportError")||t.validateInput()||(e=_.map(this.$(".js-placeholder .js-img"),function(e){return T(e).attr("src")}),n=_.map(this.$(".js-highlight"),function(e){return{type:"Highlight",title:T(e).find(".js-highlight-title").val(),description:T(e).find(".js-highlight-content").val()}}),A.showDialog(new up({info:{masterLabel:this.$(t.nameInputJsSelector).val().trim(),publisher:this.$(t.publisherInputJsSelector).val().trim(),description:this.$(".js-summary").val(),category:t.category,bundleInfo:n},imgUrls:e,exportSuccessCallback:this[t.exportSuccessCallback].bind(this),type:t.type})))},_onConvertPageToFlexipage:function(e){var t=this.$(".js-select-pages").select2("val");A.showDialog(new gp({selectedViewId:t}))},_selectTab:function(e){var t,n=this.$('.js-sd-tab-item[data-id="'+e+'"]'),i=this.$('.js-sd-tab-item[data-id="'+this._selectedTabId+'"]'),s=this.$(".js-sd-tab-content");0<s.length&&s.fadeOut(25,function(){i.removeClass("slds-is-active"),s.remove()}.bind(this)),e===_p?t=this.renderExportTemplateToBPOArea():e===Sp?t=this.renderConvertFlexipageArea():e===Cp&&(t=this.renderExportThemeArea()),this.$(".js-settings-developer-section").html(t),n.addClass("slds-is-active"),e===Sp?this.buildPageDropDown():e===_p&&this.$(".js-select-category").select2({minimumResultsForSearch:-1}),this._selectedTabId=e},_handlePagesChanged:function(){this.buildPageDropDown()},_handleTemplateExported:function(e){this._exportedTemplateNames.push(e.name)},_handleThemeExported:function(e){this._exportedThemeNames.push(e.name)},_handleGetAllExportedTemplateNames:function(){PicassoWebServices.CommUtil.GetAllExportedTemplateNames(function(e){this._exportedTemplateNames=e,this._isTemplateNamesLoaded=!0,this.$(".js-local-save-indicator").addClass("hidden"),this._pendingTemplateNameCheck&&this._onUpdateTemplateName()}.bind(this))},_handleGetAllExportedThemeNames:function(){PicassoWebServices.CommUtil.GetAllExportedThemeNames(function(e){this._exportedThemeNames=e,this._isThemeNamesLoaded=!0,this.$(".js-local-save-indicator").addClass("hidden"),this._pendingThemeNameCheck&&this._onUpdateThemeName()}.bind(this))},_checkEnableExport:function(){0===this.$(".cb-DevSection-exportInputError").length&&(this.$(".js-export-template-bpo").removeClass("cb-DevSection-exportError").text(s.DevAreaExportTemplateButton),this.$(".js-export-theme").removeClass("cb-DevSection-exportError").text(s.DevAreaExportTemplateButton))},_checkTemplateOrThemeInlineError:function(t){var n=!1,e=this.$(t.nameInputJsSelector).val().trim(),i=this.$(t.publisherInputJsSelector).val().trim();return this._isTemplateNamesLoaded?-1<t.nameList.indexOf(e)&&(this.$(".js-name-error").addClass("cb-DevSection-exportInputError"),this.$(t.nameInputJsSelector).addClass("cb-DevSection-exportInputError"),this.$(t.exportButtonJsSelector).addClass("cb-DevSection-exportError").text(s.DevAreaExportTemplateButtonError),n=!0):(this.$(".js-local-save-indicator").removeClass("hidden"),this._pendingTemplateNameCheck=!0),0===e.length&&(this.$(t.nameInputJsSelector).addClass("cb-DevSection-exportInputError"),this.$(t.exportButtonJsSelector).addClass("cb-DevSection-exportError").text(s.DevAreaExportTemplateButtonError),n=!0),0===i.length&&(this.$(t.publisherInputJsSelector).addClass("cb-DevSection-exportInputError"),this.$(t.exportButtonJsSelector).addClass("cb-DevSection-exportError").text(s.DevAreaExportTemplateButtonError),n=!0),0===this.$(".js-placeholder .js-img").length&&(this.$(".js-upload-image").eq(0).addClass("cb-DevSection-exportInputError"),this.$(".js-image-error").addClass("cb-DevSection-exportInputError"),this.$(t.exportButtonJsSelector).addClass("cb-DevSection-exportError").text(s.DevAreaExportTemplateButtonError),n=!0),0===this.$(".js-summary").val().length&&(this.$(".js-summary").addClass("cb-DevSection-exportInputError"),this.$(t.exportButtonJsSelector).addClass("cb-DevSection-exportError").text(s.DevAreaExportTemplateButtonError),n=!0),_.each(this.$(".js-highlight-title"),function(e){0===T(e).val().length&&(T(e).addClass("cb-DevSection-exportInputError"),this.$(t.exportButtonJsSelector).addClass("cb-DevSection-exportError").text(s.DevAreaExportTemplateButtonError),n=!0)}.bind(this)),_.each(this.$(".js-highlight-content"),function(e){0===T(e).val().length&&(T(e).addClass("cb-DevSection-exportInputError"),this.$(t.exportButtonJsSelector).addClass("cb-DevSection-exportError").text(s.DevAreaExportTemplateButtonError),n=!0)}.bind(this)),n},buildPageDropDown:function(){var a,o;$P.hasFlexipagePerm&&(a={},o=this.$("select.js-select-pages").empty(),h.getRoutes().each(function(e){var t=e.get("ViewType")||"";a[t]=e}),h.getViews().sortBy(function(e){return e.get("Name")}).forEach(function(e){var t,n,i,s=a[e.get("ViewType")];s&&(t=s.get("Name"),n=e.get("ViewType"),i=_.find(vp,function(e){return n.startsWith(e)}),_.includes(hp,t)||_.includes(mp,n)||i||(i=e.get("Name"),s=s.get("Name"),t!==i&&(s=s+" - "+i),o.append("<option value='"+e.get("ComponentID")+"'>"+s+"</option>")))}),o.select2())},render:function(){$P.userCanCreateFlexipage?this._isExportSupported?this._selectedTabId=_p:this._selectedTabId=Sp:this._selectedTabId=null;var e=[{perm:this._isExportSupported&&$P.userCanCreateFlexipage,tabId:_p,tabLabel:s.DevAreaExportTemplateTab},{perm:$P.hasCommBuilderThemingPerm&&$P.userCanCreateFlexipage,tabId:Cp,tabLabel:s.DevAreaExportThemeTab},{perm:$P.hasFlexipagePerm&&$P.userCanCreateFlexipage,tabId:Sp,tabLabel:s.DevAreaConvertToFlexiTabTitle}].filter(function(e){return e.perm}),e=0<e.length?this._devTabsTemplate({sections:e}):"",e=this._devContainerTemplate({description:$P.userCanCreateFlexipage?s.DeveloperSectionDesc:s.DeveloperSectionDescAlt,devTabs:e,devConsoleVisible:I.AccessControl(P.PERMISSIONS.OPEN_DEV_CONSOLE)});return this.$el.html(e),this._selectedTabId&&this._selectTab(this._selectedTabId),this.buildPageDropDown(),this.$('[data-toggle="tooltip"]').tooltip(),this}}),Tp=".".concat(D.SPINNER_CLASSNAME),Pp=PicassoWebServices.Labels.CommBuilderUpdateSettings,e=PicassoWebServices.Labels.PicassoDialog,Ip=Fe.View.extend({className:"cb-MigrationConfirmationDialog",template:_.template('<header class="slds-modal__header">\n            <h2 class="slds-text-heading_medium">{{=title}}</h2>\n        </header>\n        <div class="slds-p-around_x-large">\n            <p class="cb-MigrationDlg-description">{{= confirmMessage }}</p>\n        </div>\n        <footer class="slds-modal__footer js-migration-footer">\n            <button class="slds-button slds-button_neutral vex-last js-migration-cancel">'.concat(e.Cancel,'</button>\n            <button class="slds-button slds-button_brand js-migration-confirm">').concat(e.Upgrade,"</button>\n        </footer>\n        ").concat(D.spinner).trim()),events:{"click .js-migration-confirm":"_migrate","click .js-migration-cancel":"_closeDialog"},_migrate:function(){this.$(Tp).show(),PicassoWebServices.ManageSiteCommon.triggerSiteDotComToCMSMigration(function(e){this.$(Tp).hide(),this._closeDialog(),"SUCCESS"===e.status?this.successCallback&&this.successCallback(e):this.failCallback&&this.failCallback(e)}.bind(this))},_closeDialog:function(){A.closeDialog()},initialize:function(e){this.options=e||{},"function"==typeof e.successCallback&&(this.successCallback=e.successCallback),"function"==typeof e.failCallback&&(this.failCallback=e.failCallback)},render:function(){return this.$el.html(this.template({title:Pp.UpgradeConfirmationTitle,confirmMessage:Pp.UpgradeConfirmationMessage})),this.$(Tp).hide(),this}}),Ep=".".concat(D.SPINNER_CLASSNAME),wp=PicassoWebServices.Labels.CommBuilderUpdateSettings,t=PicassoWebServices.Labels.PicassoDialog,Lp=Fe.View.extend({className:"cb-RollbackConfirmationDialog",template:_.template('<header class="slds-modal__header">\n            <h2 class="slds-text-heading_medium">{{=title}}</h2>\n        </header>\n        <div class="slds-p-around_x-large">\n            <p class="cb-RollbackDlg-description">{{= confirmMessage }}</p>\n        </div>\n        <footer class="slds-modal__footer js-rollback-footer">\n            <button class="slds-button slds-button_neutral vex-last js-rollback-cancel">'.concat(t.Cancel,'</button>\n            <button class="slds-button slds-button_brand js-rollback-confirm">').concat(wp.RollbackButton,"</button>\n        </footer>\n        ").concat(D.spinner).trim()),events:{"click .js-rollback-confirm":"_rollback","click .js-rollback-cancel":"_closeDialog"},_rollback:function(){this.$(Ep).show(),PicassoWebServices.ManageSiteCommon.rollBackToSiteDotCom(function(e){this.$(Ep).hide(),this._closeDialog(),"SUCCESS"===e.status?this.successCallback&&this.successCallback(e):this.failCallback&&this.failCallback(e)}.bind(this))},_closeDialog:function(){A.closeDialog()},initialize:function(e){this.options=e||{},"function"==typeof e.successCallback&&(this.successCallback=e.successCallback),"function"==typeof e.failCallback&&(this.failCallback=e.failCallback)},render:function(){return this.$el.html(this.template({title:wp.RollbackConfirmationTitle,confirmMessage:wp.RollbackConfirmationMessage})),this.$(Ep).hide(),this}}),Dp=P.GLOBAL_SELECTOR.UPDATE_DLG,Ap=PicassoWebServices.Labels.CommBuilderUpdateSettings,mr=(PicassoWebServices.Labels.PicassoDialog,PicassoWebServices.Labels.CommBuilderPageManagement),kp=(E.getSite(),Backbone.View.extend({className:"cb-UpdateDialog",template:_.template('<h1 class="cb-Dialog-title">'+Ap.ConfirmUpdateTitle+'</h1><div class="js-update-content cb-Dialog-content">{{= confirmMessage  }}</div><div class="cb-Dialog-progress js-update-loader hidden"><div class="cb-Dialog-progressContent"><img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="cb-Dialog-progressContentIcon" /><span class="cb-Dialog-progressContentDesc">'+Ap.Updating+'</span></div></div><div class="cb-Dialog-buttons js-update-actions"><input type="button" class="cb-Dialog-button-primary cb-Dialog-button js-update-confirm" value="'+Ap.ConfirmUpdateButton+'"/><input type="button" class="cb-Dialog-button-secondary cb-Dialog-button js-update-cancel" value="'+PicassoWebServices.Labels.PicassoDialog.Cancel+'"/></div>'),events:{"click .js-update-confirm":"_update","click .js-update-cancel":"_close"},initialize:function(){},render:function(){return this.$el.html(this.template({confirmMessage:Ap.ConfirmUpdate})),this},_close:function(){A.closeDialog()},_update:function(){this.$(".js-update-content").addClass("hidden"),this.$(".js-update-actions").addClass("hidden"),this.$(".js-update-loader").removeClass("hidden"),PicassoWebServices.CommCore.DoUpgrade(function(e){localStorage.setItem(P.LS_KEY.Updated,"true"),window.location.reload()},function(e){var t=T("."+Dp).data().vex.id;A.closeDialogById(t)})}})),ot=Backbone.View.extend({className:"cb-Settings-section cb-Settings-updatesSection js-settings-updates-section",upgradeToolTipTemplate:function(e){return D.tooltipButtonIcon({tooltipPlacement:"right",tooltipLabel:e})},updatesSectionTemplate:_.template('<h2 class="cb-Settings-sectionHeading">'+Ap.UpdatesSectionTitle+'</h2><div class="cb-Settings-sectionDescription js-updates-label">{{= updatesSectionDesc }}</div>{{= updateActions }}{{= siteDotComToCMSMigration}}{{= cmsToSiteDotComRollback}}'),spinnerTemplate:_.template('<div class="spinner-container slds-spinner_container" id="js-updates-spinner"><div role="status" class="slds-spinner slds-spinner_brand slds-spinner_medium js-spinner"><span class="slds-assistive-text">'+mr.Loading+'</span><div class="slds-spinner__dot-a"></div><div class="slds-spinner__dot-b"></div></div></div>'),updateActionsTemplate:_.template('<div class="cb-SettingsUpdates-warningSection slds-media" role="status"><div class="slds-media__figure">{{= $P.viewTypes.CommonTemplates.icon({ svgClassName: "slds-icon_small", icon: "info" }) }}</div><div class="slds-media__body"><p>'+Ap.UpdateWarning+'</p></div></div><div class="cb-SettingsUpdates-optInSection slds-form-element"><div class="slds-form-element__control js-updates-checkbox-area"><label class="slds-checkbox"><input type="checkbox" class="js-updates-checkbox" value="off" /><span class="slds-checkbox_faux js-input-ga-data-opt-in-faux"></span><span class="slds-form-element__label cb-SettingsUpdates-optInLabel">'+Ap.UpdateOptInCheckbox+'</span></label></div></div><button class="slds-button slds-button_brand js-updates-upgrade-button" title="'+Ap.UpdateButtonTooltip+'" disabled="true">'+Ap.UpdateButton+"</button>"),siteDotComToCMSMigrationTemplate:_.template('<div id="js-update-migration-container">\n            <div class="cb-Settings-formGroupHeader">'.concat(Ap.UpgradeHeader,'</div>\n            <div class="cb-Settings-propertyGroup">').concat(Ap.UpgradeDescription,'</div>\n            <div class="cb-Settings-propertyGroup">').concat(Ap.PrepareSiteDotComToCMSMigration,'\n            <div class="cb-Settings-propertyInputInfoIcon">{{= siteDotComToCMSMigrationTooltip }}</div>\n            <br>\n            <div class="cb-Settings-propertyGroup">').concat(Ap.PrepareSlashSUrlUpdate.replace("{0}","{{= siteUpgradeUrl}}"),'\n            <div class="cb-Settings-propertyInputInfoIcon">{{= slashSUrlUpdateTooltip }}</div>\n            </div></div>\n            \n            <div class="cb-Settings-propertyGroup">').concat(Ap.UpgradeSuggestions,'\n            <div class="cb-Settings-propertyInputInfoIcon">{{= publishMessageTooltip }}</div>\n            </div>\n            <button class="slds-button slds-button_brand js-updates-migrate-button" title="" enabled="true">\n                    ').concat(Ap.UpgradeButton,"\n            </button>\n        </div>")),cmsToSiteDotComRollbackTemplate:_.template('<div id="js-update-rollback-container">\n            <div class="cb-Settings-formGroupHeader">'.concat(Ap.RollbackHeader,'</div>\n            <div class="cb-Settings-propertyGroup">').concat(Ap.RollbackDescription,'</div>\n            <button class="slds-button slds-button_brand js-updates-rollback-button" title="">\n                    ').concat(Ap.RollbackButton,"\n            </button>\n        </div>")),events:{"click .js-updates-upgrade-button":"_onUpgradeTemplateClick","click .js-updates-checkbox":"_onUpgradeCheckboxClick","change .js-updates-migrate-checkbox":"_onMigrateCheckboxClick","click .js-updates-migrate-button":"_onMigrateButtonClick","click .js-updates-rollback-button":"_onRollbackButtonClick"},initialize:function(){this.render(),this.listenTo(I.event,"state:upgradeflows-loaded",this.render)},render:function(){var e,t,n,i,s={updateActions:"",updatesSectionDesc:"",siteDotComToCMSMigration:"",cmsToSiteDotComRollback:""};return Qe.needsUpgrade()?(e=I.getAppState().getHomePageTemplate(),e=(e=$P.cbMetadata.templates[e.getDevName()])?e.displayName:"",s.updatesSectionDesc=L.format(Ap.UpdateDescription,_.escape(e)),s.updateActions=this.updateActionsTemplate()):I.AccessControl(P.PERMISSIONS.IS_EXPERIENCES_MIGRATION_IN_CMS_ENABLED)?(e=this.upgradeToolTipTemplate(Ap.SiteDotComToCMSMigrationTooltip),t=this.upgradeToolTipTemplate(Ap.SlashSUrlUpdateTooltip),n=this.upgradeToolTipTemplate(Ap.PublishMessageTooltip),i=E.getSite().get("siteUpgradeUrl"),s.siteDotComToCMSMigration=this.siteDotComToCMSMigrationTemplate({siteDotComToCMSMigrationTooltip:e,slashSUrlUpdateTooltip:t,publishMessageTooltip:n,siteUpgradeUrl:i})):E.getSite().get("isRollBackAvailableForCustomer")?s.cmsToSiteDotComRollback=this.cmsToSiteDotComRollbackTemplate():(e="",(t=I.getAppState().getHomePageTemplate().getDevName())&&(n=$P.cbMetadata.templates[t])&&(e=_.escape(n.displayName)),Qe.isAllUpgradeFlowsFetched()?(i=0<E.getSite().get("cmsToSiteDotComRollbackCounter")?Ap.AlreadyUpgradedAfterRevert:Ap.AlreadyUpgraded,s.updatesSectionDesc=L.format(i,e)):s.updatesSectionDesc=this.spinnerTemplate()),this.$el.html(this.updatesSectionTemplate(s)),this.$('[data-toggle="tooltip"]').tooltip(),this},_onUpgradeCheckboxClick:function(){var e=T(".js-updates-checkbox").is(":checked");this.$(".js-updates-upgrade-button").prop("disabled",!e)},_onUpgradeTemplateClick:function(){A.showDialog(new kp,{className:"picasso-vex-theme "+Dp,showCloseButton:!1,escapeButtonCloses:!1})},_onMigrateCheckboxClick:function(e){e=T(e.target).prop("checked");this.$el.find(".js-updates-migrate-button").prop("disabled",!e)},_onMigrateButtonClick:function(){var t=this;A.showDialog(new Ip({successCallback:function(e){t.$el.find(".js-updates-migrate-checkbox").prop("checked",!1).prop("disabled",!0),t.$el.find(".js-updates-migrate-button").prop("disabled",!0),w.success({message:e.messages[0],duration:w.DURATION_MEDIUM}),setTimeout(function(){window.location.reload()},w.DURATION_MEDIUM+1)},failCallback:function(e){w.error({message:e.messages[0],duration:w.DURATION_LONG})}}),{appendLocation:"#vexContainer",className:"slds-vex-theme slds-vex-theme--medium",contentClassName:"cb-Dialog cb-MigrationConfirmation-dialog-modal",showCloseButton:!1,overlayClosesOnClick:!1})},_onRollbackButtonClick:function(){var t=this;A.showDialog(new Lp({successCallback:function(e){t.$el.find(".js-updates-rollback-button").prop("disabled",!0),w.success({message:e.messages[0],duration:w.DURATION_MEDIUM}),setTimeout(function(){window.location.reload()},w.DURATION_MEDIUM+1)},failCallback:function(e){w.error({message:e.messages[0],duration:w.DURATION_LONG})}}),{appendLocation:"#vexContainer",className:"slds-vex-theme slds-vex-theme--medium",contentClassName:"cb-Dialog cb-RollbackConfirmation-dialog-modal",showCloseButton:!1,overlayClosesOnClick:!1})}}),i=PicassoWebServices.Labels.CommBuilderSettings,n=i.CustomDimensionsGoogleAnalytics,hr=i.CustomDimensionsGoogleAnalyticsSubHeading,e=i.CustomDimensionName,t=i.CustomDimensionIndex,mr=i.CustomDimensionNameInfo,Np=i.CustomDimensionIndexInfo,xp=i.CustomDimensionIndexOverridingWarningMessage,Rp=i.DuplicateDimensionErrorMessage,jp=i.InvalidDimensionErrorMessage,Bp=i.CustomDimensionsGoogleAnalyticsErrorMessage,Op=i.AdvancedSectionSaveButton,Mp=i.AdvancedSectionCancelButton,i=i.Dismiss,Vp=".js-custom-dimension-form-element",$p=".js-custom-dimension-input",Up=".js-custom-dimension-input-error",Wp=".js-custom-dimension-save-indicator",Fp=".js-custom-dimension-content-error",Hp="slds-has-error",Gp="GoogleAnalyticsCustomDimensions",zp=/^\d+$/,Kp=Backbone.View.extend({importDialogHtml:_.template('<div class="cb-SettingsAdvanced-GACustomDimensionsUpdate"><div class="cb-Dialog_header"><div class="cb-Dialog_title">'+n+'</div><div class="cb-Dialog_subtitle">'+hr+'</div></div><div class="slds-m-vertical_x-large slds-m-horizontal_xx-large slds-p-horizontal_xx-large" ><div class="slds-m-bottom_medium js-custom-dimension-content-warning">{{= warningRowHtml }} </div><div class="slds-m-bottom_medium js-custom-dimension-content-error"></div><form class="slds-form"><table class="slds-table slds-table_fixed-layout slds-table_bordered slds-no-row-hover slds-border_left slds-border_right"><thead><tr class="slds-line-height_reset"><th class="" scope="col"><span class="slds-truncate slds-m-left_medium"> '+e+"</span>"+D.tooltipButtonIcon({buttonClassName:"slds-m-left_xx-small",svgClassName:"slds-icon_xx-small",tooltipPlacement:"right",tooltipLabel:mr})+'</th><th class="" scope="col"><span class="slds-truncate slds-m-left_medium" >'+t+"</span>"+D.tooltipButtonIcon({buttonClassName:"slds-m-left_xx-small",svgClassName:"slds-icon_xx-small",tooltipPlacement:"right",tooltipLabel:Np})+'</th></tr></thead><tbody>{{= dimensionFormHtml }}</tbody></table></form></div><div class="vex-dialog-buttons"><img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="slds-m-vertical_x-small cb-SettingsAdvanced-GACustomDimensionsUpdate-save-indicator js-custom-dimension-save-indicator vex-last"/><button class="slds-button slds-button_brand vex-dialog-button vex-first test-save-button js-custom-dimension-save" disabled>'+Op+'</button><button class="slds-button slds-button_neutral vex-dialog-button vex-last test-cancel js-custom-dimension-cancel">'+Mp+"</button></div></div>"),dimensionRowHtml:_.template('<tr class="slds-hint-parent slds-form-element js-custom-dimension-form-element"><td><div class="slds-truncate slds-m-around_medium" title="{{= dimensionName }}"> {{= dimensionName }}</div></td><td><div class="slds-form-element__control slds-m-around_medium" title="{{= dimensionName }}"><input class="slds-input js-custom-dimension-input" id="{{= dimensionId }}" type="number" name="{{= dimensionName }}" value="{{= dimensionValue }}" aria-describedby="{{= dimensionId }}js-custom-dimension-input-error"/></div><div class="slds-form-element__help js-custom-dimension-input-error slds-m-left_medium" id="{{= dimensionId }}js-custom-dimension-input-error"></div></td></tr>'),warningHtml:_.template('<div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_warning" role="status"><span class="slds-assistive-text">warning</span><span class="slds-icon_container slds-icon-utility-warning slds-m-right_x-small" title="'+xp+'"><svg class="slds-icon slds-icon_x-small" aria-hidden="true"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#warning"></use></svg></span><h2>'+xp+'</h2><div class="slds-notify__close"><button class="slds-button slds-button_icon slds-button_icon-small js-custom-dimension-warning-close" title="Close"><svg class="slds-button__icon" aria-hidden="true"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/action-sprite/svg/symbols.svg#close"></use></svg><span class="slds-assistive-text">'+i+"</span></button></div></div>"),errorHtml:_.template('<div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error" role="status"><span class="slds-assistive-text">error</span><span class="slds-icon_container slds-icon-utility-error slds-m-right_x-small" title="{{= errorMessage }}"><svg class="slds-icon slds-icon_x-small" aria-hidden="true"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#error"></use></svg></span><h2 class="errorMessage">{{= errorMessage }}</h2><div class="slds-notify__close"><button class="slds-button slds-button_icon slds-button_icon-small slds-button_icon-inverse js-custom-dimension-error-close" title="Close"><svg class="slds-button__icon" aria-hidden="true"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/action-sprite/svg/symbols.svg#close"></use></svg><span class="slds-assistive-text">'+i+"</span></button></div></div>"),events:{"click .js-custom-dimension-warning-close":"_closeWarning","click .js-custom-dimension-error-close":"_closeError","click .js-custom-dimension-cancel":"_closeDialog","click .js-custom-dimension-save":"_saveDialog","change .js-custom-dimension-input":"_valueChange"},initialize:function(){this.render()},render:function(){var e=E.getSite().get(Gp);return this.$el.html(this.importDialogHtml({dimensionFormHtml:this.templateCustomDimensionRow(e),warningRowHtml:this.warningHtml()})),this.$('[data-toggle="tooltip"]').tooltip(),this},templateCustomDimensionRow:function(e){var t=this,n="";return e.forEach(function(e){e=t.dimensionRowHtml({dimensionId:e.id,dimensionName:e.name,dimensionValue:e.value});n+=e}),n},_closeDialog:function(){A.closeDialog()},_setErrorMessage:function(e){e=this.errorHtml({errorMessage:e});this.$(Fp).html(e)},_validateInput:function(){var n=this,i=!0,s=[];return this.$(Vp).each(function(){var e,t=n.$(this).find($p),t=n.$(t).val();t&&(-1!==s.indexOf(t)?(n.$(this).addClass(Hp),e=n.$(this).find(Up),n.$(e).text(Rp),i=!1):!t.match(zp)||t<=0||20<t?(n.$(this).addClass(Hp),e=n.$(this).find(Up),n.$(e).text(jp),i=!1):s.push(t))}),i||n._setErrorMessage(Bp),i},_saveDialog:function(){var t,n,i=this,e=(this.$(Wp).show(),this._validateInput());return e?(t="",n=[],this.$(Vp).each(function(){""!==t&&(t+=",");var e=T(this).find($p),e=(T(e).val()&&(t=t+T(e).attr("id")+"="+T(e).val()),{id:T(e).attr("id"),name:T(e).attr("name"),value:T(e).val()});n.push(e)}),t="{"+t+"}",this._updateSiteProperty(Gp,t,function(e){i.$(Wp).hide();e=e.UserResponseError;""!==e&&void 0!==e?i._setErrorMessage(e):(E.getSite().set(Gp,n),A.closeDialog())})):T(Wp).hide(),e},_valueChange:function(){this.$(".js-custom-dimension-save").prop("disabled",!1),this.$(Fp).html(""),this.$(Up).html(""),this.$(Vp).removeClass(Hp)},_closeWarning:function(){this.$(".js-custom-dimension-content-warning").html("")},_closeError:function(){this.$(Fp).html("")},_updateSiteProperty:function(e,t,n){PicassoWebServices.ManageSiteCommon.UpdateProperty(E.getSite().id,e,t,n)}}),Yp=PicassoWebServices.Labels.CommBuilderSettings,qp=PicassoWebServices.Labels.CommBuilderTextEditorHeader;function Xp(e){e={editorMode:"text/html",contentKey:"HeadInlineScript",shouldValidateOnType:!0,shouldValidateOnSave:!0,customLintRules:{"secure-head-markup-rule":!0},updateCss:!1,reloadIFrame:!0,EditorTitle:qp.EditorTitle,EditorTips:qp.EditorTips,CloseWarning:qp.CloseWarning,ValidationWarning:qp.ValidationWarning,CloseWarningTitle:qp.CloseWarningTitle,ValidationWarningTitle:qp.ValidationWarningTitle,textEditorDialogClassName:"cb-TextEditor-dialog",errorMessage:Yp.AdvancedSectionHeadMarkupEditorError,pageId:E.getSite().get("homepage"),successCallback:e};So(e,{showCloseButton:!1,contentClassName:e.textEditorDialogClassName,className:"cb-TextEditor-vex-theme",escapeButtonCloses:!1})}function Jp(e){var t=e.className,e=e.content;return'\n    <li name="{{= integrationType}}" class="slds-dropdown__item '.concat(t,'" role="presentation">\n        <a href="#" role="menuitem" tabindex="-1">\n            <span class="slds-truncate" title={{= ').concat(e," }}>{{= ").concat(e," }}</span>\n        </a>\n    </li>")}function Qp(e){var t=e.theme,n=e.svgClassName,e=e.icon;return'\n    <div class="'.concat(t,' slds-badge">\n        ').concat(D.icon({svgClassName:n,icon:e}),"\n        {{= integrationStatusLabel }}\n    </div>")}function Zp(e){return e=e.buttonAttributes,"\n    ".concat(D.buttonWithIcon({buttonClassName:"js-add-to-site",buttonVariantClassName:"slds-button_neutral",label:"".concat(cg.moduleAddLink),icon:"add",buttonAttributes:e}),"\n    ")}function eg(e){return e=e.buttonAttributes,'\n    <div class="slds-dropdown-trigger slds-dropdown-trigger_click js-dropdown-trigger slds-is-open">\n        '.concat(D.tooltipButtonIconWithDropdown({iconSvgClassName:"slds-hide",buttonClassName:"slds-button_icon-border-filled slds-dropdown-trigger slds-dropdown-trigger_click",buttonAttributes:e,dropdownIconSvgClassName:"slds-button__icon",label:lg.ShowMore,tooltipLabel:""}),'\n        <div class="slds-dropdown slds-dropdown_right">\n            <ul class="slds-dropdown__list" role="menu" aria-label=').concat(lg.ShowMore,">\n                ").concat(Jp({className:"js-dropdown-edit",content:"editLink"}),"\n                ").concat(Jp({className:"js-dropdown-remove",content:"removeLink"}),"\n            </ul>\n        </div>\n    </div>\n    ")}var tg=PicassoWebServices.Labels.CommBuilderSettings,n=PicassoWebServices.Labels.CommBuilderSecurityCSPSettings,ng="googleAnalyticsTrackingId",ig="googleAnalyticsDataOptInEnabled",sg="googleAnalyticsAnonymizeIpEnabled",ag="js-setup-custom-dimensions-button",hr=Backbone.View.extend({className:"cb-Settings-section cb-Settings-advancedSection js-settings-advanced-section",template:_.template('<h2 class="cb-Settings-sectionHeading">{{= sectionHeading }}</h2><div class="cb-Settings-sectionDescription">'+tg.AdvancedSectionDesc+'</div>{{ if (showGoogleAnalytics) { }}<div class="cb-Settings-formGroupHeader test-google-analytics-header">'+tg.GoogleAnalyticsSubHeading+'</div>{{= googleAnalyticsAccountHtml }}{{ } }}<div class="cb-Settings-formGroupHeader">{{= editHeadTitle }}</div>{{= templateSpecificTemplate }}<div class="cb-Settings-formGroupHeader">'+tg.AdvancedPaletteTitle+'</div>{{= componentSettingTemplate }}{{ if (showProgressiveRendering) { }}<div class="cb-Settings-formGroupHeader test-progressive-rendering-header">'+tg.PerformanceSubHeading+"</div>{{= progressiveRenderingTemplate }}{{= performanceSettingHtml }}{{ } }}"),headMarkupTemplate:_.template('<div class="cb-Settings-propertyGroup">{{= headMarkupWarning }}<div class="js-settings-community-template-name">{{= editHeadDescription }}</div><button class="cb-Button cb-Button--settingsProperty js-edit-custom-header-button">{{= editHeadButton }}</button></div>'),headMarkupWarningTemplate:_.template('<div class="cb-SettingsAdvanced-headMarkupWarning"><div class="cb-SettingsAdvanced-headMarkupWarningIcon"><svg aria-hidden="true" class="slds-icon slds-icon-text-default slds-icon--medium"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#warning"></use></svg></div><div class="cb-SettingsAdvanced-headMarkupWarningText js-head-markup-warning"><div class="cb-SettingsAdvanced-headMarkupWarningTextTitle">{{= warningTitle}}</div>{{= warningMessage}}</div></div>'),checkboxTemplate:function(e){var t=e.formClass,n=e.inputClass,i=e.isChecked,s=e.isDisabled,a=e.labelClass,o=e.label,e=e.desc;return'\n            <div class="slds-form-element '.concat(t,'">\n                <div class="slds-form-element__control">\n                    <label class="slds-checkbox">\n                        <input type="checkbox" class="').concat(n,'" ').concat(i," ").concat(s,' />\n                        <span class="slds-checkbox_faux ').concat(n,'-faux"></span>\n                        <span class="slds-form-element__label ').concat(a,'">').concat(o,"</span>\n                        ").concat(D.tooltipButtonIcon({tooltipPlacement:"right",tooltipLabel:"".concat(e)}),"\n                    </label>\n                </div>\n            </div>").trim()},googleAnalyticsTemplate:_.template('<div class="form-group cb-Settings-propertyGroup slds-m-top_medium"><div class="cb-SettingsAdvanced-googleAnalyticsTrackingIdLabel js-settings-community-template-{{= name}}">{{= description }}</div>{{ if (isDisabled) { }}'+D.tooltipButtonIcon({buttonClassName:"cb-SettingsAdvanced-inputInfoIcon",tooltipPlacement:"right",tooltipLabel:"".concat(n.GoogleAnalyticsDisabledUntilUnlocked.replace("{0}",n.ScriptLevelTitle))})+'{{ } }}<input type="text" class="form-control cb-Settings-propertyInput cb-SettingsAdvanced-googleAnalyticsTrackingIdInput js-template-ga-property-input slds-input" {{= isDisabled ? "disabled" : ""}} id="js-template-property-input-{{= name}}" data-name="{{= name}}" data-type="{{= type}}" placeholder="{{= placeholder }}" value="{{- value }}" data-native="{{= typeof(NativeProperty) != "undefined" ? 1 : 0 }}"><img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="cb-Settings-saveIndicator js-local-save-indicator hidden" />{{= googleAnalyticsDataOptInHtml }}{{= googleAnalyticsAnonymizeIpHtml }}{{= googleAnalyticsSetupCustomDimensionHtml }}</div>'),progressiveRenderingTemplate:_.template('<div class="slds-card cb-SettingsAdvanced-{{= cssClass }}Card"><header class="cb-SettingsAdvanced-{{= cssClass }}Header"><span class="slds-icon_container"><svg class="slds-icon slds-icon-text-default" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/{{= icon.sprite }}-sprite/svg/symbols.svg#{{= icon.name }}"></use></svg></span><span class="slds-text-heading_small cb-SettingsAdvanced-{{= cssClass }}Heading">{{= label }}</span></header><div class="cb-SettingsAdvanced-{{= cssClass }}CardBody"><div class="slds-text-body_regular cb-SettingsAdvanced-{{= cssClass }}Description">{{= description }}</div><div class="cb-SettingsAdvanced-{{= cssClass }}Toggle"><div class="slds-form-element"><label class="slds-checkbox_toggle slds-grid"><input type="checkbox" name="checkbox" aria-describedby="toggle-desc" value="on" class="{{= jsHookClass }}" {{= isChecked}} /><span id="toggle-desc" class="slds-checkbox_faux_container" aria-live="assertive"><span class="slds-checkbox_faux {{= jsHookClass }}-faux"></span><span class="slds-checkbox_on cb-SettingsAdvanced-{{= cssClass }}ToggleText">{{= toggle.onText }}</span><span class="slds-checkbox_off cb-SettingsAdvanced-{{= cssClass }}ToggleText">{{= toggle.offText }}</span></span></label></div></div></div></div>'),performanceSettingHtml:'<div class="form-group cb-Settings-propertyGroup slds-m-top_medium">'+tg.PerformanceCDNDesc+'</div><div class="form-group cb-Settings-propertyGroup slds-m-top_medium">'+tg.PerformanceDesc+"</div>",events:{"click .js-edit-custom-header-button":"_handleHeadMarkupEditorButtonClick","click .js-setup-custom-dimensions-button":"_launchSetupCustomDimensionDialog","change .js-template-ga-property-input":"_handleGaPropertyChange","change .js-input-ga-data-opt-in":"_handleGoogleAnalyticsDataOptInChange","change .js-input-ga-anonymize-ip":"_handleGoogleAnalyticsAnonymizeIpChange","change .js-show-filtered-cmps":"_handleShowFilterChange","change .js-enable-progressive-rendering":"_handleEnableProgressiveRendering"},initialize:function(){this.listenTo(E.getSite(),"change:"+ng,this._handleGoogleAnalyticsTrackingIdChange),this.listenTo(I.event,"state:csp-security-level-updated",this.render),this.render()},render:function(){var e="",t="",n="",i=E.getSite().get(ng),s=I.AccessControl(P.PERMISSIONS.IS_WEB_ISOLATION)||v.getCurrentScriptSecurityLevel()===v.getScriptSecurityLevels().LOCKED||!I.AccessControl(P.PERMISSIONS.GOOGLE_ANALYTICS_TRUSTED_SITES_ACCESS),t=(E.getSite().get("isHeadMarkupVerified")||(t=this.headMarkupWarningTemplate({warningTitle:tg.AdvancedSectionHeadMarkupAlertTitle,warningMessage:tg.AdvancedSectionHeadMarkupAlertBody})),I.getAppState().supportViewCrud()&&(e+=this.headMarkupTemplate({editHeadDescription:tg.AdvancedSectionHeaderDescription,editHeadButton:tg.AdvancedSectionEditHeader,headMarkupWarning:t})),this.checkboxTemplate({formClass:"cb-Settings-propertyGroup",inputClass:"js-show-filtered-cmps",isChecked:E.getSite().get("showFilteredComponents")?"checked":"",isDisabled:"",labelClass:"cb-SettingsAdvanced-settingLabel",label:tg.PaletteShowComponentLabel,desc:tg.PaletteShowComponentDesc})),a=this.checkboxTemplate({formClass:"cb-SettingsAdvanced-googleAnalyticsDataOptInCheckbox",inputClass:"js-input-ga-data-opt-in",isChecked:E.getSite().get(ig)?"checked":"",isDisabled:s?"disabled":"",labelClass:"cb-SettingsAdvanced-googleAnalyticsDataOptInLabel",label:tg.GoogleAnalyticsDataOptInFieldLabel,desc:tg.GoogleAnalyticsDataOptInFieldTooltipDesc}),o=this.checkboxTemplate({formClass:"cb-SettingsAdvanced-googleAnalyticsAnonymizeIpCheckbox",inputClass:"js-input-ga-anonymize-ip",isChecked:E.getSite().get(sg)?"checked":"",isDisabled:s?"disabled":"",labelClass:"cb-SettingsAdvanced-googleAnalyticsAnonymizeIpLabel",label:tg.GoogleAnalyticsAnonymizeIpLabel,desc:tg.GoogleAnalyticsAnonymizeIpTooltipDesc}),r=D.button({buttonVariantClassName:"slds-button_neutral",buttonAttributes:E.getSite().get(ig)?"":"disabled",label:tg.SetupCustomDimensions,buttonClassName:"cb-SettingsAdvanced-setupCustomDimensionsButton ".concat(ag)}),s=this.googleAnalyticsTemplate({name:P.PROP.GA_TRACKING_ID,description:tg.GoogleAnalyticsDescription,value:i,placeholder:tg.GoogleAnalyticsPlaceholder,type:"local",isDisabled:s,googleAnalyticsDataOptInHtml:a,googleAnalyticsAnonymizeIpHtml:o,googleAnalyticsSetupCustomDimensionHtml:r});return I.getAppState().supportsNewFeatures()&&(n+=this.progressiveRenderingTemplate({icon:{sprite:"standard",name:"dashboard"},label:tg.ProgressiveRenderingLabel,description:tg.ProgressiveRenderingDesc,toggle:{onText:tg.ProgressiveRenderingEnabled,offText:tg.ProgressiveRenderingDisabled},cssClass:"progressiveRendering",jsHookClass:"js-enable-progressive-rendering",isChecked:E.getSite().isProgressiveRenderingEnabled()?"checked":""})),this.$el.html(this.template({sectionHeading:tg.AdvancedSectionTitle,templateSpecificTemplate:e,editHeadTitle:tg.AdvancedSectionHeaderTitle,editCssTitle:tg.AdvancedSectionCssEditorTitle,componentSettingTemplate:t,googleAnalyticsAccountHtml:s,progressiveRenderingTemplate:n,performanceSettingHtml:this.performanceSettingHtml,showGoogleAnalytics:I.AccessControl(P.PERMISSIONS.GOOGLE_ANALYTICS),showProgressiveRendering:I.AccessControl(P.PERMISSIONS.PROGRESSIVE_RENDERING)})),this.$('[data-toggle="tooltip"]').tooltip(),E.getSite().trigger("change:"+ng,E.getSite(),i),this},_launchSetupCustomDimensionDialog:function(){var e={showCloseButton:!0,className:"slds-vex-theme",afterCloseFocusEl:document.activeElement,a11y:!0,overlayClosesOnClick:!0};A.showDialog(new Kp,e)},_handleHeadMarkupEditorButtonClick:function(){var t=this;Xp(function(e){E.getSite().set("isHeadMarkupVerified",e.isValid),t.render()})},_handleGaPropertyChange:function(e){var t,n,i;e.keyCode!==P.KEYCODE.ENTER&&"blur"!==e.type&&"change"!==e.type||(t=this,e=T(e.currentTarget),n=e.data("name"),i=T.trim(e.val()),Va.addMissingGoogleDomains(i,function(){t._saveLocalPropertyValues(n,i)}))},_handleGoogleAnalyticsDataOptInChange:function(e){e=T(e.currentTarget).is(":checked");this._updateGoogleAnalyticsDataOptInProperty(e)},_updateGoogleAnalyticsDataOptInProperty:function(t){var n=this;this._updateSiteProperty(P.PROP.GA_DATA_OPT_IN_ENABLED_KEY,t,function(e){E.getSite().set(ig,t),n.$(".js-setup-custom-dimensions-button").prop("disabled",!t)})},_handleGoogleAnalyticsAnonymizeIpChange:function(e){e=T(e.currentTarget).is(":checked");this._updateGoogleAnalyticsAnonymizeIpProperty(e)},_updateGoogleAnalyticsAnonymizeIpProperty:function(t){this._updateSiteProperty(P.PROP.GA_ANONYMIZE_IP_ENABLED_KEY,t,function(e){E.getSite().set(sg,t)})},_handleShowFilterChange:function(e){e=T(e.currentTarget).is(":checked");this._updateShowFilterProperty(e)},_handleEnableProgressiveRendering:function(e){var t=T(e.currentTarget);t.is(":checked")?(t.prop("checked",!1),A.sldsConfirm(tg.ProgressiveRenderingConfirmContent,tg.ProgressiveRenderingConfirmHeading,function(e){e&&(t.prop("checked",!0),this._enableProgressiveRendering(e))}.bind(this),{className:"slds-vex-theme slds-vex-theme--medium",yesText:tg.ProgressiveRenderingConfirmButton})):this._enableProgressiveRendering(!1)},_enableProgressiveRendering:function(t){this._updateSiteProperty("IsProgressiveRenderingEnabled",t,function(e){E.getSite().setProgressiveRenderingEnabled(t),I.event.trigger("action:refresh-current-page")})},_updateShowFilterProperty:function(t){this._updateSiteProperty("ShowFilteredComponents",t,function(e){E.getSite().set("showFilteredComponents",t),j.getAppEvent().trigger("page:reload-component-palette")})},_handleGoogleAnalyticsTrackingIdChange:function(e,t,n){this._updateGoogleAnalyticsPropertyValueAndCheckboxState(t)},_updateGoogleAnalyticsPropertyValueAndCheckboxState:function(e){var t=this.$(".js-input-ga-data-opt-in"),n=this.$(".js-input-ga-anonymize-ip"),i=this.$(".js-template-ga-property-input").prop("disabled");T.trim(e)&&!i?(t.prop("disabled",!1),n.prop("disabled",!1)):(t.prop("disabled",!0),n.prop("disabled",!0),i||(t.prop("checked",!1),n.prop("checked",!1),this._updateGoogleAnalyticsDataOptInProperty(!1),this._updateGoogleAnalyticsAnonymizeIpProperty(!1)))},_saveLocalPropertyValues:function(t,n){var i=!1,s=!1,a=this.$(".js-local-save-indicator");a.removeClass("hidden"),setTimeout(function(){i&&a.addClass("hidden"),s=!0},1e3),this._updateSiteProperty(t,n,function(e){i=!0,s&&a.addClass("hidden"),t===P.PROP.GA_TRACKING_ID&&E.getSite().set(ng,n)})},_updateSiteProperty:function(e,t,n){PicassoWebServices.ManageSiteCommon.UpdateProperty(E.getSite().id,e,t,n)}}),og=PicassoWebServices.Labels.Integrations,rg=Backbone.View.extend({_renderHTML:b.template('\n        <div class="slds-modal__header cb-GADialog-header">\n            <h2 class="slds-text-heading_medium cb-GADialog-heading test-heading">{{=modalHeader}}</h2>\n        </div>\n        <div class="ga-config-container slds-p-around_large"></div>\n        <div class="slds-modal__footer">\n            <div class=" slds-button js-cancel "></div>   \n            <div class="slds-button js-action "></div>\n        </div>'.trim()),events:{"click .js-cancel":"dismissDialog","click .js-upgrade-integration":"_upgradeIntegration"},initialize:function(e){this.data={},Object.assign(this.data,e),this.listenTo(I.event,"state:analytics-configuration-input-value",this._setActionButtonDisabledState)},_setActionButtonDisabledState:function(e){var t=this;$P.auraRun(function(){t.actionButton.set("v.disabled",!e.isUpdated),$A.render(t.actionButton,t._resetContainer(".js-action")),$A.afterRender(t.actionButton)})},render:function(){return this.$el.html(this._renderHTML({modalHeader:this.data.modalHeader})),this.renderGADialog(),this},dismissDialog:function(){A.closeDialog()},_upgradeIntegration:function(e){A.closeDialog(),this.upgradeIntegrationCallback(e)},actionButton:null,_resetContainer:function(e){e=this.$(e)[0];return e.innerHTML="",e},renderGADialog:function(e){var a=this;a.upgradeIntegrationCallback=a.data.upgradeIntegrationCallback,$P.auraRun(function(){$A.createComponents([["markup://ui:button",{label:a.data.secondaryActionLabel,class:" slds-button_neutral ",buttonTitle:a.data.secondaryActionLabel}],["markup://ui:button",{label:a.data.actionLabel,class:" slds-button_brand",buttonTitle:a.data.actionLabel}],["markup://communitySetup:integrationsConfiguration",{integrationType:a.data.integrationType,actionState:a.data.actionState,managedContentId:a.data.labelMap.managedContentId||null,variantId:a.data.labelMap.variantId||null,installCallback:a.data.installCallback,saveSuccessCallback:a.data.successCallback,isEnabled:a.data.labelMap.isEnabled,hasUpgradeScopedNotification:a.data.hasUpgradeScopedNotification,labels:{description:a.data.modalDescription,toggleText:a.data.labelMap.toggleText,inputLabel:a.data.labelMap.measurementIdLabel,helpLink:a.data.labelMap.helpLink,helpText:a.data.labelMap.helpText,infoTitle:a.data.labelMap.infoTitle,infoText:a.data.labelMap.infoText,detailsHeading:a.data.labelMap.detailsHeading,detailsVersion:a.data.labelMap.detailsVersion,detailsView:a.data.labelMap.detailsView,detailsAutoUpgrades:a.data.labelMap.detailsAutoUpgrades,upgradeNotificationLabel:a.data.labelMap.upgradeNotificationLabel,upgradeNotificationActionLabel:a.data.labelMap.upgradeNotificationActionLabel,removalMsg:a.data.removalMsg,placeholder:a.data.labelMap.placeholder,pattern:a.data.labelMap.pattern,messageWhenPatternMismatch:a.data.labelMap.measurementIdError},inputs:a.data.labelMap.inputs}]],function(e,t,n){var i,s;"SUCCESS"===t?(i=e[0],a.actionButton=e[1],s=e[2],a.actionButton.addHandler("press",s,"c.action"),a.actionButton.set("v.disabled","remove"!==a.data.actionState),s&&setTimeout(function(){$A.render(s,a._resetContainer(".ga-config-container")),$A.afterRender(s),$A.render(i,a._resetContainer(".js-cancel")),$A.afterRender(i),$A.render(a.actionButton,a._resetContainer(".js-action")),$A.afterRender(a.actionButton)},0)):(t={message:og.errorToastMessage,canDismiss:!0,duration:5e3},w.error(t))})})}}),lg=PicassoWebServices.Labels.CommunityBuilder,cg=PicassoWebServices.Labels.Integrations,e="Unavailable",dg="Setup_In_Progress",ug="Upgrade_In_Progress",pg="Enabled",mr="Disabled",gg="Error",hg=new Set(["Available",e,dg]),mg=new Set([e,dg,ug]),vg=new Set([pg,mr]),t=Backbone.View.extend({_hasLoadedData:!1,_integrations:[],_actionState:P.INTEGRATION_ACTION.ADD,className:"cb-Settings-section cb-Settings-appsSection js-settings-apps-section",template:_.template('\n        {{ if (hasLoadedData) {}}\n            <h2 class="cb-Settings-sectionHeading test-cb-Settings-sectionHeading">{{= appsLabel}}</h2>\n            <div class="cb-Settings-sectionDescription test-cb-Settings-sectionDescription">\n                {{= appsSectionLabel}}\n            </div>\n            <div>\n                <ul class="slds-grid slds-gutters cb-integrations-section">\n                    {{ _.forEach(templates, function(_template, index) { }}\n                        <li class="slds-col slds-size_1-of-2 cb-integration">\n                            {{= _template }}\n                        </li>\n                    {{ }) }}\n                </ul>\n            </div>\n        {{ } else {}}\n            <div class="cb-Settings-integrationSection-spinner slds-is-relative slds-p-top_large">\n                {{= $P.viewTypes.CommonTemplates.spinner }}\n            </div>\n        {{}}}\n        '.trim()),integrationTemplate:_.template('<div class="slds-card">\n            <div class="slds-card__header slds-grid">\n                <header class="slds-media slds-media_center slds-has-flexi-truncate">\n                    <img src="{{= logoURL}}" class="cb-integrations-logo" title="{{= moduleName}} Logo"></img>\n                    <div class="slds-media__body slds-grid slds-gutter slds-grid_vertical-align-end">\n                        <div>\n                            <h3 class="slds-text-heading_small">\n                                <span class="test-settings-apps-module-header slds-text-title_bold">{{= moduleName}}</span>\n                            </h3>\n        \n                            {{ if (isExternal) {}}\n                                <div class=cb-integrations-propertyLabel slds-text-color_weak">{{= externalLabel}}</div>\n                            {{ } else {}}\n                                <div class=cb-integrations-propertyLabel slds-text-color_weak">{{= internalLabel}}</div>\n                            {{}}}\n        \n                        </div>\n                    </div>\n                    <div class="slds-shrink-none slds-col_bump-left">\n        \n                        {{ if (isAddToSiteShown) {}}\n                            {{ if (isUserActionDisabled) {}}\n                                '.concat(Zp({buttonAttributes:"disabled"}),"\n                            {{ } else {}}\n                                ").concat(Zp({buttonAttributes:"name={{= integrationType}}"}),"\n                            {{}}}    \n                        {{ } else {}}\n                            {{ if (isUserActionDisabled) {}}\n                                ").concat(eg({buttonAttributes:"disabled"}),"\n                            {{ } else {}}\n                                ").concat(eg({}),'\n                            {{}}}    \n                        {{}}}       \n                    </div>\n                </header>\n            </div>\n            <div class="cb-integrations-body">\n                <div class="slds-card__body slds-card__body_inner">\n                    {{ if (isEnabled) {}}\n                        ').concat(Qp({theme:"slds-theme_success",svgClassName:"slds-button__icon slds-icon_xx-small cb-integrations-status-badge",icon:"check"}),"\n                    {{ } else {}}\n                        {{ if (isSetupInProgress || isUpgradeInProgress) {}}\n                            ").concat(Qp({theme:"slds-theme",svgClassName:"slds-button__icon slds-icon-text-default slds-icon_xx-small cb-integrations-status-badge",icon:"sync"}),"\n                        {{ } else {}}\n                            ").concat(Qp({theme:"slds-theme",svgClassName:"slds-hide"}),'\n                        {{}}}\n                    {{}}}\n                </div>\n                <div class="slds-card__body slds-card__body_inner test-settings-apps-module-description">{{= moduleDescription}}</div>\n                <a class="slds-card__body slds-card__body_inner" href="{{= helpLink}}" target="_blank">{{= helpText}}</a>\n            </div>\n                {{ if (hasUpgradeScopedNotification) {}}\n                    <div class="slds-scoped-notification slds-media slds-media_center slds-scoped-notification_light cb-integrations-notification" role="status">\n                        <div class="slds-media__figure">\n                            ').concat(D.icon({svgClassName:"slds-icon slds-icon_small slds-icon-text-default",icon:"info"}),'\n                        </div>\n                        <div class="slds-media__body">\n                            <p>{{= upgradeNotificationLabel}}</p>\n                        </div>\n                        <div class="slds-media__figure slds-media__figure_reverse">\n                            <a name={{= integrationType}} href="#" class="slds-text-link js-upgrade-integration">{{= upgradeNotificationActionLabel}}</a>\n                        </div>\n                    </div>\n                {{}}}\n            </div>')),events:{"click .js-dropdown-trigger":"_openDropdownMenu","blur .js-dropdown-trigger":"_closeDropdownMenu","keydown .js-dropdown-trigger":"_navigateWithArrowKeys","click .js-add-to-site":"_launchConfigurationAddDialog","click .js-dropdown-edit":"_launchConfigurationEditDialog","click .js-dropdown-remove":"_launchConfigurationRemoveDialog","click .js-upgrade-integration":"_upgradeIntegration"},initialize:function(){this.listenTo(I.event,"state:csp-security-level-updated",this.render),this.listenTo(I.event,"state:analytics-configuration-removed",this._integrationRemoved),this.render()},render:function(){var n,i,s=this;return this._hasLoadedData?(n=[],i=[],this._integrations.forEach(function(e){var t=s._getIntegrationTemplate(e);void 0!==t&&(x[e.integrationType].isExternal?i:n).push(t)}),n=n.concat(i),this.$el.html(this.template({appsLabel:PicassoWebServices.Labels.CommBuilderSettings.AppsSectionTitle,appsSectionLabel:cg.appsSectionDescription,templates:n,hasLoadedData:this._hasLoadedData})),this._closeAllDropdownMenus()):(this.$el.html(this.template({hasLoadedData:!1})),this._renderAsync()),this},_renderAsync:function(){Xe.getAllIntegrationPromise().done(function(){this._hasLoadedData=!0,this._integrations=Xe.getAllIntegrations(),this.render()}.bind(this))},_loadIntegrationConfigurationView:function(e,t){var e=e.currentTarget.getAttribute("name"),n="",i=cg.cancel,s="",a="",o="",r=x[e],l=this._integrationTypeConfigured.bind(this),c=this._installIntegrationType.bind(this),d=(this._actionState=t,this._upgradeIntegration.bind(this)),u=x[e].hasUpgradeScopedNotification,p=(t===P.INTEGRATION_ACTION.REMOVE?(n=cg.remove,i=cg.neverMind,s=x[e].removeModalHeading,a=x[e].moduleRemoveMessage):t===P.INTEGRATION_ACTION.ADD?(o=x[e].modalDescription,n=cg.save,s=x[e].addModalHeading):t===P.INTEGRATION_ACTION.EDIT&&(o=x[e].editModalDescription,n=cg.update,s=x[e].editModalHeading),this.$(".slds-dropdown-trigger")),s=new rg({modalHeader:s,modalDescription:o,actionLabel:n,secondaryActionLabel:i,integrationType:e,actionState:t,successCallback:l,installCallback:c,upgradeIntegrationCallback:d,hasUpgradeScopedNotification:u,removalMsg:a,labelMap:r}),o=t===P.INTEGRATION_ACTION.ADD?document.activeElement:p;A.showDialog(s,{className:"slds-vex-theme cb-Dialog--Integrations test-dialog-integrations",afterCloseFocusEl:o})},_launchConfigurationAddDialog:function(e){this._loadIntegrationConfigurationView(e,P.INTEGRATION_ACTION.ADD)},_launchConfigurationEditDialog:function(e){this._loadIntegrationConfigurationView(e,P.INTEGRATION_ACTION.EDIT)},_launchConfigurationRemoveDialog:function(e){this._loadIntegrationConfigurationView(e,P.INTEGRATION_ACTION.REMOVE)},_upgradeIntegration:function(e){var t=this,n=e.currentTarget.getAttribute("name");Xe.upgradeIntegration(n).done(function(){var e={message:x[n].upgradeIntegrationToast,canDismiss:!0,duration:5e3};w.success(e),t._hasLoadedData=!1,t.render()})},_openDropdownMenu:function(e){e=this.$(e.currentTarget);e.hasClass("slds-is-open")||e.addClass("slds-is-open"),e.find("a")[0].focus()},_closeDropdownMenu:function(e){e.currentTarget.contains(e.relatedTarget)||this.$(e.currentTarget).removeClass("slds-is-open")},_closeAllDropdownMenus:function(e){this.$(".js-dropdown-trigger").removeClass("slds-is-open")},_navigateWithArrowKeys:function(e){var t,n=this.$(e.currentTarget);"ArrowUp"!==e.key&&"ArrowDown"!==e.key||!n.hasClass("slds-is-open")||(t=(n=n.find("a")).filter(":focus")[0],t=n.index(t),n[(t+("ArrowUp"===e.key?-1:1)+n.length)%n.length].focus())},_integrationRemoved:function(e){A.closeDialog(),this._toast(e)},_integrationTypeConfigured:function(e){A.closeDialog(),this._toast(e)},_installIntegrationType:function(e){var t=this;Xe.getInstallIntegrationTypePromise(e).done(function(){t.render()}.bind(this))},_toast:function(e){var t="",t=this._actionState===P.INTEGRATION_ACTION.ADD?e.integrationStatus===dg?x[e.integrationType].inProgressToastMessage:x[e.integrationType].addToastMessage:this._actionState===P.INTEGRATION_ACTION.EDIT?x[e.integrationType].editToastMessage:x[e.integrationType].removeToastMessage;!1===e.isSuccess?(e={message:cg.errorToastMessage,canDismiss:!0,duration:5e3},w.error(e)):w.success({message:t,canDismiss:!0,duration:5e3}),this._hasLoadedData=!1,this.render()},_getIntegrationTemplate:function(e){x[e.integrationType].isInstalled=e.isInstalled,x[e.integrationType].isEnabled=e.isEnabled;var t=e.upgradeStatus,n=e.integrationStatus,n=(t===ug&&vg.has(n)&&(n=ug),x[e.integrationType].integrationStatus=n,x[e.integrationType].isUpgradeInProgress=n===ug,x[e.integrationType].isAddToSiteShown=hg.has(n),x[e.integrationType].isUserActionDisabled=mg.has(n),x[e.integrationType].isEnabled=n===pg,x[e.integrationType].isSetupInProgress=n===dg,x[e.integrationType].hasUpgradeScopedNotification=vg.has(n)&&t===gg,x[e.integrationType].integrationStatusLabel=cg[n.toLowerCase()],x[e.integrationType].detailsHeading=cg.detailsHeading,x[e.integrationType].detailsVersion=cg.detailsVersion.replace("{0}",e.currentVersion),x[e.integrationType].detailsView=x[e.integrationType].detailsView,x[e.integrationType].detailsAutoUpgrades=cg.detailsAutoUpgrades,x[e.integrationType].upgradeNotificationLabel=null==(t=x[e.integrationType].upgradeNotificationLabelRaw)?void 0:t.replace("{0}",e.availableVersion),x[e.integrationType].upgradeNotificationActionLabel=cg.upgradeNotificationActionLabel,e.isInstalled?(x[e.integrationType]._actionState=P.INTEGRATION_ACTION.EDIT,x[e.integrationType].managedContentId=e.managedContentId,x[e.integrationType].versionId=e.versionId,x[e.integrationType].contentKey=e.contentKey,x[e.integrationType].variantId=e.variantId):x[e.integrationType].contentFolderId=e.contentFolderId,E.getSite().get("appServerUrl"));if(x[e.integrationType].isIntegrationEnabled())return this.integrationTemplate({isExternal:x[e.integrationType].isExternal,helpText:x[e.integrationType].cardHelpText,helpLink:x[e.integrationType].cardHelpLink,moduleName:x[e.integrationType].moduleName,moduleDescription:x[e.integrationType].moduleDescription,integrationType:x[e.integrationType].type,isInstalled:x[e.integrationType].isInstalled,isEnabled:x[e.integrationType].isEnabled,integrationStatusLabel:x[e.integrationType].integrationStatusLabel,isAddToSiteShown:x[e.integrationType].isAddToSiteShown,isUserActionDisabled:x[e.integrationType].isUserActionDisabled,isSetupInProgress:x[e.integrationType].isSetupInProgress,isUpgradeInProgress:x[e.integrationType].isUpgradeInProgress,hasUpgradeScopedNotification:x[e.integrationType].hasUpgradeScopedNotification,upgradeNotificationLabel:x[e.integrationType].upgradeNotificationLabel,upgradeNotificationActionLabel:x[e.integrationType].upgradeNotificationActionLabel,logoURL:"".concat(n).concat(x[e.integrationType].logoURL),configureLink:cg.moduleAddLink,editLink:cg.edit,removeLink:cg.delete,externalLabel:cg.external,internalLabel:cg.salesforce,enabledLabel:cg.enabled,disabledLabel:cg.disabled})}}),bg={button:function(e,t){var n=t.icon?this.icon(e,t.icon):null,i=_g(t,"className"),s={disabled:!!t.disabled};return t.title&&(s.title=t.title),e("button.slds-button"+i,{attrs:s,on:{click:t.click}},[n,e("span",[t.label])])},icon:function(e,t){return e("span.slds-icon_container",[Sg(e,fg(t,"className"),t.icon,t.label)])},dropdownButtonIcon:function(e,t){var n=_g(t,"buttonClassName"),i=fg(t,"svgClassName");return e("button.slds-button.slds-button_icon.slds-button_icon-border.slds-button_icon-x-small"+n,{on:{click:t.click},attrs:t.attrs},[Sg(e,i+" slds-button__icon","down",t.label)])},deleteButtonIcon:function(e,t){var n=_g(t,"buttonClassName"),i=fg(t,"svgClassName");return e("button.slds-button.slds-button_icon.slds-button_icon-error"+n,{on:{click:t.click},attrs:{title:t.label}},[Sg(e,i+" slds-button__icon","delete",t.label)])},spinner:function(e,t){return e("div.slds-is-relative"+_g(t,"containerClassName"),[e("div.slds-spinner.slds-spinner_brand"+_g(t,"spinnerClassName"),{attrs:{role:"status"}},[e("span.slds-assistive-text",["Loading"]),e("div.slds-spinner__dot-a"),e("div.slds-spinner__dot-b")])])},input:function(e,t){var n=_g(t,"helpClassName"),i=L.uuid(),s=L.uuid();return e("div.slds-form-element.slds-form-element_stacked",{class:{"slds-has-error":t.errorMessage}},[e("label.slds-form-element__label",{attrs:{for:i}},[t.required?e("abbr.slds-required","*"):null,e("span",t.label)]),e("input.slds-input"+_g(t,"inputClassName"),{props:{placeholder:t.props.placeholder,value:t.props.value},on:{input:t.on.input},attrs:_.extend({},t.attrs,{"aria-describedby":s,id:i})}),e("div.slds-form-element__help"+n,{attrs:{id:s}},t.errorMessage)])},checkbox:function(e,t){var n,i=fg(t,"checkboxInputName"),s=fg(t,"checkboxEnabledText"),a=fg(t,"checkboxDisabledText"),o=fg(t,"checkboxUnavailableText"),r=fg(t,"checked"),l=fg(t,"unavailable"),c=fg(t,"onChange");return e("div.slds-form-element"+_g(t,"formClass"),[e("label.slds-checkbox_toggle slds-grid",[e("input"+_g(t,"checkboxClass"),(n=(r={unavailable:l,checked:r}).unavailable,r=r.checked,c={props:{type:"checkbox",name:i},on:{change:c}},n?c.props.disabled="disabled":r&&(c.props.checked="checked"),c)),e("span.slds-checkbox_faux_container",{props:{id:i}},[e("span.slds-checkbox_faux"+_g(t,"checkboxFauxClass")),e("span.slds-checkbox_on slds-text-align_center",s),e("span.slds-checkbox_off slds-text-align_center",l?o:a)])])])}};function fg(e,t){return e&&e[t]?e[t]:""}function _g(e,t){e=fg(e,t);return e?"."+e.trim().split(/\s+/).join("."):""}function Sg(e,t,n,i){return e("span.slds-icon_container",[e("svg",{attrs:{class:t,"aria-hidden":"true"}},[e("use",{attrs:{"xlink:href":"/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#"+n}})]),e("span.slds-assistive-text",i)])}function Cg(e){var a=PicassoWebServices.Labels.CommBuilderSettings,o=PicassoWebServices.Labels.CommBuilderPageManagement,r=bg,l=yg(),c=Tg();function t(t){S.getThemeDefinitionsPromise().done(function(e){t({type:"ReceivedThemes",data:e})})}function d(){return Immutable.fromJS(S.getCurrentTheme())}return{init:function(e){return[Immutable.Map({needsUpgrade:!N.isBrandingSetEditorEnabled()||!$P.hasCommBuilderThemingPerm,currentTheme:d(),usedThemes:null,loading:Qe.isBrandingUpgradeFlowFetched()}),function(e){t(e)}]},render:function(e,t,n){var i,s=[l.render(e,t,function(e){n({type:"CurrentThemeAction",data:e})})];return t.get("loading")?(t.get("needsUpgrade")?s.unshift((i=e)("div.cb-SettingsThemeManageView-needsUpgrade.slds-box.slds-m-horizontal_large.slds-m-bottom_large.test-needs-upgrade",[r.icon(i,{icon:"info",className:"cb-SettingsThemeManageView-infoIcon"}),i("span.cb-SettingsThemeManageView-needsUpgradeMessage",[a.ThemeSettingsManageNeedsUpgrade])])):s.push(c.render(e,t,function(e){n({type:"ThemeTileAction",data:e})})),e("div.cb-SettingsThemeManageView.test-settings-theme-manage",s)):(i=e)("div.spinner-container.slds-spinner_container.cb-SettingsThemeManageView-spinner",[i("div.slds-spinner.slds-spinner_brand.slds-spinner_medium",[i("span.slds-assistive-text",[o.Loading]),i("div.slds-spinner__dot-a"),i("div.slds-spinner__dot-b")])])},update:function(e,t){var n,i,s;switch(t.type){case"ReceivedThemes":n=[e=(e=e.set("currentTheme",d())).set("usedThemes",(i=t.data,s=S.getCurrentTheme().id,Immutable.fromJS(_.filter(i,function(e){return e.id&&e.id!==s}))))];break;case"CurrentThemeAction":n=l.update(e,t.data);break;case"ThemeTileAction":n=c.update(e,t.data);break;case"FetchedUpgradeFlows":n=[e=e.set("loading",t.data)]}return n},subscriptions:function(){return[["state:current-theme-updated",function(e){t(e)}],["state:theme-deleted",function(e){t(e)}],["state:branding-upgradeflow-sync",function(e){e({type:"FetchedUpgradeFlows",data:!0})}]]}}}function yg(e){var r=PicassoWebServices.Labels.CommBuilderSettings,l=bg,c="<div>"+r.ThemeSettingsManageResetThemeDialogContent1+'</div><ul class="cb-SettingsThemeManageView-resetThemeDlgContentList slds-m-top_small slds-m-left_x-large">'+r.ThemeSettingsManageResetThemeDialogContent2+'</ul><p class="slds-m-top_small">'+r.ThemeSettingsManageResetThemeDialogContent3+"</p>";function i(e,t,n){var i,s,a,o,n=[(s=e,o=(a=t).getIn(["currentTheme","showSpinner"]),l.button(s,{className:"slds-button_brand slds-m-right_small test-change-theme",label:r.ThemeSettingsManageChangeTheme,disabled:a.get("needsUpgrade")||o,click:function(){Bd.openChangeThemeWizard()}})),(s=e,i=n,(a=t).getIn(["currentTheme","hasDefinition"])?(o=a.getIn(["currentTheme","showSpinner"]),l.button(s,{className:"slds-button_neutral test-reset-theme",label:r.ThemeSettingsManageResetTheme,disabled:a.get("needsUpgrade")||o,click:function(){A.sldsConfirm(c,r.ThemeSettingsManageResetThemeDialogTitle,function(e){e&&i({type:"ResetTheme"})},{className:"slds-vex-theme slds-vex-theme--medium",yesText:r.Reset})}})):s("div"))];return t.getIn(["currentTheme","showSpinner"])&&n.push(l.spinner(e,{containerClassName:"cb-SettingsThemeManageView-currentThemeSpinner test-reset-spinner",spinnerClassName:"slds-spinner_x-small"})),n}return{render:function(e,t,n){return e("div.cb-SettingsThemeManageView-currentTheme.slds-border_top.slds-border_left.slds-border_right.slds-border_bottom.slds-grid.slds-p-top_x-large.slds-p-left_x-large",[e("div.cb-SettingsThemeManageView-currentThemeImageBorder",[e("div.cb-SettingsThemeManageView-currentThemeImage",{style:{backgroundImage:"url("+t.getIn(["currentTheme","imgUrl"])+")"}})]),e("div.slds-p-left_large",{},[e("div.cb-SettingsThemeManageView-currentThemeHeader.slds-text-color_weak",[r.ThemeSettingsManageCurrentTheme]),e("div.cb-SettingsThemeManageView-currentThemeName.test-current-theme-name",[t.getIn(["currentTheme","displayName"])]),e("div.slds-grid.slds-m-top_medium",i(e,t,n))])])},update:function(e,t){var n;switch(t.type){case"ResetTheme":e=e.setIn(["currentTheme","showSpinner"],!0),n=function(t){I.event.trigger("action:reset-current-theme",{themeId:e.getIn(["currentTheme","id"]),errorCallback:function(e){e&&(A.sldsPromptAlert({content:e,title:PicassoWebServices.Labels.CommunityBuilder.ResetThemeToastError}),t({type:"CurrentThemeAction",data:{type:"ResetButtons"}}))}})};break;case"ResetButtons":e=e.setIn(["currentTheme","showSpinner"],!1)}t=[e];return n&&t.push(n),t}}}function Tg(e){var o=PicassoWebServices.Labels.CommBuilderSettings,r=bg;function i(i,e,s){e=e.get("usedThemes");return e?e.isEmpty()?i("div.slds-text-align_center.test-used-themes-empty",{},[i("div.cb-SettingsThemeManageView-noUsedThemesImage"),i("div.slds-text-color_weak.slds-m-top_large",[o.ThemeSettingsManageNoUsedThemes])]):i("div.slds-grid.slds-wrap.slds-grid--vertical-stretch",_.map(e.toArray(),function(e){return n=s,(t=i)("div.cb-SettingsThemeManageView-usedThemeTile.slds-m-bottom_large.test-used-theme-tile",[t("div.cb-SettingsThemeManageView-usedThemeTileImage.slds-box_border",{style:{backgroundImage:"url("+(e=e).getIn(["imgUrls","0"])+")"}}),t("div.slds-grid.slds-grid_align-spread.slds-m-top_x-small",[t("div.cb-SettingsThemeManageView-usedThemeTileThemeName.test-used-theme-tile-name",[e.get("displayName")]),function(e,s,a){var t=r.dropdownButtonIcon(e,{buttonClassName:"test-used-theme-tile-dropdown-button",click:function(e){var t,n,i;e=e,n=a,i=!!(t=s).get("showSpinner"),e=T(e.currentTarget),new Wo({config:[{items:[{key:"activate",locator:"test-activate",label:o.ThemeSettingsManageActivateTheme,isDisabled:i,action:function(){n({type:"ActivateTheme",data:t})}},{key:"delete",locator:"test-delete",label:o.ThemeSettingsManageDeleteTheme,isDisabled:i,isHidden:!t.get("hasDefinition"),action:function(){A.sldsConfirm(o.ThemeSettingsManageDeleteThemeDialogContent,o.ThemeSettingsManageDeleteThemeDialogTitle,function(e){e&&n({type:"DeleteTheme",data:t})},{className:"slds-vex-theme slds-vex-theme--medium",yesText:o.Delete})}}]}]}).onToggle(e,null,null,null,"left")}});return s.get("showSpinner")?e("div.slds-grid",[r.spinner(e,{containerClassName:"cb-SettingsThemeManageView-themeTileSpinner test-tile-spinner",spinnerClassName:"slds-spinner_x-small"}),t]):t}(t,e,n)])]);var t,n})):i("div")}return{render:function(e,t,n){return e("div.cb-SettingsThemeManageView-usedThemes.slds-is-relative.test-used-themes",[e("div.cb-SettingsThemeManageView-usedThemesHeader.cb-Settings-formGroupHeader.slds-m-bottom_small",[o.ThemeSettingsManageUsedThemes]),i(e,t,n)])},update:function(e,t){var n,i=t.data;switch(t.type){case"ActivateTheme":var s=e.get("usedThemes").indexOf(i);e=e.setIn(["usedThemes",s,"showSpinner"],!0),n=function(e){I.event.trigger("action:swap-current-theme",{devName:i.get("devName"),resetToOriginal:!1})};break;case"DeleteTheme":n=function(e){I.event.trigger("action:delete-theme",{themeId:i.get("id")})}}t=[e];return n&&t.push(n),t}}}Pg=["name","themeLayout","associatedPages","actions"],Ig=PicassoWebServices.Labels.CommBuilderSettings,Eg=P.THEME_LAYOUT_TYPE,wg=_.template('<div class="cb-SettingsThemeAdvancedView-tableHeaderTooltipContainer {{= containerClass }}">\n            <span class="slds-truncate" title="{{= label }}">{{= label }}</span>\n            {{= tooltip }}\n        </div>'),(Np={}).value={name:function(e){var t=D.buttonIcon({buttonClassName:"cb-SettingsThemeAdvancedView-tableNameButton slds-m-left_small js-theme-layout-edit-name-show",label:Ig.ThemeSettingsTableEditName,svgClassName:"slds-icon_x-small",icon:"edit",buttonAttributes:'data-toggle="tooltip" data-placement="top"'});return'<div class="slds-grid slds-grid_align-spread"><span class="slds-truncate">'+e.name+"</span>"+t+"</div>"},themeLayout:function(t){var e=D.buttonIcon({buttonClassName:"slds-m-left_xx-small js-theme-layout-component-show",label:Ig.ThemeSettingsTableEditThemeLayoutProperties,svgClassName:"slds-icon_x-small",icon:"settings",buttonAttributes:'data-toggle="tooltip" data-placement="top"'}),n=D.buttonIcon({buttonClassName:"cb-SettingsThemeAdvancedView-tableThemeLayoutButton slds-m-left_small js-theme-layout-edit-cmp-show",label:Ig.ThemeSettingsTableEditThemeLayoutComponent,svgClassName:"slds-icon_x-small",icon:"edit",buttonAttributes:'data-toggle="tooltip" data-placement="top"'}),i=_.find(t.customThemeLayoutCmpDefs,function(e){return e.fqn===t.currentCmp}),i=i?i.label:t.currentCmp,s=Dg(Ig.ThemeSettingsTableEditThemeLayoutComponentNotAvailable,"top","cb-SettingsThemeAdvancedView-tableThemeLayoutButton slds-icon_x-small");return'<div class="cb-SettingsThemeAdvancedView-tableThemeLayoutItemContainer"><span class="slds-truncate">'+i+"</span>"+e+(Eg.SERVICE_NOT_AVAILABLE!==t.type?n:s)+"</div>"},associatedPages:function(e){return'<a href="javascript:void(0);" class="js-show-theme-layout-pages">'+k.getViewsForThemeLayoutType(e.type).length+"</a>"},actions:function(e){return e.canDelete?D.buttonIcon({buttonClassName:"cb-SettingsThemeAdvancedView-tableActionButton slds-m-left_xx-small js-theme-layout-delete",label:Ig.ThemeSettingsTableDelete,svgClassName:"slds-icon_x-small",icon:"delete",buttonAttributes:'data-toggle="tooltip" data-placement="top"'}):Dg(function(e){switch(e){case Eg.LOGIN:return Ig.ThemeSettingsTableRowOOTBLogin;case Eg.SERVICE_NOT_AVAILABLE:return Ig.ThemeSettingsTableRowOOTBServiceNotAvailable;default:Eg.INNER;return Ig.ThemeSettingsTableRowOOTB}}(e.type),"top","cb-SettingsThemeAdvancedView-tableActionButton slds-icon_x-small")}},Np.className={name:function(){return"cb-SettingsThemeAdvancedView-tableNameItem js-theme-layout-name"},themeLayout:function(){return"cb-SettingsThemeAdvancedView-tableThemeLayoutItem js-theme-layout-cmp"},associatedPages:function(){return"slds-text-align_center js-theme-layout-pages"},actions:function(){return""}},Np.headerLabel={name:function(){return wg({label:Ig.ThemeSettingsTableHeaderName,tooltip:"",containerClass:""})},themeLayout:function(){var e=Dg(Ig.ThemeSettingsTableHeaderThemeLayoutTooltip,"top","slds-m-left_xx-small");return wg({label:Ig.ThemeSettingsTableHeaderThemeLayout,tooltip:e,containerClass:""})},associatedPages:function(){var e=Dg(Ig.ThemeSettingsTableHeaderPagesTooltip,"top","slds-m-left_xx-small");return wg({label:Ig.ThemeSettingsTableHeaderPages,tooltip:e,containerClass:"slds-grid_align-center"})},actions:function(){return""}},Np.headerClassName={name:function(){return""},themeLayout:function(){return""},associatedPages:function(){return"slds-text-align_center"},actions:function(){return"slds-size--1-of-12"}},Np.getColumns=function(){return Pg},Np.getRowSections=function(){var e,t=S.getCurrentTheme().themeLayouts,n=null;return _.each(t,function(e,t){e.type===P.THEME_LAYOUT_TYPE.INNER&&(n=t),e.id=e.type}),n&&(e=t.splice(n,1),t.unshift(e[0])),{dndRows:[],nonDndRows:t}},Np.tableClassName="cb-SettingsThemeAdvancedView-table slds-table_cell-buffer";var Pg,Ig,Eg,wg,Lg=Np;function Dg(e,t,n){return D.tooltipButtonIcon({buttonClassName:"cb-SettingsThemeAdvancedView-tableHeaderTooltip js-theme-layout-info ".concat(n),tooltipPlacement:t,tooltipLabel:e})}function Ag(e){return D.tooltipButtonIcon({buttonClassName:"slds-m-left_xx-small",buttonAttributes:'data-html=true data-container="body"',svgClassName:"cb-SettingsLanguage-tooltipIcon",tooltipPlacement:"top",tooltipLabel:e})}function kg(e){return D.tooltipButtonIcon({svgClassName:"cb-SiteLanguageMetadataEditor-tooltipIcon test-tooltip-icon",buttonAttributes:"data-html=true",tooltipPlacement:"top",tooltipLabel:e})}var Ng=Backbone.View.extend({className:"js-table-container",initialize:function(e){this._dataProvider=Vo.createDataProviderWrapper(e.dataProvider,e.contextParams),this._parentRef=e.parentRef,this._contextParams=e.contextParams},render:function(){var e=this._dataProvider.getColumns();return this.$el.html(Vo.tableTemplate({className:this._dataProvider.getTableClassName(),headHtml:this._getHeadHtml(e),bodyHtml:this._getBodyHtml(e)})),this.$('[data-toggle="tooltip"]').tooltip(),this},updateRow:function(e){var t=T(this._getRowHtml(e));return this._getRowById(e.id).replaceWith(t),this.$('[data-toggle="tooltip"]').tooltip(),t},updateColumn:function(e,a){this.$(e).each(function(e,t){var n=T(t).closest("tr"),i=n.attr("data-id"),i=a(i),s=T(t).closest("td").attr("data-type"),s=this._dataProvider.getValue(s,i);t.parentNode.innerHTML=s,n.attr("title",T(T.parseHTML(s)).text())}.bind(this))},deleteRowById:function(e){this.$('tr[data-id="'+e+'"]').remove()},addRow:function(e){e=T(this._getRowHtml(e));this.$("table tbody").append(e),this.$('[data-toggle="tooltip"]').tooltip()},_getRowById:function(e){return this.$('tr[data-id="'+e+'"]')},_getRowHtml:function(e){var t=this._dataProvider.getColumns(),t=this._getTrData(t,e);return Vo.trTemplate({row:t})},_getHeadHtml:function(e){var i=this._dataProvider,s=this._contextParams,e=_.map(e,function(t){var n={};return _.each(Vo.HEADER_DATA_TYPES,function(e){n[e]=i.getData(e,t,s)}),n});return Vo.theadTemplate({headers:e})},_getBodyHtml:function(e){var t=this._dataProvider.getRowSections(),n=[];return 0<t.nonDndRows.length&&n.push(Vo.tbodyTemplate({data:this._getTbodyData(e,t.nonDndRows),className:"",trTemplate:Vo.trTemplate})),n.join("")},_getTbodyData:function(t,e){return _.map(e,function(e){return this._getTrData(t,e)}.bind(this))},_getTrData:function(e,i){var s=this._dataProvider,a=this._contextParams,o=[{id:i.id}];return _.each(e,function(t){var n={},e=(_.each(Vo.CELL_DATA_TYPES,function(e){n[e]=s.getData(e,t,i,a)}),n.type=t,T(T.parseHTML(n.value)));e.find(".slds-assistive-text").remove(),n.title=e.text().trim(),o.push(n)}),o}}),xg=PicassoWebServices.Labels.CommBuilderSettings,Rg={DUPLICATE:xg.ThemeSettingsActionNewThemeDesignNameErrorDuplicate,REQUIRED:xg.ThemeSettingsActionNewThemeDesignNameErrorRequired},jg=Backbone.View.extend({template:'<div class="cb-SettingsThemeAdvancedView test-settings-theme-advanced"><div class="cb-SettingsThemeAdvancedView-tableHeader cb-Settings-formGroupHeader slds-p-bottom_xx-small">'+xg.ThemeSettingsTableTitle+'</div><div class="js-theme-layout-table"></div><div class="js-theme-layout-ref"></div><div class="slds-grid slds-grid_align-spread"><button class="slds-button slds-button_neutral slds-m-top_medium js-theme-layout-new-show">'+xg.ThemeSettingsActionNewThemeDesign+'</button><div class="slds-m-top_medium js-theme-layout-new-buttons"><button class="slds-button slds-button_neutral js-theme-layout-new-button js-theme-layout-new-cancel">'+xg.ThemeSettingsActionNewThemeDesignCancel+'</button><button class="slds-button slds-button_brand js-theme-layout-new-button js-theme-layout-new-save js-theme-layout-new-name-save" disabled>'+xg.ThemeSettingsActionNewThemeDesignSave+"</button></div></div></div>",editRowTemplate:_.template('<tr class="cb-SettingsThemeAdvancedView-editRow js-theme-layout-new-row"><td>{{= input }}</td><td>{{= dropdown }}</td><td></td><td></td></tr>'),events:{"click .js-theme-layout-component-show":"_showThemeLayoutComponent","click .js-theme-layout-delete":"_deleteThemeLayout","click .js-theme-layout-new-show":"_showNewThemeLayout","click .js-theme-layout-new-cancel":"_cancelNewThemeLayout","click .js-theme-layout-new-save":"_saveNewThemeLayout","input .js-theme-layout-new-name":"_validateNewThemeLayoutName","click .js-theme-layout-edit-cmp-show":"_showEditThemeLayoutCmp","change .js-theme-layout-edit-cmp":"_saveEditThemeLayoutCmp","blur .js-theme-layout-edit-cmp:not([disabled])":"_cancelEditThemeLayoutCmp","click .js-theme-layout-edit-name-show":"_showEditThemeLayoutName","input .js-theme-layout-edit-name":"_validateEditThemeLayoutName","blur .js-theme-layout-edit-name:not([disabled])":"_saveOrCancelEditThemeLayoutName","keyup .js-theme-layout-edit-name:not([disabled])":"_saveOrCancelEditThemeLayoutName","click .js-nav-menu-edit":"_editNavMenu","click .js-show-theme-layout-pages":"_showThemeLayoutPages"},initialize:function(){this._table=new Ng({dataProvider:Lg,parentRef:this}),this._refsPopover=new Pd,this._propEditors={},this.listenTo(I.event,"state:theme-layout-created",this._handleCreated),this.listenTo(I.event,"state:theme-layout-updated",this._handleUpdated),this.listenTo(I.event,"state:theme-layout-deleted",this._handleDeleted),this.listenTo(I.event,"state:current-theme-updated",this._handleThemeChanged);this.listenTo(I.event,["state:view-properties-updated","state:route-created","state:routes-deleted"].join(" "),this._refreshAssignedPagesNo),this.render()},render:function(){this.$el.html(this.template),this.$(".js-theme-layout-table").append(this._table.render().$el),this.$(".js-theme-layout-new-buttons").hide(),this.$el.tooltip({selector:"[data-toggle=tooltip]"});var e=S.getCurrentTheme().themeLayouts;return _.each(e,function(e){this._propEditors[e.type]=this._createThemeLayoutPropertiesEditor(e)}.bind(this)),this},_cleanupPropEditors:function(){_.each(this._propEditors,function(e){e.view.destroy()}),this._propEditors={}},_handleThemeChanged:function(){this._cleanupPropEditors(),this.render()},_createThemeLayoutPropertiesEditor:function(e){var t={},e=(t.view=new yd({themeLayoutId:e.themeLayoutId}),t.view.render(),Lg.getColumns().length);return t.$el=t.view.$el.wrap('<tr class="js-theme-layout-cmp-editor"></tr>').wrap('<td colspan="'+e+'"></td>').parent().parent(),t},_showThemeLayoutComponent:function(e){var e=T(e.currentTarget).closest("tr"),n=e.attr("data-id"),t=this._propEditors[n];this.activePropsEditorType!==n?(_.each(this._propEditors,function(e,t){t!==n&&e.$el.detach()}),e.after(t.$el),this.activePropsEditorType=n):(this.activePropsEditorType=null,t.$el.detach())},_showNewThemeLayout:function(){this.$(".js-theme-layout-new-row").remove();var e=this._getThemeLayoutSelectEl(P.THEME_LAYOUT_TYPE.INNER,"js-theme-layout-new-cmp"),t=D.input({formElementClassName:"js-theme-layout-new-name-container",inputClassName:"js-theme-layout-new-name",placeholder:xg.ThemeSettingsActionNewThemeDesignNamePlaceholder,value:"",helpClassName:"js-theme-layout-new-name-error"});this.$(".js-theme-layout-table table tbody").append(this.editRowTemplate({input:t,dropdown:e})),this.$(".js-theme-layout-new-name").focus(),this._toggleNewThemeLayoutMode(!0)},_cancelNewThemeLayout:function(){this._toggleNewThemeLayoutMode(!1)},_saveNewThemeLayout:function(){var e=this.$(".js-theme-layout-new-name"),t=this.$(".js-theme-layout-new-cmp");I.event.trigger("action:create-theme-layout",{themeId:S.getCurrentTheme().id,themeLayoutType:e.val(),targetThemeLayoutCmpDef:t.val()}),e.prop("disabled",!0),t.prop("disabled",!0),this.$(".js-theme-layout-new-buttons .js-theme-layout-new-button").prop("disabled",!0)},_validateNewThemeLayoutName:function(e){e=T(e.currentTarget).val().trim();this._validateNameInput(e,"js-theme-layout-new-name")},_showEditThemeLayoutName:function(e){this._showEdit(e,function(e,t){t=S.getThemeLayoutByType(t),this._detachedThemeLayoutName=e.children().detach(),t=D.input({formElementClassName:"js-theme-layout-edit-name-container",inputClassName:"js-theme-layout-edit-name",placeholder:xg.ThemeSettingsActionNewThemeDesignNamePlaceholder,value:t.name,helpClassName:"js-theme-layout-edit-name-error"});e.html(t),e.find("input").focus()}.bind(this))},_saveOrCancelEditThemeLayoutName:function(e){var t,n,i;e.keyCode&&13!==e.keyCode||(t=(e=T(e.currentTarget)).val(),n=e.closest("tr").attr("data-id"),n=S.getThemeLayoutByType(n),i=this.$(".js-theme-layout-edit-name-container").hasClass("js-has-error"),n.name===t||i?((i=e.closest("td")).html(this._detachedThemeLayoutName),i.removeClass("is-active")):(n.id=n.type,n.name=t,this._table.updateRow(n).find("button:not(.js-theme-layout-info)").prop("disabled",!0),I.event.trigger("action:update-theme-layout",{themeId:S.getCurrentTheme().id,themeLayoutType:n.type,themeLayoutName:t,targetThemeLayoutCmpDef:n.currentCmp}),this._detachedThemeLayoutName.remove()))},_validateEditThemeLayoutName:function(e){e=T(e.currentTarget).val().trim();this._validateNameInput(e,"js-theme-layout-edit-name")},_validateNameInput:function(t,e){var n=this.$("."+e).attr("data-orig-value"),i=0===t.length?"REQUIRED":"",e=(i=_.find(S.getCurrentTheme().themeLayouts,function(e){return e.name.toLocaleLowerCase()===t.toLocaleLowerCase()&&e.name!==n})?"DUPLICATE":i,this.$("."+e+"-container").toggleClass("slds-has-error",!!i).toggleClass("js-has-error",!!i),this.$("."+e+"-error").html(Rg[i]||""),this.$("."+e+"-save"));0!==e.length&&(e[0].disabled=!!i)},_showEditThemeLayoutCmp:function(e){this._showEdit(e,function(e,t){this._detachedThemeLayoutCmp=e.children().detach();t=this._getThemeLayoutSelectEl(t,"js-theme-layout-edit-cmp");e.html(t),e.find("select").focus()}.bind(this))},_cancelEditThemeLayoutCmp:function(e){e=T(e.currentTarget).closest("td");e.html(this._detachedThemeLayoutCmp),e.removeClass("is-active")},_saveEditThemeLayoutCmp:function(e){var n,t=T(e.currentTarget),i=t.closest("tr").attr("data-id"),s=S.getThemeLayoutByType(i),a=t.val();s.currentCmp!==a?(t.prop("disabled",!0),n=T.Deferred(),PicassoWebServices.CommPage.GetRegionDifference(s.themeLayoutId,a,function(e){var t;0===e.length?n.resolve():(e=D.list({listClassName:"",listItemClassName:"",items:e}),t=xg.ThemeAreaLayoutConfirmTitle,e=xg.ThemeAreaLayoutConfirmContent.replace("{0}",e),A.sldsModal({content:e,title:t,className:"picasso-vex-theme cb-SettingsThemeAdvancedView-dialog",callback:function(e){return e?n.resolve():n.reject()}}))}),n.then(function(){s.currentCmp=a,s.id=s.type,this._table.updateRow(s).find("button:not(.js-theme-layout-info)").prop("disabled",!0),I.event.trigger("action:update-theme-layout",{themeId:S.getCurrentTheme().id,themeLayoutType:s.type,themeLayoutName:s.name,targetThemeLayoutCmpDef:a})}.bind(this),function(){this._cancelEditThemeLayoutCmp(e)}.bind(this))):this._detachedThemeLayoutCmp.remove()},_deleteThemeLayout:function(e){var t,n=T(e.currentTarget).closest("tr"),e=n.attr("data-id"),i=(this._propEditors[e].$el.detach(),S.getThemeLayoutByType(e)),s=(n.find("button").prop("disabled",!0),T.Deferred()),e=k.getViewsForThemeLayoutType(e);0===e.length?s.resolve():(e=D.list({listClassName:"",listItemClassName:"",items:_.map(e,function(e){return e.get("Title")})}),t=xg.ThemeAreaConfirmDeleteTitle,e=xg.ThemeAreaConfirmThemeLayoutTypeDelete.replace("{0}",e),A.sldsModal({content:e,title:t,className:"picasso-vex-theme cb-SettingsThemeAdvancedView-dialog",yesText:PicassoWebServices.Labels.PicassoDialog.Delete,yesTextClassName:"slds-button_destructive",callback:function(e){return e?s.resolve():s.reject()}})),s.then(function(){I.event.trigger("action:delete-theme-layout",{themeId:S.getCurrentTheme().id,themeLayoutType:i.type})},function(){n.find("button").prop("disabled",!1)})},_handleCreated:function(e){this.$(".js-theme-layout-new-row").remove(),e.id=e.type,this._table.addRow(e),this._propEditors[e.type]=this._createThemeLayoutPropertiesEditor(e),this.$(".js-theme-layout-new-show").show(),this.$(".js-theme-layout-new-buttons").hide(),this.$(".js-theme-layout-new-cancel").prop("disabled",!1)},_handleUpdated:function(e){e.id=e.type,this._propEditors[e.type].view.refresh(e.themeLayoutId),this._table.updateRow(e)},_refreshAssignedPagesNo:function(){this._table.updateColumn(".js-show-theme-layout-pages",function(e){e=S.getThemeLayoutByType(e);return e.id=e.type,e})},_handleDeleted:function(e){e=e.type;this._propEditors[e].view.destroy(),this._propEditors[e].$el.remove(),delete this._propEditors[e],this._table.deleteRowById(e),this._refreshAssignedPagesNo()},_getThemeLayoutSelectEl:function(e,t){var n=S.getThemeLayoutByType(e);return D.select({data:_.map(n.customThemeLayoutCmpDefs,function(e){return{label:e.label,value:e.fqn,selected:e.fqn===n.currentCmp}}),className:t})},_toggleNewThemeLayoutMode:function(e){this.$(".js-theme-layout-new-show").toggle(!e),this.$(".js-theme-layout-new-buttons").toggle(e),this.$(".js-theme-layout-new-row").toggle(e)},_showThemeLayoutPages:function(e){var e=T(e.currentTarget),t=e.closest("tr").attr("data-id"),n=S.getThemeLayoutByType(t);Zr({view:this._refsPopover.setThemeLayoutType(t,{showAll:!0,showCurrentBadge:!1,pluralLabel:xg.ThemeSettingsTableRowPages.replace("{1}",n.name),singularLabel:xg.ThemeSettingsTableRowPage.replace("{0}",n.name)}).$el[0],trigger:e[0],options:{dismissSelector:".js-close-btn",dismissSelectorLabel:PicassoWebServices.Labels.PicassoDialog.Close,horizontalOffset:24,className:"cb-ThemeLayoutRefs cb-SettingsThemeAdvancedView-themeLayoutRefs",offsetTriggerHeight:!1,nubbinPosition:"left-top"}}).show()},_editNavMenu:function(){Bd.openNavMenuEditor({title:xg.ThemeAreaEditNavMenu,header:xg.ThemeAreaNavMenuBanner})},_showEdit:function(e,t){var e=T(e.currentTarget),n=e.closest("td");n.addClass("is-active");e=e.closest("tr").attr("data-id");this._propEditors[e].$el.detach(),n.find(".tooltip").remove(),t(n,e)}}),Bg=function(i,e){var s,t=window,a=t.snabbdom.h,o=t.snabbdom.init(b.map([t.snabbdom_attributes,t.snabbdom_class,t.snabbdom_eventlisteners,t.snabbdom_props,t.snabbdom_style],"default")),n=T("<div />").appendTo(T(e)),r=b.extend({},Fe.Events),l=!0,c=n[0];function d(e){l&&u(i.update(s,e))}function u(e){var t=e[0],n=e[1],e=i.render(a,t,d);o(c,e),s=t,c=e,n&&setTimeout(function(){n(d)},0)}return i.subscriptions&&b.each(i.subscriptions(),function(e){var t=e[0],e=e[1];r.listenTo(I.event,t,e.bind(null,d))}),u(i.init()),{destroy:function(){l&&(n.remove(),r.stopListening(),i.destroy&&i.destroy(),l=!1)}}},Og=PicassoWebServices.Labels.CommBuilderSettings,Op=Backbone.View.extend({className:"cb-Settings-section cb-Settings-themeSection test-settings-theme-section",template:'<h2 class="cb-Settings-sectionHeading">'+Og.ThemeSettingsTitle+'</h2><div class="cb-Settings-sectionDescription">'+Og.ThemeSettingsDescription+'</div><div class="js-tabs-container"></div>',initialize:function(){this.render()},render:function(){this.$el.html(this.template);var e=[],t={label:Og.ThemeSettingsAdvancedTab,tabClassName:"js-settings-theme-advanced-tab",content:function(e){new jg({el:e})}},n={label:Og.ThemeSettingsManageTab,tabClassName:"test-settings-theme-manage-tab",content:function(e){Bg(Cg(),e)}};return I.AccessControl(P.PERMISSIONS.MANAGE_THEME)?(n.isActive=!0,e.push(n)):t.isActive=!0,e.push(t),ho(this.$(".js-tabs-container"),{items:e}),this}}),Mp=PicassoWebServices.Labels,Mg=Mp.Languages,xp=$P.hasCommerceStoreLanguage?Mg.BuilderAddLanguageHelpWithCommerceStoreLanguage:Mg.BuilderAddLanguageHelp,Vg=Mg.BuilderRecommendedLanguages,$g=Mg.BuilderOtherLanguages,Ug={selectedFieldsTitle:Mg.BuilderSelectedLanguages,availableFieldsTitle:Mg.AvailableLanguages,pickerHeight:"350px",fieldData:{0:"name",1:"value",2:"classname",3:"labelClassname"},fieldEntry:'<li data-value="{1}" class="{2}"><span class="{3}" title="{0}">{0}</span></li>'},Wg=Backbone.View.extend({className:"cb-AddLanguages-container js-add-languages-dlg",template:_.template('<div class="cb-AddLangauges-dialogHeader"><div class="slds-text-heading_medium cb-AddLanguages-dialogTitle">{{= title}}</div><div class="cb-AddLanguages-helpText">'+xp+'</div></div><div class="cb-AddLanguages-dualPicklist js-dual-picklist"><div class="cb-AddLanguages-leftPicklist js-available-languages"><div class="slds-form-element__label cb-AddLanguages-picklistTitle titleAvailable">'+Mp.DualFieldPicker.AvailableFields+'</div><div><ul class="slds-listbox slds-listbox_vertical availableFieldList"></ul></div></div><div class="buttonSection middleButtons"><div>{{= $P.viewTypes.CommonTemplates.buttonIcon({icon:"right", buttonClassName: "cb-AddLanguages-arrowButton moveFieldsToRight js-add-language-arrow", label:"'+Mg.AddLanguage+'" }) }}</div><div>{{= $P.viewTypes.CommonTemplates.buttonIcon({icon:"left", buttonClassName: "cb-AddLanguages-arrowButton moveFieldsToLeft js-remove-language-arrow", label:"'+Mg.RemoveLanguage+'" }) }}</div></div><div class="cb-AddLanguages-rightPicklist js-site-languages"><div class="slds-form-element__label cb-AddLanguages-picklistTitle titleSelected">'+Mp.DualFieldPicker.SelectedFields+'</div><div><ul class="slds-listbox slds-listbox_vertical selectedFieldList"></ul></div></div><div class="buttonSection middleButtons"><div>{{= $P.viewTypes.CommonTemplates.buttonIcon({icon:"up", buttonClassName: "cb-AddLanguages-arrowButton upField js-move-language-up-arrow", label:"'+Mp.DualFieldPicker.MoveUp+'" }) }}</div><div>{{= $P.viewTypes.CommonTemplates.buttonIcon({icon:"down", buttonClassName: "cb-AddLanguages-arrowButton downField js-move-language-down-arrow", label:"'+Mp.DualFieldPicker.MoveDown+'" }) }}</div></div></div><div class="cb-AddLanguages-actionButtons"><button class="slds-button slds-button_neutral js-add-language-cancel">'+Mg.Cancel+'</button><button class="slds-button slds-button_brand cb-AddLanguages-saveButton js-add-language-save">'+Mg.Save+"</button></div>"),events:{"click .js-add-language-save":"_saveLanguages","click .js-add-language-cancel":"_cancel"},initialize:function(){this.render()},render:function(){this.$el.html(this.template({title:Mg.AddLanguage}));var s=[],a=[],o={},r="slds-listbox__item",l="slds-listbox__option slds-listbox__option--plain slds-media js-language-item",c=(g.getSiteLanguages().forEach(function(e,t){o[g.getSiteLanguageFullCode(e)]=t,s.push({name:e.LanguageLabel,value:-1,classname:r,labelClassname:l})}),g.getBaseLanguage().LanguageFullCode);return this.availableLanguages=this.getCategorizedAvailableLanguages(g.getAvailableLanguages()),this.availableLanguages.forEach(function(e,t){var n,i;!0===e.IsCategoryItem?a.push({name:e.LanguageLabel,value:t,classname:"slds-listbox__item slds-text-heading_small slds-listbox__item--disabled",labelClassname:l}):(n=e.LanguageFullCode,void 0!==(i=o[n])?s[i].value=t:n!==c&&a.push({name:e.LanguageLabel,value:t,classname:r,labelClassname:l}))}),this.$(".js-dual-picklist").dualpicker(Ug),this.$(".js-dual-picklist").dualpicker_setfields(a,s),this},_cancel:function(){A.closeDialog()},_saveLanguages:function(){var t=this,n=[];T(".js-dual-picklist").dualpicker_selected().forEach(function(e){var e=t.availableLanguages[e];e&&(e={Name:e.Name,LanguageLabel:e.LanguageLabel,LanguageCode:e.LanguageCode,LanguageCountryCode:e.LanguageCountryCode,LanguageActive:!0},n.push(e))}),I.event.trigger("action:upsert-site-languages",{languages:n}),A.closeDialog()},getCategorizedAvailableLanguages:function(e){var t=[],n=[];return e.forEach(function(e){(1==e.IsRecommendedLanguage?t:n).push(e)}),0<t.length&&(t.unshift({LanguageLabel:Vg,IsCategoryItem:!0}),n.unshift({LanguageLabel:$g,IsCategoryItem:!0})),t.concat(n)}}),Fg=PicassoWebServices.Labels,Hg=Fg.Languages.LanguageDisplayNameNotUnique,Gg=Backbone.View.extend({className:"cb-SettingsLanguage-editContainer js-edit-display-label-dlg",template:_.template('<div class="cb-EditBase-dialogHeader"><div class="slds-text-heading_medium cb-EditBase-dialogTitle">{{= title}}</div></div><div class="slds-form-element cb-EditBase-inputForm js-edit-base-form"><label class="slds-form-element__label" for="name-input"><abbr class="slds-required cb-LanguageExport-requiredField" title="required">*</abbr>'+Fg.Languages.DisplayLabel+'</label><div class="slds-form-element__control cb-EditBase-nameInput"><input type="text" id="name-input" class="slds-input js-name" maxLength="100"/></div><div class="slds-form-element__help js-name-error"></div></div><div class="cb-EditBase-buttonBar"><button class="slds-button slds-button_neutral js-edit-base-cancel">'+Fg.Languages.Cancel+'</button><button class="slds-button slds-button_brand cb-EditBase-saveButton js-edit-base-save">'+Fg.Languages.Save+"</button></div>"),events:{"keyup .js-name":"_validate","click .js-edit-base-cancel":"_cancel","click .js-edit-base-save":"_save"},initialize:function(){this.listenTo(I.event,"state:base-language-updated",this._handleBaseLanguageUpdated),this.render()},render:function(){return this.$el.html(this.template({title:Fg.Languages.ChangeLabel})),this.$(".js-name").val(g.getBaseLanguage().LanguageLabel),this},_isNameUnique:function(e){for(var t=g.getSiteLanguages(),n=0;n<t.length;n++)if(t[n].LanguageLabel===e)return!1;for(var i=g.getAvailableLanguages(),s=g.getBaseLanguage(),a=0;a<i.length;a++){var o=i[a];if(o.LanguageLabel===e&&s.LanguageFullCode!==o.LanguageFullCode)return!1}return!0},_validate:function(){var e=this.$(".js-name").val().trim(),t=!this._isNameUnique(e);0===e.length||t?this.$(".js-edit-base-save").prop("disabled",!0):this.$(".js-edit-base-save").prop("disabled",!1),t?(this.$(".js-edit-base-form").addClass("slds-has-error"),this.$(".js-name-error").text(Hg)):(this.$(".js-edit-base-form").removeClass("slds-has-error"),this.$(".js-name-error").empty())},_cancel:function(){A.closeDialog()},_save:function(){I.event.trigger("action:update-base-language-label",{BaseLanguageLabel:this.$(".js-name").val(),successCallback:function(){A.closeDialog()}})},_handleBaseLanguageUpdated:function(){this.$(".js-name").val(g.getBaseLanguage().LanguageLabel)}}),zg=PicassoWebServices.Labels.Languages,i=PicassoWebServices.Labels.PicassoDialog,n=PicassoWebServices.Labels.UploadDialog.Details,Kg=Backbone.View.extend({importDialogHtml:'<div class="cb-LanguageImportPicker-dialogHeader"><div class="slds-text-heading_medium cb-LanguageImportPicker-dialogTitle">'+zg.ImportLanguageContent+'</div><div class="cb-LanguageImportPicker-dialogHelpText">'+zg.BuilderXmlUploadMessage+'</div></div><div class="js-file-picker-content cb-LanguageXmlPicker-content cb-LanguageImportPicker-filePicker clearfix"><div class="js-progress-indicator cb-LanguageXmlPicker-progress"><div class="cb-LanguageXmlPicker-progressContent"><img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="cb-LanguageXmlPicker-progressContentIcon"></img><span class="cb-LanguageXmlPicker-progressContentDesc">'+PicassoWebServices.Labels.UploadDialog.Uploading+"</span></div></div></div>",successDialogTemplate:_.template('<div class="cb-LanguageImportPicker-dialogHeader cb-LanguageImportPicker-statusDialogHeader cb-LanguageImportPicker-successDialogHeader js-import-translation-content-success-header"><div class="slds-text-heading_medium cb-LanguageImportPicker-successTitle">{{= successTitle}}</div></div><div class="cb-LanguageImportPicker-successMsg js-import-translation-content-success-msg">{{= successMsg}}</div>{{ if (warning) { }}<div class="cb-LanguageImportPicker-warningMsg">{{= warningMsg}}</div><article class="slds-card cb-LanguageImportPicker-detailsCard"><div class="slds-card__body"><div class="slds-section js-details-section"><div class="slds-section__title cb-LanguageImportPicker-detailsTitle">{{= $P.viewTypes.CommonTemplates.buttonWithIcon({buttonClassName: "js-detail-expand-toggle", buttonVariantClassName: "slds-section__title-action", svgClassName: "slds-section__title-action-icon", icon: "switch", label: "'+n+'"}) }}</div><div aria-hidden="false" id="details-to-expand" class="slds-section__content cb-LanguageImportPicker-sectionContent js-section-content"><ul class="cb-LanguageImportPicker-detailList">{{= detailList}}</ul></div></div></div></article>{{ } }}<div class="cb-LanguageImportPicker-successButton"><button class="slds-button slds-button_neutral js-close">'+i.GotIt+"</button></div>"),detailListItemTemplate:_.template('<li class="cb-LanguageImportPicker-detailListItem"><span class="cb-LanguageImportPicker-detailItemName">{{= detailName }}</span>&nbsp;:&nbsp;{{= detailMsg }}</li>'),infoDialogTemplate:_.template('<div class="cb-LanguageImportPicker-dialogHeader cb-LanguageImportPicker-statusDialogHeader cb-LanguageImportPicker-infoDialogHeader js-import-translation-content-info-header"><div class="cb-LanguageImportPicker-infoTitle">{{= infoTitle}}</div></div><div class="cb-LanguageImportPicker-infoMsg js-import-translation-content-info-msg">{{= infoMsg}}</div><div class="cb-LanguageImportPicker-infoButton"><button class="slds-button slds-button_neutral js-close">'+i.Ok+"</button></div>"),errorDialogTemplate:_.template('<div class="cb-LanguageImportPicker-dialogHeader cb-LanguageImportPicker-statusDialogHeader cb-LanguageImportPicker-errorDialogHeader"><div class="cb-LanguageImportPicker-errorTitle">{{= errorTitle}}</div></div><div class="cb-LanguageImportPicker-errorMsg">{{= errorMsg}}</div><div class="cb-LanguageImportPicker-errorButton"><button class="slds-button slds-button_neutral js-close">'+i.Ok+"</button></div>"),events:{"click .js-close":"_closeDialog","click .js-detail-expand-toggle":"_toggleDetailsExpand"},initialize:function(){this.render()},render:function(){var e={filePickerClass:"cb-LanguageXmlPicker-section cb-LanguageXmlPicker-section--full",filePickerSectionClass:"cb-LanguageXmlPicker-sectionUpperDiv",dragHereText:zg.DragXMLFile,selectFileText:zg.SelectXMLFile,uploadUrl:"/sfsites/upload?dataUpload=on&language=true&selectedID=&unpackZip=on&converthtml=on&convertcss=on&overwritefiles=on",supportedFileExtensions:["xml"],fileFormatNotSupportedMessage:zg.FileFormatNotSupportedMessage,statusDialog:!0,uploadSuccessCallback:this._parseDataLog.bind(this),uploadErrorCallback:this._showError.bind(this)},e=(this.$el.html(this.importDialogHtml),new Jl(e));return this.listenTo(e,"upload-start",this._showProgressIndicator),this.listenTo(e,"upload-completed",this._hideProgressIndicator),this.$(".js-file-picker-content").append(e.render().$el),this},_parseDataLog:function(e){if(1===parseInt(e.ASYNC))this.$el.html(this.infoDialogTemplate({infoTitle:zg.ImportSuccessTitle,infoMsg:zg.AsyncImport}));else{for(var t=e.DATALOG.split("|"),n={},i=!1,s=1;s<t.length;s++){var a=t[s].split("::");"<INFO>"===a[0]&&"Start"===a[2]?(n[a[1]]={},n[a[1]].name=a[3]):"<WARNING>"===a[0]&&"Start"!==a[2]&&(i=!0,n[a[1]]={},n[a[1]].message=L.htmlEncode(a[3]))}var o="";if(i)for(var r in n)n.hasOwnProperty(r)&&n[r].message&&(o+=this.detailListItemTemplate({detailName:n[r].name,detailMsg:n[r].message}));this.$el.html(this.successDialogTemplate({successTitle:zg.ImportCompleteTitle,successMsg:zg.PropertiesImported.replace("{0}",t[0]),warning:i,warningMsg:zg.WarningsFound,detailList:o})),0<parseInt(t[0])&&(this.destroy=function(){window.location.reload(!0)})}},_showError:function(e){this.$el.html(this.errorDialogTemplate({errorTitle:"Errors",errorMsg:e.ERROR_MESSAGE}))},_closeDialog:function(){A.closeDialog()},_toggleDetailsExpand:function(){var e=this.$(".js-details-section"),t="slds-is-open";e.hasClass(t)?e.removeClass(t):e.addClass(t)},_showProgressIndicator:function(){this.$(".js-progress-indicator").show()},_hideProgressIndicator:function(){this.$(".js-progress-indicator").hide()}}),Yg=PicassoWebServices.Labels,qg=Backbone.View.extend({className:"cb-LanguageExport js-export-translation-content-dlg",template:_.template('<div class="cb-LanguageExport-dialogHeader"><div class="slds-text-heading_medium cb-LanguageExport-dialogTitle">{{= title}}</div></div><div class="cb-LanguageExport-selectionContainer"><div class="cb-LanguageExport-selectLinks"><a class="cb-LangaugeExport-selectAll js-select-all">'+Yg.PicassoDialog.SelectAll+'</a><a class="cb-LangaugeExport-selectNone js-select-none">'+Yg.PicassoDialog.SelectNone+'</a></div><select multiple="" class="slds-select cb-LanguageExport-languageList js-language-list" size="6""></select><div class="slds-form-element cb-LanguageExport-inputForm"><label class="slds-form-element__label" for="filename-input">'+Yg.Languages.ExportFilename+'</label><div class="slds-form-element__control cb-LanguageExport-filenameInput"><input type="text" id="filename-input" class="slds-input js-filename" maxlength="100" placeholder="'+Yg.OverviewTab.Languages+'"><span class="cb-LanguageExport-filenameExtension">.xml</span></div></div></div><div class="cb-LanguageExport-buttonBar"><button class="slds-button slds-button_neutral js-language-export-cancel">'+Yg.Languages.Cancel+'</button><button class="slds-button slds-button_brand cb-LanguageExport-saveButton js-language-export-save">'+Yg.Languages.Export+"</button></div>"),templateLanguageItem:_.template('<option class="cb-LanguageExport-languageItem js-language-item" value="{{- ComponentID }}" {{ if (LanguageCountryCode) { }}data-lang-code={{- LanguageCode }}_{{- LanguageCountryCode }} data-lang-value={{- ComponentID }}>{{- LanguageLabel }}</option>{{ } else { }}data-lang-code={{- LanguageCode }} data-lang-value={{- ComponentID }}>{{- LanguageLabel }}</option>{{ } }}'),events:{"click .js-select-all":"_selectAll","click .js-select-none":"_unselectAll","click .js-language-item":"_validate","keyup .js-filename":"_validate","click .js-language-export-cancel":"_cancel","click .js-language-export-save":"_export"},initialize:function(){this.render()},render:function(){var e=this.templateLanguageItem(g.getBaseLanguage())+this.templateLanguageItems(g.getSiteLanguages());return this.$el.html(this.template({title:Yg.Languages.ExportLanguageContent})),this.$(".js-language-list").append(e),this.$(".js-language-item:first-of-type").prop("selected",!0),this},templateLanguageItems:function(e){var t=this,n="";return e.forEach(function(e){n+=t.templateLanguageItem(e)}),n},_selectAll:function(){this.$(".js-language-item").prop("selected",!0),this.$(".js-language-list").focus(),this._validate()},_unselectAll:function(){this.$(".js-language-item").prop("selected",!1),this._validate()},_validate:function(){0<this.$(".js-language-item:selected").length?this.$(".js-language-export-save").prop("disabled",!1):this.$(".js-language-export-save").prop("disabled",!0)},_cancel:function(){A.closeDialog()},_export:function(){var e=this.$(".js-filename").val().trim(),t=(e.length<=0&&(e="languages"),this.$el.find("option:selected"));if(0!==t.length){for(var n="",i=0;i<t.length;++i)0<i&&(n+=","),n+=T(t.get(i)).attr("data-lang-code");e="/sfsites/download?sid="+I.getAppState().getCurrentSite().get("uddid")+"&sguid="+I.getAppState().getCurrentSite().get("guid")+"&exportLanguages="+n+"&fn="+e;window.open(e,"Export"),A.closeDialog()}}}),e=PicassoWebServices.Labels,Xg=e.Languages,Jg=PicassoWebServices.Labels.CommBuilderSecurityCSPSettings,Qg=(e.CommBuilderSettings,"googleTranslateAPIKey"),Zg="slds-no-row-hover cb-SettingsLanguage-langDetailEditorTable js-lang-table",eh={selectLanguage:Xg.BuilderSelectedLanguages,languageMetaData:Xg.LanguageSettings},th={selectLanguage:"slds-size_1-of-2",languageMetadata:"slds-size_1-of-2"},nh={selectLanguage:"cb-SettingsLanguage-languagePillContainer js-language-pill-container",languageMetadata:"cb-SettingsLanguage-languageMetadataContainer js-language-metadata-container"},ih={selectLanguage:"cb-SettingsLanguage-languagePillCell js-language-pill-cell"},sh=Backbone.View.extend({className:"cb-Settings-section cb-Settings-languageSection js-settings-language-section",template:_.template('<h2 class="cb-Settings-sectionHeading">'+e.OverviewTab.Languages+'</h2><div class="cb-Settings-sectionDescription"><span>{{= langOverviewText }}</span></div><div class="cb-SettingsLanguage-defaultLanguage cb-Settings-propertyGroup"><label class="cb-SettingsLanguage-defaultLanguageLabel cb-Settings-propertyLabel" for="selectLanguage">'+Xg.BuilderBaseLanguage+'</label><div class="cb-SettingsLanguage-defaultLanguageContainer"><select class="cb-SettingsLanguage-languageSelect js-available-languages" id="selectLanguage">{{= availableLanguages }}</select><a class="cb-SettingsLanguage-baseLanguageEditLink js-edit-base-language">'+Xg.ChangeLabel+"</a></div></div>{{= addLanguages }}{{= languagesTable }}{{= googleTranslateAPIKeyHtml }}"),addLanguagesTemplate:_.template('<div class="cb-SettingsLanguage-buttons">{{= $P.viewTypes.CommonTemplates.buttonWithIcon({ buttonClassName: "cb-SettingsLanguage-addLanguageButton js-add-languages", buttonVariantClassName: "slds-button_brand", label: "'+Xg.AddLanguage+'", icon: "add", svgClassName: "cb-SettingsLanguage-addIcon" }) }}<div class="cb-SettingsLanguage-secondaryButtons">{{= $P.viewTypes.CommonTemplates.button({ buttonClassName: "cb-SettingsLanguage-importTranslationButton js-import-translated-content", buttonVariantClassName: "slds-button_neutral slds-truncate", label: "'+e.Languages.ImportTranslation+'"}) }}{{= $P.viewTypes.CommonTemplates.button({ buttonClassName: "cb-SettingsLanguage-exportContentButton js-export-translated-content", buttonVariantClassName: "slds-button_neutral slds-truncate", label: "'+e.Languages.ExportContent+'"}) }}</div></div>'),availLangTemplate:_.template('<option class="js-language-option" value="{{= LanguageFullCode }}">{{= LanguageLabel }}</option>'),selectedAvailLangTemplate:_.template('<option class="js-language-option" value="{{= LanguageFullCode }}" selected="true">{{- LanguageLabel }}</option>'),noLanguagesHtml:'<article class="slds-card cb-SettingsLanguage-languageCard js-empty-site-languages"><div class="cb-SettingsLanguage-languageCardBody slds-card__body">'+e.Languages.BuilderNoLanguages+"</div></article>",siteLanguagesTemplate:_.template('<ul class="cb-SettingsLanguage-dragDropLanguageList js-dnd-languages">{{ data.forEach(function(element, index){ }}<li class="js-dnd-language" data-lang-id="{{= element.ComponentID }}" data-language-label="{{- element.LanguageLabel }}"><div class="slds-pill slds-pill_link cb-SettingsLanguage-languagePill js-language-pill {{= index === 0 ? "selected": "" }}" title="{{- element.LanguageLabel }}"><span class="slds-pill--icon_container">{{= $P.viewTypes.CommonTemplates.icon({ icon: "rows", svgClassName: "slds-icon_x-small cb-SettingsLanguage-dragHandle js-language-pill-drag-handle" }) }}</span><span class="slds-pill--label cb-SettingsLanguage-pillLabel js-pill-label">{{- element.LanguageLabel }}</span><span class="cb-SettingsLanguage-pillActions js-language-pill-actions">{{= $P.viewTypes.CommonTemplates.buttonIcon({ icon: "delete", buttonClassName: "cb-SettingsLanguage-pillCloseButton js-language-pill-remove", label:"'+e.Languages.RemoveLanguage+'" }) }}</span></div></li>{{ }) }}</ul>'),languageMetadataEditorTemplate:_.template('<div class="cb-SettingsLanguage-languageMetadataEditor js-language-metadata-editor" data-lang-id="{{= id }}"><div class="cb-SettingsLanguage-languageMetadataForm"><div><label class="slds-checkbox cb-SettingsLanguage-langEditorCheckbox js-language-active-label"><input type="checkbox" class="js-language-active" {{= isChecked ? "checked" : ""}}/><span class="slds-checkbox_faux"></span><span class="cb-SettingsLanguage-langEditorCheckboxLabel">'+Xg.BuilderLanguageActive+"</span>"+Ag(_.escape(Xg.BuilderActiveOnLiveSiteInfo))+'</label></div><div><label class="slds-form-element__label js-fallback-language-label" for="fallback-selection">'+Xg.FallbackLanguage+"</label>"+Ag(Xg.FallbackLanguageInfo)+'<div class="cb-SettingsLanguage-metadataFallbackSelectContainer"><select class="js-fallback-language"><option value="" {{= metaFallbackLanguageId === "none" ? "selected" : "" }}>{{- baseLanguage.LanguageLabel }}</option>{{ fallbackData.forEach(function(element) { }}<option value="{{= element.ComponentID }}" {{= metaFallbackLanguageId === element.ComponentID ? "selected" : "" }}>{{- element.LanguageLabel }}</option>{{ }) }}</select></div></div><div class="slds-form-element js-display-label-form"><label class="slds-form-element__label" for="display-label-input">'+Xg.DisplayLabel+'</label><div><input type="text" id="display-label-input" class="slds-input js-site-language-display-label" maxLength="100" value="{{- metaDisplayLabel }}"/></div><div class="slds-form-element__help js-display-label-error"></div></div><div><label class="slds-form-element__label js-language-code" for="language-code-input">'+Xg.LanguageCode+'</label><div><input type="text" id="language-code-input" class="slds-input js-language-code-input" value="{{- metaLanguageCode}}" disabled="" /></div></div><div><label class="slds-form-element__label js-language-country-code" for="language-country-code-input">'+Xg.LanguageCountryCode+'</label><div><input type="text" id="language-country-code-input" class="slds-input js-language-country-code-input" value="{{- metaLanguageCountryCode}}" disabled="" /></div></div></div></div>'),googleTranslateAPIKeyTemplate:_.template('<div class="cb-Settings-formGroupHeader">'+Xg.TranslationButton+'</div><div class="form-group slds-m-bottom--medium slds-m-top_medium cb-Settings-propertyGroup"><p class="cb-Settings-propertyValue cb-Settings-propertyValue--button slds-p-bottom_medium">'+Xg.TranslationFeatureDescriptiveText+'</p><p class="cb-Settings-propertyValue cb-Settings-propertyValue--button">'+Xg.TranslationAPIDescription+'</p><div class="cb-SettingsLanguage-buttons"><input type="text" class="form-control cb-Settings-propertyInput cb-SettingsLanguage-googleAnalyticsTrackingIdInput js-template-ga-property-input slds-input js-api-key-input slds-m-right_medium" data-name="GoogleTranslateAPIKey" placeholder="'+e.Languages.YourAPIKey+'" value="{{- value }}">{{= $P.viewTypes.CommonTemplates.button({ buttonClassName: "cb-SettingsLanguage-addApiKeyButton js-add-api-key", buttonVariantClassName: "slds-button_brand", label: "'+Xg.SaveAPIKey+'" }) }}<img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="cb-Settings-saveIndicator js-local-save-indicator hidden" /></div></div><div class="invalid-api-message slds-hide"><svg aria-hidden="true" class="slds-icon slds-icon-text-warning slds-icon_x-small slds-m-right--small"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#warning"></use></svg><p class="slds-text-color--error">'+Xg.InvalidAPIKey+"</p></div>"),events:{"click .js-import-translated-content":"_importLanguageContent","click .js-export-translated-content":"_exportLanguageContent","click .js-edit-base-language":"_editBaseLanguage","change .js-available-languages":"_selectBaseLanguage","click .js-add-languages":"_upsertLanguages","click .js-language-pill-remove":"_removeLanguagePill","click .js-dnd-language:not(.selected)":"_showSiteLanguageMetadata","click .js-language-active":"_toggleSiteLanguageActivation","change .js-fallback-language":"_selectFallbackLanguage","blur .js-site-language-display-label":"_updateSiteLanguageDisplayLabel","keyup .js-site-language-display-label":"_onKeyUpLabelValidation","click .js-add-api-key":"_validateAPIKey"},initialize:function(){this.listenTo(I.event,"state:base-language-label-updated",this._handleBaseLanguageLabelUpdate),this.listenTo(I.event,"state:base-language-updated",this._handleBaseLanguageUpdate),this.listenTo(I.event,"state:site-language-removed",this._handleSiteLanguageRemoval),this.listenTo(I.event,"state:site-language-display-label-updated",this._handleSiteLanguageLabelUpdate),this.listenTo(I.event,"state:site-languages-upserted",this._handleSiteLanguageUpsert),this.listenTo(I.event,"state:csp-security-level-updated",this.render),this.render()},render:function(){var r=this;return g.getAvailableLanguagesPromise().done(function(e){var t=g.getBaseLanguage(),n=g.getSiteLanguages(),e=_.map(e,function(e){return t.LanguageFullCode===e.LanguageFullCode?r.selectedAvailLangTemplate(t):r.availLangTemplate(e)}).join(""),i=Xg.BuilderSingleLanguageHelpText,s="",a="",o="",n=(I.AccessControl(P.PERMISSIONS.MULTI_LANGUAGE_SETTINGS)&&(i=Xg.BuilderLanguagesHelpText,s=this.addLanguagesTemplate(),a=this.noLanguagesHtml,o=$P.isFeedsTranslationEnabled?this.googleTranslateAPIKeyTemplate({value:E.getSite().get(Qg)}):"",0<n.length)&&(a=D.dataTable({tableClassName:Zg,data:[{id:"",selectLanguage:this.siteLanguagesTemplate({data:n}),languageMetadata:this._getLangMetadataEditor(n[0],t)}],labelMap:eh,tableHeaderClassName:th,tableCellClassName:nh,tableCellContentClassName:ih,showHeader:!0})),this.$el.html(this.template({langOverviewText:i,availableLanguages:e,addLanguages:s,languagesTable:a,googleTranslateAPIKeyHtml:o})),this.sortableOptions={handle:".js-language-pill-drag-handle",update:this._updateListOrder,placeholder:"cb-SettingsLanguage-dragPlaceholder js-dnd-language",axis:"y",opacity:.5},this.$('.js-language-metadata-editor [data-toggle="tooltip"]').tooltip(),this.$(".js-dnd-languages").sortable(this.sortableOptions).disableSelection(),this.$(".js-available-languages").select2(),this.$(".js-fallback-language").select2(),this.$('[data-toggle="tooltip"]').tooltip(),this.$("div.js-fallback-language input").attr("id"));this.$(".js-fallback-language-label").attr("for",n)}.bind(this)),this},_importLanguageContent:function(){A.showDialog(new Kg,{appendLocation:"#vexContainer",showCloseButton:!0,overlayClosesOnClick:!1,contentClassName:"cb-Dialog js-dialog cb-SettingsLanguageImportDialog js-import-translation-content-dlg",className:"slds-vex-theme"})},_exportLanguageContent:function(){A.showDialog(new qg,{appendLocation:"#vexContainer",showCloseButton:!0,overlayClosesOnClick:!1,contentClassName:"cb-Dialog js-dialog cb-SettingsLanguageExportDialog",className:"slds-vex-theme"})},_editBaseLanguage:function(){A.showDialog(new Gg,{appendLocation:"#vexContainer",showCloseButton:!0,overlayClosesOnClick:!1,contentClassName:"cb-Dialog js-dialog cb-SettingsLanguageEditBaseDialog",className:"slds-vex-theme js-import-dialog-theme"})},_upsertLanguages:function(){this._previousActiveLanguage=g.getActiveLanguage();A.showDialog(new Wg,{appendLocation:"#vexContainer",showCloseButton:!0,overlayClosesOnClick:!1,contentClassName:"cb-Dialog js-dialog cb-SettingsLanguageAddDialog",className:"slds-vex-theme"})},_validateAPIKey:function(){var t,e=this.$(".js-api-key-input")[0].value,e=T.trim(e);""===e?this._addAPIKey():(t=this,T.get("https://translation.googleapis.com/language/translate/v2/languages/?q=&key="+e,function(e){T(".invalid-api-message").hide(),t._addAPIKey()}).fail(function(){T(".invalid-api-message").css("display","flex")}))},_addAPIKey:function(){var e=this.$(".js-api-key-input")[0].value,n="GoogleTranslateAPIKey",i=T.trim(e),s=this;v.checkCSPTrustedSite(Jg.GoogleTranslateDomain).then(function(e){var t=Jg.GoogleTranslateDomain;e?s._saveLocalPropertyValues(n,i):A.sldsAlert(Jg.GoogleTranslateConsentNotifBody.replace("{0}",t),Jg.GoogleTranslateConsentNotifTitle,{className:"slds-vex-theme slds-vex-theme--medium",yesText:Jg.OK,afterCloseFocusEl:document.activeElement,afterClose:function(){v.addGoogleTranslateTrustedSites(function(){s._saveLocalPropertyValues(n,i),A.closeDialog()})},a11y:!0})})},_saveLocalPropertyValues:function(e,t){var n=!1,i=!1,s=this.$(".js-local-save-indicator");s.removeClass("hidden"),setTimeout(function(){n&&s.addClass("hidden"),i=!0},1e3),this._updateSiteProperty(e,t,function(e){n=!0,i&&s.addClass("hidden"),E.getSite().set(Qg,t)})},_updateSiteProperty:function(e,t,n){PicassoWebServices.ManageSiteCommon.UpdateProperty(E.getSite().id,e,t,n)},_selectBaseLanguage:function(e){var t=this,n=this.$(".js-available-languages option:selected"),i=n.text(),s=_.find(g.getSiteLanguages(),function(e){return e.LanguageLabel===i}),a={BaseLanguageCode:n.val(),BaseLanguageLabel:i,successCallback:function(){A.closeDialog()}};s?A.sldsModal({content:Xg.BaseLanguageInUseText,title:Xg.BaseLanguageInUseHeading,callback:function(e){e?(a.successCallback=function(){I.event.trigger("action:remove-site-language",{id:s.ComponentID}),A.closeDialog()},I.event.trigger("action:update-base-language",a)):t.$(".js-available-languages").val(g.getBaseLanguage().LanguageFullCode).trigger("change.select2")}}):I.event.trigger("action:update-base-language",a)},_updateListOrder:function(e,t){var n=T(t.item),t=T(t.item).next();I.event.trigger("action:move-site-language",{itemId:n.attr("data-lang-id"),insertBeforeId:0<t.length?t.attr("data-lang-id"):null,errorCallback:function(){A.sldsPromptAlert({title:PicassoWebServices.Labels.PicassoDialog.Error,content:Xg.ReorderingError})}})},_removeLanguagePill:function(n){var i=this;this.$(".js-language-pill-remove").prop("disabled",!0),A.sldsModal({content:Xg.DeleteConfirmationText,title:Xg.DeleteConfirmationTitle,callback:function(e){var t;e&&(e=T(n.currentTarget).attr("data-lang-id"),t=g.getActiveLanguage().ComponentID===e?function(){I.event.trigger("action:set-active-language",{id:""})}:void 0,I.event.trigger("action:remove-site-language",{id:e,successCallback:t,errorCallback:function(){A.sldsPromptAlert({title:PicassoWebServices.Labels.PicassoDialog.Error,content:Xg.DeleteLanguageFailedText})}})),i.$(".js-language-pill-remove").prop("disabled",!1)},yesTextClassName:"slds-button_destructive"})},_showSiteLanguageMetadata:function(e){var e=T(e.currentTarget),t=e.attr("data-lang-id"),n=g.getSiteLanguages(),n=_.find(n,function(e){return e.ComponentID===t});this._refreshMetadataEditor(n,g.getBaseLanguage()),this.$(".js-language-pill.selected").removeClass("selected"),e.find(".js-language-pill").addClass("selected")},_toggleSiteLanguageActivation:function(e){this._updateSiteLangMetadata({LanguageActive:T(e.currentTarget).prop("checked")})},_selectFallbackLanguage:function(){this._updateSiteLangMetadata({FallbackLanguageID:this.$(".js-fallback-language option:selected").val()})},_isLanguageLabelDuplicate:function(e,t,n,i){for(var s=g.getSiteLanguages(),a=0;a<s.length;a++)if(s[a].LanguageLabel===e&&s[a].ComponentID!==t)return!0;for(var o=g.getAvailableLanguages(),r=0;r<o.length;r++){var l=o[r];if(l.LanguageLabel===e&&l.LanguageCode!==n&&l.LanguageCountryCode!==i)return!0}return!1},_updateSiteLanguageDisplayLabel:function(){var e,t=this.$(".js-site-language-display-label").val().trim();0<this.$(".js-display-label-error").text().length||t.length<=0?(this.$(".js-display-label-form").removeClass("slds-has-error"),this.$(".js-display-label-error").empty(),(e=this.$(".js-site-language-display-label")).val(e.prop("defaultValue"))):(this.$(".js-display-label-form").removeClass("slds-has-error"),this.$(".js-display-label-error").empty(),this._updateSiteLangMetadata({LanguageLabel:_.escape(t)}))},_onKeyUpLabelValidation:function(){var e=this.$(".js-language-metadata-editor").attr("data-lang-id"),t=this.$(".js-language-code-input").val(),n=this.$(".js-language-country-code-input").val(),i=this.$(".js-site-language-display-label").val().trim();this._isLanguageLabelDuplicate(i,e,t,n)?(this.$(".js-display-label-form").addClass("slds-has-error"),this.$(".js-display-label-error").text(Xg.LanguageDisplayNameNotUnique)):(this.$(".js-display-label-form").removeClass("slds-has-error"),this.$(".js-display-label-error").empty())},_getLangMetadataEditor:function(t,e){var n=g.getActiveSiteLanguages(),i=n.slice();i.splice(n.indexOf(t),1);n=_.find(n,function(e){return e.ComponentID===t.FallbackLanguageID})?t.FallbackLanguageID:"none";return this.languageMetadataEditorTemplate({id:t.ComponentID,isChecked:t.LanguageActive,metaDisplayLabel:t.LanguageLabel,metaLanguageCode:t.LanguageCode,metaLanguageCountryCode:t.LanguageCountryCode,baseLanguage:e,fallbackData:i,metaFallbackLanguageId:n})},_updateSiteLangMetadata:function(e,t){var n=this.$(".js-language-metadata-editor").attr("data-lang-id");I.event.trigger("action:update-site-language-metadata",n,e,t)},_handleBaseLanguageLabelUpdate:function(e){this.$('.js-language-option[value="'+g.getBaseLanguage().LanguageFullCode+'"]').text(e),this.$(".js-available-languages").trigger("change.select2"),this.$('.js-fallback-language option[value=""]').text(e).trigger("change.select2")},_handleBaseLanguageUpdate:function(e){this.$('.js-fallback-language option[value=""]').text(e).trigger("change.select2")},_handleSiteLanguageRemoval:function(e){var t,n=g.getSiteLanguages();0===n.length?((t=this.$(".js-lang-table")).after(this.noLanguagesHtml),this._cleanUpMetadataEditor(),t.remove()):0<n.length&&(this.$('.js-dnd-language[data-lang-id="'+e+'"]').remove(),this.$(".js-language-metadata-editor").attr("data-lang-id")===e)&&(this._refreshMetadataEditor(n[0],g.getBaseLanguage()),this.$('.js-dnd-language[data-lang-id="'+n[0].ComponentID+'"] .js-language-pill').addClass("selected"))},_handleSiteLanguageLabelUpdate:function(e){this.$('.js-dnd-language[data-lang-id="'+e.id+'"] .js-pill-label').text(e.newLabel),this.$('.js-fallback-language option[value="'+e.id+'"]').text(e.newLabel).trigger("change.select2")},_handleSiteLanguageUpsert:function(){var e,t=g.getSiteLanguages(),n=this.$(".js-lang-table"),i=g.getBaseLanguage();0===n.length&&0<t.length?((e=this.$(".js-empty-site-languages")).after(D.dataTable({tableClassName:Zg,data:[{id:"",selectLanguage:this.siteLanguagesTemplate({data:t}),languageMetadata:this._getLangMetadataEditor(t[0],i)}],labelMap:eh,tableHeaderClassName:th,tableCellClassName:nh,tableCellContentClassName:ih,showHeader:!0})),e.remove(),this.$(".js-dnd-languages").sortable(this.sortableOptions).disableSelection(),this._initMetadataEditor()):1===n.length&&0===t.length?(this.$(".js-dnd-languages").sortable("destroy"),this._cleanUpMetadataEditor(),n.after(this.noLanguagesHtml),n.remove()):0<n.length&&0<t.length&&(this.$(".js-dnd-languages").sortable("destroy"),this.$(".js-language-pill-cell").empty().html(this.siteLanguagesTemplate({data:g.getSiteLanguages()})),this.$(".js-dnd-languages").sortable(this.sortableOptions).disableSelection(),this._refreshMetadataEditor(t[0],i)),this._previousActiveLanguage.ComponentID!==g.getActiveLanguage().ComponentID&&I.event.trigger("action:set-active-language",{id:""})},_initMetadataEditor:function(){this.$(".js-fallback-language").select2(),this.$('.js-language-metadata-editor [data-toggle="tooltip"]').tooltip()},_cleanUpMetadataEditor:function(){this.$(".js-fallback-language").select2("destroy"),this.$('.js-language-metadata-editor [data-toggle="tooltip"]').tooltip("destroy")},_refreshMetadataEditor:function(e,t){this._cleanUpMetadataEditor(),this.$(".js-language-metadata-container").empty().html(this._getLangMetadataEditor(e,t)),this._initMetadataEditor()}}),ah=PicassoWebServices.Labels.LanguagesLwr,mr=PicassoWebServices.Labels.PicassoDialog,oh=".".concat(D.SPINNER_CLASSNAME),rh=Backbone.View.extend({className:"cb-SiteLanguagesEditDlg test-edit-languages-dlg",template:_.template('\n        <header class="slds-modal__header">\n            <h2 class="slds-text-heading_medium test-modal-heading">'.concat(ah.EditLanguagesTitle,'</h2>\n        </header>\n        <div class="slds-p-around_x-large">\n            <div class="cb-SiteLanguagesEditDlg-description test-modal-description">\n                {{= helpText }}\n            </div>\n            <div class="cb-SiteLanguagesEditDlg-dualPicklist js-language-dual-picklist"></div>\n            {{ if (enableLanguagesHelpText) { }}\n                <div class="cb-SiteLanguagesEditDlg-enableLanguagesDescription test-modal-enable-languages-description">\n                    {{= enableLanguagesHelpText }}\n                </div>\n            {{ } }}\n        </div>\n        <footer class="slds-modal__footer">\n            <button class="slds-button slds-button_neutral js-edit-languages-cancel">').concat(mr.Cancel,'</button>\n            <button class="slds-button slds-button_brand js-edit-languages-save">').concat(mr.Save,"</button>\n        </footer>\n        ").concat(D.spinner).trim()),events:{"click .js-edit-languages-save":"_saveSiteLanguages","click .js-edit-languages-cancel":"_cancel"},render:function(){var e=ah.EditLanguagesHelpText.replace("{0}",E.getSite().getMaxNumSiteLanguages()),t=$P.app.state.getCurrentSite().get("isInCmsStore")?ah.EditLanguagesEnableLanguageHelpText:"";return this.$el.html(this.template({helpText:e,enableLanguagesHelpText:t})),this.dualPicklistData=this._constructDualPicklistData(),this._renderDualPicklist(this.dualPicklistData),this._addListeners(),this.$(oh).hide(),this},destroy:function(){this._removeListeners()},_constructDualPicklistData:function(){var n=Q(g.getAvailableLanguages()),e=g.getSiteLanguages(),i=g.getBaseLanguage(),s=i.LanguageFullCode,a={options:[],value:[],requiredOptions:[s]},o=(a.value.push(s),{});return e.forEach(function(e){var t=g.getSiteLanguageFullCode(e);a.value.push(t),o[t]=e,g.isLanguageEnabled(t)||(e.LanguageFullCode=t,n.push(e))}),g.isLanguageEnabled(s)||n.push(i),this.languageFullCodeToLanguageInfo={},n.forEach(function(e){var t=e.LanguageLabel,n=e.LanguageFullCode;n===s?t="".concat(i.LanguageLabel," - ").concat(ah.Default):o[n]&&(t=o[n].LanguageLabel),a.options.push({label:t,value:n}),this.languageFullCodeToLanguageInfo[n]=e}.bind(this)),a},_renderDualPicklist:function(e){var t=e.options,n=e.value,i=e.requiredOptions,s=ah.MaximumSiteLanguagesError.replace("{0}",E.getSite().getMaxNumSiteLanguages());$P.auraRun(function(){$A.createComponent("lightning:dualListbox",{label:ah.SelectLanguagesHelpText,sourceLabel:ah.AvailableLanguages,selectedLabel:ah.SiteLanguages,options:t,requiredOptions:i,value:n,max:E.getSite().getMaxNumSiteLanguages(),messageWhenRangeOverflow:s,variant:"label-hidden",disableReordering:!0},function(e){e&&($A.render(e,this.$(".js-language-dual-picklist")[0]),$A.afterRender(e))}.bind(this))}.bind(this))},_addListeners:function(){this.selectedSiteLanguages=null,this.$(".js-language-dual-picklist").on("change",this._handleSiteLanguagesChanged.bind(this))},_removeListeners:function(){this.$el.off()},_handleSiteLanguagesChanged:function(e){this.selectedSiteLanguages=e.target.value},_cancel:function(){A.closeDialog()},_saveSiteLanguages:function(){var t,e=this;this.$(oh).show(),A.hideCloseButton(),this.selectedSiteLanguages?(t=[],this.selectedSiteLanguages.shift(),this.selectedSiteLanguages.forEach(function(e){var e=this.languageFullCodeToLanguageInfo[e];e&&(e={Name:e.Name,LanguageLabel:e.LanguageLabel,LanguageCode:e.LanguageCode,LanguageCountryCode:e.LanguageCountryCode,LanguageActive:!0},t.push(e))}.bind(this)),this._upsertSiteLanguagesSuccessCallback=function(){A.closeDialog(),e._showSaveSiteLanguagesSuccessToast()}.bind(this),I.event.trigger("action:upsert-site-languages",{languages:t,successCallback:this._upsertSiteLanguagesSuccessCallback})):A.closeDialog()},_showSaveSiteLanguagesSuccessToast:function(){w.success({message:ah.SaveSiteLanguagesSuccessText,duration:5e3})}}),lh=PicassoWebServices.Labels.LanguagesLwr,ch=PicassoWebServices.Labels.PicassoDialog,dh=".".concat(D.SPINNER_CLASSNAME),uh=Backbone.View.extend({className:"cb-SiteLanguageActionMenu js-language-action-menu",_languageActionMenuTemplate:function(e){return'<ul class="slds-dropdown__list cb-SiteLanguageActionMenu-list" role="menu" aria-label="'.concat(lh.ShowMore,'">\n                ').concat(e.map(function(e){return'<li role="presentation" class="'.concat(_.isEmpty(e.locator)?"":e.locator," cb-SiteLanguageActionMenu-menuItem js-language-action-menu-item slds-dropdown__item ").concat("true"===e.disabled?"disabled":"",'" \n                                data-value="').concat(e.key,'">\n                        <a class="cb-SiteLanguageActionMenu-menuItemLink js-language-action-menu-link" href="javascript:void(0);" ').concat("true"===e.disabled?"aria-disabled=".concat(e.disabled," disabled"):"",'>\n                            <span role="menuitem" class="cb-SiteLanguageActionMenu-menuItemLinkContent slds-truncate">\n                                ').concat(e.label,"\n                            </span>\n                        </a>\n                    </li>")}).join(""),"\n            </ul>").trim()},_setAsDefaultLanguageConfirmationTemplate:function(e){return'<div class="cb-SetAsDefaultLanguageDlg-warning">\n                '.concat(D.iconWithAlt({svgClassName:"cb-SetAsDefaultLanguageDlg-warningIcon slds-icon_small slds-icon-text-default",icon:"warning",label:"".concat(ch.Warning)}),'\n                <span class="cb-SetAsDefaultLanguageDlg-warningText">').concat(lh.ChangeDefaultLanguageConfirmationText,'</span>\n            </div>\n            <ul class="cb-SetAsDefaultLanguageDlg-warningList">\n                <li>').concat(lh.LoseExistingTranslationsWarning,"</li>\n                <li>").concat(lh.UpdateExistingTranslationsWarning,"</li>\n                <li>").concat(lh.LoseExistingDefaultLanguageTranslationsWarning,"</li>\n                ").concat(e,"\n            </ul>\n            ").concat(lh.ChangeDefaultLanguageConfirmationHelpLink).trim()},_loseExistingDefaultLanguageWarningHtml:"<li>".concat(lh.LoseExistingDefaultLanguageWarning,"</li>"),events:{"click .js-language-action-menu-item:not(.disabled)":"_onClickMenuItem"},initialize:function(e){var t=this;this.languageId=e.languageId,this.languageLabel=e.languageLabel,this.languageDisabled=e.languageDisabled,this._menuItemsConfig=[{locator:"js-set-as-default-language",key:"SetAsDefaultLanguage",label:lh.SetAsDefaultLanguage,disabled:this.languageDisabled,action:function(){t._onSetAsDefaultLanguage()}},{locator:"js-delete-language",key:"DeleteLanguage",label:lh.DeleteLanguage,disabled:!1,action:function(){t._onDeleteLanguage()}}],this.render()},render:function(){return this.$el.html(this._languageActionMenuTemplate(this._menuItemsConfig)),this},_onDeleteLanguage:function(){var t=this;A.sldsPromptConfirm({title:lh.DeleteConfirmationTitle,headerClass:"cb-Dialog_header--error",content:lh.DeleteConfirmationText,contentClassName:"cb-DeleteLanguageDlg",yesText:ch.Delete,yesTextClassName:"slds-button slds-button_destructive",onSubmit:function(e){e.preventDefault(),t._deleteLanguage()}.bind(this)}),this._initializeSpinner(".cb-DeleteLanguageDlg"),this.trigger("closeLanguageActionMenu")},_deleteLanguage:function(){$(dh).show();var e=g.getActiveLanguage().ComponentID;this._removeSiteLanguage({id:this.languageId,successCallback:this._resetActiveLanguage.bind(this,e),errorCallback:this._showDeleteLanguageError.bind(this)})},_resetActiveLanguage:function(e){this._closeDialog(),e===this.languageId&&I.event.trigger("action:set-active-language",{id:P.LANGUAGES.BASE_LANG_ID,shouldReopenSettingsPanelAfterIframeReloads:!0})},_showDeleteLanguageError:function(){A.sldsPromptAlert({title:lh.FailurePromptTitle,content:lh.DeleteLanguageFailureText,yesText:ch.GotIt})},_onSetAsDefaultLanguage:function(){var e=g.getSiteLanguageById(this.languageId);this._showChangeDefaultLanguageDialog(e)},_showChangeDefaultLanguageDialog:function(t){var n=this;A.sldsPromptConfirm({title:lh.ChangeDefaultLanguageConfirmationTitle,content:this._getChangeDefaultLanguageDialogContent({newDefaultLanguageLabel:t.LanguageLabel}),contentClassName:"cb-SetAsDefaultLanguageDlg",yesText:ch.Change,onSubmit:function(e){e.preventDefault(),n._changeDefaultLanguage(t)}.bind(this)}),this._initializeSpinner(".cb-SetAsDefaultLanguageDlg"),this.trigger("closeLanguageActionMenu")},_getChangeDefaultLanguageDialogContent:function(e){var e=e.newDefaultLanguageLabel,t=g.getBaseLanguage(),n=g.isLanguageEnabled(t.LanguageFullCode)?"":this._loseExistingDefaultLanguageWarningHtml;return this._setAsDefaultLanguageConfirmationTemplate(n).replaceAll("{0}",e).replaceAll("{1}",t.LanguageLabel)},_changeDefaultLanguage:function(e){var t=this,n=($(dh).show(),""),i=function(){t._closeDialog(),t._showSetAsDefaultLanguageSuccessToast(e.LanguageLabel),I.event.trigger("action:set-active-language",{id:P.LANGUAGES.BASE_LANG_ID,shouldReopenSettingsPanelAfterIframeReloads:!0})}.bind(this,e),n=e.LanguageCountryCode?e.LanguageCode+"_"+e.LanguageCountryCode:e.LanguageCode;I.event.trigger("action:change-default-language",{newDefaultLanguageAndCountryCode:n,newDefaultLanguageLabel:e.LanguageLabel,newDefaultLanguageId:e.ComponentID,successCallback:i})},_removeSiteLanguage:function(e){var t=e.id,n=e.successCallback,e=e.errorCallback;I.event.trigger("action:remove-site-language",{id:t,successCallback:n,errorCallback:e})},_showSetAsDefaultLanguageSuccessToast:function(e){w.success({message:lh.ChangeDefaultLanguageSuccessText.replace("{0}",e),duration:5e3})},_onClickMenuItem:function(e){var t=e.currentTarget.getAttribute("data-value"),n=_.find(this._menuItemsConfig,function(e){return e.key===t});n&&n.action(e),e.stopPropagation()},_initializeSpinner:function(e){$(e).append(D.spinner),$(dh).hide()},_closeDialog:function(){A.closeDialog()}}),Np=PicassoWebServices.Labels.LanguagesLwr,xp=PicassoWebServices.Labels.PicassoDialog,ph=Backbone.View.extend({className:"cb-SiteLanguageLanguageDisabledWarning",warningPopoverHtml:'<section aria-describedby="disabled-warning-body" aria-labelledby="disabled-warning-heading" role="dialog">\n            '.concat(D.buttonIcon({buttonClassName:"slds-float_right slds-popover__close js-close-dialog",svgClassName:"slds-button__icon_medium",icon:"close",label:"".concat(xp.Close)}),'\n            \n            <div class="slds-popover__body" id="disabled-warning-body">\n                <div class="slds-media">\n                    <div class="slds-media__body">\n                        <header class="slds-popover__header">\n                            <h2 class="slds-text-heading_small" id="disabled-warning-heading">').concat(Np.DisabledLanguageHeadingText,"</h2>\n                        </header>\n                        <p>").concat(Np.DisabledLanguageBodyText,"</p>\n                    </div>\n                </div>\n            </div>\n        </section>"),events:{"click .js-close-dialog":"_onCloseDialog"},initialize:function(){this.render()},render:function(){return this.$el.html(this.warningPopoverHtml),this},_onCloseDialog:function(){this.trigger("closeLanguageDisabledWarning")}}),gh=PicassoWebServices.Labels.LanguagesLwr,hh=Backbone.View.extend({className:"cb-SiteLanguageMetadataEditor-container",template:_.template('<div class="cb-SiteLanguageMetadataEditor js-language-metadata-editor" data-lang-id="{{= id }}">\n            <div class="cb-SiteLanguageMetadataEditor-form">\n                {{ if (isSiteLanguage) { }}\n                    <div class="slds-form-element">\n                        <label class="slds-checkbox cb-SiteLanguageMetadataEditor-checkbox js-language-active-label">\n                            <input type="checkbox" class="js-language-active" {{= isLanguageActive ? "checked" : "" }} />\n                            <span class="slds-checkbox_faux"></span>\n                            <span class="cb-SiteLanguageMetadataEditor-checkboxLabel">'.concat(gh.LanguageActive,"</span>\n                            ").concat(kg(gh.LanguageActiveInfo),'\n                        </label>\n                    </div>\n                    <div class="slds-form-element">\n                        <label class="slds-form-element__label js-fallback-language" for="fallback-selection">').concat(gh.FallbackLanguage,'</label>\n                        <div class="slds-form-element__icon">').concat(kg(gh.FallbackLanguageInfo),'</div>\n                        <div class="slds-form-element__control cb-SiteLanguageMetadataEditor-fallbackSelectContainer">\n                            <select class="js-fallback-language-input">\n                                <option value="{{= baseLanguage.ComponentID }}" {{= fallbackLanguageId === "none" ? "selected" : "" }}>\n                                    {{- baseLanguage.LanguageLabel }}\n                                </option>\n                                {{ fallbackLanguages.forEach(function(element) { }}\n                                    <option value="{{= element.ComponentID }}" {{= fallbackLanguageId === element.ComponentID ? "selected" : "" }}>\n                                        {{- element.LanguageLabel }}\n                                    </option>\n                                {{ }) }}\n                            </select>\n                        </div>\n                    </div>\n                {{ } }}\n                <div class="slds-form-element js-language-label-form">\n                    <label class="slds-form-element__label js-language-label" for="language-label-input">').concat(gh.LanguageLabel,'</label>\n                    <div class="slds-form-element__icon">').concat(kg(gh.LanguageLabelInfo),'</div>\n                    <div class="slds-form-element__control">\n                        <input type="text" id="language-label-input" class="slds-input js-language-label-input" maxLength="100" value="{{- languageLabel }}" />\n                    </div>\n                    <div class="slds-form-element__help js-language-label-error"></div>\n                </div>\n                <div class="slds-form-element">\n                    <label class="slds-form-element__label js-language-code" for="language-code-input">').concat(gh.LanguageCode,'</label>\n                    <div class="slds-form-element__control">\n                        <input type="text" id="language-code-input" class="slds-input js-language-code-input" value="{{= languageCode }}" readonly />\n                    </div>\n                </div>\n                <div class="slds-form-element">\n                    <label class="slds-form-element__label js-language-country-code" for="language-country-code-input">').concat(gh.LanguageCountryCode,'</label>\n                    <div class="slds-form-element__control">\n                        <input type="text" id="language-country-code-input" class="slds-input js-language-country-code-input" value="{{= languageCountryCode }}" readonly />\n                    </div>\n                </div>\n            </div>\n        </div>')),events:{"click .js-language-active":"_handleLanguageActiveToggled","keyup .js-language-label-input":"_validateLanguageLabel","blur .js-language-label-input":"_updateLanguageLabel","change .js-fallback-language-input":"_updateFallbackLanguage"},initialize:function(e){this.languageMetadata=e,this.languageId=e.id,this.languageLabel=e.languageLabel,this.isSiteLanguage=e.isSiteLanguage},render:function(){return this.$el.html(this.template(this.languageMetadata)),this._initMetadataEditor(),this},destroy:function(){this._cleanUpMetadataEditor(),this.remove()},_initMetadataEditor:function(){var e;this.$(".js-fallback-language-input").select2(),this.$('.js-language-metadata-editor [data-toggle="tooltip"]').tooltip(),0<this.$(".js-fallback-language-input").length&&(e=this.$("div.js-fallback-language-input input").attr("id"),this.$(".js-fallback-language").attr("for",e))},_cleanUpMetadataEditor:function(){this.$(".js-fallback-language-input").select2("destroy"),this.$('.js-language-metadata-editor [data-toggle="tooltip"]').tooltip("destroy")},_handleLanguageActiveToggled:function(e){e=T(e.currentTarget).prop("checked");e?this._updateLanguageActive(e):this._deactivateLanguage()},_deactivateLanguage:function(){var e,t=T(".js-language-active");this._isUsedAsFallbackLanguage(this.languageId)?(e=gh.DeactivateLanguageActiveConfirmationText.replaceAll("{0}",this.languageLabel),A.sldsPromptConfirm({title:gh.DeactivateLanguageActiveConfirmationTitle,headerClass:"cb-Dialog_header--error",content:e,contentClassName:"cb-DeactivateLanguageDlg",yesText:gh.Deactivate,yesTextClassName:"slds-button slds-button_destructive",afterCloseFocusEl:t,callback:function(e){e?this._updateLanguageActive(!1):t.prop("checked",!0)}.bind(this)})):this._updateLanguageActive(!1)},_isUsedAsFallbackLanguage:function(t){return g.getSiteLanguages().some(function(e){return e.FallbackLanguageID===t})},_updateLanguageActive:function(e){I.event.trigger("action:set-site-language-active-metadata",this.languageId,{isLanguageActive:e})},_updateFallbackLanguage:function(){this._updateSiteLanguageMetadata({FallbackLanguageID:this.$(".js-fallback-language-input option:selected").val()})},_updateDefaultLanguageLabel:function(e){I.event.trigger("action:update-base-language-label",{BaseLanguageLabel:e,successCallback:function(){A.closeDialog()}})},_updateLanguageLabel:function(){var e,t=this.$(".js-language-label-input").val().trim();0<this.$(".js-language-label-error").text().length||t.length<=0?(this.$(".js-language-label-form").removeClass("slds-has-error"),this.$(".js-language-label-error").empty(),(e=this.$(".js-language-label-input")).val(e.prop("defaultValue"))):(this.$(".js-language-label-form").removeClass("slds-has-error"),this.$(".js-language-label-error").empty(),this.isSiteLanguage?this._updateSiteLanguageMetadata({LanguageLabel:t}):this._updateDefaultLanguageLabel(t))},_validateLanguageLabel:function(){var e=this.$(".js-language-label-input").val().trim();this._isDuplicateLanguageLabel(e,this.languageId)?(this.$(".js-language-label-form").addClass("slds-has-error"),this.$(".js-language-label-error").text(gh.LanguageLabelNotUnique)):(this.$(".js-language-label-form").removeClass("slds-has-error"),this.$(".js-language-label-error").empty())},_isDuplicateLanguageLabel:function(t,e){var n=""!=e?g.getSiteLanguageFullCode(g.getSiteLanguageById(e)):g.getBaseLanguage().LanguageFullCode;return[].concat(Q(g.getSiteLanguages()),Q(g.getAvailableLanguages())).some(function(e){return e.LanguageLabel===t&&!(n===g.getSiteLanguageFullCode(e))})},_handleBaseLanguageLabelUpdated:function(e){this._refreshDefaultLanguage(e),this.$('.js-fallback-language-input option[value=""]').text(e).trigger("change.select2")},_updateSiteLanguageMetadata:function(e,t){I.event.trigger("action:update-site-language-metadata",this.languageId,e,t)}}),mh=PicassoWebServices.Labels.LanguagesLwr,vh=P.LANGUAGES.BASE_LANG_ID,bh=P.LANGUAGES.DEFAULT_FALLBACK_LANGUAGE_ID_VALUE,fh={CLASS_NAMES:"cb-SiteLanguagesEditor slds-no-row-hover slds-table_header-hidden",HEADER_CLASS_NAMES:{selectLanguage:"slds-size_1-of-2",languageMetadata:"slds-size_1-of-2"},CELL_CLASS_NAMES:{selectLanguage:"cb-SiteLanguagesEditor-languagesContainer js-languages-container",languageMetadata:"cb-SiteLanguagesEditor-languageMetadataContainer js-language-metadata-container"},CONTENT_CLASS_NAMES:{selectLanguage:"cb-SiteLanguagesEditor-languagePills js-language-pills"},COLUMN_LABELS:{selectLanguage:mh.SiteLanguages,languageMetadata:mh.LanguageSettings}},_h=Backbone.View.extend({className:"cb-SiteLanguagesEditor-container",siteLanguagesTableTemplate:_.template('{{= defaultLanguageTemplate }}\n        <ul class="cb-SiteLanguagesEditor-dragDropLanguageList js-site-languages">\n            {{ data.forEach(function(element, index){ }}\n                <li class="js-site-language" data-lang-id="{{= element.ComponentID }}" data-lang-label="{{- element.LanguageLabel }}" data-lang-disabled="{{= element.IsDisabled}}">\n                    <div class="slds-pill slds-pill_link cb-SiteLanguagesEditor-languagePill js-language-pill" title="{{- element.LanguageLabel }}">\n                        <span class="slds-pill--icon_container">\n                            '.concat(D.icon({icon:"rows",svgClassName:"slds-icon_x-small cb-SiteLanguagesEditor-dragHandle js-language-pill-drag-handle"}),'\n                        </span>\n                        <span class="slds-pill--label cb-SiteLanguagesEditor-languagePillLabel js-language-pill-label">{{- element.LanguageLabel }}</span>\n                        {{ if (element.IsDisabled) { }}\n                        <span class="cb-SiteLanguagesEditor-warning">\n                            {{= warningTrigger }}\n                        </span>\n                        {{ } }}\n                        <span class="slds-dropdown-trigger slds-dropdown-trigger_click slds-is-open">\n                            {{= actionMenuTrigger }}\n                        </span>\n                    </div>\n                </li>\n            {{ }) }}\n        </ul>')),defaultLanguageTemplate:_.template('<div class="cb-SiteLanguagesEditor-defaultLanguage slds-current-color js-default-language" data-lang-id="{{= defaultLanguageId }}" data-lang-label="{{- defaultLanguageLabel }}">\n            <div class="slds-pill slds-pill_link cb-SiteLanguagesEditor-languagePill js-language-pill selected" title="{{- defaultLanguageLabel }}">\n                <span class="slds-pill--label cb-SiteLanguagesEditor-languagePillLabel js-language-pill-label">{{- defaultLanguageLabel }}</span>\n                <span class="cb-SiteLanguagesEditor-defaultIndicator">\n                    '.concat(D.icon({svgClassName:"slds-icon_xx-small cb-SiteLanguagesEditor-defaultIcon",icon:"check"}),'\n                    <span class="cb-SiteLanguagesEditor-defaultText">').concat(mh.Default,'</span>\n                </span>\n                <span class="cb-SiteLanguagesEditor-warning">\n                    {{= warningTrigger }}\n                </span>\n            </div>\n        </div>')),actionMenuTriggerHtml:"".concat(D.buttonIcon({buttonClassName:"cb-SiteLanguagesEditor-threeDots js-language-action-menu-trigger",buttonAttributes:'data-toggle="tooltip" data-container="body" data-placement="top" aria-haspopup="true" aria-expanded="false"',svgClassName:"slds-button__icon_large cb-SiteLanguagesEditor-threeDotsIcon",icon:"threedots",label:"".concat(mh.SiteLanguageActions)})),warningTriggerHtml:"".concat(D.buttonIcon({buttonClassName:"js-language-disabled-warning-trigger",buttonAttributes:'aria-haspopup="false"',svgClassName:"cb-SiteLanguagesEditor-warningIcon slds-button__icon_large",icon:"warning",label:"".concat(mh.DisabledLanguage)})),events:{"click .js-site-language":"_handleSiteLanguageClicked","click .js-default-language":"_handleDefaultLanguageClicked"},initialize:function(){this.listenTo(I.event,"state:base-language-label-updated",this._handleBaseLanguageLabelUpdated),this.listenTo(I.event,"state:base-language-updated",this._handleBaseLanguageUpdated),this.listenTo(I.event,"state:site-language-removed",this._handleSiteLanguageRemoved),this.listenTo(I.event,"state:site-language-display-label-updated",this._handleSiteLanguageLabelUpdated),this.listenTo(I.event,"state:site-languages-upserted",this._handleSiteLanguagesUpserted),this.listenTo(I.event,"state:site-language-added",this._handleSiteLanguageAdded)},render:function(){return this.$el.html(this._renderSiteLanguagesTable()),this._renderLanguageMetadataEditor(vh),this._initSiteLanguagesTable(),this.$('[data-toggle="tooltip"]').tooltip(),this},_initSiteLanguagesTable:function(){this.sortableOptions={handle:".js-language-pill-drag-handle",update:this._reorderSiteLanguages,placeholder:"cb-SiteLanguagesEditor-dragPlaceholder js-site-language",axis:"y",opacity:.5},this.$(".js-site-languages").sortable(this.sortableOptions).disableSelection()},_cleanUpSiteLanguagesTable:function(){this.$(".js-site-languages").sortable("destroy")},_renderSiteLanguagesTable:function(){return D.dataTable({tableClassName:fh.CLASS_NAMES,data:[{id:"",selectLanguage:this._createSiteLanguagesList(),languageMetadata:""}],labelMap:fh.COLUMN_LABELS,tableHeaderClassName:fh.HEADER_CLASS_NAMES,tableCellClassName:fh.CELL_CLASS_NAMES,tableCellContentClassName:fh.CONTENT_CLASS_NAMES,showHeader:!1})},_createSiteLanguagesList:function(){var e=_.cloneDeep(g.getSiteLanguages()),t=g.getBaseLanguage(),n=t.LanguageLabel,i=t.ComponentID,t=t.LanguageFullCode;return e.forEach(function(e){var t=g.getSiteLanguageFullCode(e);g.isLanguageEnabled(t)?e.IsDisabled=!1:e.IsDisabled=!0}),0<e.length?this.siteLanguagesTableTemplate({data:e,actionMenuTrigger:this.actionMenuTriggerHtml,warningTrigger:this.warningTriggerHtml,defaultLanguageTemplate:this.defaultLanguageTemplate({defaultLanguageLabel:n,defaultLanguageId:i,warningTrigger:this._getWarningTriggerHtmlForLanguageFullCode(t)})}):this.defaultLanguageTemplate({defaultLanguageLabel:n,defaultLanguageId:i,warningTrigger:this._getWarningTriggerHtmlForLanguageFullCode(t)})},_handleSiteLanguageClicked:function(e){var t=this.$(".js-language-action-menu-trigger"),n=this.$(".js-language-disabled-warning-trigger");C.isClickedInsideEl(t,e)?this._handleLanguageActionMenuTriggered(e):C.isClickedInsideEl(n,e)?this._handleLanguageDisabledWarningTriggered(e):this._showLanguageMetadataEditor(e)},_handleDefaultLanguageClicked:function(e){var t=this.$(".js-language-disabled-warning-trigger");C.isClickedInsideEl(t,e)?this._handleLanguageDisabledWarningTriggered(e):this._showLanguageMetadataEditor(e)},_handleLanguageActionMenuTriggered:function(e){var t,e=T(e.currentTarget),n=e.attr("data-lang-id"),i=e.attr("data-lang-label"),e=e.attr("data-lang-disabled");this._popover?this._popover.destroy():(t="li[data-lang-id=".concat(n,"] .js-language-action-menu-trigger"),this._showLanguageActionMenu({languageId:n,languageLabel:i,languageDisabled:e},t))},_showLanguageActionMenu:function(e,t){var n=this.$(t),t=this._createLanguageActionMenuView(e);this._popover=Zr({view:t.$el[0],trigger:n[0],options:{className:"cb-SiteLanguageActionMenu-popover",nubbinPosition:"left-top",offsetTriggerHeight:!1,horizontalOffset:20,destroyCallback:function(){this._popover=null,n.attr("aria-expanded",!1)}.bind(this)}}),this._popover.show(),n.attr("aria-expanded",!0)},_createLanguageActionMenuView:function(e){e=new uh(e);return this.listenToOnce(e,"closeLanguageActionMenu",function(){this._popover&&this._popover.destroy()}.bind(this)),e},_handleLanguageDisabledWarningTriggered:function(e){var e=T(e.currentTarget).attr("data-lang-id");this._warningPopover?this._warningPopover.destroy():(e=e?"li[data-lang-id=".concat(e,"] .js-language-disabled-warning-trigger"):".js-default-language .js-language-disabled-warning-trigger",this._showLanguageDisabledWarning(e))},_showLanguageDisabledWarning:function(e){var t=this.$(e),e=this._createLanguageDisabledWarningView();this._warningPopover=Zr({view:e.$el[0],trigger:t[0],options:{className:"cb-SiteLanguageLanguageDisabledWarning-popover",nubbinPosition:"left-top",offsetTriggerHeight:!1,horizontalOffset:10,destroyCallback:function(){this._warningPopover=null,t.attr("aria-haspopup",!1)}.bind(this)}}),this._warningPopover.show(),t.attr("aria-haspopup",!0)},_createLanguageDisabledWarningView:function(){var e=new ph;return this.listenToOnce(e,"closeLanguageDisabledWarning",function(){this._warningPopover&&this._warningPopover.destroy()}.bind(this)),e},_reorderSiteLanguages:function(e,t){var n=T(t.item),t=T(t.item).next();I.event.trigger("action:move-site-language",{itemId:n.attr("data-lang-id"),insertBeforeId:0<t.length?t.attr("data-lang-id"):null,errorCallback:function(){A.sldsPromptAlert({title:PicassoWebServices.Labels.PicassoDialog.Error,content:mh.ReorderLanguagesFailureText})}})},_handleBaseLanguageLabelUpdated:function(e){this._refreshDefaultLanguage(e),this.$('.js-fallback-language option[value=""]').text(e).trigger("change.select2")},_handleBaseLanguageUpdated:function(){this._refreshLanguageTable()},_handleSiteLanguageRemoved:function(e){this.$('.js-site-language[data-lang-id="'.concat(e,'"]')).remove();var t=this.$(".js-language-metadata-editor").attr("data-lang-id");t===e?(this._renderLanguageMetadataEditor(vh),this.$(".js-default-language .js-language-pill").addClass("selected")):this._renderLanguageMetadataEditor(t)},_handleSiteLanguageLabelUpdated:function(e){var t=e.id,e=e.newLabel;this.$('.js-site-language[data-lang-id="'.concat(t,'"] .js-language-pill-label')).text(e),this.$('.js-fallback-language option[value="'.concat(t,'"]')).text(e).trigger("change.select2")},_handleSiteLanguagesUpserted:function(){this._refreshLanguageTable()},_handleSiteLanguageAdded:function(){this._refreshLanguageTable()},_showLanguageMetadataEditor:function(e){var e=T(e.currentTarget),t=e.attr("data-lang-id");this._renderLanguageMetadataEditor(t),this.$(".js-language-pill.selected").removeClass("selected"),e.find(".js-language-pill").addClass("selected")},_createDefaultLangMetadataEditor:function(e){return new hh({id:vh,languageLabel:e.LanguageLabel,languageCode:e.LanguageCode,languageCountryCode:e.LanguageCountryCode,baseLanguage:g.getBaseLanguage(),isSiteLanguage:!1})},_createLangMetadataEditor:function(t){var n=this,e=g.getActiveSiteLanguages(),i=e.filter(function(e){return n._isValidFallbackLanguage(t.ComponentID,e)}),e=_.find(e,function(e){return e.ComponentID===t.FallbackLanguageID})?t.FallbackLanguageID:bh;return new hh({id:t.ComponentID,isLanguageActive:t.LanguageActive,languageLabel:t.LanguageLabel,languageCode:t.LanguageCode,languageCountryCode:t.LanguageCountryCode,baseLanguage:g.getBaseLanguage(),fallbackLanguages:i,fallbackLanguageId:e,isSiteLanguage:!0})},_isValidFallbackLanguage:function(e,t){var n;return e!==t.ComponentID&&(n=!0,(t=t.FallbackLanguageID)&&t!==bh?t!==e&&this._isValidFallbackLanguage(e,g.getSiteLanguageById(t)):n)},_renderLanguageMetadataEditor:function(e){var t;this._editorView&&this._editorView.destroy(),e===vh?(t=g.getBaseLanguage(),this._editorView=this._createDefaultLangMetadataEditor(t)):(t=g.getSiteLanguageById(e),this._editorView=this._createLangMetadataEditor(t)),this.$(".js-language-metadata-container").empty().html(this._editorView.render().$el)},_refreshLanguageTable:function(){this._cleanUpSiteLanguagesTable(),this.$(".js-language-pills").empty().html(this._createSiteLanguagesList()),this.$(".js-site-languages").sortable(this.sortableOptions).disableSelection(),this._renderLanguageMetadataEditor(vh)},_refreshDefaultLanguage:function(e){var t=g.getBaseLanguage().LanguageFullCode;this.$(".js-language-pill.selected").removeClass("selected"),this.$(".js-default-language").replaceWith(this.defaultLanguageTemplate({defaultLanguageLabel:e,defaultLanguageId:P.LANGUAGES.BASE_LANG_ID,warningTrigger:this._getWarningTriggerHtmlForLanguageFullCode(t)}))},_getWarningTriggerHtmlForLanguageFullCode:function(e){return g.isLanguageEnabled(e)?"":this.warningTriggerHtml}}),Sh=PicassoWebServices.Labels.LanguagesLwr,Mp=PicassoWebServices.Labels.PicassoDialog,n=PicassoWebServices.Labels.UploadDialog.Details,Ch=Backbone.View.extend({importInProgressDialogHtml:'<header class="slds-modal__header">\n            <h2 class="slds-text-heading_medium test-modal-heading">'.concat(Sh.ImportInProgressTitle,'</h2>\n        </header>\n        <div class="cb-SiteLanguageImportStatusDlg-spinnerSection test-spinner-section">\n            ').concat(D.spinner,"\n        </div>").trim(),statusDialogTemplate:_.template('<header class="slds-modal__header cb-SiteLanguageImportStatusDlg-statusDialogHeader">\n            <h2 class="slds-text-heading_medium test-modal-heading">{{= statusTitle}}</h2>\n        </header>\n        <div class="slds-p-around_x-large cb-SiteLanguageImportStatusDlg-statusMsg test-import-status-msg">{{= statusMsg}}</div>\n        {{ if (hasDetail) { }}\n        <ul class="slds-accordion cb-SiteLanguageImportStatusDlg-detail">\n            <li class="slds-accordion__list-item">\n                <section class="slds-accordion__section js-details-section">\n                    <div class="slds-accordion__summary">\n                        <h2 class="slds-accordion__summary-heading">\n                            <button class="slds-button slds-button_reset slds-accordion__summary-action js-details-summary-toggler" aria-controls="import-details" aria-expanded="true" title="'.concat(n,'">\n                                <svg class="slds-accordion__summary-action-icon slds-button__icon slds-button__icon_left" aria-hidden="true">\n                                    <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#chevrondown"></use>\n                                </svg>\n                                <span class="slds-accordion__summary-content">').concat(n,'</span>\n                            </button>\n                        </h2>\n                    </div>\n                    <div class="slds-accordion__content" id="import-details">\n                        <ul class="cb-SiteLanguageImportStatusDlg-detailContent test-details-summary-content">{{= detailList }}</ul>\n                    </div>\n                </section>\n            </li>\n        </ul>\n        {{ } }}\n        <footer class="slds-modal__footer">\n            <button class="slds-button slds-button_neutral js-close">').concat(Mp.GotIt,"</button>\n        </footer>").trim()),detailListItemTemplate:_.template('<li class="test-detail-item">{{= message }}</li>'.trim()),events:{"click .js-close":"_closeDialog","click .js-details-summary-toggler":"_toggleDetailsExpand"},initialize:function(){this.render()},render:function(){return this.$el.html(this.importInProgressDialogHtml),this},setStatus:function(e){var t,n;"success"===e.status?(n=(t=0<e.warnings.length)?Sh.ImportStatusSuccessWarningsDescription:Sh.ImportStatusSuccessNoWarningsDescription,this.$el.html(this.statusDialogTemplate({statusTitle:Sh.ImportStatusSuccessTitle,statusMsg:n.replace("{0}",e.targetLanguage),hasDetail:t,detailList:this._getDetailList(e.warnings)})),0<e.numOfPropertiesImported&&(this.destroy=function(){window.location.reload(!0)})):"error"===e.status?this.$el.html(this.statusDialogTemplate({statusTitle:Sh.ImportStatusErrorTitle,statusMsg:Sh.ImportStatusErrorDescription,hasDetail:0<e.errors.length,detailList:this._getDetailList(e.errors)})):"uploadError"===e.status?this.$el.html(this.statusDialogTemplate({statusTitle:Sh.ImportStatusErrorTitle,statusMsg:e.error,hasDetail:!1})):"async"===e.status&&this.$el.html(this.statusDialogTemplate({statusTitle:Sh.ImportStatusAsyncTitle,statusMsg:Sh.ImportStatusAsyncDescription,hasDetail:!1}))},_getDetailList:function(e){var t=this,n="";return e.forEach(function(e){n+=t.detailListItemTemplate({message:e})}),n},_closeDialog:function(){A.closeDialog()},_toggleDetailsExpand:function(){var e=this.$(".js-details-section"),t="slds-is-open";e.hasClass(t)?e.removeClass(t):e.addClass(t)}}),yh=PicassoWebServices.Labels.LanguagesLwr,Th=Backbone.View.extend({importSectionHtml:'<h4 class="cb-SiteLanguageImport-subSectionHeader cb-Settings-formGroupSubHeader">'.concat(yh.ImportSubheader,'</h4>\n        <div class="cb-SiteLanguageImport-subSectionHeaderDescription cb-Settings-formGroupSubHeaderDescription">\n            <span>').concat(yh.ImportDescription,'</span>\n        </div>\n        <div class="cb-SiteLanguageImport-filePickerContent js-file-picker-content"></div>').trim(),initialize:function(){this.render()},render:function(){var e={variant:P.FILE_PICKER_VARIANT.SMALL,selectFileText:yh.ImportUploadFile,dragHereText:yh.ImportDragHere,uploadUrl:"/sfsites/upload?dataUpload=on&language=true&selectedID=&unpackZip=on&converthtml=on&convertcss=on&overwritefiles=on",supportedFileExtensions:["xlf"],fileFormatNotSupportedMessage:yh.ImportFileExtensionNotSupported,uploadSuccessCallback:this._handleUploadSuccess.bind(this),uploadErrorCallback:this._handleUploadError.bind(this)},e=(this.$el.html(this.importSectionHtml),new Jl(e));return this.$(".js-file-picker-content").append(e.$el),this.listenTo(e,"upload-start",this._showImportStatusDialog.bind(this)),this},_showImportStatusDialog:function(){this._importStatusDialog=new Ch,A.showDialog(this._importStatusDialog,{appendLocation:"#vexContainer",showCloseButton:!0,overlayClosesOnClick:!1,contentClassName:"cb-Dialog js-dialog cb-SettingsLanguageImportDialog js-import-translation-status-dlg",className:"slds-vex-theme"})},_handleUploadSuccess:function(e){if(1===parseInt(e.ASYNC))this._importStatusDialog.setStatus({status:"async"});else{for(var t=e.DATALOG.split("|"),e=t[0],n=[],i=[],s="",a=1;a<t.length;a++){var o=J(t[a].split("::"),3),r=o[0],l=o[1],o=o[2];"<ERROR>"===r?n.push(l):"<WARNING>"===r&&i.push(l),o&&(s=o)}0<n.length?this._importStatusDialog.setStatus({status:"error",errors:n}):this._importStatusDialog.setStatus({status:"success",numOfPropertiesImported:e,targetLanguage:s,warnings:i})}},_handleUploadError:function(e){this._importStatusDialog.setStatus({status:"uploadError",error:e.ERROR_MESSAGE})}}),Ph=PicassoWebServices.Labels.LanguagesLwr,i=PicassoWebServices.Labels.PicassoDialog,Ih=".".concat(D.SPINNER_CLASSNAME),Eh=Backbone.View.extend({className:"cb-SiteLanguagesExportDlg",_html:'\n        <header class="slds-modal__header">\n            <h2 class="slds-text-heading_medium test-modal-heading">'.concat(Ph.ExportContentTitle,'</h2>\n        </header>\n        <div class="slds-p-around_x-large cb-SiteLanguagesExportDlg-content">\n            <div class="cb-SiteLanguagesExportDlg-description test-modal-description">').concat(Ph.ExportContentHelpText,'</div>\n            <div class="cb-SiteLanguagesExportDlg-dualPicklist js-language-dual-picklist"></div>\n        </div>\n        <footer class="slds-modal__footer">\n            <button class="slds-button slds-button_neutral js-export-languages-cancel">').concat(i.Cancel,'</button>\n            <button class="slds-button slds-button_brand js-export-languages" disabled>').concat(Ph.ExportContentExportButtonText,"</button>\n        </footer>\n        ").concat(D.spinner).trim(),_cmsWarningHtml:'\n        <header class="slds-modal__header">\n            <h2 class="slds-text-heading_medium test-modal-heading">'.concat(Ph.ExportCmsWarningConfirmationTitle,'</h2>\n        </header>\n        <div class="slds-p-around_x-large cb-SiteLanguagesExportDlg-content">\n            <div class="cb-SiteLanguagesExportDlg-description test-modal-description">').concat(Ph.ExportCmsWarningConfirmationText,'</div>\n        </div>\n        <footer class="slds-modal__footer">\n            <button class="slds-button slds-button_neutral js-export-languages-cancel">').concat(i.Cancel,'</button>\n            <button class="slds-button slds-button_brand js-accept-cms-warning">').concat(Ph.ExportCmsWarningConfirmationButtonText,"</button>\n        </footer>").trim(),events:{"click .js-accept-cms-warning":"_acceptCmsWarning","click .js-export-languages":"_exportSiteLanguages","click .js-export-languages-cancel":"_closeDialog"},initialize:function(){this.showCmsWarning=!0},render:function(){return this.showCmsWarning?this.$el.html(this._cmsWarningHtml):(this.dualPicklistData=this._constructDualPicklistData(),this.$el.html(this._html),this._renderDualPicklist(this.dualPicklistData),this._addListeners(),this.$(Ih).hide()),this},destroy:function(){this._removeListeners()},_acceptCmsWarning:function(){this.showCmsWarning=!1,this.render()},_constructDualPicklistData:function(){var e=g.getSiteLanguages(),n={options:[]};return e.forEach(function(e){var t=e.LanguageLabel,e=g.getSiteLanguageFullCode(e);n.options.push({label:t,value:e})}.bind(this)),n},_renderDualPicklist:function(e){var t=e.options;$P.auraRun(function(){$A.createComponent("lightning:dualListbox",{label:"hidden label",sourceLabel:Ph.ExportContentAvailableColumnText,selectedLabel:Ph.ExportContentSelectedColumnText,options:t,variant:"label-hidden",disableReordering:!0},function(e){e&&($A.render(e,this.$(".js-language-dual-picklist")[0]),$A.afterRender(e))}.bind(this))}.bind(this))},_addListeners:function(){this.selectedSiteLanguages=null,this.$(".js-language-dual-picklist").on("change",this._handleSelectedLanguagesChanged.bind(this))},_removeListeners:function(){this.$el.off()},_handleSelectedLanguagesChanged:function(e){this.selectedSiteLanguages=e.target.value,0<this.selectedSiteLanguages.length?this.$(".js-export-languages").prop("disabled",!1):this.$(".js-export-languages").prop("disabled",!0)},_exportSiteLanguages:function(){this.$(Ih).show(),A.hideCloseButton(),this._exportSuccessCallback=this._showExportEnqueueSuccess.bind(this),this._exportErrorCallback=this._showExportEnqueueFailure.bind(this),I.event.trigger("action:export-site-translations",{languages:this.selectedSiteLanguages,successCallback:this._exportSuccessCallback,errorCallback:this._exportErrorCallback})},_closeDialog:function(){A.closeDialog()},_showExportEnqueueSuccess:function(){this._closeDialog(),A.sldsModal({title:Ph.ExportContentSuccessTitle,content:Ph.ExportContentSuccessText,isSingleButton:!0,yesText:Ph.ExportContentSuccessConfirmationButtonText})},_showExportEnqueueFailure:function(e){this._closeDialog();var t,n=Ph.ExportContentFailureText;e&&(t=Ph.ExportContentFailureDetailText.replace("{0}",e)),A.sldsPromptAlert({title:Ph.ExportContentFailureTitle,content:"".concat(n," ").concat(t),yesText:Ph.ExportContentFailureConfirmationButtonText})}}),e=PicassoWebServices.Labels.LanguagesLwr,wh=Backbone.View.extend({exportSectionTemplate:_.template('<h4 class="cb-SiteLanguageExport-subSectionHeader cb-Settings-formGroupSubHeader">'.concat(e.ExportSubheader,'</h4>\n        <div class="cb-SiteLanguageExport-subSectionHeaderDescription cb-Settings-formGroupSubHeaderDescription">\n            <span>').concat(e.ExportDescription,"</span>\n        </div>\n        <div>\n            ").concat(D.button({buttonClassName:"js-export-content",buttonVariantClassName:"slds-button_neutral slds-truncate",label:"".concat(e.ExportButtonText)}),"\n        </div>").trim()),events:{"click .js-export-content":"_showExportContentDialog"},initialize:function(){this.render()},render:function(){return this.$el.html(this.exportSectionTemplate()),this},_showExportContentDialog:function(){var e={appendLocation:"#vexContainer",showCloseButton:!0,overlayClosesOnClick:!1,contentClassName:"cb-Dialog js-dialog cb-SettingsLwrLanguageExportDialog test-export-content-dlg",className:"slds-vex-theme",afterCloseFocusEl:this.$(".js-export-content")};A.showDialog(new Eh,e)}}),mr=PicassoWebServices.Labels,Lh=mr.LanguagesLwr,Dh=Backbone.View.extend({className:"cb-Settings-section cb-Settings-languageSection js-settings-languages",template:_.template('<h2 class="cb-Settings-sectionHeading">'.concat(mr.OverviewTab.Languages,'</h2>\n        <div class="cb-Settings-sectionDescription">\n            <span class="test-section-description">{{= description }}</span>\n        </div>\n        {{= siteLanguagesSection }}\n        {{= translationsSection }}').trim()),siteLanguagesTemplate:function(e){return'<div class="test-site-languages-section">\n                '.concat(e,'\n                <div class="cb-SettingsLanguagesLwr-sectionContent">\n                    <div class="cb-SettingsLanguagesLwr-siteLanguagesTableContainer js-site-languages-editor-container"></div>\n                </div>\n            </div>').trim()},siteLanguagesHeaderHtml:'<div class="cb-SettingsLanguagesLwr-sectionHeaderContainer">\n            <div class="cb-SettingsLanguagesLwr-sectionHeader">\n                '.concat(D.icon({svgClassName:"slds-icon_x-small cb-SettingsLanguagesLwr-sectionHeaderIcon",icon:"world"}),'\n                <h3 class="cb-SettingsLanguagesLwr-sectionHeaderText">').concat(Lh.SiteLanguages,'</h3>\n            </div>\n            <div class="cb-SettingsLanguagesLwr-sectionHeaderActions">\n                ').concat(D.button({buttonClassName:"js-edit-languages",buttonVariantClassName:"slds-button_brand",label:"".concat(Lh.EditLanguages)}),"\n            </div>\n        </div>"),translationsSectionTemplate:_.template('<div class="test-translations-section">\n            <div class="cb-SettingsLanguagesLwr-sectionHeaderContainer">\n                <div class="cb-SettingsLanguagesLwr-sectionHeader">\n                    '.concat(D.icon({svgClassName:"slds-icon_x-small cb-SettingsLanguagesLwr-sectionHeaderIcon cb-SettingsLanguagesLwr-translationsIcon",icon:"text_template"}),'\n                    <h3 class="cb-SettingsLanguagesLwr-sectionHeaderText">').concat(Lh.Translations,'</h3>\n                </div>\n            </div>\n            <div class="cb-SettingsLanguagesLwr-sectionContent">\n                <div class="cb-SettingsLanguagesLwr-subSection js-site-language-export-container"></div>\n                <div class="cb-SettingsLanguagesLwr-subSection js-site-language-import-container"></div>\n            </div>\n        </div>').trim()),events:{"click .js-edit-languages":"_showEditLanguagesDialog"},initialize:function(){this.listenTo(I.event,"state:site-languages-upserted",this._handleSiteLanguagesUpserted),this.render()},render:function(){return g.getAvailableLanguagesPromise().done(function(e){var t=Lh.LanguagesHelpText.replace("{0}",E.getSite().getMaxNumSiteLanguages());this.$el.html(this.template({description:t,siteLanguagesSection:this.siteLanguagesTemplate(this.siteLanguagesHeaderHtml),translationsSection:this.translationsSectionTemplate()})),this._renderSiteLanguagesEditor(),this._renderSiteLanguageExport(),this._renderSiteLanguageImport()}.bind(this)),this},_renderSiteLanguagesEditor:function(){this._siteLanguagesEditor=(new _h).render(),this.$(".js-site-languages-editor-container").html(this._siteLanguagesEditor.$el)},_renderSiteLanguageImport:function(){var e=(new Th).render();this.$(".js-site-language-import-container").html(e.$el)},_renderSiteLanguageExport:function(){var e=(new wh).render();this.$(".js-site-language-export-container").html(e.$el)},_showEditLanguagesDialog:function(){this._previousActiveLanguage=g.getActiveLanguage();var e={appendLocation:"#vexContainer",showCloseButton:!0,overlayClosesOnClick:!1,contentClassName:"cb-Dialog js-dialog cb-SiteLanguagesEditDlg-modal",className:"slds-vex-theme",afterCloseFocusEl:this.$(".js-edit-languages")};A.showDialog(new rh,e)},_handleSiteLanguagesUpserted:function(){this._previousActiveLanguage.ComponentID!==g.getActiveLanguage().ComponentID&&I.event.trigger("action:set-active-language",{id:P.LANGUAGES.BASE_LANG_ID,shouldReopenSettingsPanelAfterIframeReloads:!0})}}),Ah=PicassoWebServices.Labels.CommBuilderSettings,kh="CmsSettings",Nh="none",xp=Backbone.View.extend({className:"cb-Settings-section cb-Settings-cmsSection",cmsConnectTemplate:_.template('<h2 class="cb-Settings-sectionHeading slds-p-right_x-small">'+Ah.CmsConnectAreaCaption+'<span class="slds-p-left_x-small"></span></h2><div class="cb-Settings-formGroupHeader">'+Ah.CmsConnectAreaHeaderFooterTitle+'</div><div class="cb-Settings-formGroupDescription">'+Ah.CmsConnectAreaHeaderFooterDesc+'</div><fieldset class="slds-form_compound"><div class="slds-form-element__group"><div class="slds-form-element__row">{{= headerSourceHtml }}{{= headerURLHtml }}{{= headerPersonalizationHtml }}</div></div><div class="slds-form-element__group"><div class="slds-form-element__row">{{= footerSourceHtml }}{{= footerURLHtml }}{{= footerPersonalizationHtml }}</div></div></fieldset>'),picklistTemplate:_.template('<div class="cb-SettingsCMSConnectView-picklist"><label title="{{= LabelTooltip}}" class="cb-Settings-propertyLabel" for="js-template-property-input-{{= Name}}">{{= Label }}</label><img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="js-local-save-indicator-{{= Name}} cb-Settings-saveIndicator hidden" /><div class="slds-form-element__control"><select class="{{= Name}} js-template-property-select" data-name="{{= Name}}"></select><span class="slds-p-top_small slds-text-color--error js-conn-disabled-error-{{= Name}} hidden">'+Ah.CmsConnectAreaErrorConnDis+"</span></div></div>"),inputTemplate:_.template('<div class="slds-p-left_x-large"><label title="{{= LabelTooltip }}" class="cb-Settings-propertyLabel" for="js-template-property-input-{{= Name}}">{{= Label }}</label><img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="cb-Settings-saveIndicator js-local-save-indicator-{{= Name}} hidden" /><div class="slds-form-element__control"><input type="text" {{= Disabled ? "disabled" : ""}} class="cb-Settings-propertyInput js-template-property-input slds-input {{= Name}}" id="js-template-property-input" data-name="{{= Name}}" placeholder="{{= Placeholder }}" value="{{- Value }}" data-native="{{= typeof(NativeProperty) != "undefined" ? 1 : 0 }}"><span class="slds-p-top_small slds-text-color--error js-source-url-error-{{= Name}} hidden">'+Ah.CmsConnectAreaSourceURLError+"</span></div></div>"),personalizationTemplate:_.template('<div class="slds-p-left_x-large cb-Settings-propertyGroup"><label title="{{= LabelTooltip }}" class="cb-Settings-propertyLabel cb-Settings-propertyLabel--inlineBlock" for="js-template-property-input-{{= Name}}">{{= Label }}</label><div class="cb-Settings-propertyInputInfoIcon">{{= Tooltip }}</div><img src="/sfsites/sfservice/builder/resources/images/loading-gray.gif" class="cb-Settings-saveIndicator js-local-save-indicator-{{= Name}} hidden" /><div class="slds-form-element"><div class="slds-form-element__control"><label class="slds-checkbox"><input type="checkbox" {{= Disabled ? "disabled" : ""}} class="{{= Name}} cb-Settings-cmsPersonalizationCheckbox js-cms-personalization" {{= isChecked}} /><span class="slds-checkbox_faux js-cms-personalization-checkbox--faux"></span></label></div></div></div>'),tooltipTemplate:function(e){return D.tooltipButtonIcon({buttonClassName:"".concat(e),svgClassName:"cb-SettingsPersonalization-inputInfoIcon",tooltipPlacement:"left",tooltipLabel:"".concat(Ah.CmsConnectPersonalizationInfo)})},template:_.template("{{= cmsConnectTemplateHtml }}"),events:{"change .js-template-property-select":"_onCMSConnectionSourcePicklistChange","change .js-template-property-input":"_onCMSConnectionURLChange","change .js-cms-personalization":"_onCMSPersonalizationChange"},initialize:function(){this.render()},render:function(){var e=this._getCMSSettings();return this._renderCMSConnectContent(e),this._renderPicklist(PicassoWebServices.Enums.CmsSettingsMapKey.headerName,e?e.headerName:null),this._renderPicklist(PicassoWebServices.Enums.CmsSettingsMapKey.footerName,e?e.footerName:null),this._setPersonalizationCheckbox(PicassoWebServices.Enums.CmsSettingsMapKey.headerPersonalization,e.headerName,this,!0,!1),this._setPersonalizationCheckbox(PicassoWebServices.Enums.CmsSettingsMapKey.footerPersonalization,e.footerName,this,!0,!1),this.$('[data-toggle="tooltip"]').tooltip(),this},_onCMSConnectionSourcePicklistChange:function(e){var t=T(e.currentTarget).attr("class").split(" ")[0],e=T(e.target).val();this._validateSelectedSourceValue(t,e,this),this._saveSelectedSourceValue(t,e,this)},_onCMSConnectionURLChange:function(e){var e=T(e.currentTarget),t=e.data("name"),e=T.trim(e.val());this._saveSelectedSourceURLValue(t,e,this)},_onCMSPersonalizationChange:function(e){var e=T(e.currentTarget),t=e[0].checked,e=e.attr("class").split(" ")[0];this._saveSelectedCheckboxValue(e,t,this)},_renderPicklist:function(e,n){var t,i=this.$("."+e),s=this.$(".js-conn-disabled-error-"+e);s.addClass("hidden"),PicassoWebServices.CommContent.GetCmsConnectSources(function(e){t=e.cmsConnectSources,i.append("<option value=none>"+Ah.CmsConnectAreaPicklistDefaultOption+"</option>"),t&&0<t.length&&_.each(t,function(e){var t;"ACTIVE"!==e.status&&n!==e.name||(t="",n===e.name&&(t="selected","INACTIVE"===e.status)&&s.removeClass("hidden"),i.append("<option value='"+e.name+"' "+t+">"+L.htmlEncode(e.label)+"</option>"))}),i.select2({minimumResultsForSearch:-1})})},_renderCMSConnectContent:function(e){var t,n,i,s,a,o,r,l="";return e&&"true"===e.isEnabled&&(t=this.picklistTemplate({Name:PicassoWebServices.Enums.CmsSettingsMapKey.headerName,Label:Ah.CmsConnectAreaHeaderSource,LabelTooltip:Ah.CmsConnectAreaHeaderSource}),n=this.inputTemplate({Name:PicassoWebServices.Enums.CmsSettingsMapKey.headerUrl,Label:Ah.CmsConnectAreaHeaderURL,LabelTooltip:Ah.CmsConnectAreaHeaderURL,Value:e?e.headerUrl:null,Disabled:this._isCmsSourceUrlOrPersonalizationDisabled(e.headerName),Placeholder:Ah.CmsConnectAreaHeaderURLDefaultText}),i=this.picklistTemplate({Name:PicassoWebServices.Enums.CmsSettingsMapKey.footerName,Label:Ah.CmsConnectAreaFooterSource,LabelTooltip:Ah.CmsConnectAreaFooterSource}),s=this.inputTemplate({Name:PicassoWebServices.Enums.CmsSettingsMapKey.footerUrl,Label:Ah.CmsConnectAreaFooterURL,LabelTooltip:Ah.CmsConnectAreaFooterURL,Value:e?e.footerUrl:null,Disabled:this._isCmsSourceUrlOrPersonalizationDisabled(e.footerName),Placeholder:Ah.CmsConnectAreaFooterURLDefaultText}),r=a="","true"===e.isPersonalizationEnabled&&(o=this.tooltipTemplate(PicassoWebServices.Enums.CmsSettingsMapKey.headerPersonalization),a=this.personalizationTemplate({Name:PicassoWebServices.Enums.CmsSettingsMapKey.headerPersonalization,Label:Ah.CmsConnectPersonalization,LabelTooltip:"Header ".concat(Ah.CmsConnectPersonalization),Tooltip:o,Disabled:this._isCmsSourceUrlOrPersonalizationDisabled(e.headerName),isChecked:"true"===e.headerPersonalization?"checked":"notchecked"}),o=this.tooltipTemplate(PicassoWebServices.Enums.CmsSettingsMapKey.footerPersonalization),r=this.personalizationTemplate({Name:PicassoWebServices.Enums.CmsSettingsMapKey.footerPersonalization,Label:Ah.CmsConnectPersonalization,LabelTooltip:"Footer ".concat(Ah.CmsConnectPersonalization),Tooltip:o,Disabled:this._isCmsSourceUrlOrPersonalizationDisabled(e.footerName),isChecked:"true"===e.footerPersonalization?"checked":"notchecked"})),l=this.cmsConnectTemplate({headerSourceHtml:t,headerURLHtml:n,headerPersonalizationHtml:a,footerSourceHtml:i,footerURLHtml:s,footerPersonalizationHtml:r})),this.$el.html(this.template({cmsConnectTemplateHtml:l})),this},_saveLocalPropertyValues:function(e,t){var n=this.$(".js-local-save-indicator-"+e);n.removeClass("hidden"),PicassoWebServices.ManageSiteCommon.UpsertPropertyMapEntry(I.getAppState().getCurrentPageId(),kh,e,t,function(e){setTimeout(function(){n.addClass("hidden")},1e3),I.event.trigger("action:refresh-current-page")})},_getCMSSettings:function(){return I.getAppState().getHomePageTemplate().get(kh)},_isCmsSourceUrlOrPersonalizationDisabled:function(e){return!(!$A.util.isUndefinedOrNull(e)&&!$A.util.isEmpty(e)&&e!==Nh)},_validateSelectedSourceValue:function(e,t,n){var i,s=n.$(".js-conn-disabled-error-"+e);t===Nh?s.addClass("hidden"):PicassoWebServices.CommContent.GetCmsConnectSources(function(e){(i=e.cmsConnectSources)&&0<i.length&&_.each(i,function(e){if(t===e.name)return"INACTIVE"===e.status?s.removeClass("hidden"):s.addClass("hidden"),!1})})},_saveSelectedSourceValue:function(e,t,n){var i,s,a=e===PicassoWebServices.Enums.CmsSettingsMapKey.headerName?PicassoWebServices.Enums.CmsSettingsMapKey.headerUrl:PicassoWebServices.Enums.CmsSettingsMapKey.footerUrl,o=e===PicassoWebServices.Enums.CmsSettingsMapKey.headerName?PicassoWebServices.Enums.CmsSettingsMapKey.headerPersonalization:PicassoWebServices.Enums.CmsSettingsMapKey.footerPersonalization,r=t;$A.util.isUndefinedOrNull(a)||(i=n.$("."+a),s=n.$("."+o),i.prop("disabled",!1),s.prop("disabled",!1),n.$(".js-pers-disabled-error-"+o).addClass("hidden"),r===Nh&&(i.val(""),i.prop("disabled",!0),n.$(".js-source-url-error-"+a).addClass("hidden"),n.$("."+a).removeClass("slds-has-error"),n._saveLocalPropertyValues(a,""),s[0].checked=!1,s.prop("disabled",!0),this._saveSelectedCheckboxValue(o,!1,n),r=""),n._saveLocalPropertyValues(e,r),this._setPersonalizationCheckbox(o,t,n,!0,!0))},_setPersonalizationCheckbox:function(n,i,s,a,o){var r,l=s.$(".cb-SettingsPersonalization-inputInfoIcon."+n),c=(l.attr("data-original-title",Ah.CmsConnectPersonalizationInfo),l.tooltip(),s.$("."+n));PicassoWebServices.CommContent.GetCmsConnectSources(function(e){if((r=e.cmsConnectSources)&&0<r.length)for(var t=0;t<r.length;t++)if(r[t].name===i&&"true"!==r[t].personalizationEnabled){c.prop("disabled",!0),a&&(l.attr("data-original-title",Ah.CmsConnectPersonalizationInfo),l.tooltip()),o&&(s.$(".cb-Settings-cmsPersonalizationCheckbox."+n)[0].checked=!1,s._saveSelectedCheckboxValue(n,!1,s));break}})},_saveSelectedSourceURLValue:function(n,i,s){PicassoWebServices.CommContent.isValidCMSComponentPath(i,function(e){var t=s.$(".js-source-url-error-"+n);e?(t.addClass("hidden"),s.$("."+n).removeClass("slds-has-error"),s._saveLocalPropertyValues(n,i)):(t.removeClass("hidden"),s.$("."+n).addClass("slds-has-error"))})},_saveSelectedCheckboxValue:function(e,t,n){n._saveLocalPropertyValues(e,t)}});var xh={openNavMenuEditor:function(s){$P.auraRun(function(){e=s,n=I.getAppState().get("currentSite").get("networkId"),t=I.getAppState().get("currentSite").get("isActive");var e,t,n={navigationLinkSetIdOrName:e.id,navigationLinkSetMasterLabel:e.name,networkId:n,isPublished:t,saveSuccessCallback:e.successCallback,hasSubMenus:!0,hasHome:!0,hasCustomBrands:!0,exitConfirmLabel:$A.get("$Label.navigationCustomMenuEditor.ExitMenuEditorConfirm"),unsavedChangesLabel:$A.get("$Label.navigationCustomMenuEditor.UnsavedChangesMenu"),deletePanelLabel:$A.get("$Label.navigationCustomMenuEditor.DeleteMenuItem"),deleteConfirmLabel:$A.get("$Label.navigationCustomMenuEditor.RemoveMenuEditorItemConfirm")},i=$A.util.format(".cb-SettingsNavigationSection-tableWrapper .js-table-row[data-id='{0}'] .js-dropdown-trigger",s.id);$A.createComponent("communitySetup:navigationBarCustomEditor",n,function(e,t,n){$A.assert(e,"Failed to create navigation menu editor: "+n),$A.getEvt("markup://ui:createPanel").setParams({panelType:"modal",visible:!0,owner:$A.getRoot().getGlobalId(),panelConfig:{title:s.title,body:e,flavor:"cbDefault",useTransition:!1,showCloseButton:!0,closeDialogLabel:"",closeAction:function(){e.closeDialog()},returnFocusElementSelector:i}}).fire()})})}},Rh="state:navigationlinkset-entity-updated",jh=[],Bh=PicassoWebServices.Labels.CommBuilderSettings;function Oh(t){return b.find(jh,function(e){return e.id===t})}qe.getNavigationLinkSets=function(){return jh},qe.getNavigationLinkSet=Oh,qe.getNavigationLinkSetsPromise=function(){var t=T.Deferred();return PicassoWebServices.CommNavigation.GetNavigationLinkSets(function(e){jh=e.NavigationLinkSets,t.resolve()}),t.promise()},I.event.on("action:update-navigationlinkset-entity",function(e){e=!!e&&e.isCreate;I.event.trigger(Rh,{isCreate:e})}),qe.onEditNavigationLinkSet=function(e){var t=Oh(e).name;xh.openNavMenuEditor({title:Bh.NavigationAreaEditMenu,id:e,name:t,successCallback:function(){I.event.trigger(Rh,{isCreate:!1})}.bind(this)})},qe.onDeleteNavigationLinkSet=function(n){var i=Oh(n).name;PicassoWebServices.CommNavigation.IsNavigationLinkSetInUse(n,function(e){var t=$P.isPersonalizationEnabled&&!E.getSite().isWebApp()?Bh.NavigationDeleteCurrentlyInUseWithPersonalization:Bh.NavigationDeleteCurrentlyInUse;e?A.sldsAlert(t.replace("{0}",i),Bh.NavigationDeleteErrorTitle,{yesText:Bh.NavigationDeleteGotIt}):A.sldsConfirm(Bh.NavigationDeleteConfirmContent,Bh.NavigationDeleteConfirmTitle,function(e){e&&PicassoWebServices.CommNavigation.DeleteNavigationLinkSet(n,function(e){e.Errors?(e=e.Errors,A.sldsAlert(e,Bh.NavigationDeleteErrorTitle)):I.event.trigger(Rh,{isCreate:!1})})},{className:"slds-vex-theme slds-vex-theme--medium",yesText:Bh.Delete,yesTextClassName:"slds-button slds-button_destructive test-yes",a11y:!0})})};Mh=PicassoWebServices.Labels.CommBuilderPageManagement,Vh=["name"];var Mh,Vh,$h,Uh,Wh,Fh,Hh={value:{name:function(e){return _.escape(e.name)}},className:{name:function(){return"js-page-table-item-name"}},headerLabel:{name:function(){return Mh.PageNameColumn}},headerClassName:{name:function(){return"slds-size--4-of-12"}},getColumns:function(){return Vh},getRowSections:function(){var t=[],e=qe.getNavigationLinkSets();return _.each(e,function(e){t.push(e)}),{dndRows:[],nonDndRows:t}}},Gh=[{items:[{key:"edit",label:(Np=PicassoWebServices.Labels.CommBuilderPageManagement).ActionEdit,icon:{sprite:"utility",name:"edit"},action:function(e){qe.onEditNavigationLinkSet(e)}},{key:"delete",label:Np.ActionDelete,icon:{sprite:"utility",name:"delete"},action:function(e){qe.onDeleteNavigationLinkSet(e)},isDisabled:function(e,t,n){return qe.getNavigationLinkSet(e).default}}]}],zh=PicassoWebServices.Labels.CommBuilderSettings,n=Backbone.View.extend({_hasLoadedData:!1,className:"cb-Settings-section cb-Settings-navigationSection js-settings-navigation-section",_networkId:null,_template:function(){return'<div class="cb-Settings-sectionHeading">'.concat(zh.NavigationSectionTitle,'</div>\n            <div class="cb-Settings-sectionDescription">').concat(zh.NavigationSettingsDescription,'</div>\n            <div class="cb-SettingsNavigationSection-buttons slds-p-bottom_small slds-m-top_x-large" >\n                ').concat(D.buttonWithIcon({buttonClassName:"js-add-navigation-linkset",buttonVariantClassName:"slds-button_brand",label:"".concat(zh.NavigationSettingsButton),icon:"add"}),'\n            </div>\n            <div class="cb-SettingsNavigationSection-tableWrapper js-table-container"></div>').trim()},events:{"click .js-add-navigation-linkset":"_addNavigationLinkset"},initialize:function(){this._networkId=I.getAppState().getNetworkId(),this._table=new zo({dataProvider:Hh,dropdownConfig:Gh,parentRef:this,contextParams:{}}),this.render(),this.listenTo(I.event,"state:navigationlinkset-entity-updated",this._handleNavigationLinksetUpdated)},render:function(){return this._hasLoadedData?(this._table.$el.remove(),this.$el.html(this._template),this.$(".js-table-container").append(this._table.render().$el),this._table.delegateEvents()):this._renderAsync(),this},_renderAsync:function(){qe.getNavigationLinkSetsPromise().done(function(){this._hasLoadedData=!0,this.render()}.bind(this))},_addNavigationLinkset:function(){xh.openNavMenuEditor({title:zh.NavigationAreaEditMenu,successCallback:this._handleNavigationLinksetAdded.bind(this)})},_handleNavigationLinksetAdded:function(){this._hasLoadedData=!1,this._renderAsync(),I.event.trigger("state:navigation-linkset-added")},_handleNavigationLinksetUpdated:function(e){this._hasLoadedData=!1,this._renderAsync(),e&&!e.isCreate&&I.event.trigger("action:refresh-current-page")}});function Kh(s){$P.auraRun(function(){e=s,t=E.getSite().get("uddid");var e,t={item:e.menuItem,siteId:t,saveSuccessCallback:e.successCallback},i=$A.util.format(".cb-SettingsMobilePublisherSection-tableWrapper .js-table-row[data-id='{0}'] .js-dropdown-trigger",s.id);$A.createComponent("communitySetup:nativeTabBarMenuEditor",t,function(e,t,n){$A.assert(e,"Failed to create native tab menu item editor: "+n),$A.getEvt("markup://ui:createPanel").setParams({panelType:"modal",visible:!0,owner:$A.getRoot().getGlobalId(),panelConfig:{title:s.title,body:e,flavor:"cbDefault",useTransition:!1,showCloseButton:!0,closeDialogLabel:"",closeAction:function(){e.closeDialog()},returnFocusElementSelector:i}}).fire()})})}var Yh="action:update-native-mobile-nav-config",qh="action:update-native-app-version-config",Xh=PicassoWebServices.Labels.CommBuilderSettings;function Jh(){var t;t=T.Deferred(),PicassoWebServices.CommNative.GetNativeConfig(function(e){$h=e.NativeTabMenu,Uh=e.ShowNavMenu,Wh=e.NativeMobileNavConfig,Fh=e.MobilePublisherAppUpdateConfig,t.resolve()}),t.promise().done(function(){I.event.trigger("state:native-tab-menu-item-updated")})}I.event.on("action:update-native-tab-menu-item-sortorder",function(e){e=e.idToPositionMap;PicassoWebServices.CommNative.UpdateSortOrder(e,function(e){Jh()})}),I.event.on("action:delete-native-tab-menu-item",function(e){var t=e.id;A.sldsConfirm(Xh.NativeTabBarMenuItemDeleteConfirmContent,Xh.NativeTabBarMenuItemDeleteConfirmTitle,function(e){e&&PicassoWebServices.CommNative.DeleteNativeTabMenuItem(parseInt(t),function(e){e.Errors?(e=e.Errors,A.sldsAlert(e,Xh.NativeTabBarMenuItemDeleteErrorTitle)):Jh()})},{className:"slds-vex-theme slds-vex-theme--medium",yesText:Xh.Delete,yesTextClassName:"slds-button slds-button_destructive test-yes",a11y:!0})}),I.event.on("action:create-native-tab-menu-item",function(){Kh({title:Xh.MobilePublisherSettingsButton,menuItem:{iconDetails:{}},successCallback:function(){Jh()}})}),I.event.on("action:edit-native-tab-menu-item",function(e){var t,e=e.id;Kh({title:Xh.MobilePublisherEditMenuDialogTitle,menuItem:(t=parseInt(e),b.find($h.menuItems,function(e){return e.id===t})),id:e,successCallback:function(){Jh()}})}),I.event.on("action:update-native-show-hide-navmenu",function(e){e=e.showNavMenu;PicassoWebServices.CommNative.SetShowNavMenu(e)}),I.event.on(Yh,function(e){PicassoWebServices.CommNative.SetNativeMobileNavConfig(e,function(){I.event.trigger("state:show-ios-nav-menu-config-updated",e)})}),I.event.on("state:branding-set-values-updated",function(e,t){var n,i;t||(n=l.getBrandingSet(I.getAppState().getCurrentPreviewSiteBrandingSetId()),t=l.getBrandingSetPropertyDefs(n.def)),I.AccessControl(P.PERMISSIONS.IS_NATIVE_NAVIGATION_ENABLED)&&(i=t.map(function(e){return e.name}),Object.values($P.cbMetadata.componentBrandingMap["community_builder:native_tab_bar"]).flat().some(function(e){return i.includes(e)}))&&PicassoWebServices.CommNative.UpdateBrandingProperties()}),I.event.on("action:update-native-tab-bar-properties",function(e){PicassoWebServices.CommNative.SetNavMenuProperties(e,function(e){Jh()})}),I.event.on(qh,function(e){PicassoWebServices.CommNative.SetMobilePublisherAppUpdateConfig(e.payload,function(){e.successCallback(),Jh()})});function Qh(t){return function(e){if(!em.validateUrl(e,t))return t||"Invalid url"}}function Zh(t,n){return function(e){if(!em.validateVersion(e,t))return n||"Invalid version"}}var em={validateVersion:function(e,t){return(n=(n=e).split(".")).length<=3&&n.every(function(e){return/^\d{1,3}$/.test(e)})&&0<=function(e,t){for(var n=e.split("."),i=t.split(".");n.length<i.length;)n.push("0");for(;i.length<n.length;)i.push("0");for(var n=n.map(Number),i=i.map(Number),s=0;s<n.length;++s)if(n[s]!==i[s])return n[s]>i[s]?1:-1;return 0}(e,t);var n},validateUrl:function(e){try{var t=new URL(e);return"https:"===(null==t?void 0:t.protocol)}catch(e){return!1}}},tm=PicassoWebServices.Labels.CommBuilderSettings,nm={enableAppUpdate:{key:"enableAppUpdate",label:tm.MobilePublisherAppSettingsUpdateAppVersion,value:""},iosAppVersion:{key:"minVersion.ios.version",label:tm.MobilePublisherAppSettingsMinAppVersion,value:"",default:"10.0",placeholder:tm.MobilePublisherAppSettingsIOSMinAppVersionPlaceholderText,validate:Zh("10.0",tm.MobilePublisherAppSettingsMinAppVersionErrorText)},iosAppUrl:{key:"minVersion.ios.url",label:tm.MobilePublisherAppSettingsIOSAppUrl,value:"",placeholder:tm.MobilePublisherAppSettingsIOSAppUrlPlaceholderText,validate:Qh(tm.MobilePublisherAppSettingsAppUrlErrorText)},androidAppVersion:{key:"minVersion.android.version",label:tm.MobilePublisherAppSettingsMinAppVersion,value:"",default:"10.1",placeholder:tm.MobilePublisherAppSettingsAndroidMinAppVersionPlaceholderText,validate:Zh("10.1",tm.MobilePublisherAppSettingsMinAppVersionErrorText)},androidAppUrl:{key:"minVersion.android.url",label:tm.MobilePublisherAppSettingsAndroidAppUrl,value:"",placeholder:tm.MobilePublisherAppSettingsAndroidAppUrlPlaceholderText,validate:Qh(tm.MobilePublisherAppSettingsAppUrlErrorText)},forceAppUpdate:{key:"forceAppUpdate",label:tm.MobilePublisherAppSettingsRequiresAppUpdate,value:""}},im=Backbone.View.extend({template:function(e){var t=e.header,e=e.body;return'<div class="cb-SettingsMobilePublisherSection-appSettings">\n                    '.concat(t,'\n                    <div class="cb-SettingsMobilePublisherSection-appSettingsBody">').concat(e,"</div>\n                </div>")},headerTemplate:b.template('<div class=\'cb-Settings-formGroupHeaderContainer\'>\n            <div class="cb-Settings-formGroupHeaderWithIcon">\n                {{= icon}}\n                <h3 class="cb-Settings-formGroupHeaderText">'.concat(tm.MobilePublisherAppSettingsTitle,"</h3>\n            </div>\n        </div>\n        <p class='cb-Settings-subsection slds-p-bottom_medium'>").concat(tm.MobilePublisherAppSettingsDescription,"</div>").trim()),enableAppUpdateTemplate:b.template('\n        <div class="cb-Settings-propertyGroup cb-SettingsMobilePublisherSection-appSettingsShowAppUpdate">\n            <label class="slds-checkbox_toggle slds-grid">\n                <span class="cb-Settings-propertyLabel slds-form-element__label slds-m-bottom_none">{{= label}}</span>\n                <input type="checkbox" class="js-enable-app-update js-app-settings-control" id="{{=key}}" {{=value}} aria-describedby="toggle-update-app"/>\n                <span id="toggle-update-app" class="slds-checkbox_faux_container" aria-live="assertive">\n                    <span class="slds-checkbox_faux"></span>\n                    <span class="slds-checkbox_on">'.concat(tm.MobilePublisherAppSettingsUpdateAppVersionEnabled,'</span>\n                    <span class="slds-checkbox_off">').concat(tm.MobilePublisherAppSettingsUpdateAppVersionDisabled,"</span>\n                </span>\n            </label>\n        </div>")),appSettingsInputGroup:b.template('<div class="cb-SettingsMobilePublisherSection-appSettingsInputGroup">\n            {{= appUrl}}\n            {{= minAppVersion}}\n        </div>'),appSettingInput:b.template('<div class="cb-Settings-propertyGroup slds-form-element">\n            <label class="cb-Settings-propertyLabel" for="js-template-property-input-{{= key}}">\n                <abbr class="slds-required" title="required">* </abbr>{{= label }}</label>\n                {{= icon}}\n            <div class="slds-form-element__control">\n                <input type="text" id="{{= key}}" placeholder="{{= placeholder}}"\n                 required="" aria-describedby="error-{{= key}"\n                  class="cb-Settings-propertyInput slds-input js-app-settings-control" aria-invalid="true" value="{{= value }}" {{=disabled}} />\n            </div>\n            <div class="slds-form-element__help hidden" id="error-{{= key}}"></div>\n      </div>'),forceAppUpdate:b.template('<div class="cb-Settings-propertyGroup slds-form-element cb-SettingsMobilePublisherSection-appSettingsForceAppUpdateContainer">\n            <div class="slds-form-element__control">\n                <label class="slds-checkbox">\n                    <input type="checkbox" class="js-force-app-update js-app-settings-control" id="{{= key}}" {{=value}}  {{=disabled}} />\n                    <span class="slds-checkbox_faux"></span>\n                    <span class="slds-form-element__label">{{=label}}</span>\n                </label>\n            </div>\n        </div>'.trim()),appSettingsForm:function(e){return b.template("{{= enableAppUpdate}}\n            ".concat(e.iosAppUrlAndVersion?"{{= iosAppUrlAndVersion}}":"","\n            ").concat(e.androidAppUrlAndVersion?"{{= androidAppUrlAndVersion}}":"","\n            {{= forceAppUpdate}}"))(e)},initialize:function(){this.render()},render:function(){var e=Fh;return this.$el.append(this.template({header:this.headerTemplate({icon:this.getAppVersionIcon()}),body:this.appSettingsBody(e)})),this.$('[data-toggle="tooltip"]').tooltip(),this},events:{"change .js-app-settings-control":"onInputChange"},getAppVersionIcon:function(){return $P.viewTypes.CommonTemplates.icon({svgClassName:"slds-icon_x-small cb-Settings-formGroupHeaderIcon",icon:"setup_assistant_guide"})},appSettingsBody:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e={enableAppUpdate:this.enableAppUpdateTemplate(m(m({},nm.enableAppUpdate),{},{value:e.enableAppUpdate?"checked":""})),forceAppUpdate:this.forceAppUpdate(m(m({},nm.forceAppUpdate),{},{value:e.forceAppUpdate?"checked":"",disabled:e.enableAppUpdate?"":"disabled"})),iosAppUrlAndVersion:this.appUrlAndVersion(e,nm.iosAppVersion,nm.iosAppUrl),androidAppUrlAndVersion:this.appUrlAndVersion(e,nm.androidAppVersion,nm.androidAppUrl)};return this.appSettingsForm(e)},appUrlAndVersion:function(e,t,n){return this.appSettingsInputGroup({minAppVersion:this.appSettingInput(m(m({},t),{},{value:b.get(e,t.key),disabled:e.enableAppUpdate?"":"disabled",icon:this.getHelpTextIcon(t.default)})),appUrl:this.appSettingInput(m(m({},n),{},{value:b.get(e,n.key),disabled:e.enableAppUpdate?"":"disabled",icon:""}))})},getHelpTextIcon:function(e){return D.tooltipButtonIcon({buttonClassName:"cb-Settings-propertyInputInfoIcon",buttonAttributes:'data-container="body"',tooltipPlacement:"right",tooltipLabel:L.format(tm.MobilePublisherAppSettingsMinAppVersionHelpText,e)})},getControlValue:function(e){return"checkbox"===e.prop("type")?e.prop("checked"):e.val()},onInputChange:function(e){var e=T(e.target),t=e.attr("id"),n=this.getControlValue(e),i={},s=Object.values(nm).find(function(e){return e.key===t});s.validate&&this.toggleError(e,s.validate(n)),b.set(i,t,n),"enableAppUpdate"===t?(i.forceAppUpdate=n,this.triggerUpdateConfig(i)):"forceAppUpdate"!==t||this.hasError()?this.hasError()||(this.preparePayload(i,t,n),this.triggerUpdateConfig(i)):this.triggerUpdateConfig(i)},triggerUpdateConfig:function(e){I.event.trigger(qh,{payload:e,successCallback:function(){w.success({message:tm.MobilePublisherAppSettingsUpdateVersionToastMessageTitle,details:tm.MobilePublisherAppSettingsUpdateVersionToastMessageText,duration:w.DURATION_MEDIUM})}})},preparePayload:function(t){var n=this;Object.values(nm).filter(function(e){return e.key.startsWith("minVersion")}).forEach(function(e){b.set(t,e.key,n.getControlValue(n.$el.find('input[id="'+e.key+'"]')))})},toggleError:function(e,t){var n=e.closest(".cb-Settings-propertyGroup");n.find('[id="error-'.concat(e.attr("id"),'"]')).text(t||""),t?n.addClass("slds-has-error"):n.removeClass("slds-has-error")},hasError:function(){return 0<this.$el.find(".slds-has-error").length}});var Mp=PicassoWebServices.Labels.CommBuilderSettings,sm={buttonClassName:"js-add-native-tab-menu-item",buttonVariantClassName:"slds-button_brand",label:Mp.MobilePublisherSettingsButton,icon:"add"},am=Backbone.View.extend({template:function(e){var t=e.header,e=e.addButton;return'\n            <div class="cb-settings-nav-items-config">\n                '.concat(t,'\n                <div class="cb-SettingsMobilePublisherSection-tableWrapper js-table-container"></div>\n                <div class="cb-SettingsMobilePublisherSection-buttons slds-p-top_small">').concat(e,"</div>\n            </div>")},headerTemplate:_.template('<div class=\'cb-Settings-formGroupHeaderContainer\'>\n            <div class="cb-Settings-formGroupHeaderWithIcon">\n                {{= icon}}\n                <h3 class="cb-Settings-formGroupHeaderText">'.concat(Mp.MobilePublisherTabBarNavItemsTitle,"</h3>\n            </div>\n            <div class='cb-Settings-formGroupHeaderDescription'>\n                ").concat(L.format(Mp.MobilePublisherTabBarNavItemsDescription,P.MOBILE_PUBLISHER.MAX_NATIVE_TAB_MENU_ITEMS),"\n            </div>\n        </div>\n        ").trim()),initialize:function(){this.render()},addButton:function(){var e=$P.viewTypes.CommonTemplates.buttonWithIcon(sm);return e=$h.menuItems.length>=P.MOBILE_PUBLISHER.MAX_NATIVE_TAB_MENU_ITEMS?$P.viewTypes.CommonTemplates.buttonWithIcon(m(m({},sm),{},{buttonAttributes:"disabled"})):e},render:function(){return this.$el.append(this.template({header:this.headerTemplate({icon:this.headerIcon()}),addButton:this.addButton()})),this.applyDnd(),this},events:{"click .js-add-native-tab-menu-item":"_addNativeTabMenuItem"},_addNativeTabMenuItem:function(){I.event.trigger("action:create-native-tab-menu-item")},_updateSortOrder:function(e){I.event.trigger("action:update-native-tab-menu-item-sortorder",{idToPositionMap:e})},headerIcon:function(){return $P.viewTypes.CommonTemplates.icon({svgClassName:"slds-icon_x-small cb-Settings-formGroupHeaderIcon",sprite:"utility",icon:"tabset"})},applyDnd:function(){var e,t,n;this._table=new zo({dataProvider:(t=PicassoWebServices.Labels.CommBuilderPageManagement,n=["name","pageName","target"],{value:{name:function(e){return _.escape(e.name)},target:function(e){return _.escape(e.targetUrl)},pageName:function(e){return _.escape(e.pageName)}},className:{pageName:function(){return"js-page-table-item-name"}},headerLabel:{name:function(){return t.NativeMenuItemName},target:function(){return t.NativeMenuItemTarget},pageName:function(){return t.NativeMenuItemPageName}},headerClassName:{pageName:function(){return"slds-size--4-of-12"}},getColumns:function(){return n},getRowSections:function(){var t=[],e=$h.menuItems;return _.each(e,function(e){t.push(e)}),{dndRows:t,nonDndRows:[]}}}),dropdownConfig:[{items:[{key:"edit",label:(e=PicassoWebServices.Labels.CommBuilderPageManagement).ActionEdit,icon:{sprite:"utility",name:"edit"},action:function(e){I.event.trigger("action:edit-native-tab-menu-item",{id:e})}},{key:"delete",label:e.ActionDelete,icon:{sprite:"utility",name:"delete"},action:function(e){I.event.trigger("action:delete-native-tab-menu-item",{id:e})}}]}],parentRef:this,contextParams:{}}),this.$el.find(".js-table-container").append(this._table.render().$el),this._table.delegateEvents(),this.listenTo(this._table,"dnd-update",this._updateSortOrder)}}),om={barTintColor:"rgb(255, 255, 255)",iconTintColorUnselected:"rgb(201,197,197)"},rm=PicassoWebServices.Labels.CommBuilderSettings;var lm="OVERRIDE";function cm(){return N.isScopedBrandingSetManagementEnabled()?PicassoWebServices.Labels.CommBuilderColorPickerLWR:PicassoWebServices.Labels.CommBuilderColorPicker}function dm(){o.trigger("theme-editor-action:show-detail",void 0,P.BRANDING_FIELD.COLOR),o.trigger("open-app-nav",P.LEFT_PANEL.THEME_EDITOR)}var um=Backbone.View.extend({className:"cb-ColorEditorPicker test-color-editor-picker",template:_.template('{{ if (brandingDefLabel) { }}<div class="cb-ColorEditorPicker-selectContainer slds-select_container"><select class="cb-ColorEditorPicker-select slds-select js-color-editor-picker-select" aria-label="{{= parentLabel }} tabindex="0""><option value="INHERIT" {{= value ? "" : "selected"}}>'+cm().Inherit+'</option><option value="'+lm+'" {{= value ? "selected" : ""}}>'+cm().Override+'</option></select></div>{{ } }}<div class="cb-ColorEditorPicker-contentContainer">{{ if (value) { }}<div class="cb-ColorEditorPicker-content"><input type="text" class="cb-ColorEditorPicker-input js-color-editor-picker-input" value="{{=value}}"/></div>{{ } else { }}<div class="cb-ColorEditorPicker-content test-color-editor-picker-inherit-desc"><span>{{= inheritDescLabel }}</span></div>{{ } }}</div>'),events:{"change .js-color-editor-picker-select":"_onSelectChange","click .js-color-editor-picker-theme-panel-link":"_onThemeLinkClick","keyup .js-color-editor-picker-theme-panel-link":"_onThemeLinkKeyup"},initialize:function(e){this._value=e.value,this._parentLabel=e.parentLabel,this._brandingDefLabel=e.brandingDefLabel,this._brandingValue=e.brandingValue,this._brandingSet=e.brandingSet,this._onChangeCallback=e.onChangeCallback,this._hideAlpha=e.hideAlpha,this.render()},_getRenderValue:function(){return this._value||this._brandingDefLabel?this._value:"rgb(255,255,255)"},render:function(){this.$el.html(this.template({value:this._getRenderValue(),inheritDescLabel:this._getInheritDescLabel(),parentLabel:this._parentLabel,brandingDefLabel:this._brandingDefLabel}));var e=this.$(".js-color-editor-picker-input");return e.spectrum({flat:!0,color:this._value,allowEmpty:!1,move:_.debounce(this._onChange.bind(this),500),showButtons:!1,preferredFormat:"rgb",showInput:!0,showAlpha:!this._hideAlpha,showPalette:!1}),e.on("change.js-color-editor-picker",this._onChange.bind(this)),this.$(".sp-input").on("keyup.js-color-editor-picker",this._onColorInputKeyup.bind(this)),this},_getInheritDescLabel:function(){var e;return this._brandingDefLabel?(e=cm().InheritDescription,N.isScopedBrandingSetManagementEnabled()?L.format(e,this._parentLabel,this._brandingSet.name,'<a role="button" tabindex="0" class="js-color-editor-picker-theme-panel-link">'.concat(this._brandingDefLabel,"</a>")):L.format(e,this._parentLabel,'<a role="button" tabindex="0" class="js-color-editor-picker-theme-panel-link">'.concat(this._brandingDefLabel,"</a>"))):""},_onColorInputKeyup:function(e){var t=this.$(".js-color-editor-picker-input"),e=e.currentTarget.value;this._isValidColor(e)&&(t.spectrum("set",e),this._onChange())},destroy:function(){var e=this.$(".js-color-editor-picker-input");e.spectrum("destroy"),e.off(".js-color-editor-picker"),this.remove()},reflow:function(){this.$(".js-color-editor-picker-input").spectrum("reflow");var e=this.$(".js-color-editor-picker-select");e.length?e.focus():(e=this.$(".sp-input")).length&&e.focus()},_isValidColor:function(e){var t,n;return!!e&&(t=0===(n=e.trim().toLowerCase()).indexOf("rgb")&&")"===n.slice(-1),n=0===n.indexOf("#")&&7===n.length,t||n)&&tinycolor(e).isValid()},_onChange:function(){var e=this.$(".js-color-editor-picker-input").spectrum("get");e&&e.toRgbString&&(this._value=e.toRgbString(),this._save())},_save:function(){this._onChangeCallback(this._value)},_onSelectChange:function(){var e;this.$(".js-color-editor-picker-select").val()===lm?(this._value=this._brandingValue,this._hideAlpha&&this._isValidColor(this._brandingValue)&&((e=tinycolor(this._brandingValue)).setAlpha(1),this._value=e.toRgbString())):this._value="",this.render(),this._save()},_onThemeLinkClick:function(){this._brandingSet&&"SCOPED"===this._brandingSet.type?I.event.trigger("action:set-preview-scoped-branding-set",{id:this._brandingSet.id,successCallback:function(){dm()}}):dm()},_onThemeLinkKeyup:function(e){e.keyCode===P.KEYCODE.ENTER&&this._onThemeLinkClick()}});function pm(){return N.isScopedBrandingSetManagementEnabled()?PicassoWebServices.Labels.CommBuilderColorPickerLWR:PicassoWebServices.Labels.CommBuilderColorPicker}function gm(){var o=PicassoWebServices.Labels.CommBuilderSecurityCSPSettings;function s(i,e,s){var e=e.get("clickjackTrustedDomains"),a=[];return e.forEach(function(e){var t,n;a.push(i("tr.test-settings-security-trusted-sites-table-row",[i("td",[i("div.slds-truncate.slds-p-right_x-small.test-settings-security-trusted-sites-table-row-source",{attrs:{title:e,"data-value":e}},e)]),i("td",[i("div",(t=e,n=s,bg.deleteButtonIcon(i,{buttonClassName:"test-settings-security-trusted-sites-table-row-action",svgClassName:"test-settings-security-trusted-sites-table-row-action",click:function(e){A.sldsConfirm(o.FrameAncestorsTrustedSitesDeleteDlgDesc,o.FrameAncestorsDeleteDlgTitle,function(e){e&&n({type:"DeleteTrustedDomain",data:t})},{className:"slds-vex-theme slds-vex-theme--medium",yesText:"Delete",yesTextClassName:"slds-button slds-button_destructive test-yes",a11y:!0})},label:o.Delete})))])]))}),a}function e(e,t,n){var i=bg.button(e,{className:"cb-SettingsSecurityCSPView-trustedSitesTableAddButton test-settings-security-trusted-sites-add slds-button_neutral",label:o.FrameAncestorsTrustedDomainsAddButton,icon:{icon:"add",className:"slds-icon-text-default slds-button__icon slds-button__icon_left"},disabled:!1,click:function(){var e,t,n;e={trustedSite:Immutable.Map({currentTrustedDomain:""}),valid:!1,mode:"NEW"},t=document.createElement("div"),n=A.showDialogAdvanced({content:t,className:"slds-vex-theme",contentClassName:"cb-Dialog js-dialog cb-SettingsSecurityCSPView-trustedSiteDialog test-trusted-site-dialog",afterCloseFocusEl:document.activeElement,a11y:!0}),n=Vm({currentTrustedSite:e.trustedSite,vexId:n.data().vex.id,valid:e.valid,mode:e.mode}),Bg(n,t)}});return e("div.cb-SettingsSecurityCSPView-trustedSitesContainer.test-settings-security-trusted-sites-container",[e("div.cb-SettingsSecurityCSPView-trustedSitesTitle.cb-Settings-formGroupSubHeader",o.FrameAncestorsTrustedDomainsTitle),e("div.cb-SettingsSecurityCSPView-trustedSitesDescription.cb-Settings-formGroupSubHeaderDescription",{props:{innerHTML:o.FrameAncestorsTrustedDomainsDesc}}),(e=e,n=n,(t=t).get("clickjackTrustedDomains").size?e("table.cb-SettingsSecurityCSPView-trustedSitesTable.test-settings-security-trusted-sites-table.slds-table.slds-table_cell-buffer.slds-no-row-hover.slds-table_bordered",[e("thead",[e("tr",[e("th",[e("div.slds-truncate.slds-p-right_x-small",o.FrameAncestorsTrustedDomain)]),e("th",[e("div","")])])]),e("tbody",s(e,t,n))]):null),i])}return{render:e,update:function(e,t){var n,e=[e];return(n="DeleteTrustedDomain"===t.type?function(){I.event.trigger("action:remove-clickjack-trusted-domain",{trustedSiteId:t.data})}:n)&&e.push(n),e}}}function hm(){var s=gm(),i=PicassoWebServices.Labels.SiteClickjackProtectionLevel,a=[{value:"AllowAllFraming",label:i.A},{value:"SameOriginOnly",label:i.SO},{value:"NoFraming",label:i.NO},{value:"External",label:i.E}],o=_.template('<div class="{{- selected ? "cb-SettingsSecurityClickjackView-statusSelectDropdownItem--active" : "" }}">'+D.icon({icon:"check"})+'<span class="cb-SettingsSecurityClickjackView-statusSelectDropdownItemLabel">{{= label }}</span></div>'),r=bg;function l(n,t,e){var i=n.get("clickjackProtectionLevels");Yd({items:_.reduce(i,function(e,t){return e.push({id:t.value,html:o({label:t.label,selected:t.value===n.get("currentClickjackProtectionLevel")})}),e},[]),cssClass:"cb-SettingsSecurityClickjackView-statusSelectDropdownItems",onClickHandler:function(e){t({type:"SetClickjackLevel",data:e})},onCloseCallback:function(){t({type:"ToggleIsDropdownOpen",data:!1})},onOpenCallback:function(){t({type:"ToggleIsDropdownOpen",data:!0})},selected:n.get("currentClickjackProtectionLevel")}).toggle(e.currentTarget,!0)}function e(e,t,n){return e("div.cb-SettingsSecurityClickjackView",[e("div.cb-SettingsSecurityClickjackView-title.cb-Settings-formGroupHeader",{props:{innerHTML:i.Title}}),e("div.cb-SettingsSecurityClickjackView-statusContainer",[e("div.cb-SettingsSecurityClickjackView-statusSelectContainer",[e("label.cb-SettingsSecurityClickjackView-statusSelectTitle",{attrs:{for:"cb-SettingsSecurityClickjackView-statusSelectDropdown"}},i.PicklistTitle),e("div.cb-SettingsSecurityClickjackView-statusSelectDescription",{props:{innerHTML:i.PicklistDescription}}),e("div.cb-SettingsSecurityClickjackView-statusSelectDropdownContainer.js-settings-clickjack-dropdown-container",{attrs:{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","data-id":t.get("currentClickjackProtectionLevel")}},[e("input.cb-SettingsSecurityClickjackView-statusSelectDropdownToggle",{props:{value:_.find(a,{value:t.get("currentClickjackProtectionLevel")}).label,id:"cb-SettingsSecurityClickjackView-statusSelectDropdown"},on:{mouseup:l.bind(null,t,n),keyup:function(e,t,n){var i=n.keyCode;e.get("isDropdownOpen")||P.KEYCODE.DOWN===i&&l(e,t,n)}.bind(null,t,n)},attrs:{tabindex:0,readonly:!0,autoComplete:"off",role:"textbox",placeholder:i.DropdownPlaceholder}}),r.icon(e,{icon:"down",className:"cb-SettingsSecurityClickjackView-statusSelectDropdownToggleIcon slds-icon_x-small",label:"DOWN"})])])]),t.get("currentClickjackProtectionLevel")===_.find(a,{label:i.E}).value?s.render(e,t,function(e){n({type:"TrustedSiteAction",data:e})}):null])}return{init:function(){return[Immutable.Map({isDropdownOpen:!1,currentClickjackProtectionLevel:v.getSiteClickjackProtectionLevel(),clickjackProtectionLevels:a,clickjackTrustedDomains:v.getClickjackTrustedDomains()})]},render:e,update:function(e,t){var n,i=[e];return"SetClickjackLevel"===t.type?n=function(){I.event.trigger("action:update-site-clickjack-protection-level",{level:t.data})}:"ToggleIsDropdownOpen"===t.type?i=[e=e.set("isDropdownOpen",void 0!==t.data?t.data:!e.get("isDropdownOpen"))]:"TrustedSiteAction"===t.type?i=s.update(e,t.data):"FetchData"===t.type&&(i=[e=(e=e.set("currentClickjackProtectionLevel",v.getSiteClickjackProtectionLevel())).set("clickjackTrustedDomains",v.getClickjackTrustedDomains())]),n&&i.push(n),i},subscriptions:function(){return[["state:site-clickjack-protection-level-updated",function(e){e({type:"FetchData"})}],["state:clickjack-trusted-domains-updated",function(e){e({type:"FetchData"})}]]}}}function mm(){var l=vm(),c=PicassoWebServices.Labels.CommBuilderSecurityCSPSettings,b=PicassoWebServices.Labels.DisallowedCSP,o="googleAnalyticsTrackingId",f="CONTENT",S="CONTENT_LAYOUT_COMPONENT",C="THEME_LAYOUT_COMPONENT",y="CUSTOM_COMPONENT",d={unlocked:c.ScriptLevel_unlocked,locked:c.ScriptLevel_locked,grandfathered:c.ScriptLevel_grandfathered},r=_.template('{{= description }}<br /><br />{{ _.each(packages, function(components, packageName) { }}<div class="slds-section slds-is-open"><h3 class="slds-section__title slds-theme_shade"><span class="slds-truncate slds-p-horizontal_small" title="{{= packageName }} ({{= components.length}})">{{= packageName }} ({{= components.length }})</span></h3><div aria-hidden="false" class="slds-section__content"><ul class="slds-is-nested slds-list_dotted">{{ _.each(components, function(component) { }}<li>{{= component.outputString }}</li>{{ }); }}</ul></div>{{ }); }}');function u(s,a,e){var n=_.template('<div class="{{- selected ? "cb-SettingsSecurityCSPView-statusSelectDropdownItem--active" : "" }}">'+D.icon({icon:"check"})+'<span class="cb-SettingsSecurityCSPView-statusSelectDropdownItemLabel">{{= label }}</span></div>'),t=s.get("scriptSecurityLevels");Yd({items:_.reduce(t,function(e,t){return e.push({id:t,html:n({label:d[t],selected:t===s.get("currentScriptSecurityLevel")})}),e},[]),cssClass:"cb-SettingsSecurityCSPView-statusSelectDropdownItems",onClickHandler:function(e){var t,n,i;t=e,e=s,n=a,i=E.getSite().isWebApp(),e.get("currentScriptSecurityLevel")!==t&&(e.get("scriptSecurityLevels").UNLOCKED===t?A.sldsConfirm(c.ScriptLevelUnlockedConfirmDesc,c.ScriptLevelUnlockedConfirmTitle,function(e){e&&(e=E.getSite().get(o),Va.addMissingGoogleDomains(e,function(){n({type:"SetSecurityLevel",data:t})}))},{className:"slds-vex-theme slds-vex-theme--medium",yesText:c.Allow,afterCloseFocusEl:document.activeElement,a11y:!0}):e.get("scriptSecurityLevels").LOCKED===t?A.sldsConfirm(c.ScriptLevelLockedConfirmDesc+"\n"+(e.get("isLockerServiceEnabled")?"":i?c.WebSecurityServiceForceEnableForLockedCommunityDesc:c.LockerServiceForceEnableForLockedCommunityDesc),c.ScriptLevelLockedConfirmTitle,function(e){e&&n({type:"SetSecurityLevel",data:t})},{className:"slds-vex-theme slds-vex-theme--medium",yesText:c.Change,afterCloseFocusEl:document.activeElement,a11y:!0}):A.sldsConfirm(c.ScriptLevelGrandfatheredConfirmDesc+"\n"+(e.get("isLockerServiceEnabled")?"":i?c.WebSecurityServiceForceEnableForGrandfatheredCommunityDesc:c.LockerServiceForceEnableForGrandfatheredCommunityDesc),c.ScriptLevelGrandfatheredConfirmTitle,function(e){e&&n({type:"SetSecurityLevel",data:t})},{className:"slds-vex-theme slds-vex-theme--medium",yesText:c.Allow,afterCloseFocusEl:document.activeElement,a11y:!0}))},onCloseCallback:function(){a({type:"ToggleSecurityLevelIsOpen",data:!1})},onOpenCallback:function(){a({type:"ToggleSecurityLevelIsOpen",data:!0})},selected:s.get("currentScriptSecurityLevel")}).toggle(e.currentTarget)}function p(e,i,t){var s=T(t.currentTarget),t=s.is(":checked"),a=!e.get("isLockerServiceEnabled");t?i({type:"UpdateLockerServiceEnabledState",data:a}):(s.prop("checked",!0),v.getDisallowedCustomComponentsForDisablingLockerAsync(function(e){var m,v,t,n=E.getSite().isWebApp();_.isEmpty(e)?A.sldsConfirm(n?c.WebSecurityServiceDisableConfirmDesc:c.LockerServiceDisableConfirmDesc,n?c.WebSecurityServiceDisableConfirmTitle:c.LockerServiceDisableConfirmTitle,function(e){e&&(s.prop("checked",!1),i({type:"UpdateLockerServiceEnabledState",data:a}))},{className:"slds-vex-theme slds-vex-theme--medium",yesText:c.Allow,afterCloseFocusEl:document.activeElement,a11y:!0}):A.sldsPromptAlert({title:n?c.DisallowedComponentsForDisablingWebSecurityTitle:c.DisallowedComponentsForDisablingLockerTitle,content:(n=n?c.DisallowedComponentsForDisablingWebSecurityContent:c.DisallowedComponentsForDisablingLockerContent,v={},t="",_.each(e,function(e){m=e.packageName,v[m]||(v[m]=[]);var t,n="<strong>"+e.name+" ("+b[y]+")</strong>",i="<em>"+e.locationData.viewName+"</em> "+b.PAGE_VARIATION,s="<strong>"+e.name+" ("+b[C]+")</strong>",a="<em>"+e.locationData.rootContainerLabel+"</em> "+b.THEME_LAYOUT,o="<em>"+e.locationData.regionLabel+"</em> "+b.REGION,r="<strong>"+e.name+" ("+b[S]+")</strong>",l=e.locationData.rootContainerType,c=e.locationData.rootContainerName,d=e.locationData.rootContainerDescriptor,u=e.locationData.secondaryContainerType,p=e.locationData.secondaryContainerName,g=e.locationData.inContent,h=e.locationData.immediateChild;l==f?t=h||u?h&&u?L.format(b.Format2,n,p+" ("+b[y]+")",i):L.format(b.Format3,n,i):L.format(b.Format1,n,i):l==C?e.descriptor===d?t=L.format(b.Format4,s,a):!g&&h?t=L.format(b.Format7,n,c+" ("+b[C]+")",a):g||h?g&&h&&u?t=L.format(b.Format10,n,p+" ("+b[y]+")",o,a):g&&!h&&u?t=L.format(b.Format6,n,o,a):!g||h||u||(t=L.format(b.Format5,n,o,a)):t=L.format(b.Format8,n,c+" ("+b[C]+")",a):l==S&&(t=e.descriptor===d?L.format(b.Format1,r,i):h?L.format(b.Format2,n,c+" ("+b[S]+")",i):L.format(b.Format9,n,c+" ("+b[S]+")",i)),e.outputString=t,v[m].push(e)}),t=_.isEmpty(v)?t:r({packages:v,description:n})),yesText:PicassoWebServices.Labels.PicassoDialog.GotIt,headerClass:"cb-Dialog_header--info",className:"cb-SettingsSecurityCSPView-disallowedComponentsDialog"})}))}function e(e,t,n){return e("div.cb-SettingsSecurityCSPView",[e("div.cb-SettingsSecurityCSPView-title.cb-Settings-formGroupHeader",{props:{innerHTML:c.Title}}),e("div.cb-SettingsSecurityCSPView-statusContainer",[e("div.cb-SettingsSecurityCSPView-statusSelectContainer",[e("div.slds-grid",[e("label.cb-SettingsSecurityCSPView-statusSelectTitle",{attrs:{for:"cb-SettingsSecurityCSPView-statusSelectDropdown"}},c.ScriptLevelTitle),t.get("showSpinner")?e("div.slds-grid",bg.spinner(e,{containerClassName:"cb-SettingsSecurityCSPView-spinnerContainer",spinnerClassName:"slds-spinner_x-small"})):""]),e("div.cb-SettingsSecurityCSPView-statusSelectDescription",{props:{innerHTML:c.ScriptLevelDesc}}),e("div.cb-SettingsSecurityCSPView-statusSelectDropdownContainer.js-settings-security-dropdown-container",{attrs:{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","data-id":t.get("currentScriptSecurityLevel")}},[e("input.cb-SettingsSecurityCSPView-statusSelectDropdownToggle",{props:{value:d[t.get("currentScriptSecurityLevel")],id:"cb-SettingsSecurityCSPView-statusSelectDropdown"},on:{mouseup:u.bind(null,t,n),keyup:function(e,t,n){var i=n.keyCode;e.get("isSecurityLevelDropdownOpen")||P.KEYCODE.DOWN===i&&u(e,t,n)}.bind(null,t,n)},attrs:{tabindex:0,readonly:!0,autoComplete:"off",role:"textbox",placeholder:c.ScriptLevelPlaceholder}}),bg.icon(e,{icon:"down",className:"cb-SettingsSecurityCSPView-statusSelectDropdownToggleIcon slds-icon_x-small",label:"DOWN"})]),(i=e,s=t,a=n,o=(r=E.getSite().isWebApp())?c.WebSecurityServiceStatusTitle:c.LockerServiceStatusTitle,r=r?c.WebSecurityServiceStatusDescription:c.LockerServiceStatusDescription,s.get("scriptSecurityLevels").GRANDFATHERED!==s.get("currentScriptSecurityLevel")?i("div.cb-SettingsSecurityCSPView-lockerServiceStatusContainer.js-settings-security-locker-service-container",{attrs:{enabled:s.get("isLockerServiceEnabled")}},[i("div",{class:"cb-SettingsSecurityCSPView-lockerServiceToggleContainer"},[i("div",{class:"cb-SettingsSecurityCSPView-lockerServiceTitle"},o),bg.checkbox(i,{formClass:"cb-SettingsSecurityCSPView-lockerServiceToggle",checkboxClass:"js-settings-security-locker-service-checkbox",checkboxFauxClass:"js-settings-security-locker-service-checkbox-faux",checkboxInputName:"locker-service-toggle",checkboxEnabledText:c.LockerServiceEnabled,checkboxDisabledText:c.LockerServiceDisabled,checked:s.get("isLockerServiceEnabled"),onChange:p.bind(null,s,a)})]),i("div.slds-text-body_regular cb-SettingsSecurityCSPView-lockerServiceDescription",r)]):null)]),(o=e,(s=t).get("currentScriptSecurityLevel")===s.get("scriptSecurityLevels").GRANDFATHERED?o("div.cb-SettingsSecurityCSPView-statusWarningContainer",[bg.icon(o,{icon:"warning",className:"cb-SettingsSecurityCSPView-statusWarningIcon slds-icon_small",label:c.ScriptLevel_grandfatheredWarningIconLabel}),o("span.cb-SettingsSecurityCSPView-statusWarningLabel",{props:{innerHTML:c.ScriptLevelGrandfatheredWarningDesc}})]):null)]),(a=e,(i=t).get("currentScriptSecurityLevel")===i.get("scriptSecurityLevels").LOCKED?a("div.cb-SettingsSecurityCSPView-additionalMessage",{props:{innerHTML:c.ScriptLevelAdditionalTextLocked.replace("{0}",E.getSite().get("cspTrustedSitesUrl"))}}):null),t.get("scriptSecurityLevels").GRANDFATHERED!==t.get("currentScriptSecurityLevel")?l.render(e,t,function(e){n({type:"TrustedSiteAction",data:e})}):null]);var i,s,a,o,r}return{init:function(){return[Immutable.Map({isSecurityLevelDropdownOpen:!1,currentScriptSecurityLevel:v.getCurrentScriptSecurityLevel(),scriptSecurityLevels:v.getScriptSecurityLevels(),scriptSrcTrustedSites:v.getScriptSrcTrustedSites(),isLockerServiceEnabled:v.isLockerServiceEnabled()})]},render:e,update:function(e,t){var n,i=[e];return"SetSecurityLevel"===t.type?n=function(){I.event.trigger("action:set-csp-security-level",{securityLevel:t.data})}:"ToggleSecurityLevelIsOpen"===t.type?i=[e=e.set("isSecurityLevelDropdownOpen",void 0!==t.data?t.data:!e.get("isSecurityLevelDropdownOpen"))]:"TrustedSiteAction"===t.type?i=l.update(e,t.data):"FetchData"===t.type?i=[e=(e=(e=(e=e.set("currentScriptSecurityLevel",v.getCurrentScriptSecurityLevel())).set("scriptSecurityLevels",v.getScriptSecurityLevels())).set("scriptSrcTrustedSites",v.getScriptSrcTrustedSites())).set("isLockerServiceEnabled",v.isLockerServiceEnabled())]:"ToggleSpinner"===t.type?i=[e=e.set("showSpinner",t.data)]:"UpdateLockerServiceEnabledState"===t.type&&I.event.trigger("action:update-locker-service-enabled-state",{enableLockerService:t.data}),n&&i.push(n),i},subscriptions:function(){return[["state:script-src-trusted-sites-updated",function(e){e({type:"FetchData"})}],["state:csp-security-level-updated",function(e){e({type:"FetchData"})}],["state:locker-service-enabled-state-updated",function(e){e({type:"FetchData"})}]]}}}function vm(){var o=PicassoWebServices.Labels.CommBuilderSecurityCSPSettings;function r(e,t,n,i){var s=document.createElement("div"),a=A.showDialogAdvanced({content:s,className:"slds-vex-theme",contentClassName:"cb-Dialog js-dialog cb-SettingsSecurityCSPView-trustedSiteDialog test-trusted-site-dialog",afterCloseFocusEl:document.activeElement,a11y:!0}),a=$m({currentTrustedSite:i.trustedSite,vexId:a.data().vex.id,valid:i.valid,mode:i.mode});Bg(a,s)}function s(n,e,i){var e=e.get("scriptSrcTrustedSites"),s=[];return e.forEach(function(e){var t=e.get("isActive")?o.TrustedSitesTableStatusActive:o.TrustedSitesTableStatusInactive;s.push(n("tr.test-settings-security-trusted-sites-table-row",{attrs:{"data-id":e.get("sourceName")}},[n("td",[n("div.slds-truncate.slds-p-right_x-small.test-settings-security-trusted-sites-table-row-name",{attrs:{title:e.get("sourceName"),"data-value":e.get("sourceName")}},e.get("sourceName"))]),n("td",[n("div.slds-truncate.slds-p-right_x-small.test-settings-security-trusted-sites-table-row-source",{attrs:{title:e.get("source"),"data-value":e.get("source")}},e.get("source"))]),n("td",[n("div.cb-SettingsSecurityCSPView-trustedSitesTableRowStatus.test-settings-security-trusted-sites-table-row-status.slds-truncate.slds-p-right_x-small",{class:{"cb-SettingsSecurityCSPView-trustedSitesTableRowStatusIsActive":e.get("isActive")},attrs:{title:t,"data-value":e.get("isActive")}},t)]),n("td",[n("div",(t=e,bg.dropdownButtonIcon(n,{buttonClassName:"test-settings-security-trusted-sites-table-row-action",click:function(e,t,n,i){var s=jQuery(i.currentTarget),a=new Wo({config:[{items:[{key:"edit",locator:"test-edit",label:o.Edit,action:function(){r(0,0,0,{trustedSite:t,valid:!0,mode:"EDIT"})},icon:{sprite:"utility",name:"edit"}},{key:"delete",locator:"test-delete",label:o.Delete,action:function(t){A.sldsConfirm(o.TrustedSiteDeleteDlgDesc,o.TrustedSiteDeleteDlgTitle,function(e){e&&n({type:"DeleteTrustedSite",data:t})},{className:"slds-vex-theme slds-vex-theme--medium",yesText:"Delete",yesTextClassName:"slds-button slds-button_destructive test-yes",a11y:!0})},icon:{sprite:"utility",name:"delete"}}]}]}),i=i.currentTarget.getAttribute("data-id");a.onToggle(s,i,null,null,"left")}.bind(null,n,t,i),attrs:{"data-id":t.get("id")},label:o.ShowMore})))])]))}),s}function e(e,t,n){var i=bg.button(e,{className:"cb-SettingsSecurityCSPView-trustedSitesTableAddButton test-settings-security-trusted-sites-add slds-button_neutral",label:o.TrustedSitesAddButton,icon:{icon:"add",className:"slds-icon-text-default slds-button__icon slds-button__icon_left"},disabled:!1,click:function(){r(0,0,0,{trustedSite:Immutable.Map({id:"",isActive:!0,source:"",sourceName:""}),valid:!1,mode:"NEW"})}});return e("div.cb-SettingsSecurityCSPView-trustedSitesContainer.test-settings-security-trusted-sites-container",[e("div.cb-SettingsSecurityCSPView-trustedSitesTitle.cb-Settings-formGroupSubHeader",o.TrustedSitesTitle),e("div.cb-SettingsSecurityCSPView-trustedSitesDescription.cb-Settings-formGroupSubHeaderDescription",{props:{innerHTML:o.TrustedSitesDesc.replace("{0}",E.getSite().get("cspTrustedSitesUrl"))}}),(e=e,n=n,(t=t).get("scriptSrcTrustedSites").size?e("table.cb-SettingsSecurityCSPView-trustedSitesTable.test-settings-security-trusted-sites-table.slds-table.slds-table_cell-buffer.slds-no-row-hover.slds-table_bordered",[e("thead",[e("tr",[e("th",[e("div.slds-truncate.slds-p-right_x-small",o.TrustedSitesTableName)]),e("th",[e("div.slds-truncate.slds-p-right_x-small",o.TrustedSitesTableUrl)]),e("th",[e("div.slds-truncate.slds-p-right_x-small",o.TrustedSitesTableStatus)]),e("th",[e("div","")])])]),e("tbody",s(e,t,n))]):null),i])}return{render:e,update:function(t,n){"DeleteTrustedSite"===n.type&&(e=function(){var e=t.get("scriptSrcTrustedSites").find(function(e){return e.get("id")===n.data});I.event.trigger("action:remove-script-src-trusted-site",{trustedSiteId:n.data,existingTrustedSite:e.toJSON()})});var e,i=[t];return e&&i.push(e),i}}}function bm(){function s(e){var t=Um.getDataRows()[e.currentTarget.dataset.rowid],n="js-csp-violation-uri-edit";A.sldsConfirm(l({input:r({value:t.blockedUri,inputClassName:n}),notScriptSrc:"script-src"!==t.directive}),a.CSPViolationsWhitelistConfirmTitle,function(e){e&&(e=document.getElementsByClassName(n)[0].value,v.addTrustedSite(e,t.directive))},{className:"slds-vex-theme slds-vex-theme--medium",contentClassName:"cb-Dialog cb-SettingsCspViolationsView-dialog",yesText:a.CSPViolationsWhitelistConfirmYes,afterCloseFocusEl:document.activeElement,a11y:!0})}function i(e){v.getCspViolations(function(){e({type:"FetchData"})})}var a=PicassoWebServices.Labels.CommBuilderSecurityCSPSettings,o=_.template('<div class="slds-illustration slds-illustration_small">  <div aria-hidden="true" class="cb-SettingsCspViolationsView-noRowsImage"></div>  <div class="slds-text-longform cb-SettingsCspViolationsView-noRowsText">    <h3 class="slds-text-heading_medium">'+a.CSPViolationsNoRowsHeader+'</h3>    <p class="slds-text-body__regular">'+a.CSPViolationsNoRowsContent+"</p>  </div></div>"),r=_.template('<div class="slds-form-element"><label class="slds-form-element__label"><abbr class="slds-required">*</abbr><span>'+a.TrustedSiteDlgURL+'</span><input type="text" class="slds-input {{= inputClassName }}" maxlength="2000" value="{{- value }}" data-orig-value="{{- value }}"/></label></div>'),l=_.template('{{= input }}{{ if (notScriptSrc) { }}<div class="cb-SettingsCspViolationsView-dialog__note">'+a.CSPViolationsWhitelistNonScriptNote+"</div>{{ } }}");return{init:function(){return[Immutable.Map({dataTableHtml:Wm.dataTableHtml||null,showSpinner:!1,refreshOnRender:!0})]},render:function(e,t,n){return(t=t.get("dataTableHtml")?t:t.set("showSpinner",!0)).get("refreshOnRender")&&i(n),n=t,(t=e)("div.cb-SettingsSecurityCspViolationsView",[t("div.cb-SettingsSecurityCspViolationsView-title.cb-Settings-formGroupSubHeader",{props:{innerHTML:a.CSPViolationsHeader}}),t("div.cb-SettingsSecurityCspViolationsView-description.cb-Settings-formGroupSubHeaderDescription",{props:{innerHTML:a.CSPViolationsDescription}}),t("div.js-csp-violations-table",{props:{innerHTML:n.get("dataTableHtml")?n.get("dataTableHtml"):""}}),t("div"+(n.get("showSpinner")?"":".slds-hide"),bg.spinner(t,{containerClassName:"cb-SettingsCspViolationsView-spinnerContainer js-csp-violations-spinner-container ",spinnerClassName:"slds-spinner_x-small"}))])},update:function(e,t){var n=[e];if("FetchData"===t.type){if(e=e.set("refreshOnRender",!1),0===v.getCspViolations().length)return i=o(),Wm.dataTableHtml=i,n=[e=e.set("dataTableHtml",i)];var i=new Ng({dataProvider:Um,parentRef:this}).render().$el.html();Wm.dataTableHtml=i,n=[e=e.set("dataTableHtml",i),function(e){_.each(document.getElementsByClassName("js-csp-violations-whitelist"),function(e){e._addedListener||(e._addedListener=!0,e.addEventListener("click",s))}),$(".cb-SettingsCspViolationsView-blockedTooltip").tooltip()}]}return n},subscriptions:function(){return[["state:site-clickjack-protection-level-updated",function(e){i(e)}]]}}}function fm(){function e(e,t,n){return e("div.cb-SettingsPrivacy-cookieConsentView",[e("div.cb-SettingsPrivacyConsentCookie-title.cb-Settings-formGroupHeader",Fm.CookieConsentHeader),e("div.slds-card.cb-SettingsPrivacy-cookieConsentCard",[e("header.cb-SettingsPrivacy-cookieConsentHeading",Fm.CookieConsentTitle),e("div.cb-SettingsPrivacy-cookieConsentCardBody",[e("div.slds-text-body_regular.cb-SettingsPrivacy-cookieConsentDescription",{props:{innerHTML:Fm.CookieConsentDescription}}),bg.checkbox(e,{formClass:"slds-form-element",checkboxClass:"cb-SettingsPrivacy-cookieConsentToggle",checkboxFauxClass:"cb-SettingsPrivacy-cookieConsentToggle",checkboxInputName:"cookie-consent-toggle",checkboxEnabledText:Fm.CookieConsentEnabled,checkboxDisabledText:Fm.CookieConsentDisabled,checked:t.get("isCookieConsentEnabled"),onChange:function(e,t,n){t({type:"UpdateCookieConsentEnabledState",data:$(n.currentTarget).is(":checked")})}.bind(null,t,n)})])])])}return{init:function(){return[Immutable.Map({isCookieConsentEnabled:E.getSite().isCookieConsentEnabled()})]},render:e,update:function(e,t){var n,i=[e];return"UpdateCookieConsentEnabledState"===t.type?n=function(){I.event.trigger("action:update-site-property",{name:"CookieConsentEnabled",value:t.data})}:"FetchData"===t.type&&(i=[e=e.set("isCookieConsentEnabled",E.getSite().isCookieConsentEnabled())]),n&&i.push(n),i}}}var _m,Sm,Cm,ym,Tm,Pm,Im,Em,wm=Backbone.View.extend({className:"cb-ColorEditor test-color-editor",template:_.template('<label class="cb-ColorEditor-label {{= brandingDefLabel ? " cb-ColorEditor-label--mapped " : ""}}{{= infoTooltip ? " cb-ColorEditor-label--hasTooltip ": ""}}slds-truncate slds-form-element__label" title="{{- label }}">{{- label }}</label>{{ if (brandingDefLabel && !value) { }}<div class="cb-ColorEditor-iconContainer js-color-editor-icon-container" data-test-tooltip="{{= tooltipText }}"></div>{{ } }}<div class="cb-ColorEditor-actionButtonContainer {{= infoTooltip ? "cb-ColorEditor-actionButtonContainer--hasTooltip": ""}}"><button class="cb-ColorEditor-actionButton js-color-editor-action-button" style="background-color: {{= value ? value : brandingValue }}"><span class="slds-assistive-text">{{- label }}</button><div class="cb-ColorEditor-actionButtonBackground"></div></div>'),scopedBrandingTemplate:function(e){var t=e.brandingValue,n=(e.brandingSet,e.brandingDefLabel),i=e.label,i=void 0===i?"":i,s=e.value,a=e.infoTooltip,e=(e.tooltipText,"cb-ColorEditor-label slds-truncate slds-form-element__label ".concat(n?"cb-ColorEditor-label--mapped":""," ").concat(a?"cb-ColorEditor-label--hasTooltip":"").trim());return'\n        <label class="'.concat(e,'" title="').concat(i,'">').concat(i,"</label>\n        ").concat(n&&!s?'<div class="cb-ColorEditor-iconContainer js-color-editor-icon-container" data-test-tooltip="{{= tooltipText }}"></div>':"",'\n        <div class="cb-ColorEditor-actionButtonContainer ').concat(a?"cb-ColorEditor-actionButtonContainer--hasTooltip":"",'">\n            <button class="cb-ColorEditor-actionButton js-color-editor-action-button" style="background-color: ').concat(s||t,'"><span class="slds-assistive-text">').concat(i,'</button>\n            <div class="cb-ColorEditor-actionButtonBackground"></div>\n        </div>').trim()},events:{"mousedown .js-color-editor-action-button":"_onActionButtonClick","keydown .js-color-editor-action-button":"_onActionButtonKeyup"},initialize:function(e){this._label=e.label,this._value=e.value,this._attributeName=e.attributeName,this._componentItemId=e.componentItemId,this._onChangeCallbackFromParent=e.onChangeCallback,this._infoTooltip=e.infoTooltip,this._hideAlpha=e.hideAlpha,I.event.on("state:branding-set-values-updated",this._renderAsync.bind(this)),I.event.on("state:preview-site-branding-set-updated",this._renderAsync.bind(this)),this.listenTo(j.getAppEvent(),"select-aura-component",this._onSelectComponent),this.listenTo(I.event,"state:aura-component-moved",this._handleComponentMoved),this.listenTo(j.getAppEvent(),"unselect-aura-component",this._hidePopover),this.$el.attr("data-attribute",this._attributeName),this._renderAsync()},render:function(){var e={brandingValue:this._brandingValue,brandingDefLabel:this._brandingDefLabel,label:this._label,value:this._value,infoTooltip:this._infoTooltip,labels:pm()},t=N.isScopedBrandingSetManagementEnabled(),n=this._getTooltipText(t),t=t?this.scopedBrandingTemplate(m(m({},e),{},{brandingSet:this._brandingSet,tooltipText:n})):this.template(m(m({},e),{},{tooltipText:n}));return this.$el.html(t),n&&this._renderHelpText(n),this},_getTooltipText:function(e){var t=pm(),n=null;return n=this._brandingSet&&!this._value?e?t.LinkedTo.replace("{0}",this._brandingSet.name).replace("{1}",this._brandingDefLabel):t.LinkedTo.replace("{0}",this._brandingDefLabel):n},_renderHelpText:function(e){var n=this;$P.auraRun(function(){$A.createComponent("lightning:helpText",{content:e,iconName:"utility:link"},function(e){var t;e&&(t=n.$(".js-color-editor-icon-container").empty(),$A.render(e,t[0]),$A.afterRender(e))})})},_renderAsync:function(){N.getBrandingPropertyInfoForComponentAttribute(this._componentItemId,this._attributeName,function(e){var e=e||{},t=e.value,e=e.labels,n=N.getClosestBrandingSetId(this._componentItemId);this._brandingSet=l.getBrandingSet(n),this._brandingValue=t,this._brandingDefLabel=null==e?void 0:e.label,this.render()}.bind(this))},_onActionButtonClick:function(){this._popover?this._hidePopover():this._showPopover()},_onSelectComponent:function(e){e&&e.id&&e.id!==this._componentItemId&&this._hidePopover()},_handleComponentMoved:function(e){e.itemId===this._componentItemId&&this._brandingValue&&this._renderAsync()},_hidePopover:function(){this._popover&&(this._popover.destroy(),this._popover=null)},_showPopover:function(){var e;this._popover||(e=new um({labels:pm(),value:this._value,parentLabel:this._label,brandingDefLabel:this._brandingDefLabel,brandingValue:this._brandingValue,brandingSet:this._brandingSet,hideAlpha:this._hideAlpha,onChangeCallback:this._onChangeCallback.bind(this)}),this._popover=Zr({view:e.$el[0],trigger:this.$(".js-color-editor-action-button")[0],options:{dismissSelector:".js-close-btn",className:"cb-ColorEditorPicker-panel",offsetTriggerWidth:!1,destroyCallback:function(){this._popover=null,e.destroy(),this._returnFocusToActionButton()}.bind(this),successCallback:e.reflow.bind(e)}}),this._popover.show())},_returnFocusToActionButton:function(){var e=this.$(".js-color-editor-action-button");e&&e.focus()},_onActionButtonKeyup:function(){var e;event.defaultPrevented||(e=event.keyCode,P.KEYCODE.ENTER===e?this._showPopover():P.KEYCODE.TAB===e&&this._hidePopover())},_onChangeCallback:function(e){var t=this.$(".js-color-editor-action-button")[0],n=t.getBoundingClientRect();(n.x||n.y||n.width||n.height)&&this._popover.reposition(t),this._value=e,this.render(),this._onChangeCallbackFromParent(e)}}),i=PicassoWebServices.Labels.CommBuilderSettings,Lm=Backbone.View.extend({template:function(e){e=e.header;return'\n            <div class="cb-settings-tab-bar-style">\n            '.concat(e,"\n            <div class='cb-settings-tab-bar-style-content js-tab-styles-section'></div>\n        </div>")},headerTemplate:_.template('<div class=\'cb-Settings-formGroupHeaderContainer\'>\n            <div class="cb-Settings-formGroupHeaderWithIcon">\n                {{= icon}}\n                <h3 class="cb-Settings-formGroupHeaderText">'.concat(i.MobilePublisherSettingsTabBarStyleTabTitle,"</h3>\n            </div>\n            <div class='cb-Settings-formGroupHeaderDescription'>").concat(i.MobilePublisherSettingsTabBarStyleDescription,"</div>\n        </div>").trim()),render:function(){var t,e,n=this;return this.$el.append(this.template({header:this.headerTemplate({icon:this.headerIcon()})})),t=$h.branding,(e=[{name:"TabBarBackgroundColor",attributeName:"barTintColor",label:rm.TabBarStyleTabBarBackgroundColorTitle},{name:"TabBarIconColor",attributeName:"iconTintColorUnselected",label:rm.TabBarStyleTabIconColorTitle},{name:"ActiveTabIconColor",attributeName:"iconTintColor",label:rm.TabBarStyleActiveTabIconColorTitle,componentItemId:"community_builder:native_tab_bar"}]).forEach(function(e){!t.isBrandingNonDefault&&e.componentItemId||(e.value=tinycolor(t.values[e.attributeName]).toRgbString()||om[e.attributeName]||""),e.hideAlpha=!0}),e.forEach(function(e){n._appendProperty(e)}),this},initialize:function(){this.render()},_appendProperty:function(n){var e;n&&(n.onChangeCallback=function(e){var t={};t[n.attributeName]=e,I.event.trigger("action:update-native-tab-bar-properties",t)}.bind(this),e=new wm(n),this.$el.find(".js-tab-styles-section").append(e.$el))},headerIcon:function(){return $P.viewTypes.CommonTemplates.icon({svgClassName:"slds-icon_x-small cb-Settings-formGroupHeaderIcon",sprite:"standard",icon:"brand"})}}),Dm=PicassoWebServices.Labels.CommBuilderSettings,Am={formClass:"",inputClass:"",isChecked:"",isDisabled:"",labelClass:"",label:"",desc:""},km=Backbone.View.extend({template:function(e){e=e.header;return'\n            <div class="cb-settings-additional-nav-options">\n                '.concat(e,"\n            </div>")},headerTemplate:_.template('<div class=\'cb-Settings-formGroupHeaderContainer\'>\n            <div class="cb-Settings-formGroupHeaderWithIcon">\n                {{= icon}}\n                <h3 class="cb-Settings-formGroupHeaderText">'.concat(Dm.MobilePublisherTabBarAdditionalNavOptionsTitle,"</h3>\n            </div>\n            <div class='cb-Settings-formGroupHeaderDescription'>{{= description}}</div>\n        </div>").trim()),showNavMenuTemplate:_.template('<div class="slds-form-element {{= formClass}}">\n            <div class="slds-form-element__control">\n                <label class="slds-checkbox slds-checkbox-container">\n                    <input type="checkbox" class="{{= inputClass}}" {{= isChecked}} {{= isDisabled }} />\n                    <span class="slds-checkbox_faux {{= inputClass}}-faux"></span>\n                    <span class="slds-form-element__label {{= labelClass}}">{{= label}}</span>\n                    <span class="icon-utility-info {{= (desc ? \'\' : \'hidden\')}}" data-toggle="tooltip" data-placement="right" title="{{= desc}}"></span>\n                </label>\n            </div>\n        </div>'.trim()),tabMobileNavConfigTemplate:_.template('<div class="cb-SettingsMobilePublisherSection-NavigationOptions">\n            <img src="/sfsites/sfservice/builder/resources/images/mp-back-nav.svg" alt="">\n            <img src="/sfsites/sfservice/builder/resources/images/mp-hamburger-back-nav.svg" alt="">\n            <div class=\'cb-SettingsMobilePublisherSection-FlexAuto\'>\n                <fieldset class="slds-form-element">\n                    <legend class="slds-form-element__legend slds-form-element__label">'.concat(Dm.MobilePublisherIOSOnly,'</legend>\n                    {{= showBackButtonTmpl}}\n                    {{= showHamburgerMenuWithBackButtonTmpl}}  \n                </fieldset>\n            </div>\n            <img src="/sfsites/sfservice/builder/resources/images/mp-hamburger-nav.svg" alt="">\n            <div class=\'cb-SettingsMobilePublisherSection-FlexAuto\'>\n                <fieldset class="slds-form-element">\n                <legend class="slds-form-element__legend slds-form-element__label">').concat(Dm.MobilePublisherAndroidAndIOS,"</legend>\n                {{= showHamburgerMenuTmpl}}\n                </fieldset>\n            </div>\n        </div>").trim()),initialize:function(){this.render(),this.listenTo(I.event,"state:show-ios-nav-menu-config-updated",this._showIosNavMenuConfigUpdated)},render:function(){var e=I.AccessControl(P.PERMISSIONS.IS_MOBILE_PUBLISHER_NAVIGATION_OPTIONS_ENABLED),t=e?Dm.MobilePublisherTabBarAdditionalNavOptionsDescription:Dm.MobilePublisherNavigationOptionsNotEnabledForLwr;return this.$el.append(this.template({header:this.headerTemplate({icon:this.headerIcon(),description:t})})),e&&(this.$el.find(".cb-settings-additional-nav-options").append(this.renderMobileNavigationConfiguration()),this.$el.find('[data-toggle="tooltip"]').tooltip()),this},events:{"change .js-show-hide-nav-menu":"_handleShowHideNavMenuChange","click .js-show-hide-hamburger-menu-ios":"_handleShowHamburgerMenuIOS","click .js-show-hide-backbutton":"_handleShowHideBackButtonChange"},renderMobileNavigationConfiguration:function(){var e=Wh,t=e.showBackButton,e=e.showHamburgerMenuWithBackButton,n=this.showNavMenuTemplate(m(m({},Am),{},{inputClass:"js-show-hide-nav-menu",isChecked:Uh?"checked":"",labelClass:"cb-SettingsMobilePublisherSection-showHamburgerMenu",label:Dm.MobilePublisherShowHamburgerMenu})),i=this.showNavMenuTemplate(m(m({},Am),{},{inputClass:"js-show-hide-backbutton",isChecked:t?"checked":"",labelClass:"cb-SettingsMobilePublisherSection-showBackbutton",label:Dm.MobilePublisherShowBackButton})),e=this.showNavMenuTemplate(m(m({},Am),{},{formClass:"cb-Settings-showHamburgerMenu js-show-hamburger-ios-form",inputClass:"js-show-hide-hamburger-menu-ios",isChecked:e?"checked":"",isDisabled:t?"":"disabled",labelClass:"cb-SettingsMobilePublisherSection-showHamburgerMenu",label:Dm.MobilePublisherShowHamburgerMenuWithBackButton}));return this.tabMobileNavConfigTemplate({showHamburgerMenuTmpl:n,showBackButtonTmpl:i,showHamburgerMenuWithBackButtonTmpl:e})},headerIcon:function(){return $P.viewTypes.CommonTemplates.icon({svgClassName:"slds-icon_x-small cb-Settings-formGroupHeaderIcon",sprite:"utility",icon:"touch_action"})},_handleShowHideNavMenuChange:function(e){e=$(e.currentTarget).is(":checked");I.event.trigger("action:update-native-show-hide-navmenu",{showNavMenu:e})},_handleShowHamburgerMenuIOS:function(e){e=e.currentTarget.checked;I.event.trigger(Yh,{showBackButton:!0,showHamburgerMenuWithBackButton:e})},_handleShowHideBackButtonChange:function(e){var e=e.currentTarget.checked,t=this.$el.find(".js-show-hide-hamburger-menu-ios"),t=!!e&&t.is(":checked");I.event.trigger(Yh,{showBackButton:e,showHamburgerMenuWithBackButton:t})},_showIosNavMenuConfigUpdated:function(e){var t=this.$el.find(".js-show-hide-hamburger-menu-ios");t.prop("disabled",!e.showBackButton),t.prop("checked",e.showHamburgerMenuWithBackButton)}}),Nm=PicassoWebServices.Labels.CommBuilderSettings,xm="tab-navigation",Rm="tab-app-settings",e=Backbone.View.extend({_hasLoadedData:!1,className:"cb-Settings-section cb-Settings-mobilePublisherSection js-settings-mobilePublisherSection-section",_networkId:null,template:function(e){e=e.mobilePublisherSectionTabs;return'<h2 class="cb-Settings-sectionHeading">'.concat(Nm.MobilePublisherSettingTitle,'</h2>\n            <div class="cb-Settings-sectionDescription">').concat(Nm.MobilePublisherSettingsDescription,'</div>\n            <div class="cb-MobilePublisherSection-tabsContainer slds-tabs_default">').concat(e,'</div>\n            <div class="cb-Settings-mobilePublisherSection js-settings-mobile-publisher-section"></div>').trim()},mobilePublisherSectionTabsTemplate:function(e){e=e.tabItems;return'\n            <ul class="cb-MobilePublisherSection-tabsNav slds-tabs_default__nav" role="tablist">\n                '.concat(e.map(function(e){return'<li data-id="'.concat(e.tabId,'" class="cb-MobilePublisherSection-tabsNavItem slds-tabs_default__item js-sd-tab-item" role="presentation" data-id="').concat(e.tabId,'">\n                        <a href="javascript:void(0)" data-id="').concat(e.tabId,'" class="cb-MobilePublisherSection-tabsNavItemLink slds-tabs_default__link" role="tab">').concat(e.tabLabel,"</a>\n                    </li>").trim()}).join(""),"\n            </ul>").trim()},mobilePublisherSectionTabTemplate:b.template('<div class="cb-MobilePublisherSection-tabContent js-mp-tab-content" data-id="{{= tabId }}"></div>'.trim()),events:{"click .js-sd-tab-item:not(.slds-is-active)":"_onTabClick"},initialize:function(){this._networkId=I.getAppState().getNetworkId(),this.render(),this.listenTo(I.event,"state:native-tab-menu-item-updated",this._handleNativeTabMenuItemUpdated)},renderTabAppSettings:function(e){e=this.mobilePublisherSectionTabTemplate({tabId:e});this.$(".js-settings-mobile-publisher-section").html(e),new im({el:".js-mp-tab-content"})},renderTabBarNavigation:function(e){e=this.mobilePublisherSectionTabTemplate({tabId:e});this.$(".js-settings-mobile-publisher-section").html(e),new am({el:".js-mp-tab-content"}),new Lm({el:".js-mp-tab-content"}),new km({el:".js-mp-tab-content"})},render:function(){var e;return this._hasLoadedData?(e=[{tabId:xm,tabLabel:Nm.MobilePublisherSettingsTabNavigationTabTitle}],e=(I.AccessControl(P.PERMISSIONS.IS_MOBILE_PUBLISHER_APP_SETTINGS_ENABLED)&&e.push({tabId:Rm,tabLabel:Nm.MobilePublisherAppSettingsTabTitle}),this.mobilePublisherSectionTabsTemplate({tabItems:e})),this.$el.html(this.template({mobilePublisherSectionTabs:e})),this._selectTab(this._selectedTabId||"tab-navigation")):Jh(),this},_handleNativeTabMenuItemUpdated:function(){this._hasLoadedData=!0,this.render()},_onTabClick:b.debounce(function(e){e=T(e.currentTarget).attr("data-id");this._selectTab(e)},125),_selectTab:function(e){var t=this.$('.js-sd-tab-item[data-id="'+e+'"]');switch(this.$('.js-sd-tab-item[data-id="'+this._selectedTabId+'"]').removeClass("slds-is-active"),t.addClass("slds-is-active"),this.$(".js-mp-tab-content").remove(),e){case xm:this.renderTabBarNavigation(e);break;case Rm:this.renderTabAppSettings()}this._selectedTabId=e}}),mr=PicassoWebServices.Labels.CommBuilderSettings,Np=Backbone.View.extend({className:"cb-Settings-section cb-Settings-searchSection js-Settings-searchSection",template:_.template('\n        <h2 class="cb-Settings-sectionHeading">\n            '.concat(mr.SearchIndexSettingsSectionTitle,'\n        </h2>\n        <div class="cb-Settings-sectionDescription">\n            ').concat(mr.SearchIndexSettingsSectionDescription,'\n        </div>\n        <div class="js-Settings-searchSectionContent"></div>\n        <div class="cb-Settings-searchSection-spinner js-Settings-searchSection-spinner slds-is-relative slds-p-top_large">\n            {{= $P.viewTypes.CommonTemplates.spinner }}\n        </div>\n    ')),initialize:function(){this.render()},render:function(){this.$el.html(this.template()),this.renderComponent()},renderComponent:function(){var t=this,e={siteId:E.getSite().get("uddid")};$P.auraRun(function(){$A.createComponent("communitySetup:cbSearchIndex",e,function(e){e&&($A.render(e,t.$(".js-Settings-searchSectionContent")[0]),$A.afterRender(e),t.$el.on("lightning__showtoast",t.showToast.bind(t)),t.$(".js-Settings-searchSection-spinner").hide())})})},showToast:function(e){var e=e.originalEvent.toastAttributes,t=e.message,n=e.title,i=e.type,s={message:n,details:t,duration:e.duration,canDismiss:!0};switch(i){case"warning":w.warning(s);break;case"error":s.duration=null,w.error(s);break;default:w.success(s)}}}),jm=(_m=["name","count"],Sm=PicassoWebServices.Labels.CommBuilderSettings,Cm=_.template('<div class="cb-SettingsSeoView-tableHeaderTooltipContainer {{= containerClass }}"><span class="cb-SettingsSeoView-tableHeader slds-truncate slds-truncate slds-p-right_x-small" title="{{= label }}">{{= label }}</span></div>'),{value:{name:function(e){return'<div class="slds-grid slds-grid_align-spread"><span class="slds-truncate slds-p-right_x-small js-settings-seo-table-row-name">'+e.name+"</span></div>"},count:function(e){return'<div class="slds-grid slds-grid_align-spread"><span class="slds-truncate slds-p-right_x-small js-settings-seo-table-row-count">'+e.count+"</span></div>"}},className:{name:function(){return"cb-SettingsSeoView-tableNameItem js-seo-table-name"},count:function(){return"cb-SettingsSeoView-tableCountItem js-seo-table-count"}},headerLabel:{name:function(){return Cm({label:Sm.SEOSettingsTableNameHeader,containerClass:""})},count:function(){return Cm({label:Sm.SEOSettingsTableCountHeader,containerClass:""})}},headerClassName:{name:function(){return""},count:function(){return""}},getColumns:function(){return _m},getRowSections:function(){return{nonDndRows:[]}},tableClassName:"cb-SettingsSeoView-table slds-table_cell-buffer"}),Bm=PicassoWebServices.Labels.CommBuilderSettings,Om=PicassoWebServices.Labels.SeoSettingsContentSnapshotRefreshStatus,Mm=P.SETTINGS_SEO_SITEMAP,Mp=Backbone.View.extend({className:"cb-Settings-section cb-Settings-seoSection",template:_.template('<h2 class="cb-Settings-sectionHeading cb-Settings-seoSectionHeading">'+Bm.SEOSettingsTitle+'</h2><div class="cb-Settings-sectionDescription">'+Bm.SEOSettingsDescription+'</div><div class="cb-Settings-propertyGroup js-seo-object-access"><div class="cb-Settings-formGroupHeader">'+Bm.SEOSettingsGuestProfileSectionTitle+'</div></div><div class="js-seo-sitemap-section"></div><div class="js-spinner"></div>'),contentSnapshotTemplate:_.template('<div class="js-content-snapshot"><div class="cb-Settings-formGroupHeader js-content-snapshot-header">'+Bm.SEOSettingsContentSnapShotSectionTitle+'</div><div class="cb-Settings-propertyValue cb-Settings-refresh-seo-snapshot-description js-content-snapshot-description">'+Bm.SEOSettingsContentSnapShotDescription+'</div><div class="cb-Settings-propertyValue cb-Settings-refresh-seo-snapshot-note js-content-snapshot-description-note">'+Bm.SEOSettingsContentSnapShotDescriptionNote+'</div><div><div class="slds-form-element__label cb-Settings-refresh-published-page js-content-snapshot-published-pages-label">'+Bm.SEOSettingsContentSnapShotPublishedPagesLabel+'<span class="icon-utility-info js-content-snapshot-info-bubble" data-toggle="tooltip" data-placement="top" title="'+Bm.SEOSettingsContentSnapShotSectionGhostInfoBubbleText+'"></span></div></div><div><select class="cb-Settings-routes-routesSelect js-available-routes" id="selectPage" name ="routes"></select></div><div><button class="cb-Button cb-Button--settingsProperty cb-Button-refresh-page-snapshot-button js-refresh-page-snapshot-button">'+Bm.SEOSettingsContentSnapShotPublishedPagesRefreshPageSnapshotButton+"</button></div></div>"),sitemapGenerationTriggerTemplate:_.template('<div><div class="cb-Settings-formGroupHeader">'+Bm.SEOSettingsSitemapSectionTitle+'</div><div class="cb-Settings-sitemap-section-description">'+Bm.SEOSettingsSitemapSectionDescription+'</div><div><table class="cb-Settings-sitemapStatus-table js-sitemap-status-table"><tbody><tr><td class="cb-Settings-sitemapStatus-header">'+Bm.SEOSettingsSitemapStatusHeader+'</td><td class="cb-Settings-sitemapStatus-header">'+Bm.SEOSettingsSitemapRequestTimeHeader+'</td></tr><tr><td class="cb-Settings-sitemapStatusIndicator-inProgress" {{= statusLabel === "in-progress" ? "" : "hidden"}}><span class="slds-badge slds-badge_inverse">'+Bm.SEOSettingsSitemapStatusInProgress+'</span></td><td class="cb-Settings-sitemapStatusIndicator-complete" {{= statusLabel === "complete" ? "" : "hidden"}}><span class="slds-badge slds-theme_success">'+Bm.SEOSettingsSitemapStatusComplete+'</span></td><td class="cb-Settings-sitemapStatusIndicator-empty" {{= statusLabel === "empty" ? "" : "hidden"}}>'+Mm.DEFAULT_VALUE+'</td><td class="cb-Settings-sitemapStatus-timestamp js-sitemap-status-timestamp">{{- lastRequestTime }}</td></tr></tbody></table></div><button class="cb-Button cb-Button--settingsProperty cb-Button-sitemapTrigger-button js-sitemap-trigger-button" {{= isSitemapTriggerAvailable ? "" : "disabled"}}>'+Bm.SEOSettingsSitemapTriggerButton+"</button></div>"),availRouteTemplate:_.template('<option class="cb-Settings-routes-option js-route-option" value="{{= route_id }}" data-section="{{= route_status}}">{{= route_name }}</option>'),events:{"click .js-refresh-page-snapshot-button":"_refreshPageSnapshot","click .js-sitemap-trigger-button":"_triggerSitemapGeneration"},_refreshPageSnapshot:function(){var e,t=this.$(".js-available-routes").find(":selected"),n=Bm.SEOSettingsContentSnapShotPublishedPagesSelectRefreshDialogContent.replace("{0}",t.text()),i=t.val(),s=t.attr("data-section");"ROUTE_READY"!==s?(e=s.toLowerCase()+"_title",s=s.toLowerCase()+"_desc",Om.hasOwnProperty(e)&&Om.hasOwnProperty(s)&&(s=0<=Om[s].indexOf("{0}")?Om[s].replace("{0}",t.text()):Om[s],A.sldsModal({title:Om[e],content:s,yesText:Bm.SEOSettingsContentSnapShotGotItButtonText,isSingleButton:!0}))):A.sldsModal({content:n,title:Bm.SEOSettingsContentSnapShotPublishedPagesSelectRefreshDialogTitle,callback:function(e){e&&I.event.trigger("action:refresh-seo-snapshot",{routeUuid:i})},className:"slds-vex-theme slds-vex-theme--medium",yesText:Bm.SEOSettingsContentSnapShotPublishedPagesRefreshButtonText})},_triggerSitemapGeneration:function(){I.event.trigger("action:trigger-sitemap-generation")},_handleSeoSnapshotPublishedSuccessfully:function(){w.success({message:Bm.SEOSettingsContentSnapShotPublishedPagesRequestSuccessLabel,duration:5e3})},initialize:function(){ym=Bm.SEOSectionGuestProfileHelpLink.replace("{0}",E.getSite().get("guestuserurl")),this.listenTo(I.event,["state:routes-base-urls-updated","state:routes-deleted","state:community-privacy-updated","state:seo-snapshot-refreshed","state:site-published"].join(" "),h.getAllSEORoutes),this.listenTo(I.event,"state:routes-properties-updated",function(e){e.some(function(e){e=e.props;return e&&(e.hasOwnProperty("RouteUrl")||e.hasOwnProperty("Name")||e.hasOwnProperty("AuthorizationState"))})&&h.getAllSEORoutes()}),this.listenTo(I.event,"state:seo-data-loaded",this._handleSEODataLoaded),this.listenTo(I.event,"state:seo-snapshot-refreshed",this._handleSeoSnapshotPublishedSuccessfully),this.listenTo(I.event,"state:seo-routes-loaded",this._handleRoutesLoaded),this.listenTo(I.event,"state:sitemap-generation-triggered",this._handleSitemapGenerationTriggered),this.$el.html(this.template({guestUserProfileURL:E.getSite().get("guestuserurl"),isSitemapTriggerAvailable:!0,lastRequestTime:"-"})),this.$(".js-spinner").append(D.spinner),h.getSEOData(),h.getAllSEORoutes()},render:function(){var t,n=this._SEOdata;return this.$(".js-spinner").remove(),n&&0!==Object.keys(n).length?(this.$(".js-seo-object-access").append('<div class="cb-Settings-propertyValue">'+Bm.SEOSettingsGuestProfileSectionDescription.replace("{0}",ym)+" "+Bm.SEOSectionTellMoreHelpLink+"</div>"),this.$(".js-seo-object-access").append('<div class="cb-SettingsSeo-table js-seo-table"></div>'),this._table=new Ng({dataProvider:jm,parentRef:this}),t=[],Object.keys(n).forEach(function(e){t.push({name:e,count:n[e]})}),jm.getRowSections=function(){return{nonDndRows:t}},this.$(".js-seo-table").append(this._table.render().$el),this.$el.tooltip({selector:"[data-toggle=tooltip]"})):this.$(".js-seo-object-access").append(this._getEmptyStateHtml()),this.$(".js-seo-sitemap-section").html(this.sitemapGenerationTriggerTemplate(this._getSitemapTriggerTemplateParams())),this},_handleSEODataLoaded:function(e){this._SEOdata=e,this.render()},_getEmptyStateHtml:function(){return'<div class="slds-illustration slds-illustration_small"><div class="cb-Settings-seoObjectAccess-noDataImage"></div></div><div class="slds-text-longform"><h3 class="cb-Settings-seoObjectAccess-noDataTitle slds-illustration__header slds-text-heading_medium">'+Bm.SEOSettingsEmptyStateTitle+'</h3><p class="cb-Settings-seoObjectAccess-noDataDesc slds-text-body_regular">'+Bm.SEOSettingsEmptyStateDesctiption.replace("{0}",ym)+'</p><p class="cb-Settings-seoObjectAccess-noDataDesc slds-text-body_regular">'+Bm.SEOSettingsEmptyStateTip+" "+Bm.SEOSectionTellMoreHelpLink+"</p></div>"},_handleRoutesLoaded:function(e){var t=this;this.$(".js-content-snapshot").remove(),0<e.length&&(this.$(".js-seo-object-access").append(this.contentSnapshotTemplate()),_.each(e,function(e){t.$(".js-available-routes").append(t.availRouteTemplate(e))}),this.$(".js-available-routes").select2({dropdownCssClass:"cb-Select2-drop-down"}))},_getSitemapTriggerTemplateParams:function(e){var t,n=Mm.DEFAULT_VALUE,i=!0,s=!1,a=Mm.STATUS.EMPTY;return e?s=!0:E.getSite().get("sitemapTriggerLastRequestTime")&&(e=new Date(E.getSite().get("sitemapTriggerLastRequestTime"))),e&&(s||E.getSite().get("isSitemapJobRunning")?(i=!1,a=Mm.STATUS.IN_PROGRESS):((s=new Date).setDate(s.getDate()-1),(t=new Date).setMinutes(t.getMinutes()-2),a=e<t?Mm.STATUS.COMPLETE:Mm.STATUS.IN_PROGRESS,i=e<s),n=C.convertDateTimeToString(e)),{isSitemapTriggerAvailable:i,statusLabel:a,lastRequestTime:n}},_handleSitemapGenerationTriggered:function(e){e.Success&&this.$(".js-seo-sitemap-section").html(this.sitemapGenerationTriggerTemplate(this._getSitemapTriggerTemplateParams(new Date(e.Timestamp))))}}),Vm=function(e){var o=PicassoWebServices.Labels.CommBuilderSecurityCSPSettings;function t(e,t,n){return e("form.slds-form",{props:{onsubmit:function(e,t,n){t({type:"saveTrustedSite"}),n.preventDefault()}.bind(null,t,n)}},[e("div.cb-Dialog_header",[e("div.cb-Dialog_title",[],o.FrameAncestorsTrustedDomainsAddButton)]),e("div.cb-Dialog_content",[t.get("errorGeneric")?e("div.cb-SettingsSecurityCSPView-trustedSiteDialogErrorMessage",t.get("errorGeneric")):"",bg.input(e,{errorMessage:t.get("errorSource"),helpClassName:"test-url-input-error",inputClassName:"test-url-input",required:!0,label:o.FrameAncestorsTrustedDomain,props:{placeholder:o.TrustedSiteDlgPlaceholder,value:t.get("currentTrustedSite").get("currentTrustedDomain")},on:{input:function(e,t,n){e=e.get("currentTrustedSite");e=e.set("currentTrustedDomain",n.currentTarget.value),t({type:"updateCurrentTrustedSite",data:e})}.bind(null,t,n)},attrs:{maxlength:2e3}})]),e("div.vex-dialog-buttons",[e("button.slds-button.slds-button_brand.vex-dialog-button.vex-first.test-save-button",{props:{type:"submit",value:"submit",disabled:!t.get("valid")||t.get("saving")}},o.FrameAncestorsTrustedDomainsAddButton),e("button.slds-button.slds-button_neutral.vex-dialog-button.vex-last.test-cancel",{props:{type:"button",disabled:t.get("saving")},on:{click:function(e){e({type:"closeDialog"})}.bind(null,n)}},o.Cancel)])])}function r(e){var t=e.get("currentTrustedSite");return e=e.setIn("currentTrustedSite.currentTrustedDomain".split("."),t.get("currentTrustedDomain").trim())}return{init:function(){return[Immutable.Map({clickjackTrustedDomains:v.getClickjackTrustedDomains(),currentTrustedSite:e.currentTrustedSite,vexId:e.vexId,valid:e.valid,saving:!1,errorSource:"",errorSourceName:"",errorGeneric:"",mode:e.mode})]},render:t,update:function(e,t){var n,i,s,a=[e];return"closeDialog"===t.type?He.closeByID(e.get("vexId")):"saveTrustedSite"===t.type?(n=function(){e=r(e);I.event.trigger("action:add-clickjack-trusted-domain",{trustedDomain:e.get("currentTrustedSite").get("currentTrustedDomain")})},a=[e=e.set("saving",!0)]):"updateCurrentTrustedSite"===t.type?(e=e.set("currentTrustedSite",t.data),s=r(i=e).get("currentTrustedSite").get("currentTrustedDomain"),a=[e=i=(i=0===s.length?i.set("errorSource",o.TrustedSiteErrorURL_empty):0!==s.indexOf("http://")&&0!==s.indexOf("https://")&&0!==s.indexOf("wss://")?i.set("errorSource",o.TrustedSiteErrorURL_protocol):s.split("//")[1]&&0!==s.split("//")[1].length?"*"===s.split("//")[1]?i.set("errorSource",o.TrustedSiteErrorURL_asterix):-1!==s.split("//")[1].indexOf(" ")?i.set("errorSource",o.TrustedSiteErrorURL_space):i.set("errorSource",""):i.set("errorSource",o.TrustedSiteErrorURL_empty)).set("valid",""===i.get("errorSource")&&s)]):"handleResponse"===t.type&&((s=t.data).error?a=[e=(e=e.set("errorGeneric",s.error)).set("saving",!1)]:He.closeByID(e.get("vexId"))),n&&a.push(n),a},subscriptions:function(){return[["state:clickjack-trusted-domains-updated",function(e,t){e({type:"handleResponse",data:t})}]]}}},$m=function(e){var d=PicassoWebServices.Labels.CommBuilderSecurityCSPSettings;function t(e,t,n){var i=L.uuid();return e("form.slds-form",{props:{onsubmit:function(e,t,n){t({type:"saveTrustedSite"}),n.preventDefault()}.bind(null,t,n)}},[e("div.cb-Dialog_header",[e("div.cb-Dialog_title",[],"EDIT"===t.get("mode")?d.TrustedSiteDlgTitleEdit+" "+t.get("currentTrustedSite").get("sourceName"):d.TrustedSiteDlgTitle)]),e("div.cb-Dialog_content",[t.get("errorGeneric")?e("div.cb-SettingsSecurityCSPView-trustedSiteDialogErrorMessage",t.get("errorGeneric")):"",bg.input(e,{errorMessage:t.get("errorSourceName"),helpClassName:"test-name-input-error",inputClassName:"test-name-input",required:!0,label:d.TrustedSiteDlgName,props:{placeholder:"",value:t.get("currentTrustedSite").get("sourceName")},on:{input:function(e,t,n){e=e.get("currentTrustedSite");e=e.set("sourceName",n.currentTarget.value),t({type:"updateCurrentTrustedSite",data:e})}.bind(null,t,n)},attrs:{maxlength:40}}),bg.input(e,{errorMessage:t.get("errorSource"),helpClassName:"test-url-input-error",inputClassName:"test-url-input",required:!0,label:d.TrustedSiteDlgURL,props:{placeholder:d.TrustedSiteDlgPlaceholder,value:t.get("currentTrustedSite").get("source")},on:{input:function(e,t,n){e=e.get("currentTrustedSite");e=e.set("source",n.currentTarget.value),t({type:"updateCurrentTrustedSite",data:e})}.bind(null,t,n)},attrs:{maxlength:2e3}}),e("div.slds-form-element.slds-form-element_stacked",[e("div.slds-form-element__control",[e("div.slds-checkbox",[e("input.test-active-checkbox",{props:{type:"checkbox",checked:t.get("currentTrustedSite").get("isActive")?"checked":""},on:{change:function(e,t,n){e=e.get("currentTrustedSite");e=e.set("isActive",n.currentTarget.checked),t({type:"updateCurrentTrustedSite",data:e})}.bind(null,t,n)},attrs:{id:i}}),e("label.slds-checkbox__label.test-active-label",{attrs:{for:i}},[e("span.slds-checkbox_faux"),e("span.slds-form-element__label",d.TrustedSiteDlgActive)])])])])]),e("div.vex-dialog-buttons",[e("button.slds-button.slds-button_brand.vex-dialog-button.vex-first.test-save-button",{props:{type:"submit",value:"submit",disabled:!t.get("valid")||t.get("saving")}},t.get("currentTrustedSite").get("id")?d.TrustedSiteDlgUpdate:d.TrustedSiteDlgAddSite),e("button.slds-button.slds-button_neutral.vex-dialog-button.vex-last.test-cancel",{props:{type:"button",disabled:t.get("saving")},on:{click:function(e){e({type:"closeDialog"})}.bind(null,n)}},d.Cancel)])])}function u(e){var t=e.get("currentTrustedSite");return e=(e=e.setIn("currentTrustedSite.sourceName".split("."),t.get("sourceName").trim())).setIn("currentTrustedSite.source".split("."),t.get("source").trim())}return{init:function(){return[Immutable.Map({scriptSrcTrustedSites:v.getScriptSrcTrustedSites(),currentTrustedSite:e.currentTrustedSite,vexId:e.vexId,valid:e.valid,saving:!1,errorSource:"",errorSourceName:"",errorGeneric:"",mode:e.mode})]},render:t,update:function(t,e){var n,i,s,a,o,r,l,c=[t];return"closeDialog"===e.type?He.closeByID(t.get("vexId")):"saveTrustedSite"===e.type?(n=function(){var e;"EDIT"===(t=u(t)).get("mode")?(e=t.get("scriptSrcTrustedSites").find(function(e){return e.get("id")===t.getIn("currentTrustedSite.id".split("."))}),I.event.trigger("action:update-script-src-trusted-site",{trustedSiteInfo:t.get("currentTrustedSite").toJSON(),existingTrustedSite:e.toJSON()})):I.event.trigger("action:add-script-src-trusted-site",{trustedSiteInfo:t.get("currentTrustedSite").toJSON()})},c=[t=t.set("saving",!0)]):"updateCurrentTrustedSite"===e.type?(t=(s=t).set("currentTrustedSite",e.data),i=t,a=(s=s).getIn("currentTrustedSite.sourceName".split("."))!==i.getIn("currentTrustedSite.sourceName".split(".")),s=s.getIn("currentTrustedSite.source".split("."))!==i.getIn("currentTrustedSite.source".split(".")),o=u(i).get("currentTrustedSite"),r=o.get("source"),l=o.get("sourceName"),s&&(o=i.get("scriptSrcTrustedSites").some(function(e){return e.get("source")===r&&e.get("id")!==i.get("currentTrustedSite").get("id")}),i=0===r.length?i.set("errorSource",d.TrustedSiteErrorURL_empty):0!==r.indexOf("http://")&&0!==r.indexOf("https://")&&0!==r.indexOf("wss://")?i.set("errorSource",d.TrustedSiteErrorURL_protocol):r.split("//")[1]&&0!==r.split("//")[1].length?o?i.set("errorSource",d.TrustedSiteErrorURL_unique):"*"===r.split("//")[1]?i.set("errorSource",d.TrustedSiteErrorURL_asterix):-1!==r.split("//")[1].indexOf(" ")?i.set("errorSource",d.TrustedSiteErrorURL_space):i.set("errorSource",""):i.set("errorSource",d.TrustedSiteErrorURL_empty)),a&&(s=i.get("scriptSrcTrustedSites").some(function(e){return e.get("sourceName").toLowerCase()===l.toLowerCase()&&e.get("id")!==i.get("currentTrustedSite").get("id")}),i=0===l.length?i.set("errorSourceName",d.TrustedSiteErrorName_empty):s?i.set("errorSourceName",d.TrustedSiteErrorName_unique):i.set("errorSourceName","")),c=[t=i=i.set("valid",""===i.get("errorSourceName")&&""===i.get("errorSource")&&r&&l)]):"handleResponse"===e.type&&((o=e.data).error?c=[t=(t=t.set("errorGeneric",o.error)).set("saving",!1)]:He.closeByID(t.get("vexId"))),n&&c.push(n),c},subscriptions:function(){return[["state:script-src-trusted-sites-updated",function(e,t){e({type:"handleResponse",data:t})}]]}}},Um=(Tm=PicassoWebServices.Labels.CommBuilderSecurityCSPSettings,Pm=_.template('{{ if (whitelistBlocked) { }}{{= blockedTooltip }}{{ } else { }}<button class="slds-button slds-button_neutral slds-text-body_small js-csp-violations-whitelist" data-rowid="{{= rowId }}">'+Tm.CSPViolationsWhitelistButton+"</button>{{ } }}"),{tableClassName:"cb-SettingsCspViolationsView-table slds-table_cell-buffer",getColumns:function(){return["blockedUri","directive","whitelisted"]},headerLabel:{blockedUri:function(){return Tm.CSPViolationsBlockedURI},directive:function(){return Tm.CSPViolationsDirective},whitelisted:function(){return Tm.CSPViolationsWhitelistStatus}},headerClassName:{blockedUri:function(){return"slds-size--7-of-12"},directive:function(){return"slds-size--2-of-12"},whitelisted:function(){return"slds-size--3-of-12"}},className:{},getDataRows:function(){return v.getCspViolations()},_getTestDataRows:function(){return[{rowId:0,blockedUri:"https://example.com/foo.png",sourceUri:"https://my.force.com/s/",directive:"img-src",whitelisted:!1},{rowId:1,blockedUri:"https://example.com/script.js",sourceUri:"https://my.force.com/s/",directive:"script-src",whitelisted:!1},{rowId:2,blockedUri:"https://api.example.com/forscript/get",sourceUri:"https://my.force.com/s/",directive:"connect-src",whitelisted:!0}]},getRowSections:function(){return{dndRows:[],nonDndRows:this.getDataRows()}},value:{blockedUri:function(e){e=e.blockedUri;return"<span>"+(e="inline"===e?Tm.CSPViolationsWhitelistInlineSource:e)+"</span>"},directive:function(e){return"<span>"+e.directive+"</span>"},whitelisted:function(e){var t="script-src"===e.directive&&v.getCurrentScriptSecurityLevel()===v.getScriptSecurityLevels().LOCKED,n="inline"===e.blockedUri,n=D.bsLabelWithTooltipIcon({label:Tm.CSPViolationsInlineBlock,tooltipClassName:"cb-SettingsCspViolationsView-blockedTooltip",placement:"left",tooltipContent:n?Tm.CSPViolationsWhitelistButtonDisabledInline:Tm.CSPViolationsWhitelistButtonDisabled});return Pm({rowId:e.rowId,whitelistBlocked:t,blockedTooltip:n})}}}),Wm={},Fm=PicassoWebServices.Labels.CommBuilderPrivacySettings,i=PicassoWebServices.Labels.CommBuilderSettings,mr=Backbone.View.extend({className:"cb-Settings-section cb-Settings-securitySection test-settings-security-section",template:'<h2 class="cb-Settings-sectionHeading">'+i.SecuritySettingsTitle+'</h2><div class="cb-Settings-sectionDescription">'+i.SecuritySettingsDescription+"</div>",initialize:function(){this.render(),this.on("state:section-shown-again",this.render,this),this.on("state:left-panel-shown",this.render,this)},render:function(){return this.$el.html(this.template),Bg(hm(),this.$el),Bg(mm(),this.$el),Bg(bm(),this.$el),I.AccessControl(P.PERMISSIONS.COOKIE_CONSENT_PILOT)&&Bg(fm(),this.$el),this}}),Hm="desc",Gm="date",zm=".js-change-history-body",i="IN_PROGRESS",Km="DEPLOYED",Ym="ERROR",qm=PicassoWebServices.Labels.CommBuilderSettings,Xm=(u(hv={},i,qm.ChangeHistoryInProgressStatus),u(hv,Km,qm.ChangeHistorySuccessStatus),u(hv,Ym,qm.ChangeHistoryErrorStatus),hv),i=Backbone.View.extend({className:"cb-Settings-section cb-Settings-changeHistorySection test-change-history-section",template:_.template('<h2 class="cb-Settings-sectionHeading">'+qm.ChangeHistorySettingsTitle+'</h2><div class="cb-Settings-sectionDescription">'+qm.ChangeHistorySettingsDescription+'</div><div class="cb-Settings-changeHistorySection-body cb-Settings-changeHistorySection-body--loading js-change-history-body"></div>'),initialize:function(){this.render(),this.listenTo(I.event,"state:site-published",this.fetchAndRenderChangeHistory),this.addListeners()},render:function(){var t=this,e=(this.$el.html(this.template()),this.getColumnsForDatatable()),n=this.$(zm)[0];return $P.auraRun(function(){$A.createComponent("community_builder:datatable",{keyField:"id",columns:e,hideCheckboxColumn:!0,columnWidthsMode:"fixed",isLoading:!0},function(e){e&&($A.render(e,n),$A.afterRender(e),t.fetchAndRenderChangeHistory())})}),this},fetchAndRenderChangeHistory:function(){var t=this;this.updateDatatableComponent([],Hm,Gm,!0),E.getChangeHistoryPromise().done(function(e){t.renderChangeHistoryTable(e)})},getColumnsForDatatable:function(){return[{label:qm.ChangeHistoryDescriptionColumn,fieldName:"description",type:"text",sortable:!0,hideDefaultActions:!0,wrapText:!0,initialWidth:390},{label:qm.ChangeHistoryDateColumn,fieldName:"date",type:"date",typeAttributes:{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short"},sortable:!0,hideDefaultActions:!0,wrapText:!0,initialWidth:140},{label:qm.ChangeHistoryChangedByColumn,fieldName:"changedBy",type:"text",sortable:!0,hideDefaultActions:!0,wrapText:!0,initialWidth:120},{label:qm.ChangeHistoryStatusColumn,fieldName:"status",type:"text",sortable:!0,hideDefaultActions:!0,wrapText:!0,initialWidth:111.1}]},getDataForDatatable:function(e){var t=this;return this.data=[],e&&0<e.length&&e.forEach(function(e){e={id:e.id,description:e.description,date:e.publishedDate.sortData,changedBy:e.createdBy,status:t.getStatus(e.state)};t.data.push(e)}),this.data=_.orderBy(this.data,[Gm],Hm),this.data},onSort:function(e){var e=e.originalEvent.detail,t=e.fieldName,e=e.sortDirection;this.data=_.orderBy(this.data,t,e),this.updateDatatableComponent(this.data,e,t,!1)},renderChangeHistoryTable:function(e){this.data=this.getDataForDatatable(e),this.updateDatatableComponent(this.data,Hm,Gm,!1)},getDatatableComponent:function(){var e=this.$("community_builder-datatable");return e[0]?$A.componentService.getAttributeProviderForElement(e[0]):null},updateDatatableComponent:function(e,t,n,i){var s=this.getDatatableComponent();s&&(s.set("v.tableData",e),s.set("v.sortedDirection",t),s.set("v.sortedBy",n),s.set("v.isLoading",i),i?this.$(zm).addClass("cb-Settings-changeHistorySection-body--loading"):this.$(zm).removeClass("cb-Settings-changeHistorySection-body--loading"))},getStatus:function(e){return E.getSite().get("isInCmsStore")?Xm[e]||e:"PUBLISHED"===e?qm.ChangeHistorySuccessStatus:e},addListeners:function(){this.$(zm).on("onsort",this.onSort.bind(this))},removeListeners:function(){this.$el.off()},destroy:function(){this.removeListeners();var e=this.getDatatableComponent();e&&e.destroy()}}),Km=PicassoWebServices.Labels.CommBuilderSettings,Jm=Backbone.View.extend({_activeView:null,_sectionsViewsDataMap:{general:{dataSectionName:"general",displayLabel:Km.GeneralSectionTitle,viewType:me,viewInstance:null},theme:{dataSectionName:"theme",displayLabel:Km.ThemeSectionTitle,viewType:Op,viewInstance:null,visible:function(){return N.isThemeSettingEnabled()}},languages:{dataSectionName:"languages",displayLabel:PicassoWebServices.Labels.OverviewTab.Languages,get viewType(){return I.AccessControl(P.PERMISSIONS.LWR_LANGUAGE_SETTINGS)?Dh:sh},viewInstance:null,visible:function(){return I.AccessControl(P.PERMISSIONS.LANGUAGE_SETTINGS)}},navigation:{dataSectionName:"navigation",displayLabel:Km.NavigationSectionTitle,viewType:n,viewInstance:null},mobilePublisher:{dataSectionName:"mobilePublisherSetup",displayLabel:Km.MobilePublisherSettingTitle,viewType:e,viewInstance:null,visible:function(){return I.AccessControl(P.PERMISSIONS.IS_NATIVE_NAVIGATION_ENABLED)}},seo:{dataSectionName:"seo",displayLabel:Km.SEOSectionTitle,viewType:Mp,viewInstance:null,visible:function(){return I.getAppState().supportsNewFeatures()&&I.AccessControl(P.PERMISSIONS.SEO_SETTING)}},search:{dataSectionName:"search",displayLabel:Km.SearchSectionTitle,viewType:Np,viewInstance:null,visible:function(){return I.AccessControl(P.PERMISSIONS.IS_SEARCH_INDEXING_ENABLED)}},cmsConnect:{dataSectionName:"cmsConnect",displayLabel:Km.CmsConnectAreaCaption,viewType:xp,viewInstance:null,visible:function(){var e;return!!I.getAppState().supportsNewFeatures()&&(e=I.getAppState().getHomePageTemplate().get("CmsSettings"))&&"true"===e.isEnabled&&I.AccessControl(P.PERMISSIONS.CMS_CONNECT)}},advanced:{dataSectionName:"advanced",displayLabel:Km.AdvancedSectionTitle,viewType:hr,viewInstance:null,visible:function(){return I.getAppState().supportViewCrud()}},apps:{dataSectionName:"apps",displayLabel:Km.AppsSectionTitle,viewType:t,viewInstance:null,visible:function(){return $P.app.state.getCurrentSite().get("isInCmsStore")&&Xe.isAnyIntegrationAvailable()&&I.getAppState().supportViewCrud()}},security:{dataSectionName:"security",displayLabel:Km.SecuritySectionTitle,viewType:mr,viewInstance:null},developer:{dataSectionName:"developer",displayLabel:Km.DeveloperSectionTitle,viewType:fr,viewInstance:null,visible:function(){return I.getAppState().isCurrentPageAura()&&($P.userCanCreateFlexipage||I.AccessControl(P.PERMISSIONS.PAGE_EDIT)&&I.AccessControl(P.PERMISSIONS.OPEN_DEV_CONSOLE))&&I.getAppState().supportsNewFeatures()}},updates:{dataSectionName:"updates",displayLabel:Km.UpdatesSectionTitle,viewType:ot,viewInstance:null},changeHistory:{dataSectionName:"changeHistory",displayLabel:Km.ChangeHistorySettingsTitle,viewType:i,viewInstance:null}},className:"cb-Settings js-settings",settingsMenuItemTemplate:_.template('<li class="cb-Settings-menuItem js-settings-menu-item {{= classNames }}" data-section="{{= name }}">{{= label }}{{ if (typeof(badge) != "undefined") { }}<span class="cb-Settings-menuItemBadge js-{{= badge.section }}-section-badge badge" title="{{= badge.title }}">{{= badge.value }}</span>{{ } }}</li>'),settingsTemplate:_.template('<div class="cb-Settings-menuContainer"><ul class="cb-Settings-menu">{{= menuItems }}</ul></div><div class="cb-Settings-contentContainer js-settings-content-container"><div class="cb-Settings-content js-settings-content"></div></div>'),events:{"click .js-settings-menu-item":"_onSectionClick"},initialize:function(){this._rendered=!1,this.listenTo(j.getAppEvent(),"settings-show-section",this._showSection),this.listenTo(I.event,"state:community-privacy-updated",this._handleCommunityPrivacyChange),E.getSite().on("change:isHeadMarkupVerified",function(){this.render(this._sectionsViewsDataMap.advanced.dataSectionName)}.bind(this)),this.listenTo(I.event,"state:upgradeflows-loaded",function(){this.render(this.activeSection)}.bind(this))},show:function(){this._rendered||this.render(),this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")},render:function(e){return _.each(this._sectionsViewsDataMap,function(e){e.viewInstance=null}),Qe.needsUpgrade()?this._sectionsViewsDataMap.updates.badge={value:Qe.needsUpgrade()?1:0,title:PicassoWebServices.Labels.AppNav.UpdatesAvailable,section:"updates"}:delete this._sectionsViewsDataMap.updates.badge,E.getSite().get("isHeadMarkupVerified")?delete this._sectionsViewsDataMap.advanced.badge:this._sectionsViewsDataMap.advanced.badge={value:1,title:PicassoWebServices.Labels.AppNav.UpdatesAvailable,section:"advanced"},this.$el.html(this.settingsTemplate({menuItems:this._buildSettingsMenuItemsHtml()})),e=e||this._sectionsViewsDataMap.general.dataSectionName,this._showSection(e),this._rendered=!0,this._refreshSEOSectionView(),this},_buildSettingsMenuItemsHtml:function(){var t=[];return _.each(this._sectionsViewsDataMap,function(e){e.visible&&!e.visible()||t.push(this.settingsMenuItemTemplate({name:e.dataSectionName,label:e.displayLabel,classNames:"js-settings-menu-item-"+e.dataSectionName,badge:e.badge||void 0}))}.bind(this)),t.join("")},_onSectionClick:function(e){e=T(e.target).closest(".cb-Settings-menuItem").data("section");this.activeSection=e,this._showSection(e)},_showSection:function(e){var t,n;this._getSection(e)&&(t=this._hasPrevRenderedViewForSection(e),n=this._getViewForSection(e),this._updateSettingsMenu(e),null!==this._activeView&&this._activeView.$el.hide(),0===(e=this.$(".js-settings-content")).find(n.$el).length&&e.append(n.$el),t&&(n.$el.show(),n.trigger("state:section-shown-again")),this._activeView=n)},_updateSettingsMenu:function(e){this.$(".js-settings-menu-item.is-active").removeClass("is-active"),this.$('.js-settings-menu-item[data-section="'+e+'"]').addClass("is-active")},_hasPrevRenderedViewForSection:function(e){return null!==this._getSection(e).viewInstance},_getViewForSection:function(e){e=this._hasPrevRenderedViewForSection(e)?this._getSection(e).viewInstance:this._createViewForSection(e);return e},_createViewForSection:function(e){var t=new(this._getSection(e).viewType);return this._updateRenderedViewsMap(e,t),t},_updateRenderedViewsMap:function(e,t){this._getSection(e).viewInstance=t},_getSection:function(e){return _.find(this._sectionsViewsDataMap,{dataSectionName:e})},_refreshSEOSectionView:function(){I.getAppState().getCurrentSite().isCommunityPublic()?this._refreshSectionView("seo",!0):this._refreshSectionView("seo",!1)},_handleCommunityPrivacyChange:function(e){this._refreshSectionView("seo",e)},_refreshSectionView:function(e,t){this._getSection(e)&&(e='.js-settings-menu-item[data-section="'+e+'"]',t?this.$(e).removeClass("hidden"):this.$(e).addClass("hidden"))}}),Qm=PicassoWebServices.Labels.BrandingSetsPanel,Zm=".".concat(D.SPINNER_CLASSNAME),ev=Backbone.View.extend({className:"cb-BrandingSetsRename js-branding-name-modal",_template:_.template('<div class="slds-modal__header slds-modal__header--empty"></div><div class="cb-BrandingSetsRename-content slds-modal__content slds-p-around--medium"><img src="/sfsites/sfservice/builder/resources/images/branding-sets-rename.png"/><div class="slds-text-heading_large">{{= title }}</div><div class="slds-form-element js-form-element"><div class="slds-form-element__control"><input type="text" class="js-input slds-input js-branding-name-input" maxlength="100" value="{{= value }}"/></div><div class="js-error-message slds-form-element__help"></div></div></div><div class="slds-modal__footer"><button class="js-cancel slds-button slds-button_neutral">'+Qm.RenameCancel+'</button><button class="js-save slds-button slds-button_brand" disabled>'+Qm.RenameSave+"</button></div>"+"".concat(D.spinner).trim()),events:{"click .js-save":"_save","click .js-cancel":"_cancel","keyup .js-input":"_onInputKeyup"},_error:"",_options:null,initialize:function(e){this._options=e,this.render()},render:function(){return this.$el.html(this._template({value:this._options.value||"",title:N.isScopedBrandingSetManagementEnabled()?Qm.RenameScopedBrandingSetTitle:Qm.RenameTitle})),this.$(Zm).hide(),setTimeout(function(){this.$(".js-input").select()}.bind(this),"100"),this},_isValidEnterKey:function(e){return e.which===P.KEYCODE.ENTER&&!this.$(".js-save").prop("disabled")},_onInputKeyup:function(e){this._isValidEnterKey(e)?this._save():this.$(".js-save").prop("disabled",!this._valid())},_valid:function(){var e=null,t=this.$(".js-input").val(),n=t!==this._options.value,i=0===t.trim().length,t=N.isNameDuplicate(t)&&n;return i?e=Qm.RenameErrorLength:t&&(e=Qm.RenameErrorDuplicate),null!==e?(this.$(".js-form-element").addClass("slds-has-error"),this.$(".js-error-message").html(e)):(this.$(".js-form-element").removeClass("slds-has-error"),this.$(".js-error-message").html("")),null===e&&n},_save:function(){var e=this;this._options.onSaveCallback&&(this.$(Zm).show(),this._options.onSaveCallback(this.$(".js-input").val().trim()).finally(function(){e.$(Zm).hide(),A.closeDialog()}))},_cancel:function(){A.closeDialog()}}),tv=(Im=PicassoWebServices.Labels.BrandingSetsPanel,Em=[{label:Im.DropdownBrandingSet,items:[{locator:"js-edit",key:"Edit",label:Im.DropdownEdit,icon:{sprite:"utility",name:"edit_form"},action:function(e){nv(e)}},{locator:"js-rename",key:"Rename",label:Im.DropdownRename,icon:{sprite:"utility",name:"edit"},action:function(n){var e=l.getBrandingSet(n);A.showDialog(new ev({value:e.name,onSaveCallback:function(t){return new Promise(function(e){I.event.trigger("action:rename-branding-set",{id:n,name:t,successCallback:function(){return e()}})})}}),{className:"slds-vex-theme slds-vex-theme--medium"})}},{locator:"js-duplicate",key:"Duplicate",label:Im.DropdownDuplicate,icon:{sprite:"utility",name:"copy"},action:function(e){var t=l.getBrandingSet(e),t=N.createUniqueNameForClone(t.name);I.event.trigger("action:duplicate-branding-set",{name:t,id:e,successCallback:function(e){nv(e.BrandingSet.id)}})}},{locator:"js-delete",key:"Delete",label:Im.DropdownDelete,icon:{sprite:"utility",name:"delete"},isDisabled:function(e){return N.isDefault(e)},action:function(t){var e=l.getBrandingSet(t);A.sldsModal({title:Im.DropdownDeleteConfirmTitle,content:Im.DropdownDeleteConfirmContent.replace("{0}",e.name),yesText:PicassoWebServices.Labels.PicassoDialog.Delete,yesTextClassName:"slds-button_destructive",callback:function(e){e&&I.event.trigger("action:delete-branding-set",{id:t})}})}}]},{label:Im.DropdownAudience,items:[{locator:"js-assign-audience",key:"Assign Audience",label:Im.DropdownAssignAudience,icon:{sprite:"utility",name:"groups"},isHidden:function(e){return $P.isPersonalizationEnabled?N.hasAudience(e)||N.isDefault(e):N.hasAudience(e)},action:function(e){Ki.openAudienceSelectorForBranding(e,function(){Em.triggerUpdateStart(e),I.event.trigger("action:update-branding-audience-target-infos")})}},{locator:"js-edit-audience",key:"Edit Audience",label:Im.DropdownEditAudience,icon:{sprite:"utility",name:"groups"},isHidden:function(e){return $P.isPersonalizationEnabled?!N.hasAudience(e)&&!N.isDefault(e):!N.hasAudience(e)},isDisabled:function(e){return N.isDefault(e)},action:function(e){Ki.openAudienceSelectorForBranding(e,function(){Em.triggerUpdateStart(e),I.event.trigger("action:update-branding-audience-target-infos")})}},{locator:"js-remove-audience",key:"Remove Audience",label:Im.DropdownRemoveAudience,icon:{sprite:"utility",name:"ban"},isHidden:function(e){return!N.hasAudience(e)||N.isDefault(e)},action:function(e){Em.triggerUpdateStart(e),I.event.trigger("action:remove-branding-set-audience",{id:e})}},{locator:"js-set-as-default",key:"Set As Default",label:Im.DropdownSetAsDefault,icon:{sprite:"utility",name:"bookmark"},isHidden:function(e){return N.isDefault(e)},action:function(e){Em.triggerUpdateStart(e),I.event.trigger("action:set-branding-set-as-site-default",{id:e})}}]}]);function nv(e){I.getAppState().getCurrentPreviewSiteBrandingSetId()!==e&&I.event.trigger("action:set-preview-site-branding-set",{id:e})}function iv(e){var t="",t=e.values.CompanyLogo&&"/sfsites/assets/Images/spacer.gif"!==e.values.CompanyLogo?(t+='<div class="cb-BrandingSetsShared-logoContainer">')+'<img class="cb-BrandingSetsShared-logo js-branding-set-logo" src="'+tc.addPathPrefix(_.escape(e.values.CompanyLogo))+'"/>':(t+='<div class="cb-BrandingSetsShared-logoContainer cb-BrandingSetsShared-logoContainer--empty">')+D.icon({svgClassName:"cb-BrandingSetsShared-logo--empty slds-icon_small",icon:"image"});return t+="</div>"}function sv(n,e){var e=1<arguments.length&&void 0!==e?e:6,t=l.getBrandingSetPropertyDefs(n.def),i='<div class="cb-BrandingSetsShared-colorIcons js-branding-sets-shared-color-icons">';return _.chain(t).filter(function(e){return e.type&&"Color"===e.type.name&&!N.isDerivedProperty(e)}).take(e).each(function(e){var t=(t=n.values[e.name])||e.defaultValue,e=(_s.isBrandExpression(t)&&(t=_s.getResolvedBrandValueFromExpression(t).getValue()),_.escape(t));i+='<div class="cb-BrandingSetsShared-colorIcon {1} js-branding-sets-shared-color-icon" style="background-color:{0};"></div>'.replace("{0}",e).replace("{1}",200<tinycolor(e).getBrightness()?"cb-BrandingSetsShared-colorIcon--white":"")}).value(),i+="</div>"}var av,ov,rv=PicassoWebServices.Labels.BrandingSetsPanel,lv=Backbone.View.extend({_template:_.template('<div class="cb-BrandingSetsPanelTile js-branding-set-tiles">{{= tiles }}</div>'),_tileTemplate:_.template('\n        <div class="cb-BrandingSetsPanelTile-item js-tile {{= selected ? "cb-BrandingSetsPanelTile-item--selected js-selected" : ""}}" data-id="{{= id }}">\n            <div class="cb-BrandingSetsPanelTile-itemHeader">\n                <div class="cb-BrandingSetsPanelTile-itemHeaderTitle js-branding-set-tile-title slds-truncate" title="{{= name }}">\n                    {{= name }}\n                </div>\n                <div class="cb-BrandingSetsPanelTile-itemHeaderAction js-action dropdown">\n                    {{= action }}\n                </div>\n            </div>\n            <div class="cb-BrandingSetsPanelTile-itemContent">\n                <div class="cb-BrandingSetsPanelTile-itemContentLogo">\n                    <span>\n                        '.concat(rv.TileLogo,'\n                    </span>{{= logo }}\n                </div>\n                <div class="cb-BrandingSetsPanelTile-itemContentBrand">\n                    <span>\n                        ').concat(rv.TileColors,"\n                    </span> {{= color }}\n                    {{= audienceBadge }}\n                </div>\n            </div>\n        </div>").trim()),_dropdown:null,events:{"click .js-dropdown-trigger":"_onDropdownToggle","click .js-tile-edit-audience":"_onEditAudience","click .js-tile":"_onTileClick"},initialize:function(e){this._dropdown=new Wo({config:tv})},render:function(){var e=_.sortBy(l.getAllBrandingSets(),"created_time"),t=I.getAppState().getCurrentPreviewSiteBrandingSetId(),n=[];return _.each(e,function(e){n.push(this._tileTemplate({id:e.id,name:e.name,action:D.dropdownButtonIcon({buttonClassName:"js-dropdown-trigger",svgClassName:""}),logo:iv(e),color:sv(e),audienceBadge:this._buildAudienceBadge(e),selected:t===e.id}))}.bind(this)),this.$el.html(this._template({tiles:n.join("")})),this},_onEditAudience:function(e){e.stopPropagation();e=T(e.currentTarget).closest(".js-tile").data("id");N.openAudienceSelectorForBrandingSet(e)},_onTileClick:function(e){var e=T(e.target);e.closest(".js-action").has(e).length||(e=e.closest(".js-tile").data("id"),I.getAppState().getCurrentPreviewSiteBrandingSetId()!==e&&I.event.trigger("action:set-preview-site-branding-set",{id:e}))},_onDropdownToggle:function(e){var e=T(e.currentTarget),t=e.closest(".js-tile").data("id");this._dropdown.onToggle(e,t,this)},_buildAudienceBadge:function(e){var t='<div class="cb-BrandingSetsPanelTile-audienceBadge">';return N.isDefault(e.id)?t+='<span class="slds-badge js-default-badge">'.concat(rv.AudienceDefault,"</span>"):(e=N.hasAudience(e.id),t+=D.bsIconWithTooltip({className:"slds-icon_small js-tile-edit-audience "+(e?"cb-BrandingSetsPanelTile-audienceBadgeIcon--hasAudience":"cb-BrandingSetsPanelTile-audienceBadgeIcon--noAudience"),icon:"groups",label:e?rv.TileEditAudience:rv.TileAssignAudience,placement:"bottom"})),t+="</div>"}}),cv=(av=PicassoWebServices.Labels.BrandingSetsPanel,ov=["name","brand","audience","status"],(Ym={}).value={name:function(e){return e.name},brand:function(e){return'\n                <div class="cb-BrandingSetsPanelTable-brand">\n                    '.concat(iv(e),"\n                    ").concat(sv(e),"\n                </div>")},audience:function(e){var t='<span class="slds-badge js-default-badge">'.concat(av.AudienceDefault,"</span>");return dv(e.id)?t:(t=l.getBrandingAudienceTargetInfo(e.id))?L.htmlEncode(t.get("audienceName")):av.AudienceNone},priority:function(e){e=l.getBrandingAudienceTargetInfo(e.id);return e&&!e.isDefault()?e.get("groupPriority"):D.iconWithAlt({className:"js-no-priority-dash",svgClassName:"slds-icon_x-small slds-icon-text-light",icon:"dash",label:av.PriorityNone})},status:function(e){return av["PublishState_"+e.status]}},Ym.className={name:function(){return"js-branding-table-item-name cb-BrandingSetsPanelTable-name"},audience:function(){return"js-branding-table-item-audience"},priority:function(){return"js-branding-table-item-priority slds-text-align--center"},status:function(){return"js-branding-table-item-status"}},Ym.headerLabel={name:function(){return av.TableBrandingSet},brand:function(){return av.TableBrand},audience:function(){return D.bsLabelWithTooltipIcon({label:av.TableAudienceAssigned,tooltipClassName:"cb-BrandingSetsPanelTable-audienceTooltip",tooltipContent:av.AudienceColumnTooltip,placement:"top"})},priority:function(){return D.bsLabelWithTooltipIcon({label:av.TablePriority,tooltipClassName:"cb-BrandingSetsPanelTable-priorityTooltip",tooltipContent:av.PriorityColumnTooltip,placement:"top"})},status:function(){return av.TableStatus}},Ym.headerClassName={name:function(){return"slds-size--3-of-12"},brand:function(){return"slds-size--2-of-12"},audience:function(){return"slds-size--2-of-12"},priority:function(){return"slds-size--2-of-12 slds-text-align--center"},status:function(){return"slds-size--2-of-12"}},Ym.getColumns=function(){for(var e=ov.slice(),t=0,n=l.getAllBrandingSets(),i=0;i<n.length;++i){var s=l.getBrandingAudienceTargetInfo(n[i].id);if(s&&!s.isDefault()&&1<++t){e.splice(3,0,"priority");break}}return e},Ym.getRowSections=function(){var t=[],n=[],e=l.getAllBrandingSets().sort(function(e,t){var n=l.getBrandingAudienceTargetInfo(e.id),i=l.getBrandingAudienceTargetInfo(t.id);return null==n&&null==i?e.name.localeCompare(t.name):null==n&&null!=i?1:null!=n&&null==i?-1:dv(e.id)?1:dv(t.id)?-1:0==(n=n.get("groupPriority")-i.get("groupPriority"))?e.name.localeCompare(t.name):n});return _.each(e,function(e){(!dv(e.id)&&N.hasAudience(e.id)?t:n).push(e)}),{dndRows:t,nonDndRows:n}},Ym);function dv(e){return N.isDefault(e)}var uv,pv,gv=Backbone.View.extend({className:"cb-BrandingSetsPanelTable",initialize:function(e){var t=this;this._table=new zo({dataProvider:cv,dropdownConfig:tv,parentRef:this}),this.$el.append(this._table.$el),this.listenTo(this._table,"dnd-update",function(e){t._updatePriorities(e)}),this.listenTo(I.event,"state:site-published",function(){t._table.render()})},render:function(){return this._table.render(),this},_updatePriorities:function(e){var t=this;I.event.trigger("action:update-branding-audience-target-priorities",{brandingSetIdToPriorityMap:e,successCallback:function(){t._table.render()}})}}),hv=PicassoWebServices.Labels.BrandingSetsPanel,mv=Backbone.View.extend({_labels:PicassoWebServices.Labels.BrandingSetsPanel,_template:_.template('<div class="cb-BrandingSetsPanel js-branding-sets-panel slds-popover slds-nubbin--left-top" role="dialog"><div class="slds-popover__body"><div class="cb-BrandingSetsPanel-header slds-grid"><div class="slds-medium-size--5-of-6"><div class="slds-text-heading_medium">'+hv.PanelTitle+'</div></div><div class="cb-BrandingSetsPanel-headerClose slds-medium-size--1-of-6">{{= $P.viewTypes.CommonTemplates.buttonIcon({ buttonClassName: "js-close-panel", svgClassName: "cb-BrandingSetsPanel-headerCloseIcon", icon: "close", label: "'+PicassoWebServices.Labels.AppNav.Close+'", buttonAttributes: "" }) }}</div></div><div class="cb-BrandingSetsPanel-content slds-grid"><div class="cb-BrandingSetsPanel-contentDescription slds-medium-size--7-of-12"><p>'+hv.PanelDescription+'</p></div><div class="cb-BrandingSetsPanel-contentActions js-content-actions slds-medium-size--5-of-12">{{= $P.viewTypes.CommonTemplates.bsButtonIconWithTooltip({ buttonClassName: "js-manage-audience slds-button_icon-border", placement: "top", svgClassName: "", icon: "groups", label: this._labels.ManageAudiences }) }}<div class="cb-BrandingSetsPanel-contentActionGroup js-action-group slds-button-group"></div>{{= $P.viewTypes.CommonTemplates.buttonWithIcon({ buttonClassName: "cb-BrandingSetsPanel-contentActionGroupNewButton js-new-branding-set", buttonVariantClassName: "slds-button_neutral slds-truncate", icon: "add", label: this._labels.PanelNewBrandingSet})}} </div></div><div class="js-content">{{= $P.viewTypes.CommonTemplates.spinner }} </div></div></div>'),_actionGroupTemplate:_.template('{{= $P.viewTypes.CommonTemplates.bsButtonIconWithTooltip({ buttonClassName: "js-state-tile slds-button_icon-border" + (state === "tile" ? " cb-BrandingSetsPanel-contentActionGroupSelected" : ""), placement: "top", svgClassName: "", icon: "tile_card_list", label: this._labels.TileViewSwitch }) }}{{= $P.viewTypes.CommonTemplates.bsButtonIconWithTooltip({ buttonClassName: "js-state-table slds-button_icon-border" + (state === "table" ? " cb-BrandingSetsPanel-contentActionGroupSelected" : ""), placement: "top", svgClassName: "", icon: "richtextbulletedlist", label: this._labels.ListViewSwitch }) }}'),active:!1,_state:"tile",events:{"click .js-close-panel":"close","click .js-manage-audience":"_onManageAudience","click .js-new-branding-set":"_newBrandingSet","click .js-state-table":"_showTable","click .js-state-tile":"_showTile"},initialize:function(e){this._tileView=new lv,this._tableView=new gv,this._isDataLoaded=!1},render:function(){return this.$el.html(this._template()),this._renderActionGroup(),this.active&&this.open(),this.$el.tooltip({selector:'[data-toggle="tooltip"]',container:".js-content-actions",delay:{show:200,hide:0}}),this},updateContent:function(){this._isDataLoaded||(this.$(".js-content").empty().append(this._tileView.$el).append(this._tableView.$el),this._isDataLoaded=!0),this._updateContentView(),this._tileView.render(),this._tableView.render()},_updateContentView:function(){this._tileView.$el.addClass("slds-hide"),this._tableView.$el.addClass("slds-hide"),("tile"===this._state?this._tileView:this._tableView).$el.removeClass("slds-hide")},_renderActionGroup:function(){this.$(".js-content-actions .tooltip").remove(),this.$(".js-action-group").html(this._actionGroupTemplate({state:this._state}))},_showTile:function(){"tile"!==this._state&&(this._state="tile",this._renderActionGroup(),this._updateContentView())},_showTable:function(){"table"!==this._state&&(this._state="table",this._renderActionGroup(),this._updateContentView())},fadeToggle:function(){this.$(".js-branding-sets-panel").fadeToggle(150,function(){this._checkState()}.bind(this))},fadeIn:function(){this.$(".js-branding-sets-panel").fadeIn(150,function(){this._checkState()}.bind(this))},open:function(){this.$(".js-branding-sets-panel").show(),this._checkState()},close:function(){this.$(".js-branding-sets-panel").hide(),this._checkState()},toggle:function(){this.$(".js-branding-sets-panel").toggle(),this._checkState()},_onManageAudience:function(e){T(e.currentTarget).blur(),N.openAudienceSelectorForBrandingSet()},_newBrandingSet:function(){A.showDialog(new ev({onSaveCallback:function(e){return new Promise(function(t){I.event.trigger("action:create-branding-set",{name:e,successCallback:function(e){I.event.trigger("action:set-preview-site-branding-set",{id:e.BrandingSet.id}),t()}})})}}),{className:"slds-vex-theme slds-vex-theme--medium"})},_checkState:function(){this.active="block"===this.$(".js-branding-sets-panel").css("display")}}),vv=(uv=PicassoWebServices.Labels.ScopedBrandingSetsPanel,pv=["selection","name","palette"],(me={}).value={selection:function(e){return e.selected?D.icon({svgClassName:"slds-icon_x-small cb-Table-selection",icon:"check"}):""},name:function(e){return e.name},palette:function(e){return'\n                <div class="cb-ScopedBrandingSetsPanelTable-brand">\n                    '.concat(sv(e,4),"\n                </div>")}},me.className={selection:function(){return"slds-text-align_right"},name:function(){return"js-branding-table-item-name"}},me.headerLabel={name:function(){return uv.TableBrandingSet},palette:function(){return uv.TableBrand}},me.headerClassName={selection:function(){return"slds-size_1-of-12"},name:function(){return"slds-size_6-of-12"},palette:function(){return"slds-size_4-of-12"}},me.getColumns=function(){return pv.slice()},me.getRowSections=function(e){var t=_.cloneDeep(l.getAllBrandingSets()),n=(t=(t=e&&"function"==typeof e.filter?t.filter(e.filter):t).sort(function(e,t){return e.name.localeCompare(t.name)}),l.getCurrentPreviewScopedBrandingSet()||l.getPreviewBrandingSet()),e=t.find(function(e){return e.id===n.id});return e&&(e.selected=!0),{dndRows:[],nonDndRows:t}},me);bv=PicassoWebServices.Labels.ScopedBrandingSetsPanel,fv=bv.DropdownDeleteConfirmInstancesSingular,_v=bv.DropdownDeleteConfirmInstancesPlural,Sv=function(e){var t=e.viewName,e=e.instances,n=1===e?fv:_v;return"<li>".concat(t," (").concat(e," ").concat(n,")</li>").trim()};var bv,fv,_v,Sv,Cv=[{label:bv.DropdownBrandingSet,items:[{locator:"js-edit",key:"Edit",label:bv.DropdownEdit,icon:{sprite:"utility",name:"edit_form"},action:function(e){Tv(e)}},{locator:"js-rename",key:"Rename",label:bv.DropdownRename,icon:{sprite:"utility",name:"edit"},action:function(n){var e=l.getBrandingSet(n);A.showDialog(new ev({value:e.name,onSaveCallback:function(t){return new Promise(function(e){I.event.trigger("action:rename-branding-set",{id:n,name:t,successCallback:function(){return e()}})})}}),{className:"slds-vex-theme slds-vex-theme--medium"})}},{locator:"js-duplicate",key:"Duplicate",label:bv.DropdownDuplicate,icon:{sprite:"utility",name:"copy"},isHidden:Pv,action:function(e){var t=l.getBrandingSet(e),t=N.createUniqueNameForClone(t.name);I.event.trigger("action:duplicate-branding-set",{name:t,id:e,successCallback:function(e){Tv(e.BrandingSet.id)}})}},{locator:"js-delete",key:"Delete",label:bv.DropdownDelete,icon:{sprite:"utility",name:"delete"},isHidden:Pv,isDisabled:function(e){return N.isDefault(e)},action:function(t){var i=l.getBrandingSet(t);l.getScopedBrandingSetUsagesPromise(t).then(function(e){var n=e.viewBrandingSetInstances;A.sldsModal({title:bv.DropdownDeleteConfirmTitle,content:yv(i.name,n),yesText:PicassoWebServices.Labels.PicassoDialog.Delete,yesTextClassName:"slds-button_destructive",callback:function(e){e&&I.event.trigger("action:delete-branding-set",{id:t,successCallback:function(){var e,t;e=Object.keys(n),t=I.getAppState().getCurrentViewId(),t=h.getViews().get(t).get(P.PROP.NAME_KEY),e.indexOf(0<=t)&&I.event.trigger("action:refresh-current-page",{persistState:!0})}})}})}).catch(function(e){e=e.message,e=void 0===e?bv.DropdownDeleteErrorContent:e;A.sldsPromptAlert({title:bv.DropdownDeleteError,content:e})})}}]}];function yv(e,t){return 0<Object.keys(t).length?'<p class="slds-m-bottom_small">'.concat(bv.DropdownDeleteConfirmContentHasUsages,'</p>\n                <p class="slds-m-bottom_small">').concat(bv.DropdownDeleteConfirmDetail.replaceAll("{0}",e),"</p>\n                ").concat(function(e){e=e.map(Sv);return'<ul class="slds-list_dotted">'.concat(e.join(""),"</ul>").trim()}(Object.entries(t).map(function(e){e=J(e,2);return{viewName:e[0],instances:e[1]}}))).trim():bv.DropdownDeleteConfirmContentDefault.replaceAll("{0}",e)}function Tv(e){Iv(e)?(I.event.trigger("action:set-preview-scoped-branding-set",{id:null}),I.getAppState().getCurrentPreviewSiteBrandingSetId()!==e&&I.event.trigger("action:set-preview-site-branding-set",{id:e}),o.trigger("theme-editor-action:show-detail",P.BRANDING_SET_TYPE.APP)):I.getAppState().getCurrentPreviewScopedBrandingSetId()!==e&&I.event.trigger("action:set-preview-scoped-branding-set",{id:e,successCallback:function(){o.trigger("theme-editor-action:show-detail",l.getBrandingSet(e).type)}})}function Pv(e){return Iv(e)}function Iv(e){return l.getBrandingSet(e).type===P.BRANDING_SET_TYPE.APP}var Ev=PicassoWebServices.Labels.ScopedBrandingSetsPanel;function wv(e){return e.type===P.BRANDING_SET_TYPE.APP}function Lv(e){return e.type===P.BRANDING_SET_TYPE.SCOPED}var Dv=Backbone.View.extend({className:"cb-ScopedBrandingSetsPanelTable",initialize:function(e){var t=this;this._tables=[],this._tables.push(new zo({dataProvider:vv,contextParams:{title:{label:Ev.TableTitleDefaultPalette},filter:wv},dropdownConfig:Cv,parentRef:this})),this._tables.push(new zo({dataProvider:vv,contextParams:{title:{label:Ev.TableTitleSectionPalettes,actions:$P.viewTypes.CommonTemplates.buttonWithIcon({buttonClassName:"cb-Table-actionGroupNewButton js-new-branding-set",buttonVariantClassName:"slds-button_neutral slds-truncate",icon:"add",label:Ev.PanelNewBrandingSet})},filter:Lv,emptyMessage:Ev.EmptySection},dropdownConfig:Cv,parentRef:this})),this._tables.forEach(function(e){t.$el.append(e.$el)})},render:function(){return this._tables.forEach(function(e){e.render()}),this}}),Op=PicassoWebServices.Labels.ScopedBrandingSetsPanel,Av=Backbone.View.extend({_template:_.template('\n        <div class="cb-ScopedBrandingSetsPanel js-branding-sets-panel slds-popover slds-nubbin--left-top" role="dialog">\n            <div class="slds-popover__body">\n                <div class="cb-ScopedBrandingSetsPanel-header slds-grid">\n                    <div class="slds-medium-size--5-of-6">\n                        <div class="slds-text-heading_medium">'.concat(Op.PanelTitle,'</div>\n                    </div>\n                    <div class="cb-ScopedBrandingSetsPanel-headerClose slds-medium-size--1-of-6">\n                        {{= $P.viewTypes.CommonTemplates.buttonIcon({ buttonClassName: "js-close-panel", svgClassName: "cb-ScopedBrandingSetsPanel-headerCloseIcon", icon: "close", label: "').concat(PicassoWebServices.Labels.AppNav.Close,'", buttonAttributes: "" }) }}\n                    </div>\n                </div>\n                <div class="cb-ScopedBrandingSetsPanel-content slds-grid">\n                    <div class="cb-ScopedBrandingSetsPanel-contentDescription">\n                        <p>').concat(Op.PanelDescription,'</p>\n                    </div>\n                </div>\n                <div class="js-content">\n                    {{= $P.viewTypes.CommonTemplates.spinner }}\n                </div>\n            </div>\n        </div>')),active:!1,events:{"click .js-close-panel":"close","click .js-new-branding-set":"_newBrandingSet"},initialize:function(e){this._tableView=new Dv,this._isDataLoaded=!1},render:function(){return this.$el.html(this._template()),this.active&&this.open(),this},updateContent:function(){this._isDataLoaded||(this.$(".js-content").empty().append(this._tableView.$el),this._isDataLoaded=!0),this._tableView.render()},fadeToggle:function(){this.$(".js-branding-sets-panel").fadeToggle(150,function(){this._checkState()}.bind(this))},fadeIn:function(){this.$(".js-branding-sets-panel").fadeIn(150,function(){this._checkState()}.bind(this))},open:function(){this.$(".js-branding-sets-panel").show(),this._checkState()},close:function(){this.$(".js-branding-sets-panel").hide(),this._checkState()},toggle:function(){this.$(".js-branding-sets-panel").toggle(),this._checkState()},_newBrandingSet:function(){A.showDialog(new ev({onSaveCallback:function(e){return new Promise(function(t){I.event.trigger("action:create-branding-set",{name:e,type:P.BRANDING_SET_TYPE.SCOPED,successCallback:function(e){I.event.trigger("action:set-preview-scoped-branding-set",{id:e.BrandingSet.id,successCallback:function(){o.trigger("theme-editor-action:show-detail",P.BRANDING_SET_TYPE.SCOPED)}}),t()}})})}}),{className:"slds-vex-theme slds-vex-theme--medium"})},_checkState:function(){this.active="block"===this.$(".js-branding-sets-panel").css("display")}}),n=PicassoWebServices.Labels.BrandingSetsPanel,kv=PicassoWebServices.Labels.CommBuilderTextEditorCss;function Nv(){return I.getAppState().getNetworkId()+"_cbCSSEditorDoesShow"}var xv,Rv=Backbone.View.extend({className:"cb-BrandingSetsNav js-branding-sets-nav slds-dropdown slds-dropdown_left",_template:b.template('\n        <ul class="slds-dropdown__list" role="menu" aria-label="'.concat(n.ShowBrandingNav,'">\n            <li class="slds-dropdown__item">\n                <a class="cb-BrandingSetsNavItem js-dropdown-item js-open-branding-sets {{= brandingSetEditorClass }}" role="menuitem">\n                <div class="cb-BrandingSetsNavItemContainer">\n                    <div class="cb-BrandingSetsNavItemIconContainer">\n                        ').concat(D.icon({svgClassName:"cb-BrandingSetsNavItemIcon slds-icon_small",icon:"palette"}),'\n                    </div>\n                    <div class="cb-BrandingSetsNavItemLabel slds-truncate">\n                        {{ if (showScopedBrandingSetManagement) {}}\n                        ').concat(n.NavManageScopedBrandingSets,"\n                        {{ } else {}}\n                        ").concat(n.NavManageBrandingSets,'\n                        {{}}}\n                    </div>\n                </div>\n                </a>\n            </li>\n            {{ if (showEditCss) {}}\n            <li class="slds-dropdown__item">\n                <a class="cb-BrandingSetsNavItem js-dropdown-item js-open-css-editor" role="menuitem">\n                    <div class="cb-BrandingSetsNavItemContainer">\n                        <div class="cb-BrandingSetsNavItemIconContainer">\n                            ').concat(D.icon({svgClassName:"cb-BrandingSetsNavItemIcon slds-icon_small",icon:"insert_tag_field"}),'\n                        </div>\n                        <div class="cb-BrandingSetsNavItemLabel slds-truncate">\n                            ').concat(n.NavEditCSS,"\n                        </div>\n                    </div>\n                </a>\n            </li>\n            {{}}}\n        </ul>").trim()),events:{"click .js-open-branding-sets":"_openBrandingSets","click .js-open-css-editor":"_handleCSSEditorClick"},initialize:function(e){this.showBrandingSetEditor=e.showBrandingSetEditor},render:function(){var e="";return this.showBrandingSetEditor||(e="cb-BrandingSetsNavItem--hidden"),this.$el.html(this._template({brandingSetEditorClass:e,showScopedBrandingSetManagement:N.isScopedBrandingSetManagementEnabled(),showEditCss:N.isCustomCssEnabled()})),this},close:function(){this.$(".js-branding-sets-nav").hide()},_openCSSEditor:function(){this.$(".js-branding-sets-nav").hide();var e="cb-TextEditor-dialog",t={editorMode:"css",contentKey:"CustomCSS",shouldValidateOnType:!0,shouldValidateOnSave:!0,updateCss:!0,reloadIFrame:!1,EditorTitle:kv.EditorTitle,EditorTips:kv.EditorTips,CloseWarningTitle:kv.CloseWarningTitle,CloseWarning:kv.CloseWarning,ValidationWarningTitle:kv.ValidationWarningTitle,ValidationWarning:kv.ValidationWarning,ValidationWarningYes:kv.ValidationWarningYes,textEditorDialogClassName:e,pageId:I.getAppState().getCurrentPageId()};So(t,{showCloseButton:!1,contentClassName:e,className:"cb-TextEditor-vex-theme",escapeButtonCloses:!1})},_showCSSEditorPromptDialog:function(){var e=kv.CSSEditorDialogMsg,t=function(e){e&&(T.cookie(Nv(),!0),this._openCSSEditor())}.bind(this);A.sldsPromptConfirm({title:kv.CSSEditorDialogTitle,content:e,yesText:kv.CSSEditorDialogYes,className:"js-CSSEditorPromptDialog",callback:t})},_handleCSSEditorClick:function(){T.cookie(Nv())?this._openCSSEditor():this._showCSSEditorPromptDialog()},_openBrandingSets:function(e){e.currentTarget.classList.contains("js-disabled")||(this.$(".js-branding-sets-nav").hide(),this.trigger("panel:fadeIn"))}}),e=PicassoWebServices.Labels.ThemeEditor,Mp=PicassoWebServices.Labels.BrandingSetsPanel,Np=PicassoWebServices.Labels.AppNav.ColorPaletteTitle,jv=Backbone.View.extend({className:"cb-BrandingSetsPanel-container js-branding-set-container",_template:_.template('\n        <div class="cb-BrandingSetsPanel-titleContainer slds-grid slds-grid_align-spread slds-grid_vertical-align-center">\n            <div class="cb-BrandingSetsPanel-headerContainer slds-text-heading_small">\n                <div class="cb-BrandingSetsPanel-headerTitle slds-truncate js-header-title" title="{{= title}}">{{= title}}</div>\n                <div class="cb-BrandingSetsPanel-scopedTitleContainer js-scoped-title-container slds-grid">\n                    '.concat(D.buttonIcon({buttonClassName:"cb-BrandingSetsPanel-scoped-backBtn js-scoped-back-btn cb-no-focus-outline",svgClassName:"slds-icon_x-small",label:"".concat(e.Back),icon:"chevronleft"}),'\n                    <span class="cb-BrandingSetsPanel-headerScopedTitle slds-truncate js-scoped-title">').concat(Np,'</span>\n                </div>\n                <div class="cb-BrandingSetsPanel-subTitleContainer js-sub-title-container slds-grid">\n                    ').concat(D.buttonIcon({buttonClassName:"cb-BrandingSetsPanel-backBtn js-back-btn cb-no-focus-outline",svgClassName:"slds-icon_x-small",label:"".concat(e.Back),icon:"chevronleft"}),'\n                    <span class="cb-BrandingSetsPanel-headerSubTitle slds-truncate js-sub-title"></span>\n                </div>\n            </div>\n            {{ if (showNavTrigger) { }}\n            <div class="js-toggle slds-dropdown-trigger slds-dropdown-trigger_click">\n                <button class="cb-BrandingSetsPanel-button slds-button slds-button_icon-border slds-button_icon-x-small slds-not-selected" aria-haspopup="true" title="').concat(Mp.ShowBrandingNav,'">\n                    <svg aria-hidden="true" class="slds-button__icon">\n                        <use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#down"></use>\n                    </svg>\n                </button>\n            </div>\n            {{ } }}\n        </div>').trim()),events:{"click .js-toggle":"toggle","click .js-back-btn":"_onClickBackBtn","click .js-scoped-back-btn":"_onClickScopedBackBtn"},panel:null,nav:null,isScopedBrandingSet:!1,initialize:function(e){this.title=e.title,this.panel=new(N.isScopedBrandingSetManagementEnabled()?Av:mv);this.listenTo(I.event,["state:branding-set-values-updated","state:preview-site-branding-set-updated","state:preview-scoped-branding-set-updated","state:default-branding-set-updated","state:branding-set-created","state:branding-set-duplicated","state:branding-set-renamed","state:branding-set-deleted","state:branding-audience-target-infos-updated","state:branding-audience-target-priorities-updated","state:current-theme-updated"].join(" "),this._update),this.listenTo(I.event,"state:audience-entity-updated",this._handleAudienceEntityUpdated),this.render(),this.initializeBrandingNav(),this.listenTo(I.event,"state:branding-upgradeflow-sync",this.initializeBrandingNav),this.listenTo(j.getAppEvent(),"theme-editor-action:show-detail",this._handleShowDetail)},_handleShowDetail:function(e,t){t?(this.$(".js-header-title").css("display","none"),this.isScopedBrandingSet=e===P.BRANDING_SET_TYPE.SCOPED):(this._navigateBackIfNeeded(),e===P.BRANDING_SET_TYPE.APP?(this.$(".js-scoped-title-container").css({display:"none"}),this.$(".js-sub-title-container").css({display:"none"}),this.$(".js-header-title").css({display:"inherit",opacity:1,transform:"translateX(0px)"}),this.isScopedBrandingSet=!1):e===P.BRANDING_SET_TYPE.SCOPED&&(this.isScopedBrandingSet=!0,this.showScopedTitle()))},_navigateBackIfNeeded:function(){var e=this.$(".js-sub-title-container").get(0);"none"!==getComputedStyle(e).display&&(this.trigger("back"),this.$(".js-sub-title-container").css("display","none"),this.$(".js-scoped-title-container").css({transform:"translateX(0px)"}))},initializeBrandingNav:function(){var e=Qe.isBrandingUpgradeFlowFetched()&&N.isBrandingSetEditorEnabled();this.nav=new Rv({showBrandingSetEditor:e}),T(document).click(function(e){0===this.$el.has(e.target).length&&0===this.nav.$el.has(e.target).length&&this.nav.close()}.bind(this)),this.listenTo(this.nav,"panel:fadeIn",function(){this.panel.fadeIn()}.bind(this)),e&&l.getBrandingAudienceTargetInfosPromise().done(function(){this._update()}.bind(this))},render:function(){return this.$el.html(this._template({title:this.title,showNavTrigger:I.AccessControl(P.PERMISSIONS.BRANDING_SETS)})),this.$(".js-sub-title-container").css("display","none"),this.$(".js-scoped-title-container").css("display","none"),N.isScopedBrandingSetManagementEnabled()&&this.$(".js-toggle").css("display","none"),this.$el.append(this.panel.render().$el),this},toggle:function(e){var t=this.$(".js-toggle");this.nav.render().delegateEvents(),ta.trigger(this.nav.$el,t,{dismissSelectorWithinDropdown:".js-dropdown-item"})},hide:function(){this.panel.close()},showScopedTitle:function(){this.$(".js-header-title").css("display","none"),this.$(".js-scoped-title-container").css({display:"inherit",opacity:1})},showSubTitle:function(e){var e=this.$(".js-sub-title").html(e).css("display","none"),t=this.$(".js-sub-title-container"),n=this.isScopedBrandingSet?this.$(".js-scoped-title-container"):this.$(".js-header-title");T.Velocity.RunSequence([{elements:n,properties:"transition.slideLeftOut",options:{duration:C.SLIDE_LEFT_OUT_DURATION,complete:function(){t.css({display:"inherit",opacity:0})}}},{elements:t,properties:"transition.fadeIn",options:{duration:C.SLIDE_RIGHT_IN_DURATION}},{elements:e,properties:"transition.slideRightBigIn",options:{duration:C.SLIDE_RIGHT_IN_DURATION,sequenceQueue:!1}}])},showNavTrigger:function(e){N.isScopedBrandingSetManagementEnabled()&&(e=e===P.BRANDING_FIELD.COLOR?"":"none",this.$(".js-toggle").css("display",e))},openBrandingSetPanel:function(){this.panel.fadeIn()},closeBrandingSetPanel:function(){this.panel.close()},_onClickScopedBackBtn:function(){this.isScopedBrandingSet=!1,I.event.trigger("action:set-preview-scoped-branding-set",{id:null,successCallback:function(){o.trigger("theme-editor-action:show-detail",P.BRANDING_SET_TYPE.APP)}})},_onClickBackBtn:function(){var e=this.$(".js-sub-title"),t=this.isScopedBrandingSet?this.$(".js-scoped-title-container"):this.$(".js-header-title"),n=this.$(".js-sub-title-container");T.Velocity.RunSequence([{elements:e,properties:"transition.slideRightBigOut",options:{duration:C.SLIDE_RIGHT_OUT_DURATION}},{elements:n,properties:"transition.fadeOut",options:{duration:C.SLIDE_RIGHT_OUT_DURATION,sequenceQueue:!1,complete:function(){t.css({display:"inherit",opacity:0})}}},{elements:t,properties:"transition.slideLeftIn",options:{duration:C.SLIDE_LEFT_IN_DURATION}}]),this.trigger("back")},_update:function(){this.panel.updateContent()},_handleAudienceEntityUpdated:function(e){e===P.AUDIENCE_TARGET_NAME.BRANDING&&this._update()}}),Bv="js-component-palette-button",Ov="js-theme-editor-button",Mv="js-page-structure-button",Vv="js-settings-button",$v={},Uv=($v[P.LEFT_PANEL.COMPONENT_PALETTE]=Bv,$v[P.LEFT_PANEL.THEME_EDITOR]=Ov,$v[P.LEFT_PANEL.PAGE_STRUCTURE]=Mv,$v[P.LEFT_PANEL.SETTINGS]=Vv,Backbone.View.extend({className:"cb-AppNav js-app-nav",attributes:{tabindex:-1},buttonTemplate:_.template('<button class="cb-AppNav-button {{=classes}}" data-type="{{=type}}" aria-label="{{=title}}"><span class="cb-AppNav-buttonIcon"><svg aria-hidden="true" class="slds-icon_x-small"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#{{=icon}}"></use></svg></span><span class="cb-AppNav-buttonLabel">{{=title}}</span>{{ if (badge && badge.value) { }}<span title="{{=badge.title}}" class=" {{= badge.style + " cb-AppNav-buttonBadge js-button-badge" }}">{{=badge.value}}</span>{{ } }}</button>'),events:function(){var t={};return _.each($v,function(e){t["click ."+e]="_onSelect"}),t},_openedPanel:null,initialize:function(){this.initButtonOptions(),this.initializeLeftPanel(),this.showPageEditor=!0;var t=I.getAppState().getCurrentPageId();this.listenTo(I.event,"state:page-change-start",function(){var e=I.getAppState().getCurrentPageId();e!=t&&(this._isCurrentPageSiteComLogin()?this._showHideComponentsPanel(!1):this._showHideComponentsPanel(!0),t=e)}),this.listenTo(j.getAppEvent(),"open-app-nav",this.open),this.listenTo(I.event,"state:component-error",function(){this.render()}),this.listenTo(I.event,"state:no-component-errors",function(){this.render()}),I.getAppState().on("change:workspaceMode",this._handleWorkspaceModeChange.bind(this)),E.getSite().on("change:isHeadMarkupVerified",function(){this.initButtonOptions(),this.render()}.bind(this)),Vn.isMobileExperienceEnabled()&&I.getAppState().on("change:currentResolution",function(){var e;this.render(),null!=this._openedPanel&&(e=$v[this._openedPanel],this._panelsMap[e].close())}.bind(this)),I.event.on("state:upgradeflows-loaded",function(){this.initButtonOptions(),this.render()}.bind(this)),this.render()},initializeLeftPanel:function(){this._panelsMap={},this._panelsMap[Bv]=new zl({title:this.componentsButtonOptions.title,view:new Kl,isFixedHeight:!0,closeOnComponentSelect:!0,closeOnComponentDeselect:!0});var e=new jv({title:this.themeEditorButtonOptions.title}),e=(this._panelsMap[Ov]=new zl({title:"",view:new Wd({headerView:e}),isFixedHeight:!1,headerOptionView:e,closeOnComponentSelect:!0,closeOnComponentDeselect:!0}),new(I.AccessControl(P.PERMISSIONS.NEW_PAGE_STRUCTURE_PANEL)?sp:Fu)),t=(Vn.isMobileExperienceEnabled()&&e.on("hidden-component-count-changed",this._handleHiddenComponentCountChanged.bind(this)),Vn.isResponsiveCmpVisibilityEnabled()&&e.on("responsive-hidden-components-loaded",this._updateResponsiveVisibilityBadge.bind(this)),this._panelsMap[Mv]=new zl({title:this.pageStructureButtonOptions.title,view:e,isFixedHeight:!1,classNames:"pageStructure",closeOnComponentSelect:!1,closeOnComponentDeselect:!1}),this._panelsMap[Vv]=new zl({title:this.settingsButtonOptions.title,view:new Jm,isFixedHeight:!0,classNames:"widePanel",closeOnComponentSelect:!0,closeOnComponentDeselect:!0}),T("#pagesLiveWorkareaPanel"));this._forEachPanel(function(e){this.listenTo(e,"close",this._onPanelClose),t.append(e.$el.hide())})},initButtonOptions:function(){this.componentsButtonOptions={classes:Bv,type:P.LEFT_PANEL.COMPONENT_PALETTE,icon:"connected_apps",title:PicassoWebServices.Labels.AppNav.ComponentPaletteTitle,badge:void 0},this.themeEditorButtonOptions={classes:Ov,type:P.LEFT_PANEL.THEME_EDITOR,icon:"brush",title:PicassoWebServices.Labels.AppNav.ThemeTitle,badge:void 0},this.pageStructureButtonOptions={classes:Mv,type:P.LEFT_PANEL.PAGE_STRUCTURE,icon:"page_structure",title:PicassoWebServices.Labels.AppNav.PageStructureTitle,badge:void 0},this.settingsButtonOptions={classes:Vv,type:P.LEFT_PANEL.SETTINGS,icon:"settings",title:PicassoWebServices.Labels.AppNav.SettingsTitle,badge:{value:(Qe.needsUpgrade()?1:0)+(E.getSite().get("isHeadMarkupVerified")?0:1),title:PicassoWebServices.Labels.AppNav.UpdatesAvailable}}},render:function(){var e=[],t=this.pageStructureButtonOptions,t=(0<Ke.getAllComponentErrors().length&&(t=_.extend({},t,{badge:{value:'<div class="icon-utility-error"></div>',title:PicassoWebServices.Labels.AppNav.ComponentError}})),this.buttonTemplate(t));return Vn.isMobileExperienceEnabled()&&I.getAppState().isMobileFormFactor()?(e.push(t),setTimeout(function(){T(".cb-AppNav").css({position:"fixed",top:T(".cb-AppNav").offset().top})})):(I.getAppState().supportViewCrud()&&!this._isCurrentPageSiteComLogin()&&e.push(this.buttonTemplate(this.componentsButtonOptions)),e.push(this.buttonTemplate(this.themeEditorButtonOptions)),e.push(t),e.push(this.buttonTemplate(this.settingsButtonOptions))),this.$el.html(e.join("")),this._openedPanel&&this.open(this._openedPanel),this},_onSelect:function(e){e=T(e.currentTarget).data("type");this.open(e)},_hidePanelsOther:function(n){this._forEachPanel(function(e,t){n!==t&&e.hide()})},open:function(e){this._resetButtonState(),this._openedPanel=e;var e=$v[e],t=(this._hidePanelsOther(e),this.$("."+e).addClass("is-active"),this._panelsMap[e]);t.show(function(){var e=t.$el[0].querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');e&&e.focus()})},_forEachPanel:function(e){_.each(this._panelsMap,e.bind(this))},_onPanelClose:function(e){e=e.isManualClose;this._resetButtonState(e)},_resetButtonState:function(e){e&&this.$(".cb-AppNav-button.is-active").focus(),this.$(".cb-AppNav-button").removeClass("is-active"),this._openedPanel=null},_showHideComponentsPanel:function(e){e?(this.$("."+Bv).removeClass("hide"),this.$("."+Ov).removeClass("hideTopCurve")):(this.$("."+Bv).addClass("hide"),this.$("."+Ov).addClass("hideTopCurve"))},_handleWorkspaceModeChange:function(e){e.get("workspaceMode")===P.workspace.PREVIEW?(j.getAppEvent().trigger("close-left-panel"),this.$el.fadeOut(200)):this.$el.fadeIn(200)},_handleHiddenComponentCountChanged:function(e){var t;0===Ke.getAllComponentErrors().length&&(t=this.$("."+Mv+" .js-button-badge"),I.getAppState().isMobileFormFactor()&&0<e?(e={value:e,title:PicassoWebServices.Labels.AppNav.HiddenComponentBadgeTitle,style:"cb-AppNav-hiddenComponentBadge"},this.pageStructureButtonOptions.badge=e,0<t.length?(t.empty().html(e.value),t.attr("title",e.title),t.addClass(e.style)):this.render()):0<t.length&&(this.pageStructureButtonOptions.badge=void 0,this.render()))},_showHideResponsiveVisibilityBadge:function(e){var t=this.$(".".concat(Mv," .").concat("js-button-badge"));e?0===t.length&&(e={value:'<span class="cb-AppNav-hiddenComponentBadge--plain"></span>',title:PicassoWebServices.Labels.AppNav.HiddenComponentBadgeTitle,style:"cb-AppNav-hiddenComponentBadge"},this.pageStructureButtonOptions.badge=e,this.render()):0<t.length&&(this.pageStructureButtonOptions.badge=void 0,this.render())},_updateResponsiveVisibilityBadge:function(e){this._showHideResponsiveVisibilityBadge(e)},_isCurrentPageSiteComLogin:function(){return I.getAppState().getCurrentPageId()===E.getSite().get("loginpage")&&!I.getAppState().isCurrentPageAura()}})),Wv="js-cb-tooltip",Fv=_.template('<div class="tooltip bottom" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>');function Hv(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:window,i=e;return{get:function(){var e=i;return i=void 0,n.hasOwnProperty(t)&&delete n[t],e}}}function Gv(e){var t=e.selected,n=e.label,e=e.colorPalette;return'<div class="cb-brandingSetPicklistItem">\n        <div class="'.concat(t?"cb-brandingSetPicklistItem--active":"",'">\n            ').concat(D.icon({icon:"check"}),'\n            <span class="cb-brandingSetPicklistItemLabel slds-truncate test-branding-set-picklist-item-label" title="').concat(n,'">').concat(n,"</span>\n            ").concat(e||"","\n        </div>\n    </div>").trim()}var zv={init:function(l){xv=l.jQuery||window.jQuery;var e=l.$el,t=l.selector,c=l.content,d=xv(Fv({className:l.className||""})),u=d.find(".tooltip-inner");return e.on("mouseenter."+Wv,t,function(e){var t,n,i,s,a,o,r;_.isFunction(c)?u.append(c()):_.isString(c)&&u.append(c),xv("body").append(d),t=d,e=e.currentTarget,n=l,e=e.getBoundingClientRect(),i=t[0].getBoundingClientRect(),s=xv(document).width(),a=e.top+e.height,o=e.left+e.width/2-i.width/2,r="50%",o+i.width>s?(o=s-i.width,r=i.width-(s-e.left-e.width/2)):o<0&&(o=0,r=e.left+e.width/2),t.addClass(n.whitespaceWrap?"in wrap":"in").css({top:a,left:o}),t.find(".tooltip-arrow").css({left:r})}),e.on("mouseleave."+Wv,t,function(){u.empty(),d.remove()}),this}},Kv=PicassoWebServices.Labels.CommBuilderPropertyEditor,xp=Kv.ScopedBrandingSetsPicklistValueNew,Yv=Kv.ScopedBrandingSetsPicklistValueNone,qv='<div class="cb-brandingSetPicklistItem cb-newBrandingSetItem">\n        <div class="cb-newBrandingSetIcon">\n            '.concat(D.icon({icon:"add"}),'\n            <span class="cb-brandingSetPicklistItemLabel test-branding-set-picklist-item-label">').concat(xp,"</span>\n        </div>\n    </div>").trim(),Xv='<a class="cb-editBrandingSet slds-m-top_xx-small js-edit-branding-set">'.concat(Kv.ScopedBrandingSetsEdit,"</a>"),Jv=Backbone.View.extend({tagName:"div",className:"cb-BrandingSetPicklist slds-p-bottom_small slds-p-horizontal_medium js-branding-set-picklist",events:{"click .js-brandingset-picklist-input":"_onBrandingSetPicklistClick","click .js-edit-branding-set":"_handleEditBrandingSet","keyup .js-brandingset-picklist-input":"_onBrandingSetPicklistKeyup"},initialize:function(){var e=this;this._componentId,this._currentBrandingSetId,this.listenTo(I.event,"state:component-scoped-branding-set-updated",function(e){var t=e.brandingSetId;e.componentId===this._componentId&&this._setCurrentBrandingSetValue(t)}),this.listenTo(I.event,"state:branding-set-renamed",function(){this._setCurrentBrandingSetValue(this._currentBrandingSetId)}),this.listenTo(o,"select-aura-component",function(){e.$(".js-brandingset-picklist-input").blur()}),this.render()},render:function(){this.$el.html(this._getComboboxPicklistHtml()),this.$el.append($(Xv))},update:function(e){var t=e.componentId,e=e.currentBrandingSetId;this._componentId=t,this._setCurrentBrandingSetValue(e)},_getComboboxPicklistHtml:function(){var e={formInputClassName:"js-brandingset-picklist-input",formInputId:"brandingset-picklist-input-id",fullWidth:!0,label:Kv.ScopedBrandingSetsPicklistLabel,value:this._getCurrentBrandingSetValue()};return D.comboboxPicklist(e)},_handleEditBrandingSet:function(){I.event.trigger("action:set-preview-scoped-branding-set",{id:this._currentBrandingSetId,successCallback:function(){o.trigger("theme-editor-action:show-detail",P.BRANDING_SET_TYPE.SCOPED),o.trigger("open-app-nav",P.LEFT_PANEL.THEME_EDITOR)}})},_getCurrentBrandingSetValue:function(){var e;return!this._currentBrandingSetId||void 0===(e=(l.getBrandingSet(this._currentBrandingSetId)||{}).name)?Yv:e},_setCurrentBrandingSetValue:function(e){var t=(l.getBrandingSet(e)||{}).name,t=void 0===t?Yv:t;this._currentBrandingSetId=e,t!==Yv?this.$(".js-edit-branding-set").removeClass("hidden"):this.$(".js-edit-branding-set").addClass("hidden"),this.$(".js-brandingset-picklist-input").val(t)},_onBrandingSetPicklistKeyup:function(e){var t=e.keyCode;P.KEYCODE.DOWN===t&&this._onBrandingSetPicklistClick(e)},_onBrandingSetPicklistClick:function(e){var n=this,t=l.getAllBrandingSets(P.BRANDING_SET_TYPE.SCOPED).slice().sort(function(e,t){e=e.name.toUpperCase(),t=t.name.toUpperCase();return e<t?-1:t<e?1:0}).map(function(e){var t=sv(e,4);return{id:e.id,html:Gv({label:e.name,selected:e.id==n._currentBrandingSetId,colorPalette:t})}}),i={id:"",html:Gv({label:Yv,selected:""===n._currentBrandingSetId})},s={id:"new",html:qv};Yd({items:[i].concat(Q(t),[s]),cssClass:"cb-brandingSetPicklistItems js-branding-set-selection-picklist-items",onClickHandler:function(e){"new"===e?n._triggerNewBrandingSetDialog():n._handleUpdateScopedBrandingSetId(e)},selected:this._currentBrandingSetId}).toggle(e.currentTarget)},_getBrandingSetType:function(e){return e?l.getBrandingSet(e).type:P.BRANDING_SET_TYPE.APP},_handleUpdateScopedBrandingSetId:function(e){var t=this._componentId,n=""===e?null:e,i=this._getBrandingSetType(n);e!==this._currentBrandingSetId&&I.event.trigger("action:update-component-scoped-branding-set",{componentId:t,brandingSetId:n,successCallback:function(){window[P.FLAGS.KEEP_LHS_OPEN]=new Hv(!0,P.FLAGS.KEEP_LHS_OPEN),o.trigger("theme-editor-action:show-detail",i),o.trigger("open-app-nav",P.LEFT_PANEL.THEME_EDITOR)}})},_triggerNewBrandingSetDialog:function(){var n=this;A.showDialog(new ev({onSaveCallback:function(e){return new Promise(function(t){I.event.trigger("action:create-branding-set",{name:e,type:P.BRANDING_SET_TYPE.SCOPED,successCallback:function(e){n._handleUpdateScopedBrandingSetId(e.BrandingSet.id),t()}})})}}),{className:"slds-vex-theme slds-vex-theme--medium"})}}),Qv=[{label:(hr=PicassoWebServices.Labels.CommBuilderPropertyEditor).Component,items:[{locator:"js-propertyeditor-duplicate",key:"Duplicate",label:hr.Duplicate,icon:{sprite:"utility",name:"copy"},action:function(e){j.getAppEvent().trigger("clone-canvas-item",e)}},{locator:"js-propertyeditor-delete",key:"Delete",label:hr.Delete,icon:{sprite:"utility",name:"delete"},action:function(e){j.getAppEvent().trigger("delete-canvas-item",e)}}]},{label:hr.Audience,isHidden:function(e,t,n){return!(I.getAppState().supportsNewFeatures()&&!ib())||n.isInThemeRegion()||tb(e)},items:[{locator:"js-propertyeditor-assign-audience",key:"AssignAudience",label:hr.AssignAudience,icon:{sprite:"utility",name:"groups"},isHidden:function(e){return eb(e)||tb(e)},action:function(e,t,n){n.manageAudience(e)}},{locator:"js-propertyeditor-edit-audience",key:"EditAudience",label:hr.EditAudience,icon:{sprite:"utility",name:"groups"},isHidden:function(e){return!eb(e)||tb(e)},action:function(e,t,n){n.manageAudience(e)}},{locator:"js-propertyeditor-unassign-audience",key:"UnassignAudience",label:hr.UnassignAudience,icon:{sprite:"utility",name:"ban"},isHidden:function(e){return!eb(e)||tb(e)},action:function(e,t,n){n.unassignAudience(e)}}]},{label:hr.Performance,isHidden:function(e,t,n){return!(E.getSite().isProgressiveRenderingEnabled()&&!ib())||n.isInThemeRegion()||n.isInTabset()},items:[{locator:"js-propertyeditor-assign-priority",key:"AssignPriority",label:hr.AssignPriority,icon:{sprite:"standard",name:"dashboard",extraClass:"cb-DropdownMenu-standardIcon"},isHidden:function(e,t,n){return nb(n)},action:function(e,t,n){n.managePriority(e)}},{locator:"js-propertyeditor-edit-priority",key:"EditPriority",label:hr.EditPriority,icon:{sprite:"standard",name:"dashboard",extraClass:"cb-DropdownMenu-standardIcon"},isHidden:function(e,t,n){return!nb(n)},action:function(e,t,n){n.managePriority(e,n.getPriority())}},{locator:"js-propertyeditor-unassign-priority",key:"UnassignPriority",label:hr.UnassignPriority,icon:{sprite:"utility",name:"ban"},isHidden:function(e,t,n){return!nb(n)},action:function(e,t,n){n.unassignPriority(e)}}]}];function Zv(e){var t=I.getAppState().getCurrentViewId();return f.getAudienceTargetInfoForComponent(t,e)}function eb(e){e=Zv(e);return!!e&&!e.get("hasCmpAttributeVariation")}function tb(e){e=Zv(e);return!!e&&e.get("hasCmpAttributeVariation")}function nb(e){return e.isPriorityAssigned()}function ib(){var e=I.getAppState().getCurrentViewId();return c.isServiceNotAvailableView(e)}var sb=[{items:[{locator:"js-propertyeditor-duplicate",key:"Duplicate",label:(t=PicassoWebServices.Labels.CommBuilderPropertyEditor).Duplicate,icon:{sprite:"utility",name:"copy"},action:function(e){j.getAppEvent().trigger("clone-canvas-item",e)}},{locator:"js-propertyeditor-delete",key:"Delete",label:t.Delete,icon:{sprite:"utility",name:"delete"},action:function(e){j.getAppEvent().trigger("delete-canvas-item",e)}}]}],ab=[{items:[{locator:"js-propertyeditor-rename-variation",key:"Rename Variation",label:(mr=PicassoWebServices.Labels.CommBuilderPropertyEditor).EditVariationName,icon:{sprite:"utility",name:"edit"},action:function(e){j.getAppEvent().trigger("open-create-variation-popover",e,".cb-ComponentPropertyPanel-headerTitle",!1,!0)}},{locator:"js-propertyeditor-delete-variation",key:"Delete Variation",label:mr.DeleteVariation,icon:{sprite:"utility",name:"delete"},action:function(e){j.getAppEvent().trigger("delete-variation-item",e)}}]}],ob=PicassoWebServices.Labels.ExpressionBasedVariations,rb=Backbone.View.extend({className:"js-create-variation-modal",_currentId:"",_currVariationName:"",_isRenameVariationFlow:!1,_newComponentVariationTemplate:_.template('<div class="js-create-variation-modal">\n            <header class="slds-popover__header cb-variation-modal-header">\n                <div class="slds-float_left cb-variation-modal-title"> '.concat(ob.NewComponentVariation,' </div>\n                {{=$P.viewTypes.CommonTemplates.buttonIcon({buttonClassName: "js-add-variation-modal-close slds-button_icon-small slds-float_right slds-popover__close", label: PicassoWebServices.Labels.PicassoDialog.Close, icon: "close" }) }}\n            </header>\n            <div class="slds-form-element">\n                <label class="slds-form-element__label cb-new-component-variation" for="variation-name-input">\n                    <abbr class="slds-required">* </abbr>\n                    ').concat(ob.ComponentVariationName,'\n                </label>\n                <div class="slds-form-element__control">\n                    <input aria-describedby="create-variation-form-error" class="slds-input js-name" type="text" id="variation-name-input" maxLength="80" name="value" required="true" aria-required="true">\n                </div>\n                <div id="create-variation-form-error" class="js-variation-name-input-alert slds-form-element__help slds-hide" role="alert"></div>\n            </div>\n            <footer class="cb-variation-modal-footer">\n                <div class="slds-grid slds-grid_vertical-align-center">\n                    ').concat(D.button({buttonClassName:"cb-modal-add-item js-modal-add-item",buttonVariantClassName:"slds-button_brand slds-col_bump-left",label:ob.SaveComponentVariation}),"\n                </div>\n            </footer>\n        </div>")),events:{"keyup .js-create-variation-modal":"_handleEmptyVariationNameField","keydown .js-create-variation-modal":"handleKeyDown","click .js-modal-add-item":"_onAddVariationItem","click .js-add-variation-modal-close":"_onAddVariationCloseItem"},initialize:function(e,t,n){this._currentId=e,this._currVariationName=n,this._isRenameVariationFlow=t,this.render()},render:function(){return this.$el.html(this._newComponentVariationTemplate()),this},_onAddVariationCloseItem:function(e){j.getAppEvent().trigger("close-create-variation-popover",this._isRenameVariationFlow)},handleKeyDown:function(e){e=e.keyCode;P.KEYCODE.ESCAPE===e&&this._onAddVariationCloseItem()},_handleEmptyVariationNameField:function(e){this._handleInlineVariationError(!1);var t=this.$el.find("#variation-name-input"),n=t.val(),t=t.closest(".slds-form-element"),t=(0===n.trim().length?(t.addClass("slds-has-error"),t.find(".js-variation-name-input-alert").addClass("slds-show").removeClass("slds-hide").html(ob.RequiredVariationNameError)):(t.removeClass("slds-has-error"),t.find(".js-variation-name-input-alert").addClass("slds-hide").removeClass("slds-show")),this.$el.find(".js-modal-add-item"));this._isRenameVariationFlow&&this._currVariationName===n.trim()?t.attr("disabled",!0):t.attr("disabled",!1)},_handleInlineVariationError:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=1<arguments.length?arguments[1]:void 0;T("div.js-create-variation-modal").find(".js-modal-add-item").attr("disabled",!1);var n=T("div.js-create-variation-modal").find("#variation-name-input").closest(".slds-form-element");e?(n.find(".js-variation-name-input-alert").html(t),n.addClass("slds-has-error"),n.find(".js-variation-name-input-alert").addClass("slds-show").removeClass("slds-hide")):(n.removeClass("slds-has-error"),n.find(".js-variation-name-input-alert").addClass("slds-hide").removeClass("slds-show"))},_onAddVariationItem:function(e){var t=this.$("#variation-name-input").val(),n=this.$el.find(".slds-form-element");0===t.trim().length&&this._handleEmptyVariationNameField(),n.hasClass("slds-has-error")||(this.$el.find(".js-modal-add-item").attr("disabled",!0),n={itemId:this._currentId,variationName:t,handleInlineVariationError:this._handleInlineVariationError},this._isRenameVariationFlow?I.event.trigger("action:edit-variation-name",n):I.event.trigger("action:create-variation-component",n))}}),lb={nonSection:{dialogFn:A.sldsModal,dialogOps:{content:PicassoWebServices.Labels.ManageSite.ConfirmDelete,title:PicassoWebServices.Labels.ManageSite.ConfirmDeleteTitle,yesText:PicassoWebServices.Labels.PicassoDialog.Delete,yesTextClassName:"slds-button_destructive"}},lastSection:{dialogFn:A.sldsPromptAlert,dialogOps:{title:PicassoWebServices.Labels.ManageSite.CannotDeleteSectionTitle,content:PicassoWebServices.Labels.ManageSite.CannotDeleteSection,headerClass:"cb-Dialog_header--info",yesTextClassName:"slds-button slds-button_neutral",yesText:PicassoWebServices.Labels.PicassoDialog.GotIt}},nonEmptySection:{dialogFn:A.sldsModal,dialogOps:{content:PicassoWebServices.Labels.ManageSite.ConfirmDeleteSection,title:PicassoWebServices.Labels.ManageSite.ConfirmDeleteSectionTitle,yesText:PicassoWebServices.Labels.PicassoDialog.Delete,yesTextClassName:"slds-button_destructive"}},variationDeleteSection:{dialogFn:A.sldsModal,dialogOps:{content:PicassoWebServices.Labels.ManageSite.ConfirmDeleteVariation,title:PicassoWebServices.Labels.ManageSite.ConfirmDeleteVariationSectionTitle,yesText:PicassoWebServices.Labels.PicassoDialog.Delete,noText:PicassoWebServices.Labels.PicassoDialog.NeverMind,yesTextClassName:"slds-button_destructive",afterClose:function(){var e=T(".js-propertyeditor-dropdown-trigger");0<e.length&&null!=(e=e[0])&&e.focus()}}},emptySection:{dialogFn:A.sldsModal,dialogOps:{content:PicassoWebServices.Labels.ManageSite.ConfirmDelete,title:PicassoWebServices.Labels.ManageSite.ConfirmDeleteSectionTitle,yesText:PicassoWebServices.Labels.PicassoDialog.Delete,yesTextClassName:"slds-button_destructive"}}};function cb(e,t){t=_.extend({},lb[e].dialogOps,{callback:t});return _.extend({},lb[e],{dialogOps:t})}function db(o,r,s,a){function l(e){var t,n,i;e&&(e=o,n=s,i=a,(t=r)?I.event.trigger("action:delete-variation-component",{itemId:e,variationId:t,options:n,successCallback:i}):I.event.trigger("action:delete-aura-component",{itemId:e,options:n,successCallback:i}))}var c,e=I.getAppState().getCurrentViewId(),d=T.Deferred();return k.hasDynamicLayout(e)||E.getSite().isWebApp()?f.getCanvasComponentsForViewAsync(e,function(e){for(var t,n=e.map(function(e){return k.getFlattenedChildren([e]).filter(function(e){e=e.fqn;return vi.isSectionComponent(e)})}),i=0;i<n.length;i++){var s,a=n[i];if(s=_.find(a,function(e){return e.id===o})){t=a.filter(function(e){return void 0===e.variationName});break}}c=r?cb("variationDeleteSection",l):s?1===t.length?cb("lastSection",_.noop):cb(!_.isEmpty(k.getFlattenedImmediateChildren(s.contents))?"nonEmptySection":"emptySection",l):cb("nonSection",l),d.resolve(c)}):d.resolve(cb("nonSection",l)),d.promise()}var ub={handleDeleteItem:function(e,t,n){db(e,t,{fqn:n.fqn,shouldRemoveFromCache:n.shouldRemoveFromCache},n.successCallback).done(function(e){return(0,e.dialogFn)(e.dialogOps)})},getRichContentEditorAttributesAsync:function(e,t){f.getRichContentEditorAttributes(I.getAppState().getCurrentViewId(),e,function(e){t(e)})},getCmpVariationsByPriorityPromise:function(e){var t=T.Deferred();return this.getCmpVariationsByPriorityAsync(e,function(e){t.resolve(e)}),t.promise()},getCmpVariationsByPriorityAsync:function(e,t){f.getComponentVariationsByPriority(f.getContainingViewOrThemeLayoutId(e),e,function(e){t(e)})}},pb="cb-FloatingPanel--docked",gb=Backbone.View.extend({PANEL_MIN_HEIGHT:200,PANEL_MARGIN:15,PANEL_DRAGGED_OPACITY:.7,EXTRA_MARGIN_AT_BOTTOM:50,_states:{},initialize:function(e,t){this.initializeStates(),this._panelManager=e,this._options=t,this.listenTo(I.getAppState(),"change:currentResolution",this._handleResolutionChange),this.$el=p(this.el),this.$el.addClass("cb-FloatingPanel")},initializeStates:function(){this._states={isDocked:!1,isOpened:!1,hasBeenShown:!1}},setState:function(e){if("object"===U(e))for(var t in e)this._states.hasOwnProperty(t)&&(this._states[t]=e[t])},getCurrentState:function(){return Object.assign({},this._states)},open:function(){this._options.draggable&&!this.isDocked()&&this.initializeDraggable(),this.$el.hasClass("closed")&&(this.$el.removeClass("closed"),this.setState({isOpened:!0}),this.handleDisplayChange(),this._panelManager.handleOpen(this.panelId))},close:function(){this.$el.addClass("closed"),this.setState({isOpened:!1}),j.getAppEvent().trigger("float-panel-closed",this.panelId),this._panelManager.handleClose(this.panelId)},isVisible:function(){return!this.$el.hasClass("closed")&&!this.$el.hasClass("hidden")},enable:function(){this.$el.hasClass("hidden")&&(this.$el.removeClass("hidden"),this.handleDisplayChange())},disable:function(){this.$el.addClass("hidden")},position:function(e){this.$el.css(e)},resetPosition:function(){this.$el.css({left:"",top:""})},handleDisplayChange:function(){var e=this;this.isVisible()&&(this.hasBeenShown()||(this.setState({hasBeenShown:!0}),window.requestAnimationFrame(function(){return e.ensurePanelScrollable()})),this.isDocked()||this.ensurePanelVisible())},hasBeenShown:function(){return this.getCurrentState().hasBeenShown},initializeDraggable:function(){this.LABELS={};var n=this;n._isDraggableInitialized||(n.$el.css({"min-height":this.PANEL_MIN_HEIGHT+"px",margin:this.PANEL_MARGIN+"px"}),n.$el.draggable({containment:n.getContainment(),iframeFix:!0,scroll:!1,cancel:this.PANEL_BODY_SELECTOR,cursor:"move",opacity:this.PANEL_DRAGGED_OPACITY,start:function(e,t){p(this).css({bottom:"auto"}),n._panelManager.handleDragStart(n.panelId)},stop:function(){n.onDragStop()}}),p(window).resize(n.onResize.bind(n))),n._isDraggableInitialized=!0},onResize:function(){this.isVisible()&&!this.isDocked()&&this.ensurePanelVisible(),this.updateDraggableContainment()},onDragStop:function(){var e=this;window.requestAnimationFrame(function(){return e.ensurePanelVisible()})},updateDraggableContainment:function(){this.$el.draggable("option","containment",this.getContainment())},ensurePanelVisible:function(){this.setPanelPositionAndScroll(this.getVisiblePosition())},setPanelPositionAndScroll:function(e){e=Object.assign({height:"auto",bottom:"auto"},e);this.$el.css(e),this.ensurePanelScrollable()},getVisiblePosition:function(){return{top:Math.max(0,Math.min(this.$el.position().top,p(window).height()-this.PANEL_MIN_HEIGHT-2*this.PANEL_MARGIN))+"px",left:Math.max(0,Math.min(this.$el.position().left,p(window).width()-this.$el.outerWidth(!0)))+"px"}},ensurePanelScrollable:function(){var e=this.getMaxHeight();this.$el.css({"max-height":e})},getMaxHeight:function(){var e=this.$el[0].getBoundingClientRect();return window.innerHeight-e.top-this.PANEL_MARGIN+"px"},getContainment:function(){return[0,p("#pagesLiveWorkareaPanel").offset().top,p("#pagesLiveWorkareaPanel").width()-this.$el.outerWidth(!0),2*p(window).height()]},toggleDock:function(){var e=!this.isDocked();this.setState({isDocked:e}),e?(this._styleDockedPanel(),this._panelManager.handleDock(this.panelId)):(this._styleUndockedPanel(),this.initializeDraggable(),this._panelManager.handleUndock(this.panelId)),this.$el.draggable("option","disabled",e)},isDocked:function(){return this.getCurrentState().isDocked},_styleDockedPanel:function(){this.$el.addClass(pb),this._updateDockIcon(),j.getAppEvent().trigger("dock-floating-panel")},_styleUndockedPanel:function(){this.$el.removeClass(pb),this._updateDockIcon(),j.getAppEvent().trigger("undock-floating-panel")},_updateDockIcon:function(){var e;this.$(this.DOCK_ICON_CONTAINER_SELECTOR).empty().html(null==(e=this._dockIconTemplate)?void 0:e.call(this,this.isDocked()))},_handleResolutionChange:function(){this.close()}}),hb=PicassoWebServices.Labels.CommBuilderPropertyEditor,mb=PicassoWebServices.Labels.ExpressionBasedVariations,vb=".cb-ComponentPropertyPanel-body",bb="picklist-expanded",fb=".js-propertyeditor-dropdown-trigger",_b=".js-propertyeditor-variation-dropdown-container",Sb="picasso_docked_property_panel";var Cb=gb.extend({tagName:"div",className:"cb-ComponentPropertyPanel hidden closed js-propertyeditor",panelId:P.FLOATING_PANEL.PROPERTIES_PANEL,DOCK_ICON_CONTAINER_SELECTOR:".js-propertyeditor-dock-icon-container",PANEL_MIN_HEIGHT:200,PANEL_BODY_SELECTOR:vb,template:function(){var e=I.AccessControl(P.PERMISSIONS.STYLE_PROPERTIES)||I.AccessControl(P.PERMISSIONS.VISIBILITY_PROPERTIES),t=I.AccessControl(P.PERMISSIONS.VISIBILITY_PROPERTIES)&&I.AccessControl(P.PERMISSIONS.VARIATIONS_PROPERTIES);return'\n        <div class="'.concat(e?"cb-ComponentPropertyPanel-header-for-tabs":"cb-ComponentPropertyPanel-header",'">\n            <div class="cb-ComponentPropertyPanel-variationBack js-propertyeditor-variation-back invisible">\n            ').concat($P.viewTypes.CommonTemplates.buttonIcon({svgClassName:"cb-variation-back-icon",icon:"chevronleft",label:mb.BackToDefault}),'\n            </div>\n            <div class="slds-grid slds-grid_align-spread">\n                <div class="cb-ComponentPropertyPanel-headerTitle js-propertyeditor-header-title slds-truncate" role="heading" aria-level="3"></div>\n                <div class="cb-ComponentPropertyPanel-headerActions slds-grid">\n                    ').concat(t?""+D.tooltipButtonIconWithDropdown({buttonClassName:"js-propertyeditor-variation-dropdown-container cb-variation-button slds-button_icon-border",iconSvgClassName:"cb-variation-icon",dropdownIconSvgClassName:"slds-button__icon_x-small cb-variation-dropdown-icon",icon:"planning_poker",label:mb.ShowVariations,tooltipPlacement:"bottom",tooltipLabel:hb.CreateVariation}):"",'\n                    <div class="cb-ComponentPropertyPanel-dropdownTrigger js-propertyeditor-dropdown-trigger-container">\n                        ').concat($P.viewTypes.CommonTemplates.dropdownButtonIcon({buttonClassName:"js-propertyeditor-dropdown-trigger",svgClassName:""}),'\n                    </div>\n                    <div class="cb-ComponentPropertyPanel-dockIcon js-propertyeditor-dock-icon-container"></div>\n                    ').concat($P.viewTypes.CommonTemplates.buttonIcon({buttonClassName:"cb-ComponentPropertyPanel-closeButton js-propertyeditor-close",svgClassName:"cb-ComponentPropertyPanel-closeIcon",label:PicassoWebServices.Labels.PicassoDialog.Close,icon:"close"}),'\n                </div>\n            </div>\n            <div class="js-propertyeditor-edit-audience-container"></div>\n            <div class="js-propertyeditor-edit-priority-container"></div>\n        </div>\n        <div class="cb-ComponentPropertyPanel-body"></div>\n        <div class="cb-ComponentPropertyPanel-footer">\n            <div class="js-propertyeditor-hide-component-container"></div>\n        </div>').trim()},_dockIconTemplate:function(e){return D.buttonIcon({buttonClassName:"js-propertyeditor-dock",label:e?hb.UndockPanel:hb.DockPanel,icon:e?"pinned":"pin"})},_audienceDataTemplate:_.template('<div class="cb-ComponentPropertyPanel-headerAudienceInfo"><div class="cb-ComponentPropertyPanel-editAudience">{{= $P.viewTypes.CommonTemplates.icon({ svgClassName: "cb-ComponentPropertyPanel-audienceIcon js-propertyeditor-edit-audience js-propertyeditor-open-audience-selector", icon: "groups" }) }}</div><span class="cb-ComponentPropertyPanel-headerAudienceInfoDesc js-propertyeditor-header-audience-info-desc">{{= audienceDesc }}</a></span></div>'),_priorityDataTemplate:_.template('<div class="cb-ComponentPropertyPanel-headerPriorityInfo"><div class="cb-ComponentPropertyPanel-editPriority">{{= $P.viewTypes.CommonTemplates.icon({ svgClassName: "cb-ComponentPropertyPanel-priorityIcon js-propertyeditor-edit-priority js-propertyeditor-open-priority-selector", sprite: "standard", icon: "dashboard" }) }}</div><span class="cb-ComponentPropertyPanel-headerPriorityInfoDesc js-propertyeditor-header-priority-info-desc">{{= priorityDesc }}</a></span></div>'),_hideComponentDataTemplate:_.template('<div class="cb-ComponentPropertyPanel-footerHideComponentAction">{{= $P.viewTypes.CommonTemplates.buttonWithIcon({ buttonClassName: "cb-ComponentPropertyPanel-hidebutton js-propertyeditor-hide-component", buttonVariantClassName: "slds-button_neutral", label: "'+hb.HideOnMobile+'", icon: "hide"}) }}</div>'),_brandingDeepLinkTemplate:function(e){var t=e.brandingSetId,n=e.field,i=e.tab,s=e.section,a=e.category,e=e.label;return'<button class="cb-BrandDeepLink js-brand-deep-link slds-button slds-m-top_x-small slds-m-horizontal_medium" data-field="'.concat(n,'" data-tab="').concat(i,'" data-section="').concat(s,'" data-category="').concat(a,'" data-brand="').concat(t,'">\n            ').concat(D.icon({svgClassName:"slds-icon_x-small",icon:"brush"}),"\n            ").concat(e,"\n        </button>").trim()},events:{"click .js-propertyeditor-open-audience-selector":"_onEditAudience","click .js-propertyeditor-open-priority-selector":"_onEditPriority","click .js-propertyeditor-hide-component":"_onHideComponentInMobile","click .js-propertyeditor-dropdown-trigger":"_onDropdownTrigger","click .js-propertyeditor-variation-dropdown-container":"_onVariationDropdownTrigger","click .js-propertyeditor-variation-back":"_handleVariationBaseComponentSelected","click .js-propertyeditor-dock":"toggleDock","click .js-propertyeditor-close":"close","click .js-brandingset-picklist-input":function(){this._togglePropertyEditorOverflow(!this.$el.hasClass(bb))},"blur .js-brandingset-picklist-input":_.debounce(function(){this._togglePropertyEditorOverflow(!1)},0),"click .js-brand-deep-link":"_onBrandDeepLink",click:"_blurInput"},getMaxHeight:function(){var e=this.$el[0].getBoundingClientRect();return window.innerHeight-e.top-this.PANEL_MARGIN-this.EXTRA_MARGIN_BOTTOM+"px"},initialize:function(e){gb.prototype.initialize.apply(this,arguments),this._propertyPanelLoadedDeferred=p.Deferred(),this._propertyPanelLoadedPromise=this._propertyPanelLoadedDeferred.promise(),this._currentVariationId="",this._selectItemWork=null,this._propertyPanelId=null,this._isResolutionChanged=!0,this.reset(),this._dropdown=new Wo({config:E.getSite().isWebApp()?sb:Qv,customClass:"test-property-editor-dropdown"}),this.EXTRA_MARGIN_BOTTOM=I.AccessControl(P.PERMISSIONS.EINSTEIN_COPILOT)?50:0;var t=jQuery.cookie(Sb);this.setState({isDocked:!t||"true"===t}),this._brandingSetPicklist=new Jv,this.$el=p(this.el),this.$1el=T(this.el),this.listenTo(I.event,"state:navigation-linkset-added",this._handleNavigationLinksetAdded),this.listenTo(I.event,"state:content-area-component-audience-updated",this._handleAuraComponentAudienceUpdated),this.listenTo(I.event,"state:audience-entity-updated",this._handleAudienceEntityUpdated),this.listenTo(I.event,"state:aura-component-updated",this._handleComponentUpdated),this.listenTo(I.event,"state:aura-component-moved",this._handleComponentMoved),this.listenTo(I.getAppState(),"change:currentResolution",this._handleResolutionChange),this.listenTo(I.event,"state:page-change-start",this._onChangingView),this.listenTo(I.event,"state:variation-component-created",this._handleVariationComponentCreated),this.listenTo(I.event,"state:variation-name-edited",this._handleVariationNameUpdation),this.listenTo(I.event,"state:reordered-variation-priority",this._onVariationDropdownTrigger),this.listenTo(j.getAppEvent(),"variation-component-selected",this._handleVariationComponentSelected),this.listenTo(j.getAppEvent(),"base-component-selected",this._handleVariationBaseComponentSelected),this.listenTo(j.getAppEvent(),"open-create-variation-popover",this.handleShowCreateVariationPopover),this.listenTo(j.getAppEvent(),"close-create-variation-popover",this.handleCloseCreateVariationPopover),this.listenTo(I.event,"state:variation-component-deleted",this._handleVariationComponentDeleted),this.listenTo(I.event,"state:component-unhidden",this._updateContent),this.listenTo(j.getAppEvent(),"launch-head-markup-editor",Xp),this.listenTo(I.event,"state:branding-set-values-updated",this._handleBrandingSetValuesUpdated),this.listenTo(I.event,"state:property-editor-initialized",function(){this._propertyPanelLoadedDeferred.resolve()}),this.listenTo(j.getAppEvent(),"open-theme-settings",this._openThemeSettingsFromPropertyPanel)},toggleDock:function(){gb.prototype.toggleDock.apply(this),jQuery.cookie(Sb,this.isDocked(),{expires:400,path:"/"})},set_selectItemWork:function(e){this._selectItemWork=e},_openThemeSettingsFromPropertyPanel:function(e){var t=e.field,n=e.tab,i=e.section,e=e.category,s=N.getClosestBrandingSetId(this._currentVariationId||this._currentItemId),a=l.getBrandingSet(s).type;this._openThemeEditorPanel(s,a,t,{tab:n,section:i,category:e})},_togglePropertyEditorOverflow:function(e){e?this.$el.addClass(bb):this.$el.removeClass(bb)},_onChangingView:function(e){var t=e.viewId;I.AccessControl(P.PERMISSIONS.LWC_PROPERTY_SHEET,function(){f.getPageComponents().fetch({viewId:t})})},_handleResolutionChange:function(){this._isResolutionChanged=!0,this.close()},_handleComponentUpdated:function(e){e=e.props;e&&e.RenderPriority&&this.setPriority(e.RenderPriority)},_handleVariationComponentCreated:function(e,t){this._handleVariationComponentSelected(e,t);e=f.getPageComponents().get(this._currentItemId),e=(null==e||null==(t=e.attributes)||null==(t=t.properties)?void 0:t.label)||"";w.success({message:mb.SaveVariationComponentSuccessful.replace("{0}",e),duration:w.DURATION_MEDIUM,canDismiss:!0}),this._setFocus(_b)},_handleVariationNameUpdation:function(e){e.VariationId&&e.VariationName&&(this._variationName=e.VariationName,this._handleVariationComponentSelected(e.VariationId,e.VariationName,!0),this.$(".js-propertyeditor-header-title").html(e.VariationName),w.success({message:mb.RenameVariationSuccessful,duration:w.DURATION_MEDIUM,canDismiss:!0}),this._setFocus(fb))},_handleVariationComponentSelected:function(e,t){var n=this._currentVariationId||this._currentItemId;(2<arguments.length&&void 0!==arguments[2]&&arguments[2]||e!==n)&&j.getAppEvent().trigger("update-variation-component",e,n,t),this._popover&&this._popover.destroy(),this._variationDropdown&&this._variationDropdown.close(),this._setFocus(_b)},_handleVariationComponentDeleted:function(){var e=this._currentVariationId,t=f.getPageComponents().get(this._currentItemId),n=1<=(null==t||null==(n=t.attributes._variations)?void 0:n.length),t=null==t||null==(t=t.attributes)||null==(t=t.properties)||null==(t=t.dataBindingInfo)?void 0:t.dataProviders,t=null!=t&&t.some(function(e){return e.componentName===P.DATA_PROVIDER.PERSONALIZATION_RECOMMENDATIONS});j.getAppEvent().trigger("update-variation-component",this._currentItemId,e,null==(e=this._currentItemAttrs)?void 0:e.label,n||t),this._setFocus(fb)},_handleVariationBaseComponentSelected:function(){var e;j.getAppEvent().trigger("update-variation-component",this._currentItemId,this._currentVariationId,null==(e=this._currentItemAttrs)?void 0:e.label),this._setFocus(_b)},_handleComponentMoved:function(e){var t=e.shouldReloadPropertyEditor,e=e.itemId;t?(t=null==(t=f.getPageComponents().get(e))?void 0:t.isVariation(),this._updateContent(t)):e===this._currentItemId&&this._renderBrandingDeepLink()},_handleBrandingSetValuesUpdated:function(){var e=null==(e=this._currentItemAttrs)||null==(e=e.fqn)?void 0:e.replace("/",":"),e=N.getBrandingPropertyMapForComponent(e)||{};0<Object.keys(e).length&&this._updateContent(!!this._currentVariationId)},_handleNavigationLinksetAdded:function(){this._fireReloadEditorDataEvent()},_handleAudienceEntityUpdated:function(e,t){var n=this._currentItemId;un(t,n)&&(t=I.getAppState().getCurrentViewId(),this.setAudienceName(t,n),this._fireReloadEditorDataEvent())},_handleAuraComponentAudienceUpdated:function(){var e=I.getAppState().getCurrentViewId(),t=this._currentItemId;this.setAudienceName(e,t)},_fireReloadEditorDataEvent:function(){$P.auraRun(function(){var e=$A.getEvt("markup://siteforceBuilder:reloadEditorData");e&&e.fire()})},close:function(){gb.prototype.close.apply(this),$P.auraRun(function(){$A.getEvt("ui:getActivePanel").setParams({callback:function(e){e&&e.close()}}).fire()})},reset:function(){this._currentItemId=null,this._currentItemAttrs={}},render:function(){var t=this,n=(this.$el.html(this.template()),this.$1el.tooltip({selector:'[data-toggle="tooltip"]',delay:{show:200,hide:0}}),this.isDocked()?this._styleDockedPanel():this._styleUndockedPanel(),this.$(vb)[0]);return $P.auraRun(function(){$A.createComponent("siteforceBuilder:communityBuilderComponentPropertyPanel",{isLWCPropertySheetEnabled:I.AccessControl(P.PERMISSIONS.LWC_PROPERTY_SHEET),shouldShowStyleProperties:I.AccessControl(P.PERMISSIONS.STYLE_PROPERTIES),shouldShowVisibilityProperties:I.AccessControl(P.PERMISSIONS.VISIBILITY_PROPERTIES),shouldShowResponsiveVisibility:I.AccessControl(P.PERMISSIONS.RESPONSIVE_COMPONENT_VISIBILITY),"aura:id":t._currentVariationId||t._currentItemId,shouldShowScreenResponsiveIcon:I.AccessControl(P.PERMISSIONS.RESPONSIVE_PROPERTIES)},function(e){t.isDocked()||t.initializeDraggable(),$A.render(e,n),$A.afterRender(e),t._propertyPanelId=e.getGlobalId(),t._updateContent()})}),zv.init({$el:this.$el,selector:".js-propertyeditor-edit-audience",content:hb.EditAudience,whitespaceWrap:!0,jQuery:p}),this},showComponentProperties:function(l,c){p.when(this._propertyPanelLoadedPromise).then(function(){var e,t=this._currentVariationId||this._currentItemId,n=_.omit(this._currentItemAttrs,"audienceName","scopedBrandingSetId","dataBindingContext"),i=_.omit(this._currentVariationAttrs,"audienceName","scopedBrandingSetId","dataBindingContext"),s=f.getPageComponents(),a=s.get(l),o=null==a?void 0:a.isVariation();if(o){if(!this._reloadComponent(l,i,c,t))return;i=null==a?void 0:a.getParent(),s=(this._currentItemId=i,this._currentVariationId=l,this._variationName=null==c?void 0:c.label,null==(a=s.get(i))||null==(a=a.attributes)?void 0:a.properties);this._currentItemAttrs=_.omit(s,"audienceName","scopedBrandingSetId","dataBindingContext"),this._currentVariationAttrs=_.extend({},c),e=k.getComponentDataProviderPromise(this._currentVariationId)}else{if(!this._reloadComponent(l,n,c,t))return;this._currentItemId=l,this._currentVariationId=null,this._variationName=null,this._currentItemAttrs=_.extend({},c),this._currentVariationAttrs=null,e=k.getComponentDataProviderPromise(this._currentItemId)}var i=this._getAudienceData(this._currentItemId),r=I.getAppState().getCurrentViewId();p.when(e,i).then(function(e){var t=e?e.cmp:null,n=(t||this._currentItemAttrs).label;this._currentItemAttrs.label=n,this.$(".js-propertyeditor-header-title").html(n),this.setDataBindingContext(e),o||this.setAudienceName(r,l),this._renderScopedBrandingSetPicklist(t),this._updateContent(o),this._renderBrandingDeepLink(),this.open(),this._setFocus(".js-propertyeditor-close")}.bind(this)),this._updateFooterActions(),this._isResolutionChanged=!1}.bind(this))},_reloadComponent:function(e,t,n,i){return!(e===i&&_.isEqual(_.omit(t,"label"),_.omit(n,"label"))&&this._isVisible()&&!this._isResolutionChanged)},_getAudienceData:function(e){var t=I.getAppState().getCurrentViewId();return f.getComponentAudienceTargetInfosForViewPromise(t)},isInThemeRegion:function(){var e;return E.getSite().isWebApp()?(e=f.getPageComponents().get(this._currentItemId))&&e.isInThemeRegion():this._currentItemAttrs.isInThemeRegion},isInTabset:function(){return this._currentItemAttrs.isInTabset},isPriorityAssigned:function(){return this.getPriority()&&"neutral"!==this.getPriority().toLowerCase()},getPriority:function(){return this._currentItemAttrs.priority},getCurrentItemId:function(){return this._currentItemId},getCurrentVariationId:function(){return this._currentVariationId},setPriority:function(e){this._currentItemAttrs.priority=e,this._updateHeaderActions()},setDataBindingContext:function(e){this._currentItemAttrs.dataBindingContext=e.dataBindingContext},setAudienceName:function(e,t){e=f.getAudienceTargetInfoForComponent(e,t),t=e&&!e.get("hasCmpAttributeVariation")?e.get("audienceName"):null;this._currentItemAttrs.audienceName=t,this._updateHeaderActions()},_updateHeaderActions:function(){this.$el.removeClass("cb-ComponentPropertyPanel_dropdownEnabled");var e,t=this.$(".js-propertyeditor-edit-audience-container").empty(),n=this.$(".js-propertyeditor-edit-priority-container").empty(),i=this.$(".js-propertyeditor-dropdown-trigger-container").addClass("hidden");this._isAudienceAssigned()?(e=this._getAudienceDescription(),t.html(this._audienceDataTemplate({audienceDesc:e})),i.removeClass("hidden")):this._isProgressiveRenderingEnabled()&&this.isPriorityAssigned()?(t=this._getPriorityDescription(),n.html(this._priorityDataTemplate({priorityDesc:t})),i.removeClass("hidden")):this._isDropdownEnabled()&&(this.$el.addClass("cb-ComponentPropertyPanel_dropdownEnabled"),i.removeClass("hidden"))},_updateFooterActions:function(){var e=this.$(".cb-ComponentPropertyPanel-footer"),t=this.$(".js-propertyeditor-hide-component-container").empty();e.addClass("hidden"),this._isMobileExperienceEnabled()&&(t.html(this._hideComponentDataTemplate()),e.removeClass("hidden"))},_renderScopedBrandingSetPicklist:function(e){var t,n=this.$(".js-settings-tab-header").empty();(t=e)&&t.hasOwnProperty("scopedBrandingSetId")&&((t=!!this._currentVariationId)?this._currentVariationAttrs.scopedBrandingSetId=e.scopedBrandingSetId:this._currentItemAttrs.scopedBrandingSetId=e.scopedBrandingSetId,this._brandingSetPicklist.update({componentId:t?this._currentVariationId:this._currentItemId,currentBrandingSetId:(t?this._currentVariationAttrs:this._currentItemAttrs).scopedBrandingSetId}),n.html(this._brandingSetPicklist.$el))},_renderBrandingDeepLink:function(){var e,t=this._getBrandingDeepLink(),n=this.$(".js-settings-tab-footer").empty();t&&(e=N.getClosestBrandingSetId(this._currentVariationId||this._currentItemId),n.html(this._brandingDeepLinkTemplate(m(m({},t),{},{brandingSetId:e}))))},_getBrandingDeepLink:function(){return N.getBrandingEditorDeepLink((this._currentVariationId?this._currentVariationAttrs:this._currentItemAttrs).fqn)},_isDropdownEnabled:function(){return this._currentItemAttrs.allowDelete},_isAudienceAssigned:function(){return!!this._currentItemAttrs.audienceName},_isProgressiveRenderingEnabled:function(){return E.getSite().isProgressiveRenderingEnabled()},_isMobileExperienceEnabled:function(){return Vn.isMobileExperienceEnabled()&&!this.isInThemeRegion()&&I.getAppState().isMobileFormFactor()},_blurInput:function(e){var t=document.activeElement,n=p(t).closest(".visualEditorPropertyEditorItem"),i=n.find("label"),n=n&&0<n.find(e.target).length,i=0<i.find(e.target).length||i[0]===e.target;!t||this._isActiveElInLwcPropertySheet(t)||n&&!i||this._dropdown.$el.find(t).length||0<p(t).closest(".js-settings-tab-header").length||t.blur()},_isActiveElInLwcPropertySheet:function(e){var t=this.$("siteforcebuilder-community-builder-property-sheet-ui-container");return 1===t.length&&t[0].contains(e)},_isVisible:function(){return!this.$el.hasClass("closed")&&!this.$el.hasClass("hidden")},_updateContent:function(){var e,t,n,i,s=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this._propertyPanelId&&this._currentItemId&&(s?(this.$(".js-propertyeditor-header-title").html(this._variationName),this.$(".js-propertyeditor-variation-back").removeClass("invisible"),this.$(".js-propertyeditor-dropdown-trigger-container").removeClass("hidden"),this._dropdown&&this._dropdown.remove(),this._dropdown=new Wo({config:ab,customClass:"test-property-editor-variation-dropdown"})):(this.$(".js-propertyeditor-header-title").html(this._currentItemAttrs.label),this.$(".js-propertyeditor-variation-back").addClass("invisible"),this._dropdown&&this._dropdown.remove(),this._dropdown=new Wo({config:E.getSite().isWebApp()?sb:Qv,customClass:"test-property-editor-dropdown"})),e=f.getPageComponents().get(s?this._currentVariationId:this._currentItemId),n=this.isInThemeRegion(),i=(i=S.getThemeLayoutByViewId(I.getAppState().getCurrentViewId()))&&i.themeLayoutId,t={itemId:s?this._currentVariationId:this._currentItemId,label:s?null==e?void 0:e.get("properties").variationName:null==e?void 0:e.get("properties").label,propertyPanelId:this._propertyPanelId,themeLayoutId:i,isInThemeRegion:n,fqn:(e&&e.isUsingDeclarativeTypes()?e.get("properties"):this._currentItemAttrs).fqn,dataBindingContext:this._currentItemAttrs.dataBindingContext,isUsingDeclarativeTypes:e&&e.isUsingDeclarativeTypes(),isVariation:s,baseComponentId:this._currentItemId},E.getSite().isWebApp()&&(t.componentStylePropertiesDefinition=f.getStylePropertiesDefinition(),(i=e&&e.get("properties").componentStyleProperties)&&(t.componentStyleProperties=JSON.parse(i)),(n=e&&e.get("properties").componentCustomCssClasses)&&(t.componentCustomCssClasses=n),i=null==(s=this._currentItemAttrs)||null==(s=s.fqn)?void 0:s.replace("/",":"),N.getBrandingPropertyInfoForComponentAttributes(this._currentItemId,i,function(e){e&&(t.componentBrandingPropertyInfos=e)})),$P.auraRun(function(){var e=$A.getEvt("markup://siteforceBuilder:communityBuilderSelectComponent");e&&e.setParams(t).fire()}))},_getAudienceDescription:function(){var e=_.escape(this._currentItemAttrs.audienceName);return L.format(hb.VisibleOnlyTo,'<a href="javascript:void(0);" class="js-propertyeditor-open-audience-selector" title="'+e+'">'+e+"</a>")},_onEditAudience:function(e){this.manageAudience(this._currentItemId)},manageAudience:function(e){var t=I.getAppState().getCurrentViewId(),n=f.getAudienceTargetInfoForComponent(t,e),n=n&&n.get("audienceId");this.isPriorityAssigned()?A.sldsAlert(hb.BlockAssignAudienceContent,hb.BlockAssignAudienceHeading,{className:"slds-vex-theme slds-vex-theme--medium",yesText:PicassoWebServices.Labels.PicassoDialog.GotIt}):Ki.openAudienceSelectorForComponent(t,e,n,function(){I.event.trigger("action:sync-content-area-component-audience",{viewId:t,componentId:e})})},unassignAudience:function(e){var t=I.getAppState().getCurrentPageId(),n=I.getAppState().getCurrentViewId(),i=f.getAudienceTargetInfoForComponent(n,e).get("audienceTargetInfoID");I.event.trigger("action:unassign-content-area-component-audience",{viewId:n,entityId:i,spaPageId:t,componentId:e})},_getPriorityDescription:function(){var e=_.escape(this.getPriority()),e=PicassoWebServices.Labels.CommBuilderPriorityPicker[e];return L.format(hb.DisplayPriority,'<a href="javascript:void(0);" class="js-propertyeditor-open-priority-selector" title="'+e+'">'+e+"</a>")},_onEditPriority:function(){this.managePriority(this._currentItemId,this.getPriority())},_onHideComponentInMobile:function(){var e=this._currentItemId;I.event.trigger("action:update-aura-component-visibility",{itemId:e,isVisible:!1})},managePriority:function(t,e){var n=I.getAppState().getCurrentViewId(),n=f.getAudienceTargetInfoForComponent(n,t);n&&!n.get("hasCmpAttributeVariation")?A.sldsAlert(hb.BlockAssignPriorityContent,hb.BlockAssignPriorityHeading,{className:"slds-vex-theme slds-vex-theme--medium",yesText:PicassoWebServices.Labels.PicassoDialog.GotIt}):Kd.openPrioritySelectorForComponent(e,function(e){I.event.trigger("action:update-aura-component",{itemId:t,values:{RenderPriority:e}})})},unassignPriority:function(e){I.event.trigger("action:update-aura-component",{itemId:e,values:{RenderPriority:"NEUTRAL"}})},_setFocus:function(e){var e=p(e);0<e.length&&null!=(e=e[0])&&e.focus()},_onDropdownTrigger:function(e){e=p(e.currentTarget);this._currentVariationId?this._dropdown.onToggle(e,this._currentVariationId,this):this._dropdown.onToggle(e,this._currentItemId,this)},_onVariationDropdownTrigger:function(t){var n,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],s=3<arguments.length?arguments[3]:void 0;this._variationDropdown&&i&&this._variationDropdown.close(),i&&e?(n=p(t.target),this._buildVariationDropdown(e,t,n,i,s)):(n=p(i?t.target:t.currentTarget),e=ub.getCmpVariationsByPriorityPromise(this._currentItemId),p.when(e).then(function(e){this._buildVariationDropdown(e,t,n,i,s)}.bind(this)))},_buildVariationDropdown:function(e,t,n,i,s){var a=this,e=e||[],o=[],r=[],t=(e.forEach(function(e){return(e.hasRule?o:r).push(e)}),{config:[{label:mb.Variations,items:[].concat(Q(o.map(function(e,t){return{locator:"js-propertyeditor-variation",key:e.variationId,id:e.variationId,isDraggable:1<o.length?P.DROPDOWN_DRAG_AT_ITEM.DRAG_ALLOWED:P.DROPDOWN_DRAG_AT_ITEM.DRAG_UNDEFINED,subText:"".concat(mb.Priority)+(t+1),label:e.variationName,showToolTip:!0,action:function(e,t){j.getAppEvent().trigger("variation-component-selected",e,t)}}})),[{locator:"js-propertyeditor-variation",key:this._currentItemId,id:this._currentItemId,showToolTip:!0,isDraggable:1<o.length?P.DROPDOWN_DRAG_AT_ITEM.DRAG_DISALLOWED:P.DROPDOWN_DRAG_AT_ITEM.DRAG_UNDEFINED,label:"".concat(this._currentItemAttrs.label," ").concat(mb.BaseComponent),action:function(){j.getAppEvent().trigger("base-component-selected")}}])},{label:mb.VariationsWithoutRuleHeading,isHidden:0==r.length,addSeparator:!0,items:Q(r.map(function(e,t){return{locator:"js-propertyeditor-variation",key:e.variationId,id:e.variationId,label:e.variationName,showToolTip:!0,action:function(e,t){j.getAppEvent().trigger("variation-component-selected",e,t)}}}))},{addSeparator:!0,items:[{locator:"js-propertyeditor-create-variation",key:"Add Variation",label:mb.NewComponentVariation,closeMenuOnClick:!1,icon:{sprite:"utility",name:"add"},action:function(e){j.getAppEvent().trigger("open-create-variation-popover",e,".js-propertyeditor-create-variation",!0)}}]}],allowedSelectorOutsideDropdown:".js-create-variation-modal",isDragAllowed:1<e.length,parentEvent:t,sortableClass:1<e.length?"js-propertyeditor-sortableVariations":void 0,onDragAction:1<e.length?"action:reorder-variation-priority":void 0}),l=(this._variationDropdown=new Wo(t),{focusItemId:this._currentVariationId,fromReorder:i,itemId:s});0<e.length?setTimeout(function(){a._variationDropdown.onToggle(n,a._currentItemId,a,l)},0):j.getAppEvent().trigger("open-create-variation-popover",this._currentItemId,".js-propertyeditor-variation-dropdown-container")},_createVariationModal:function(e,t){e=new rb(e,t,this._variationName);return t&&(e.$el.find(".js-modal-add-item").attr("disabled",!0),e.$(".cb-variation-modal-title").html(mb.EditVariationName),e.$("#variation-name-input").val(this._variationName)),this.listenToOnce(e,"closeCreateVariationModal",function(){this._popover&&this._popover.destroy()}.bind(this)),e},handleCloseCreateVariationPopover:function(e){this._popover&&(this._popover.destroy(),e?this._setFocus(fb):this._setFocus(_b)),this._variationDropdown&&this._variationDropdown.close()},handleShowCreateVariationPopover:function(e,t,n,i){this._popover?this._popover.destroy():this._showPopoverMenu(e,t,n,i)},_showPopoverMenu:function(e,t,n,i){var s,e=this._createVariationModal(e,i);p.each(p(t),function(){"none"!==p(p(this)).parent().parent().css("display")&&(s=p(this))}),this._popover=Zr(n&&!i?{view:e.$el[0],trigger:p(s)[0],options:{className:"js-create-variation-modal",nubbinPosition:"left",offsetTriggerHeight:!1,horizontalOffset:20,trapFocus:!0,destroyCallback:function(){this._popover=null}.bind(this)}}:{view:e.$el[0],trigger:p(s)[0],options:{className:"js-create-variation-modal",nubbinPosition:"top",offsetTriggerWidth:!1,verticalOffset:15,trapFocus:!0,destroyCallback:function(){this._popover=null}.bind(this)}}),this._popover.show()},_onBrandDeepLink:function(e){var e=p(e.currentTarget),t=e.data("field"),n=e.data("brand"),i=l.getBrandingSet(n).type,e={tab:e.data("tab"),section:e.data("section"),category:e.data("category")};this._openThemeEditorPanel(n,i,t,e)},_openThemeEditorPanel:function(e,t,n,i){function s(){o.trigger("theme-editor-action:show-detail",t,n,i),o.trigger("open-app-nav",P.LEFT_PANEL.THEME_EDITOR)}e!==I.getAppState().getCurrentPreviewSiteBrandingSetId()?I.event.trigger("action:set-preview-scoped-branding-set",{id:e,successCallback:s}):I.event.trigger("action:set-preview-scoped-branding-set",{id:null,successCallback:s})}}),fr=PicassoWebServices.Labels.VideoPickerDialog,yb=/^(?:.*)(?:youtube\.com\/(?:watch\?v=|watch\?.*&v=|v\/|embed\/)|youtu\.be\/)(.{11,})$/im,Tb=/^(?:.*)(?:player.)?(?:vimeo.com\/)(?:video\/)?(.{1,})$/im,Pb=Backbone.View.extend({tagName:"div",className:"cb-VideoPicker",template:_.template('<div class="slds-modal__container cb-VideoPicker-container"><div class="slds-modal__header"><h2 class="slds-text-heading_medium">'+fr.AddVideo+'</h2><h3 class="cb-VideoPicker-subtitle">'+fr.AddVideoSubtitle+'</h3></div><div class="slds-modal__content slds-p-around--medium"><div class="cb-VideoPicker-body"><p class="cb-VideoPicker-input-title">'+fr.VideoType+'</p><div class="js-input-wrapper cb-VideoPicker-input-wrapper slds-form-element"><div class="slds-form-element__control"><input placeholder="'+fr.InputPlaceholder+'" class="cb-VideoPicker-input js-input slds-input" type="text" aria-describedby="cb-VideoPicker-error-message"/></div><div class="js-video-error-message cb-VideoPicker-error-message slds-form-element__help">'+fr.VideoError1+'</div></div><div class="cb-VideoPicker-preview js-video-preview"><div class="cb-VideoPicker-preview-text">'+fr.VideoPreview+'</div></div><iframe class="cb-VideoPicker-video js-video" frameborder="0" allowfullscreen></iframe></div></div><div class="slds-modal__footer"><button class="js-ok cb-VideoPicker-ok slds-button slds-button_neutral slds-button_brand slds-float_right" disabled>'+fr.OK+'</button><button class="js-cancel cb-VideoPicker-cancel slds-button slds-button_neutral slds-float_right">'+fr.Cancel+"</button></div></div>"),_iframeTemplate:_.template('<div class="sfdcCbVideoContainer"><iframe class="sfdcCbVideo" width="100%" src="{{=src}}" frameborder="0" allowfullscreen="true" title="{{=title}}"></iframe></div>'),events:{"input .js-input":"_renderVideoPreview","click .js-ok":"_processVideoLink","click .js-cancel":"_cancelVideoPicker",keydown:"_handleEnterSubmit"},initialize:function(e){this.options=e||{},"function"==typeof e.uploadSuccessCallback&&(this.uploadSuccessCallback=e.uploadSuccessCallback),"function"==typeof e.uploadCancelCallback&&(this.uploadCancelCallback=e.uploadCancelCallback),e.videoUrl&&(this.videoUrl=e.videoUrl),e.createMarkup&&(this.createMarkup=e.createMarkup)},render:function(){return this.$el.append(this.template()),_.defer(function(){T(".js-input").focus()}),this.videoUrl&&(this.$(".js-input").val(this.videoUrl),this._renderVideoPreview()),this},_handleEnterSubmit:function(e){e.keyCode===P.KEYCODE.ENTER&&this._processVideoLink()},_cancelVideoPicker:function(e){this.uploadCancelCallback&&this.uploadCancelCallback()},close:function(){this.uploadCancelCallback&&this.uploadCancelCallback(),this.remove()},destroy:function(){this.uploadCancelCallback&&this.uploadCancelCallback()},_renderVideoPreview:_.debounce(function(e){var t=this.$(".js-input").val().trim();if(!t)return this.$(".js-ok").prop("disabled",!0),this.$(".js-input-wrapper").removeClass("slds-has-error"),this.$(".js-video-error-message").slideUp(),null;(t=this._parseVideoLink(t))?(this.$(".js-ok").prop("disabled",!1),this.$(".js-video").attr("src",t).show(),this.$(".js-video-preview").hide(),this.$(".js-input-wrapper").removeClass("slds-has-error"),this.$(".js-video-error-message").slideUp()):(this.$(".js-ok").prop("disabled",!0),this.$(".js-video").hide(),this.$(".js-video-preview").show(),this.$(".js-input-wrapper").addClass("slds-has-error"),this.$(".js-video-error-message").slideDown())},500),_processVideoLink:function(){var e=this.$(".js-input").val().trim();(e=this._parseVideoLink(e))&&(e=this.createMarkup?this._composeVideoFrame(e):e,this.uploadSuccessCallback(e))},_composeVideoFrame:function(e){return this._iframeTemplate({src:e,title:PicassoWebServices.Labels.CommBuilderRichTextEditor.VideoElementTitle.replace("{0}",e)})},_parseVideoLink:function(e){var t=yb.exec(e),n=Tb.exec(e);return e=t?"https://www.youtube.com/embed/"+t[1]:n?"https://player.vimeo.com/video/"+n[1]:null,e=_.escape(e)}}),Ib=PicassoWebServices.Labels.LinkPickerDialog,Eb=Backbone.View.extend({tagName:"div",className:"cb-LinkPicker",template:_.template('<div class="slds-modal__container cb-LinkPicker-container">\n            <div class="slds-modal__header">\n                <h2 class="slds-text-heading_medium">'.concat(Ib.Title,'</h2>\n            </div>\n            <div class="slds-modal__content slds-p-around--medium">\n                <div class="cb-LinkPicker-body">\n                    <div class="slds-form-element js-input-form">\n                        <label class="slds-form-element__label js-input-label" for="js-link-picker-url-input">').concat(Ib.URL,'</label>\n                        <div class="slds-form-element__control">\n                            <input id="js-link-picker-url-input" class="js-input slds-input" type="text" placeholder="').concat(Ib.Placeholder,'" aria-describedby="js-link-picker-url-error"/>\n                        </div>\n                        <div id="js-link-picker-url-error" class="slds-form-element__help js-input-error"></div>\n                    </div>\n                    <div class="slds-form-element slds-m-top--small">\n                        <div class="slds-form-element__control">\n                            <div class="slds-checkbox">\n                                <input type="checkbox" id="js-link-picker-open-new-checkbox" class="js-open-new-checkbox"/>\n                                <label class="slds-checkbox__label" for="js-link-picker-open-new-checkbox">\n                                    <span class="slds-checkbox_faux js-target-checkbox-span"></span>\n                                    <span class="slds-form-element__label">').concat(Ib.OpenInNewWindow,'</span>\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="slds-modal__footer">\n                <button class="js-ok cb-LinkPicker-ok slds-button slds-button_neutral slds-button_brand slds-float_right">').concat(Ib.OK,'</button>\n                <button class="js-cancel cb-LinkPicker-cancel slds-button slds-button_neutral slds-float_right">').concat(Ib.Cancel,"</button>\n            </div>\n        </div>").trim()),events:{"click .js-ok":"_ok","click .js-cancel":"_cancel","keyup .js-input":"_validateInput",keydown:"_handleEnterSubmit"},initialize:function(e){this.options=e||{},"function"==typeof e.uploadSuccessCallback&&(this.uploadSuccessCallback=e.uploadSuccessCallback),"function"==typeof e.uploadCancelCallback&&(this.uploadCancelCallback=e.uploadCancelCallback),e.url&&(this.url=e.url),e.target&&(this.target=e.target)},render:function(){return this.$el.append(this.template()),_.defer(function(){T(".js-input").focus()}),this.url&&this.$(".js-input").val(this.url),this.$(".js-open-new-checkbox").prop("checked","_blank"===this.target),this},destroy:function(){this._cancel()},_handleEnterSubmit:function(e){e.keyCode===P.KEYCODE.ENTER&&this._processLink()},_validateUrl:function(e){var t,n;try{t=new URL(e,document.baseURI)}catch(e){t=null}return t?(t=new URL(document.baseURI).origin===t.origin,n=new RegExp("^(https|mailto):","i"),t||n.test(e)?void 0:Ib.URLProtocolError):Ib.URLInvalidError},_validateInput:function(){var e,t=this.$(".js-input").val().trim();return k.isLwrBasedTemplate()?(e=this._validateUrl(t))?(this.$(".js-input-form").addClass("slds-has-error"),this.$(".js-input").attr("aria-invalid",!0),this.$(".js-input-error").text(e),null):(this.$(".js-input-form").removeClass("slds-has-error"),this.$(".js-input").removeAttr("aria-invalid"),this.$(".js-input-error").empty(),t):t},_processLink:function(){var e,t=this._validateInput();null!==t&&(e=this.$(".js-open-new-checkbox").is(":checked")?"_blank":"_self",this.uploadSuccessCallback(t,e,0===t.length))},_ok:function(){this._processLink()},_cancel:function(){this.uploadCancelCallback&&this.uploadCancelCallback(),this.remove()}}),wb=PicassoWebServices.Labels.RTESourceEditorDialog,Lb=Backbone.View.extend({className:"cb-RichTextSourceEditor",template:_.template('<div class="slds-text-heading_large">{{=labelTitle}}</div><div class="cb-RichTextSourceEditor-codeMirrorWrapper js-source-mode-container"><textarea class="cb-RichTextSourceEditor-codeMirror js-codeMirror">{{=content}}</textarea></div><div class="cb-RichTextSourceEditor-footer"><button class="slds-button slds-button_neutral js-cancel">{{=labelCancel}}</button><button class="slds-button slds-button_brand js-save">{{=labelSave}}</button></div>'),events:{"click .js-cancel":"_cancel","click .js-save":"_save"},_rteInfo:null,_rteContent:"",_editor:null,_onSaveCallback:function(){},_onCancelCallback:function(){},initialize:function(e){this._onSaveCallback=e.onSaveCallback,this._onCancelCallback=e.onCancelCallback,this._rteInfo=e.data.rteInfo;e=this._getRteStoreParams(this._rteInfo.content,!1,_.bind(function(e){e.saved&&(this._rteContent=e[this._rteInfo.guid],this.render())},this));I.event.trigger("action:save-rte-content",e)},render:function(){return this.$el.html(this.template({content:this._rteContent,labelTitle:wb.SourceEditor,labelCancel:wb.Cancel,labelSave:wb.Save})),this._editor=CodeMirror.fromTextArea(this.$(".js-codeMirror")[0],{mode:"text/html",lineNumbers:!0,textWrapping:!0,indentUnit:4,highlightSelectionMatches:!0,autoCloseBrackets:!0,matchBrackets:!0}),this},destroy:function(){this._onCancelCallback()},_getRteStoreParams:function(e,t,n){return{itemId:this._rteInfo.guid,editorContent:e,decodeContentAsset:t,successCallback:n}},_save:function(){this.$(".js-save").prop("disabled",!0);var e=this._getRteStoreParams(this._editor.getValue(),!0,_.bind(function(e){return e.saved&&this._onSaveCallback(e[this._rteInfo.guid]),A.closeDialog()},this));I.event.trigger("action:save-rte-content",e)},_cancel:function(){return this._onCancelCallback(),A.closeDialog()}}),ot=PicassoWebServices.Labels.CommBuilderRichTextMigration,Db="forceCommunity:richTextInline",Ab=".js-richText",kb=".js-html";function Nb(){return I.getAppState().getNetworkId()+"_cb_rich_text_migration_confirmed"}var xb=Backbone.View.extend({className:"cb-ConfirmMigration",template:_.template('<h1 class="cb-ConfirmMigration-header slds-text-heading_large" title="'+ot.ConfirmTitle+'">'+ot.ConfirmTitle+'</h1><div class="cb-ConfirmMigration-content"><div class="cb-ConfirmMigration-contentText">'+ot.ConfirmContent+'</div><div class="slds-form-element cb-ConfirmMigration-checkbox"><div class="slds-form-element__control"><label class="slds-checkbox"><input type="checkbox" name="options" class="js-checkbox" /><span class="slds-checkbox_faux"></span><span class="slds-form-element__label">'+ot.Checkbox+'</span></label></div></div></div><div class="cb-ConfirmMigration-footer"><input type="button" class="slds-button slds-button_neutral js-cancel" value="'+ot.Cancel+'"/><input type="button" class="slds-button slds-button_brand js-save" value="'+ot.OK+'"/></div>'),events:{"click .js-cancel":"_onCancel","click .js-save":"_onSave"},initialize:function(e){this.options=e||{},"function"==typeof e.saveCallback&&(this._saveCallback=e.saveCallback)},render:function(){return this.$el.html(this.template()),this},_onCancel:function(){A.closeDialog()},_onSave:function(e){A.closeDialog(),this._saveCallback(this.$(".js-checkbox").is(":checked"))}}),Rb=Backbone.View.extend({className:"cb-RichTextPicker",template:_.template('<div class="cb-RichTextPicker-header"><div class="slds-text-heading_large cb-RichTextPicker-title" title="'+ot.Title+'">'+ot.Title+'</div><div class="cb-RichTextPicker-description">'+ot.Description+'</div></div><div class="cb-RichTextPicker-content"><div class="cb-RichTextPicker-choice js-richText"><h1 class="cb-RichTextPicker-choiceTitle slds-text-heading_medium" title="'+ot.RichContentEditor+'">'+ot.RichContentEditor+'</h1><span class="cb-RichTextPicker-choiceDesc">'+ot.RichContentEditorDesc+'</span><div class="cb-RichTextPicker-choiceIcon"><svg aria-hidden="true" class="slds-icon cb-RichTextPicker-choiceIconSvg"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#edit_form"></use></svg></div></div><div class="cb-RichTextPicker-choice js-html"><h1 class="cb-RichTextPicker-choiceTitle slds-text-heading_medium" title="'+ot.HTMLEditor+'">'+ot.HTMLEditor+'</h1><span class="cb-RichTextPicker-choiceDesc">'+ot.HTMLEditorDesc+'</span><div class="cb-RichTextPicker-choiceIcon"><svg aria-hidden="true" class="slds-icon cb-RichTextPicker-choiceIconSvg"><use xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#insert_tag_field"></use></svg></div></div></div>'),initialize:function(e){this._itemId=e.itemId},render:function(){return this.$el.html(this.template()),this._addClickHandlers(),this},destroy:function(){this._removeClickHandlers()},_addClickHandlers:function(){setTimeout(function(){this.$(Ab).on("click",this._selectRichText.bind(this)),this.$(kb).on("click",this._selectHTML.bind(this))}.bind(this),500)},_removeClickHandlers:function(){this.$(Ab).off("click",this._selectRichText.bind(this)),this.$(kb).off("click",this._selectHTML.bind(this))},_selectRichText:function(){this._migrate(Db)},_selectHTML:function(){this._migrate("forceCommunity:htmlBlock")},_migrate:function(t){T.cookie(Nb())?this._cloneAndCloseDlg(t):A.showDialog(new xb({saveCallback:function(e){this._setCookie(e),this._cloneAndCloseDlg(t)}.bind(this)}),{className:"slds-vex-theme cb-ConfirmMigration"})},_setCookie:function(e){e&&T.cookie(Nb(),!0)},_cloneAndCloseDlg:function(e){var t={openRichTextInlineEditor:Db===e};j.getAppEvent().trigger("clone-canvas-item",this._itemId,e,t),A.closeDialog()}}),jb=PicassoWebServices.Labels.RTEImagePropertiesDialog,Bb=Backbone.View.extend({tagName:"div",className:"cb-ImageProperties",template:_.template('<div class="slds-modal__container cb-ImageProperties-container">\n            <div class="slds-modal__header">\n                <h2 class="slds-text-heading_medium">'.concat(jb.Title,'</h2>\n            </div>\n            <div class="slds-modal__content slds-p-around_medium">\n                <div class="cb-ImageProperties-body">\n                    <div class="slds-form-element js-input-form">\n                        <label class="slds-form-element__label js-input-label" for="js-image-properties-alt-input">').concat(jb.AltTextLabel,'</label>\n                        <div class="slds-form-element__control">\n                            <input id="js-image-properties-alt-input" class="js-input slds-input" type="text" placeholder="').concat(jb.AltTextPlaceholder,'" aria-describedby="js-image-properties-alt-error"/>\n                        </div>\n                        <div id="js-image-properties-alt-error" class="slds-form-element__help js-input-error"></div>\n                    </div>\n                </div>\n            </div>\n            <div class="slds-modal__footer">\n                <button class="js-add cb-ImageProperties-add slds-button slds-button_brand slds-float_right">').concat(jb.Add,'</button>\n                <button class="js-cancel cb-ImageProperties-cancel slds-button slds-button_neutral slds-float_right">').concat(jb.Cancel,"</button>\n            </div>\n        </div>").trim()),events:{"click .js-add":"_add","click .js-cancel":"_cancel","keyup .js-input":"_validateInput",keydown:"_handleEnterSubmit"},initialize:function(e){this.options=e||{},"function"==typeof e.onSaveCallback&&(this.onSaveCallback=e.onSaveCallback),"function"==typeof e.onCancelCallback&&(this.onCancelCallback=e.onCancelCallback),e.alt&&(this.alt=e.alt)},render:function(){return this.$el.append(this.template()),_.defer(function(){T(".js-input").focus()}),this.alt&&this.$(".js-input").val(this.alt),this},destroy:function(){this._cancel()},_handleEnterSubmit:function(e){e.keyCode===P.KEYCODE.ENTER&&this._processInput()},_validateAlt:function(e){return e.length<=2e3},_validateInput:function(){var e=this.$(".js-input").val().trim();return this._validateAlt(e)?(this.$(".js-input-form").removeClass("slds-has-error"),this.$(".js-input").removeAttr("aria-invalid"),this.$(".js-input-error").empty(),!0):(this.$(".js-input-form").addClass("slds-has-error"),this.$(".js-input").attr("aria-invalid",!0),this.$(".js-input-error").text(L.format(jb.AltTextError,2e3)),!1)},_processInput:function(){var e;this._validateInput()&&(e=this.$(".js-input").val().trim(),this.onSaveCallback(e))},_add:function(){this._processInput()},_cancel:function(){this.onCancelCallback&&this.onCancelCallback(),this.remove()}});function Ob(t,e){var n=null;return e.forEach(function(e){e.panelId!==t.panelId&&e.isDocked()&&(n=e)}),n}function Mb(t,e){var n=[];return e.forEach(function(e){e.panelId!==t.panelId&&e.isVisible()&&!e.isDocked()&&n.push(e)}),n}function Vb(e,t){e=e.$el[0].getBoundingClientRect(),t=t.$el[0].getBoundingClientRect();return!(e.right<t.left||e.left>t.right||e.bottom<t.top||e.top>t.bottom)}var $b=function(){function n(e,t){d(this,n),u(this,"currentPanel",void 0),u(this,"allPanels",void 0),this.currentPanel=e,this.allPanels=t}return a(n,[{key:"position",value:function(){var n=this;Mb(this.currentPanel,this.allPanels).forEach(function(e){var t;Vb(e,n.currentPanel)&&(t=n.currentPanel.$el.offset().left-e.$el.outerWidth(!0),e.position({left:t})),e.updateDraggableContainment()})}}]),n}(),Ub=function(){function n(e,t){d(this,n),u(this,"currentPanel",void 0),u(this,"allPanels",void 0),this.currentPanel=e,this.allPanels=t}return a(n,[{key:"position",value:function(){var n,i=this,e=Mb(this.currentPanel,this.allPanels);0<e.length&&(n=T("#pagesLiveWorkareaPanel").outerWidth()-this.currentPanel.$el.outerWidth(!0),this.currentPanel.position({left:n}),e.forEach(function(e){var t;Vb(e,i.currentPanel)?(t=i.currentPanel.$el.offset().left-e.$el.outerWidth(!0),e.position({left:t}),e.updateDraggableContainment()):null!=(t=e.isMinimized)&&t.call(e)&&e.position({left:n})})),this.currentPanel.updateDraggableContainment(),this.currentPanel.ensurePanelVisible()}}]),n}(),Wb=function(){function n(e,t){d(this,n),u(this,"currentPanel",void 0),u(this,"allPanels",void 0),this.currentPanel=e,this.allPanels=t}return a(n,[{key:"position",value:function(){var e,n=this,t=Mb(this.currentPanel,this.allPanels),i=Ob(this.currentPanel,this.allPanels);!i&&this.currentPanel.isDocked()?t.forEach(function(e){var t;Vb(e,n.currentPanel)&&(t=n.currentPanel.$el.offset().left-e.$el.outerWidth(!0),e.position({left:t}),e.updateDraggableContainment())}):(e=T("#pagesLiveWorkareaPanel").outerWidth(),i&&i.isVisible()&&Vb(this.currentPanel,i)?(i=e-this.currentPanel.$el.outerWidth(!0),this.currentPanel.position({left:i})):t.forEach(function(e){Vb(e,n.currentPanel)&&(e=e.$el.offset().left-n.currentPanel.$el.outerWidth(!0),n.currentPanel.position({left:e}))}),this.currentPanel.updateDraggableContainment())}}]),n}(),Fb=function(){function n(e,t){d(this,n),u(this,"currentPanel",void 0),u(this,"allPanels",void 0),this.currentPanel=e,this.allPanels=t}return a(n,[{key:"position",value:function(){Mb(this.currentPanel,this.allPanels);var e=T("#pagesLiveWorkareaPanel").outerWidth(),t=this.currentPanel.$el.outerWidth(!0),n=T("#dockingPanelContainer"),n=0<n.length?n.offset().left-t:e-t;this.currentPanel.position({left:n})}}]),n}(),Hb={OPEN:"OPEN",DOCK:"DOCK",UNDOCK:"UNDOCK",MINIMIZE:"MINIMIZE",MAXIMIZE:"MAXIMIZE"},Gb=new WeakMap,zb=new WeakSet,Kb=new WeakSet,Km=function(){function t(){d(this,t),he(this,Kb),he(this,zb),ge(this,Gb,{writable:!0,value:new Map})}return a(t,[{key:"createPanel",value:function(e){e=new e(this,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{draggable:!0,dockable:!0});return oe(this,Gb).set(e.panelId,e),e}},{key:"handleDragStart",value:function(e){e=ue(this,zb,Yb).call(this,e);Mb(e,oe(this,Gb)).forEach(function(e){e.$el.css("z-index",ce(t,t,Xb))}),e.$el.css("z-index",ce(t,t,Jb))}},{key:"handleDock",value:function(e){var e=ue(this,zb,Yb).call(this,e),t=Ob(e,oe(this,Gb));t&&(t.toggleDock(),j.getAppEvent().trigger("dock-floating-panel"),t.updateDraggableContainment()),ue(this,Kb,qb).call(this,e,Hb.DOCK).position()}},{key:"handleUndock",value:function(e){e=ue(this,zb,Yb).call(this,e);Mb(e,oe(this,Gb)).forEach(function(e){e.updateDraggableContainment()}),ue(this,Kb,qb).call(this,e,Hb.UNDOCK).position()}},{key:"handleOpen",value:function(e){ue(this,Kb,qb).call(this,ue(this,zb,Yb).call(this,e),Hb.OPEN).position()}},{key:"handleMinimize",value:function(e){ue(this,Kb,qb).call(this,ue(this,zb,Yb).call(this,e),Hb.MINIMIZE).position()}},{key:"handleMaximize",value:function(e){ue(this,Kb,qb).call(this,ue(this,zb,Yb).call(this,e),Hb.MAXIMIZE).position()}},{key:"handleClose",value:function(e){e=ue(this,zb,Yb).call(this,e);e&&e.isDocked()&&Mb(e,oe(this,Gb)).forEach(function(e){return e.updateDraggableContainment()})}}]),t}();function Yb(e){return oe(this,Gb).get(e)}function qb(e,t){switch(t){case Hb.OPEN:return new Wb(e,oe(this,Gb));case Hb.DOCK:return new $b(e,oe(this,Gb));case Hb.UNDOCK:return new Ub(e,oe(this,Gb));case Hb.MINIMIZE:return new Fb(e,oe(this,Gb));default:return new Wb(e,oe(this,Gb))}}var Xb={writable:!0,value:1},Jb={writable:!0,value:2},Qb=new Km,i=function(){function t(e){d(this,t),this.superclass=e}return a(t,[{key:"with",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return t(e)},this.superclass)}}]),t}(),Zb=PicassoWebServices.Labels.CommBuilderCopilotPanel,ef=".cb-CopilotPanel-body",Ym=gb.extend({tagName:"div",className:"cb-CopilotPanel hidden closed js-copilotpanel",panelId:P.FLOATING_PANEL.COPILOT_PANEL,events:{"click .js-copilotpanel-dock":"toggleDock","click .js-copilotpanel-close":"close"},DOCK_ICON_CONTAINER_SELECTOR:".js-copilotpanel-dock-icon-container",PANEL_BODY_SELECTOR:ef,PANEL_HEADER_SELECTOR:".cb-CopilotPanel-header",_template:function(){return'\n            <div class="cb-CopilotPanel-container">                \n                <div class="cb-CopilotPanel-header slds-border_bottom slds-p-horizontal_x-small">\n                    <span class="cb-CopilotPanel-header-action slds-media__figure slds-m-right--x-small slds-icon_container slds-current-color">\n                        '.concat(D.icon({icon:"einstein"}),'\n                    </span>\n                    <h2 class="slds-panel__header-title slds-text-heading_small slds-truncate" title="').concat(Zb.Title,'">').concat(Zb.Title,'</h2>\n                    <div class="slds-panel__header-actions">                           \n                        ').concat(this.getHeaderActionTemplates(),'\n                    </div>\n                </div>\n                <div class="cb-CopilotPanel-body"></div>\n            </div>').trim()},_dockIconTemplate:function(e){return D.buttonIcon({buttonClassName:"js-copilotpanel-dock",label:e?Zb.Undock:Zb.Dock,icon:e?"pinned":"pin"})},getHeaderActionTemplates:function(){return'\n            <div class="cb-CopilotPanel-dockIcon js-copilotpanel-dock-icon-container slds-p-around_xx-small"></div>\n            '.concat(D.buttonIcon({buttonClassName:"cb-CopilotPanel-closeButton js-copilotpanel-close slds-p-around_xx-small",svgClassName:"cb-CopilotPanel-closeIcon",label:Zb.Close,icon:"close"})).trim()},getLabels:function(){return Zb},render:function(){this.$el.html(this._template()),this.isDocked()?this._styleDockedPanel():this._styleUndockedPanel();var n=this.$(ef)[0];return $P.auraRun(function(){$A.createComponent("community_builder:copilotPanel",{},function(e,t){"SUCCESS"===t&&($A.render(e,n),$A.afterRender(e))})}),this}}),tf=new i(Ym).with(function(n){return n.extend({events:{"click .js-floatingpanel-minimize-icon-container":"toggleMinimize"},_isMinimized:!1,_iconContainerSelector:".js-floatingpanel-minimize-icon-container",_minimizeIconTemplate:function(e){var t=this.getLabels();return D.buttonIcon({buttonClassName:"cb-FloatingPanel-minimize",label:e?t.Maximize:t.Minimize,icon:e?"erect_window":"minimize_window"})},_minimizeIconContainerTemplate:'<div class="cb-FloatingPanel-minimizeIcon js-floatingpanel-minimize-icon-container slds-p-around_xx-small"></div>',initialize:function(){n.prototype.initialize.apply(this,arguments),this.events=_.extend({},n.prototype.events,this.events),this.delegateEvents()},getHeaderActionTemplates:function(){var e=n.prototype.getHeaderActionTemplates.apply(this,arguments);return this._minimizeIconContainerTemplate+e},render:function(){return n.prototype.render.apply(this,arguments),this._updateMinimizeIcon(),this},open:function(){n.prototype.open.apply(this,arguments),this._isMinimized||this.$el.draggable("option","disabled",!1)},close:function(){n.prototype.close.apply(this,arguments),this._isMinimized&&this.reset()},toggleDock:function(){this.isDocked()||(this._isMinimized&&this.maximize(),this.$el.css({height:""}),this._updateMinimizeIcon()),n.prototype.toggleDock.apply(this,arguments)},onDragStop:function(){n.prototype.onDragStop.apply(this),this._saveCurrentRect()},setPanelPositionAndScroll:function(e){var t;this._isMinimized?(t={left:Math.max(0,Math.min(this.$el.position().left,$(window).width()-this.$el.outerWidth(!0)))+"px",bottom:"auto"},this.$el.css(t)):n.prototype.setPanelPositionAndScroll.apply(this,[e])},toggleMinimize:function(){this._isMinimized?this.maximize():this.minimize()},minimize:function(){this._isMinimized=!0,this.isDocked()?this.toggleDock():this._saveCurrentRect(),this.$(this.PANEL_BODY_SELECTOR).addClass("hidden");var e=this.$(this.PANEL_HEADER_SELECTOR).outerHeight(),e=$(window).height()-e-this.PANEL_MARGIN;this.$el.css({top:e}),this.$el.addClass("minimized"),this._updateMinimizeIcon(),this.$el.draggable("option","disabled",!0),this._panelManager.handleMinimize(this.panelId)},maximize:function(){this._isMinimized=!1,this.$(this.PANEL_BODY_SELECTOR).removeClass("hidden"),this.$el.removeClass("minimized"),this.$el.css(m(m({},this._panelRect),{},{margin:this.PANEL_MARGIN})),this._updateMinimizeIcon(),this.$el.draggable("option","disabled",!1),this.ensurePanelVisible(),this._panelManager.handleMaximize(this.panelId)},isMinimized:function(){return this._isMinimized},reset:function(){this._isMinimized=!1,this.$el.removeClass("minimized"),this.$(this.PANEL_BODY_SELECTOR).removeClass("hidden"),this.$el.css({bottom:"",left:"",top:"","min-height":"","max-height":""})},_updateMinimizeIcon:function(){this.$(this._iconContainerSelector).empty().html(this._minimizeIconTemplate(this._isMinimized))},_saveCurrentRect:function(){var e=this.$el[0].getBoundingClientRect(),t=getComputedStyle(this.$el[0]),n=this.$el.position();this._panelRect={height:e.height,top:n.top,left:n.left,"min-height":t.getPropertyValue("min-height"),"max-height":t.getPropertyValue("max-height")}}})}),nf=P.AUDIENCE_TARGET_NAME.COMPONENT,sf="picasso_dynamic_layout_tour",af=Object.freeze({CB_PROP_CHANGED:"cb-prop-changed"}),of=_.debounce(function(e,t,n,i,s){e.connection.send(af.CB_PROP_CHANGED,{id:t,props:n,containerId:i,hasPersonalizationOrVariations:s})},150);function rf(e){return $A.componentService.getAttributeProviderForElement(e)}var lf,cf,df,uf,pf=Backbone.View.extend({minWidth:320,maxWidth:2880,minHeight:320,maxHeight:2880,errorDialogTemplate:_.template('<div class="cb-Dialog-errorMessage js-dialog-error-message"><div class="picasso-vex-theme cb-DialogPrompt-message">{{=message}}</div><div class="picasso-vex-theme cb-DialogPrompt-errorId {{=hideErrorId ? "hidden" : ""}}">{{=errorId}}</div><div class="picasso-vex-theme cb-DialogPrompt-stacktrace">{{=stacktrace}}</div></div>'),initialize:function(e){var a=this;this.interactions=I.AccessControl(P.PERMISSIONS.PAGE_EDIT),this.pageId=I.getAppState().get("currentPageId"),this.propertyEditorPanel=Qb.createPanel(Cb),I.AccessControl(P.PERMISSIONS.EINSTEIN_COPILOT)&&(this.copilotPanel=Qb.createPanel(tf),this.copilotPanel.enable(),this.listenTo(j.getAppEvent(),"open-copilot-panel",function(e){a.copilotPanel.open()}),this.listenTo(j.getAppEvent(),"close-copilot-panel",function(e){a.copilotPanel.close()})),this.$iframe=p("#sitePreviewFrame"),this.$previewWorkarea=p("#sitePreviewWorkarea"),this.$loadingOverlay=p(".loadingOverlay"),this.$dropTarget=p("#liveDropTarget"),this.$frameScrollUpTarget=p(".dragFrameScrollUpTarget"),this.$frameScrollDownTarget=p(".dragFrameScrollDownTarget"),this.$frameScrollLeftTarget=p(".dragFrameScrollLeftTarget"),this.$frameScrollRightTarget=p(".dragFrameScrollRightTarget"),this.$workareaScrollUpTarget=p(".dragWorkareaScrollUpTarget"),this.$workareaScrollDownTarget=p(".dragWorkareaScrollDownTarget"),this.$workareaScrollLeftTarget=p(".dragWorkareaScrollLeftTarget"),this.$workareaScrollRightTarget=p(".dragWorkareaScrollRightTarget"),this.resizeOptions={handles:"e, s, w, se, sw",maxHeight:this.maxHeight,maxWidth:this.maxWidth,minHeight:this.minHeight,minWidth:this.minWidth},this.initializeDroppableArea(),j.getAppEvent().on("page:change-props",function(){a.connection.send("cache-scroll-position")}),this.listenTo(I.getAppState(),"change:currentResolution",this.onCurrentResolutionChanged),this.listenTo(j.getAppEvent(),"rotate",this.flipDimensions),this.listenTo(I.event,"state:branding-set-values-updated",this.handleBrandingSetValuesUpdated),this.listenTo(I.event,"state:component-style-updated",this.handleComponentStyleUpdated),this.listenTo(I.event,"state:component-custom-css-classes-updated",this.handleComponentCustomCssClassesUpdated),this.listenTo(I.event,"state:visibility-rule-updated",this.handleVisibilityRuleUpdated),this.listenTo(I.event,"state:personalization-updated",this.handlePersonalizationUpdated),this.listenTo(I.event,"state:page-change-start",this.handlePageChangeStart),this.listenTo(I.event,"state:aura-component-undo-redo",this.handleAuraComponentUndoRedo),this.listenTo(I.event,"state:theme-layout-area-component-audience-updated",this.handleThemeLayoutAreaComponentAudienceUpdated),this.listenTo(I.event,"state:content-area-component-audience-updated",this.handleContentAreaComponentAudienceUpdated),this.listenTo(I.event,"state:audience-entity-updated",this.handleAudienceEntityUpdated),this.listenTo(I.event,"state:aura-component-updated",this.handleComponentPropertiesChanged),this.listenTo(I.event,"state:component-scoped-branding-set-updated",function(e){e=e.componentId;this.handleComponentPropertiesChanged({itemId:e})}),this.listenTo(I.event,"state:aura-component-visibility-updated",this.handleComponentVisibilityChanged),this.listenTo(I.event,"state:view-properties-updated",this.handleViewUpdated),this.listenTo(I.event,"state:theme-layout-updated",this.handleThemeLayoutChange),this.listenTo(I.event,"state:theme-layout-deleted",this.handleThemeLayoutChange),this.listenTo(I.event,"state:theme-layout-property-updated",this.handleThemeLayoutChange),this.listenTo(I.event,"state:preview-site-branding-set-updated",this.handlePreviewBrandingSetUpdated),this.listenTo(I.event,"state:preview-scoped-branding-set-updated",this.handlePreviewScopedBrandingSetUpdated),this.listenTo(I.event,"state:route-created",this.handleRouteOrViewCreated),this.listenTo(I.event,"state:view-created",this.handleRouteOrViewCreated),this.listenTo(j.getAppEvent(),"dynamic-layout-tour-selected",this.handleDynamicLayoutTourHelpItemSelected),this.listenTo(j.getAppEvent(),"custom-css-changed",this.handleCustomCSSChanged),this.listenTo(j.getAppEvent(),"open-current-inline-editor",this.handleOpenCurrentInlineEditor),this.listenTo(j.getAppEvent(),"close-current-inline-editor",this.handleCloseCurrentInlineEditor),this.listenTo(j.getAppEvent(),"clone-canvas-item",this._handleCloneItem),this.listenTo(j.getAppEvent(),"delete-canvas-item",this._handleDeleteItem),this.listenTo(j.getAppEvent(),"delete-variation-item",this._handleDeleteVariationItem),this.listenTo(j.getAppEvent(),"page-structure-component-selected",this.handlePageStructureCmpSelected),this.listenTo(j.getAppEvent(),"page-structure-component-reselected",function(e){a.propertyEditorPanel.open(),this._scrollElementIntoView(e)}),this.listenTo(j.getAppEvent(),"update-variation-component",this.handleVariationComponentUpdation),this.listenTo(j.getAppEvent(),"dock-floating-panel",this.handleDockFloatingPanel),this.listenTo(j.getAppEvent(),"undock-floating-panel",this.handleUndockFloatingPanel),this.listenTo(I.event,["state:current-theme-updated","state:script-src-trusted-sites-updated","state:csp-security-level-updated","state:csp-violations-list-updated","state:locker-service-enabled-state-updated"].join(" "),function(){a.refreshCurrentPage(!1)}),this.listenTo(I.event,["state:site-language-active-updated","state:active-language-updated"].join(" "),function(e){e=e.shouldReopenSettingsPanelAfterIframeReloads;this.propertyEditorPanel.reset(),this.refreshCurrentPage(!1,!0),e&&this.listenToOnce(I.event,"state:page-change-start",function(){setTimeout(function(){o.trigger("open-app-nav",P.LEFT_PANEL.SETTINGS)},1500)})}),e.connData.onLiveModeConnectionReady(function(e,t,n,i,s){a._initConnection(e),a._enable(t,n,i,s);e=I.getAppState().get("currentResolution");a.updateDimensions(e.get("width"),e.get("height"))})},render:function(){this.copilotPanel&&p("#appMainPanel").append(this.copilotPanel.render().el),p("#appMainPanel").append(this.propertyEditorPanel.render().el)},events:{resizestop:"handleResizeStop",resizestart:"handleResizeStart",resize:"handleResize"},handleDockFloatingPanel:function(){this.$el.addClass("cb-SiteWrapper--dockedPanel")},handleUndockFloatingPanel:function(){this.$el.removeClass("cb-SiteWrapper--dockedPanel")},showPagesMode:function(){var e;null!=(e=this.copilotPanel)&&e.enable(),this.propertyEditorPanel.enable(),this.$el.removeClass("cb-SiteWrapper--branding"),this.$el.addClass("cb-SiteWrapper--pageConfig"),this.$el.removeClass("cb-SiteWrapper--preview"),this.$previewWorkarea.addClass("phone-pageConfig"),this.setInteractions(!0)},showPreviewMode:function(){var e;null!=(e=this.copilotPanel)&&e.disable(),this.propertyEditorPanel.disable(),this.$el.removeClass("cb-SiteWrapper--branding"),this.$el.removeClass("cb-SiteWrapper--pageConfig"),this.$el.addClass("cb-SiteWrapper--preview"),this.$previewWorkarea.removeClass("phone-pageConfig"),this.setInteractions(!1)},onCurrentResolutionChanged:function(e){var e=e.get("currentResolution"),t=this.reloadFrame.bind(this);this.updateDimensions(e.get("width"),e.get("height")),I.event.trigger("action:set-active-resolution",{updatedViewmode:e.get("label"),successCallback:function(e){t()},errorCallback:function(e){A.sldsPromptAlert({title:PicassoWebServices.Labels.PicassoDialog.Error,content:PicassoWebServices.Labels.Resolution.SetActiveError})}})},_initConnection:function(e){var i=this,n="";this.connection=e,this.connection.listenFor("live-loaded",_.bind(this.handleLoaded,this)).listenFor("show-error-dialog",_.bind(this.handleShowErrorDialog,this)).listenFor("show-csp-error-dialog",_.bind(this.handleShowCspErrorDialog,this)).listenFor("save-contentblock",_.bind(this.saveContent,this)).listenFor("get-contentblock",_.bind(this.getHtml,this)).listenFor("fetch-labels",function(){i.connection.send("labels",PicassoWebServices.Labels.LiveMode)}).listenFor("dialog-resize",function(e){i.height()<e.height+20&&i.height(e.height+20),i.width()<e.width+30&&i.width(e.width+30,!0)}).listenFor("move-item",function(t){I.event.trigger("action:move-aura-component",{data:t,successCallback:function(e){i.connection.send("cb-dnd-move-item",{data:t,results:e})},errorCallback:function(e){A.sldsPromptAlert({title:e.LastWarningTitle,content:e.LastWarning,yesText:e.LastWarningArg1})}})}).listenFor("drop-item",function(t){I.event.trigger("action:create-aura-component",{data:t,successCallback:function(e){i.connection.send("cb-dnd-drop-item",{data:t,results:e})},errorCallback:function(e){A.sldsPromptAlert({title:e.LastWarningTitle,content:e.LastWarning,yesText:e.LastWarningArg1})}})}).listenFor("delete-item",function(e){var t=f.getPageComponents().get(e.itemid);!(null==t||null==(t=t.attributes)||null==(t=t.properties)||!t.variationName)?i._handleDeleteVariationItem(e.itemid):i._handleDeleteItem(e.itemid)}).listenFor("select-item",function(e){var t=window[P.FLAGS.KEEP_LHS_OPEN]&&window[P.FLAGS.KEEP_LHS_OPEN].get();j.getAppEvent().trigger("select-aura-component",m(m({},e),{},{keepLHSOpen:t})),i._showComponentProperties(e.id),n!==e.id&&(n=e.id,i.interactions)&&i.propertyEditorPanel.enable()}).listenFor("get-inline-editor-value",function(t){ub.getRichContentEditorAttributesAsync(t.componentId,function(e){i.connection.send("get-inline-editor-value-response",{itemId:t.componentId,rawValue:null==e||null==(e=e.ComponentAttributes)||null==(e=e.richTextValue)?void 0:e.value})})}).listenFor("enter-inline-editor-mode",function(){i.propertyEditorPanel.disable(),i.propertyEditorPanel.close()}).listenFor("exit-inline-editor-mode",function(){i.propertyEditorPanel.enable(),i.propertyEditorPanel.open()}).listenFor("start-sync-inline-editor-content",function(t){var e=f.getContainingViewOrThemeLayoutId(t);PicassoWebServices.ManageSiteCommon.GetHtmlForContentBlocks([t],!0,e,function(e){i.connection.send("end-sync-inline-editor-content",e[t])})}).listenFor("enter-rte-image-uploader",function(){tc.openAssetPicker({title:PicassoWebServices.Labels.CommBuilderRichTextEditor.UploadImageDialogTitle,uploadSuccessCallback:function(e,t){i.connection.send("exit-rte-image-uploader",{altText:"",imgUrl:e,isContentAssetMode:tc.isContentAssetMode()})},uploadCancelCallback:function(){i.connection.send("exit-rte-image-uploader")}})}).listenFor("enter-rte-cms-content-selector",function(e){rc({successCallback:function(e){i.connection.send("exit-rte-cms-content-selector",e)},cancelCallback:function(){i.connection.send("exit-rte-cms-content-selector")},targetId:e.deliveryTargetId})}).listenFor("enter-rte-video-picker",function(e){A.showDialog(new Pb({uploadSuccessCallback:function(e){A.closeDialog(),i.connection.send("exit-rte-video-picker",{videoUrl:e})},uploadCancelCallback:function(){A.closeDialog(),i.connection.send("exit-rte-video-picker")},videoUrl:e.videoUrl,createMarkup:e.createMarkup}),{className:"slds-vex-theme"})}).listenFor("enter-rte-link-picker",function(e){A.showDialog(new Eb({uploadSuccessCallback:function(e,t,n){A.closeDialog(),i.connection.send("exit-rte-link-picker",{url:e,target:t,shouldRemoveLink:n})},uploadCancelCallback:function(){A.closeDialog(),i.connection.send("exit-rte-link-picker")},url:e.url,target:e.target}),{className:"slds-vex-theme cb-LinkPickerDialog"})}).listenFor("enter-rte-source-edit",function(e){A.showDialog(new Lb({data:e,onSaveCallback:function(e){i.connection.send("exit-rte-source-edit",{content:e})},onCancelCallback:function(){i.connection.send("exit-rte-source-edit")}}))}).listenFor("enter-rte-image-properties",function(e){A.showDialog(new Bb({onSaveCallback:function(e){A.closeDialog(),i.connection.send("exit-rte-image-properties",{alt:e})},onCancelCallback:function(){A.closeDialog(),i.connection.send("exit-rte-image-properties")},alt:e.alt}),{className:"slds-vex-theme cb-ImagePropertiesDialog"})}).listenFor("unselect-element",function(){j.getAppEvent().trigger("unselect-aura-component"),i.propertyEditorPanel.close()}).listenFor("move-drag-start",function(){i.propertyEditorPanel.close()}).listenFor("scroll-values",function(e){i.cachedScrollTop=e.scrollTop,i.cachedScrollLeft=e.scrollLeft}).listenFor("route-change-success",function(e){i.handleRouteChangeSuccess(e)}).listenFor("set-active-language-iframe",function(e){i.handleSetActiveLanguageIFrame(e)}).listenFor("session-timeout",function(){j.getAppEvent().trigger("show-alert",{title:PicassoWebServices.Labels.CommunityBuilder.SessionTimeoutTitle,message:PicassoWebServices.Labels.CommunityBuilder.SessionTimeoutMessage,destroy:function(){window.location.href=E.getSite().get("appServerUrl")+"?startURL="+encodeURI(window.location.href)}})}).listenFor("show-rich-text-picker",function(e){A.showDialog(new Rb({itemId:e}),{className:"slds-vex-theme cb-RichTextMigration"})}).listenFor("show-html-content-editor",function(e){Co(e)}).listenFor("cb-open-current-item-audience-selector",function(e){i.manageAudience(e)}).listenFor("cb-open-current-item-priority-selector",function(e){i.managePriority(e.componentId,e.priority)}).listenFor("cb-component-creation-completed",function(e){j.getAppEvent().trigger("canvas-state:aura-component-rendered",e.id),i.handleComponentAddedOrMoved(e)}).listenFor("cb-add-section",function(e){i._handleAddSection(e)}),p(".js-app-header").add(".js-app-nav").focusin(function(){e.send("cb-canvas-blur")})},initializeDroppableArea:function(){var n=this;this.$dropTarget.droppable({accept:".visualEditorPaletteItemDraggable",tolerance:"pointer",out:function(e,t){rf(t.draggable[0]).set("v.broadcastDragEvent",!1),n.hideDropPositions()},over:function(e,t){rf(t.draggable[0]).set("v.broadcastDragEvent",!0)}}),p(".dragFrameScrollTarget").bind("mouseout",function(e){n.connection.send("stop-animate","body, html"),n.activateFrameDragScrollTargets()}),this.$frameScrollUpTarget.bind("mouseenter",function(e){n.connection.send("animate",{selector:"body, html",properties:{scrollTop:0},duration:2500})}),this.$frameScrollLeftTarget.bind("mouseenter",function(e){n.connection.send("animate",{selector:"body, html",properties:{scrollLeft:0},duration:2500})}),this.$frameScrollDownTarget.bind("mouseenter",function(e){n.connection.send("animate",{selector:"body, html",properties:{scrollTop:p.data(n.$frameScrollDownTarget,"value")},duration:2500})}),this.$frameScrollRightTarget.bind("mouseenter",function(e){n.connection.send("animate",{selector:"body, html",properties:{scrollLeft:p.data(n.$frameScrollRightTarget,"value")},duration:2500})}),p(".dragWorkareaScrollTarget").bind("mouseout",function(e){n.cachedFrameOffset=n.$iframe.offset(),n.activateWorkareaDragScrollTargets()}),this.$workareaScrollUpTarget.bind("mouseenter",function(e){n.hideDropPositions(),n.$el.animate({scrollTop:0},2500)}),this.$workareaScrollLeftTarget.bind("mouseenter",function(e){n.hideDropPositions(),n.$el.animate({scrollLeft:0},2500)}),this.$workareaScrollDownTarget.bind("mouseenter",function(e){n.hideDropPositions(),n.$el.animate({scrollTop:p.data(n.$workareaScrollDownTarget,"value")},2500)}),this.$workareaScrollRightTarget.bind("mouseenter",function(e){n.hideDropPositions(),n.$el.animate({scrollLeft:p.data(n.$workareaScrollRightTarget,"value")},2500)})},notifyResized:function(){this.$previewWorkarea.removeClass("is-resizing"),I.getAppState().isMobileFormFactor()&&(this.$previewWorkarea.parent().addClass("phone-preview"),this.$previewWorkarea.addClass("phone-pageConfig"))},notifyResizeStarted:function(){this.$previewWorkarea.addClass("is-resizing"),this.connection.send("frame-resize-started")},saveContent:function(t){var e={items:[{ObjectID:t.guid,Content:t.content,renderEL:!0}]},n=f.getContainingViewOrThemeLayoutId(t.guid);PicassoWebServices.ManageSiteCommon.SaveContentBlocks(e,n,_.bind(function(e){y.hasProcessedErrorInResults(e)||y.processUndoRedoResponse(e),E.getSite().isWebApp()&&this.connection.send(af.CB_PROP_CHANGED,{id:t.guid,props:{richTextValue:t.content}})},this))},getHtml:function(t){var e=[],n=(e.push(t.id),f.getContainingViewOrThemeLayoutId(t.id));PicassoWebServices.ManageSiteCommon.GetHtmlForContentBlocks(e,t.renderEL,n,_.bind(function(e){y.hasProcessedErrorInResults(e)||(e={id:t.id,oldId:t.oldId||t.id,content:e[t.id],containsEL:t.containsEL},this.connection.send("replace-content",e))},this))},_handleDeleteItem:function(t,e){ub.handleDeleteItem(t,null,_.extend({},e,{successCallback:function(e){this.connection.send("cb-dnd-delete-item",{results:e}),this.propertyEditorPanel.getCurrentItemId()===t&&this.propertyEditorPanel.close()}.bind(this)}))},getContentBlockIds:function(t){this.connection.listenFor("content-block-ids",_.bind(function(e){this.connection.stopListeningFor("content-block-ids"),t(e)},this)),this.connection.send("content-block-ids")},setPage:function(e){this.$loadingOverlay.show(),e&&this.reloadFrame()},reloadFrame:function(){this.$iframe[0].contentWindow.location=I.getAppState().getEditorPreviewUrl()},handleBrandingSetValuesUpdated:function(e,t,n){if(e){e=e._currentPreviewScopedBrandingSet;if(n=n,e&&n===P.BRANDING_TYPE.COLOR)return void this.handleUpdateBrandingStyles(e.id)}this.handleUpdateBrandingStyles();var i,n=I.getAppState().get("currentPreviewSiteBrandingSetId");n&&t&&(e=l.getBrandingSet(n),n=l.getBrandingSetPropertyDefs(e.def),i=n,t.some(function(t){var e=i.find(function(e){return e.name===t.name});if(e&&e.type)return"Image"===e.type.name||"Font"===e.type.name&&Dc(t.value)}))&&this.reloadFrame()},handleComponentStyleUpdated:function(e){var t=e.componentId,n=e.styleProperties,e=e.shouldRefreshComponent;this.connection.send("reload-component-styles",{componentId:t,styleProperties:n,stylePropertiesDefinition:f.getStylePropertiesDefinition()}),e&&of(this,t)},handleComponentCustomCssClassesUpdated:function(e){of(this,e)},setInteractions:function(e){this.interactions=e,this.connection.send("set-interactions",e)},handleVisibilityRuleUpdated:function(e){var t=e.componentId,e=e.hasVisibilityRule;this.connection.send("update-visibility-rule",{componentId:t,hasVisibilityRule:e})},handlePersonalizationUpdated:function(e){var t=e.componentId,e=e.hasPersonalizationOrVariations;this.connection.send("update-personalization",{componentId:t,hasPersonalizationOrVariations:e})},manageAudience:function(e){var t=I.getAppState().getCurrentViewId();Ki.openAudienceSelectorForComponent(t,e.componentId,e.audienceId,function(){I.event.trigger("action:sync-content-area-component-audience",{viewId:t,componentId:e.componentId})})},managePriority:function(t,e){Kd.openPrioritySelectorForComponent(e,function(e){I.event.trigger("action:update-aura-component",{itemId:t,values:{RenderPriority:e}})})},_enable:function(e,t,n,i){this.render(),e&&this.handleLoaded(),t&&this.handleRouteChangeSuccess(t),n&&this.handleShowErrorDialog(n),i&&_.each(i,function(e){this.handleShowCspErrorDialog(e)}.bind(this)),j.getAppEvent().trigger("canvas-state:initial-load-complete")},flipDimensions:function(){this.updateDimensions(this.curHeight,this.curWidth)},refreshCurrentPage:function(e){I.event.trigger("action:refresh-current-page",{persistState:e,hidePropertyEditor:!(1<arguments.length&&void 0!==arguments[1])||arguments[1]})},handleSetActiveLanguageIFrame:function(e){e=g.getSiteLanguageByCode(e);I.event.trigger("action:set-active-language",{id:e?e.ComponentID:"",errorCallback:function(){A.sldsPromptAlert({title:PicassoWebServices.Labels.PicassoDialog.Error,content:PicassoWebServices.Labels.Languages.SetActiveError})}})},handleRouteChangeSuccess:function(e){e.routeType!==P.VF_ROUTE_TYPE&&(e.viewId||(e.viewId=h.getRoutes().get(e.routeId).getPreviewViewId()),this.restoreIFrameState(e.viewId),I.event.trigger("action:update-canvas-state",e))},getCurrentSelectedItem:function(e){this._handleConnectionEventOnce("selected-element",e),this.connection.send("get-selected-element")},handleAuraComponentUndoRedo:function(){this.refreshCurrentPage(!0,!1)},handleViewUpdated:function(e,t){var n=!_.isEmpty(t.AuraTag),t=!_.isEmpty(t.ThemeLayoutType);(n||t)&&this.refreshCurrentPage(!1)},handleThemeLayoutChange:function(e,t){t&&this.refreshCurrentPage(!1)},handlePreviewBrandingSetUpdated:function(){this.handleUpdateBrandingStyles()},handlePreviewScopedBrandingSetUpdated:function(){this.handleUpdateBrandingStyles(I.getAppState().getCurrentPreviewScopedBrandingSetId())},handleUpdateBrandingStyles:function(){var e,t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:I.getAppState().getCurrentPreviewSiteBrandingSetId();C.isCSSVariableSupported()?(e=null,n&&(e=_.clone(l.getBrandingSet(n))).type===P.BRANDING_SET_TYPE.APP&&e.brandsource&&(e.values=_s.getResolvedBrandValues(e.values)),e?(t=l.getBrandingSetPropertyDefs(e.def),this.connection.send("reload-branding-styles",{brandingSetId:n,brandingSet:e,brandingDef:t})):this.connection.send("reload-branding-styles",{})):I.event.trigger("action:refresh-current-page")},handlePageChangeStart:function(e){var t=e.persistState,e=e.hidePropertyEditor;this.$loadingOverlay.show(),this.propertyEditorPanel.reset(),this.propertyEditorPanel.close(),t?this.saveIFrameState(e,function(){this.reloadFrame()}.bind(this)):this.reloadFrame()},getPerfCookieKey:function(){return I.getAppState().getNetworkId()+"_suppress_perf_dialogs"},suppressPerfDialogs:function(e){return e&&jQuery.cookie(this.getPerfCookieKey(),e),!!jQuery.cookie(this.getPerfCookieKey())},shouldShowPrioritizationWarning:function(e){var t=I.getAppState().getCurrentViewId();return E.getSite().isProgressiveRenderingEnabled()&&!c.isServiceNotAvailableView(t)&&!e.isInThemeRegion&&!this.suppressPerfDialogs()},handleComponentAddedOrMoved:function(e){var t=this;this.shouldShowPrioritizationWarning(e)&&A.sldsAlert(PicassoWebServices.Labels.CommBuilderPageManagement.PrioritizationChangeWarningContent,PicassoWebServices.Labels.CommBuilderPageManagement.PrioritizationChangeWarningHeading,{className:"slds-vex-theme slds-vex-theme--medium",checkbox:{label:PicassoWebServices.Labels.CommBuilderPageManagement.SuppressPerfDialogsLabel,callback:function(){t.suppressPerfDialogs(!0)}},yesText:PicassoWebServices.Labels.PicassoDialog.GotIt})},saveIFrameState:function(t,n){var i=this;i.connection.listenFor("scroll-positions",function(e){i.savedState={top:e.top,left:e.left},i.connection.stopListeningFor("scroll-positions"),i.getCurrentSelectedItem(function(e){i.savedState&&(i.savedState.itemId=e,i.savedState.hidePropertyEditor=t,n)&&n.call(i)})}),i.connection.send("get-scroll-position")},restoreIFrameState:function(){this.savedState&&(this.savedState.itemId&&this.connection.send("cb-request-select-element-after-rendered",this.savedState),this.savedState=null)},handleComponentPropertiesChanged:function(e){var t=e.itemId,n=e.props,i=e.containerId,e=e.hasPersonalizationOrVariations;!!S.getThemeLayoutById(t)||!I.getAppState().isCurrentPageAura()&&!E.getSite().isWebApp()?this.refreshCurrentPage(!0):of(this,t,n,i,e)},handleVariationComponentUpdation:function(e,t,n){e&&t&&(this.connection.send("cb-variation-changed",{newId:e,currentId:t,label:n,hasPersonalizationOrVariations:!(3<arguments.length&&void 0!==arguments[3])||arguments[3]}),n=null==(t=f.getPageComponents().get(e))?void 0:t.getScopedBrandingSetId())&&this.handleUpdateBrandingStyles(n)},handleComponentVisibilityChanged:function(t,n){var i=this;n.hasOwnProperty("system:IsVisible")&&(k.getComponentVisibilityInfoAsync(t.itemId,function(e){i.connection.send("cb-visibility-changed",{id:t.itemId,parentId:e.parentId,beforeId:e.beforeId,isVisible:n["system:IsVisible"]})}),!1===n["system:IsVisible"])&&i.propertyEditorPanel._currentItemId===t.itemId&&i.propertyEditorPanel.close()},handleCustomCSSChanged:function(e){this.connection.send("cb-custom-css-changed",{cssBlock:e})},handleThemeLayoutAreaComponentAudienceUpdated:function(e){var t=e.componentId,e=e.viewId,e=S.getThemeLayoutByViewId(e).themeLayoutId,e=S.getAudienceTargetInfoForComponent(e,t);this.connection.send("cb-component-attr-audience-updated",{componentId:t,hasAudience:!!e})},handleContentAreaComponentAudienceUpdated:function(e){var t,n=I.getAppState().getCurrentViewId(),n=f.getAudienceTargetInfoForComponent(n,e);(n?n.get("hasCmpAttributeVariation"):void 0)?this.connection.send("cb-component-attr-audience-updated",{componentId:e,hasAudience:!0}):(t=n?n.get("audienceId"):void 0,n=n?n.get("audienceName"):void 0,this.connection.send("cb-component-audience-updated",{componentId:e,audienceId:t,audienceName:n}))},handleAudienceEntityUpdated:function(e,t){var n;e===nf&&(n=I.getAppState().getCurrentViewId(),_.each(t,function(e){var t=this._getComponentIdFromAudienceTargetInfo(e);f.getAudienceTargetInfoForComponent(n,t)&&this.connection.send("cb-component-audience-updated",{componentId:t,audienceId:e.get("audienceId"),audienceName:e.get("audienceName")})}.bind(this)))},_getComponentIdFromAudienceTargetInfo:function(e){return e.get("targetValue").split("#")[0]},handleOpenCurrentInlineEditor:function(e){this.connection.send("open-current-inline-editor",e)},handleCloseCurrentInlineEditor:function(){this.connection.send("close-current-inline-editor")},_handleCloneItem:function(e,t,n){var i=this.propertyEditorPanel._currentItemAttrs.label;I.event.trigger("action:clone-aura-component",{itemId:e,fqn:t,successCallback:function(e){this.connection.send("cb-create-item",{label:i,data:e,options:n})}.bind(this)})},_handleDeleteVariationItem:function(t,e){ub.handleDeleteItem(this.propertyEditorPanel.getCurrentItemId(),t,_.extend({},e,{successCallback:function(e){this.propertyEditorPanel.getCurrentVariationId()===t&&this.propertyEditorPanel.close()}.bind(this)}))},handlePageStructureCmpSelected:function(e){e.tabId&&e.regionKey&&this.connection.send("select-tab",e),e.itemId&&(this.connection.send("select-element",e.itemId),this._scrollElementIntoView(e))},enterFullPreview:function(e){this.viewState={margin:this.$previewWorkarea.css("margin"),width:this.width(),height:this.height()},this.$previewWorkarea.css("margin","0 auto"),this.destroyResizableOnPreviewWorkarea();var t=0,n=0;e&&(t=e.offsetWidth||0,n=e.offsetHeight||0),this.width(p(window).width()-t),this.height(p(window).height()-n)},leaveFullPreview:function(){"100%"===this.viewState.width&&"100%"===this.viewState.height?this.updateDimensions(this.viewState.width,this.viewState.height):(this.height(parseInt(this.viewState.height,10)),this.width(parseInt(this.viewState.width,10)),this.$previewWorkarea.css("margin","auto").resizable(this.resizeOptions))},updateDimensions:function(e,t){var n=this;this.notifyResizeStarted(),this.$previewWorkarea.animate({width:e},{complete:function(){n.notifyResized()}}),this.curWidth=e,this.curHeight=t},absWidth:function(){var e=this.curWidth;return e=0<e.toString().indexOf("%")?this.$previewWorkarea.innerWidth():e},absHeight:function(){var e=this.curHeight;return e=0<e.toString().indexOf("%")?this.$previewWorkarea.innerHeight():e},height:function(e){e=Math.round(e);return e?(this.$previewWorkarea.height(e),this.curHeight=e):this.curHeight},width:function(e,t){e=Math.round(e);return e?(this.$previewWorkarea.width(e),this.curWidth=e,t&&this.notifyResized(),e):this.curWidth},handleResizeStop:function(e,t){p("#liveFrameResizeOverlayHack").hide(),this.notifyResized()},handleResizeStart:function(e,t){p("#liveFrameResizeOverlayHack").show(),this.notifyResizeStarted()},handleResize:function(e,t){t&&(this.curHeight=t.size.height,this.curWidth=t.size.width)},handleLoaded:function(){this.$loadingOverlay.fadeOut("fast"),this.connection.send("scroll-document",{top:this.cachedScrollTop,left:this.cachedScrollLeft}),this.setInteractions(this.interactions),delete this.cachedScrollTop,delete this.cachedScrollLeft},handleShowErrorDialog:function(e){var t;0===p(".js-dialog-error-message").length&&($A.warning(e.errorMessage),e.errorComponent&&((t=e.errorComponent.split("$")[0])&&t.startsWith("markup://")&&(t=t.replace("markup://","")),I.event.trigger("action:add-component-error",{fqn:t})),t=e.hideErrorId?this.errorDialogTemplate({message:PicassoWebServices.Labels.CommunityBuilder.PageLoadingExceptionErrorMsg,hideErrorId:!0,errorId:"",stacktrace:e.errorMessage}):this.errorDialogTemplate({message:PicassoWebServices.Labels.CommunityBuilder.UnhandledExceptionErrorMsg,hideErrorId:!1,errorId:PicassoWebServices.Labels.CommunityBuilder.ErrorId+e.errorId,stacktrace:e.errorMessage}),A.sldsAlert(t,PicassoWebServices.Labels.CommunityBuilder.UnhandledExceptionErrorTitle,{className:"slds-vex-theme slds-vex-theme--medium cb-SldsAlertDialog--error",yesTextClassName:"slds-button slds-button_neutral"}))},handleShowCspErrorDialog:function(e){var t,n;5<=p("."+P.GLOBAL_SELECTOR.CSP_ERROR_DLG).length||(t=I.getAppState().getNetworkId()+"_hideCspViolations",jQuery.cookie(t))||(n={label:PicassoWebServices.Labels.CommunityBuilder.IgnoreCspViolationDialogMsg,callback:function(){jQuery.cookie(t,!0)}},e=this._getCspErrorMessage(e.violatedDirective,e.blockedURI),A.sldsAlert(e,PicassoWebServices.Labels.CommunityBuilder.CspViolationDialogTitle,{className:"slds-vex-theme slds-vex-theme--medium cb-SldsAlertDialog--error "+P.GLOBAL_SELECTOR.CSP_ERROR_DLG,yesTextClassName:"slds-button slds-button_neutral",checkbox:n,afterClose:function(){var e;jQuery.cookie(t)&&(e=jQuery("."+P.GLOBAL_SELECTOR.CSP_ERROR_DLG).data())&&A.closeDialogById(e.vex.id)}}))},_getCspErrorMessage:function(e,t){var n=t&&t.toLowerCase(),i=new RegExp("^(http|https|wss):");return"script-src"===(e=e.split(" ")[0])?"inline"===n?PicassoWebServices.Labels.CommunityBuilder.StrictSrcInlineCspErrorMsg:i.test(n)?L.format(PicassoWebServices.Labels.CommunityBuilder.StrictSrcTrustedSitesCspErrorMsg,t):L.format(PicassoWebServices.Labels.CommunityBuilder.OtherCspErrorMsg,t,e):i.test(n)?L.format(PicassoWebServices.Labels.CommunityBuilder.NonScriptSrcTrustedSitesCspErrorMsg,t,e,E.getSite().get("cspTrustedSitesUrl")):L.format(PicassoWebServices.Labels.CommunityBuilder.OtherCspErrorMsg,t,e)},handleRouteOrViewCreated:function(e){e=e.viewId;!jQuery.cookie(sf)&&e&&k.hasDynamicLayout(e)&&(j.getAppEvent().trigger("start-dynamic-layout-tour",{connection:this.connection,viewId:e}),jQuery.cookie(sf,!0,{expires:400,path:"/"}))},handleDynamicLayoutTourHelpItemSelected:function(){j.getAppEvent().trigger("start-dynamic-layout-tour",{connection:this.connection,viewId:I.getAppState().getCurrentViewId(),forceStart:!0})},handleDragStart:function(e,t,n){this.cachedFrameOffset=this.$iframe.offset(),this.$dropTarget.show(),this.connection.send("drag-start",{x:e.pageX-this.cachedFrameOffset.left,y:e.pageY-this.cachedFrameOffset.top}),this.activateDragScrollTargets(),j.getAppEvent().trigger("close-current-inline-editor"),n&&_.isFunction(n.dragStartHook)&&n.dragStartHook(e,t)},handleDrag:function(e,t){p(e.target).hasClass("visualEditorPaletteItemDraggable")&&this.connection.send("drag-mouse-position",{x:e.pageX-this.cachedFrameOffset.left,y:e.pageY-this.cachedFrameOffset.top})},handleDragStop:function(e,t,n,i){this.$dropTarget.hide(),this.hideDragScrollTargets(),this.connection.send("drag-end",{type:n.properties.connectorType,argument:n,x:e.pageX-this.cachedFrameOffset.left,y:e.pageY-this.cachedFrameOffset.top}),delete this.cachedFrameOffset,i&&_.isFunction(i.dragStopHook)&&i.dragStopHook(e,t)},activateDragScrollTargets:function(){this.activateWorkareaDragScrollTargets(),this.activateFrameDragScrollTargets()},activateWorkareaDragScrollTargets:function(){var e,t=this.$el.height(),n=this.$el[0].scrollHeight,i=this.$el.width(),s=this.$el[0].scrollWidth;p(".dragWorkareaScrollTarget").hide(),t<n&&(0<(e=this.$el.scrollTop())&&this.$workareaScrollUpTarget.show(),0<n-e-t)&&(this.$workareaScrollDownTarget.css("margin-top",t-40+"px").show(),p.data(this.$workareaScrollDownTarget,"value",t)),i<s&&(0<(n=this.$el.scrollLeft())&&this.$workareaScrollLeftTarget.show(),0<s-n-i)&&(this.$workareaScrollRightTarget.css("margin-left",i-40+"px").show(),p.data(this.$workareaScrollRightTarget,"value",i))},activateFrameDragScrollTargets:function(){var a=this;this.connection.listenFor("scroll-positions",function(e){a.$(".dragFrameScrollTarget").hide();var t=a.$previewWorkarea.offset().top,n=a.$previewWorkarea.offset().left,i=a.$previewWorkarea.width(),s=a.$previewWorkarea.height();0<e.top&&(a.$frameScrollUpTarget.show(),a.$frameScrollUpTarget.width(i),a.$frameScrollUpTarget.css({top:t+"px",left:n+"px"})),0<e.left&&(a.$frameScrollLeftTarget.show(),a.$frameScrollLeftTarget.height(s),a.$frameScrollLeftTarget.css({top:t,left:n})),0<e.right&&(a.$frameScrollRightTarget.show(),p.data(a.$frameScrollRightTarget,"value",e.right+e.left),a.$frameScrollRightTarget.height(s),a.$frameScrollRightTarget.css({top:t,left:n+i-20+"px"})),0<e.bottom&&(a.$frameScrollDownTarget.show(),p.data(a.$frameScrollDownTarget,"value",e.bottom+e.top),a.$frameScrollDownTarget.width(i),a.$frameScrollDownTarget.css({top:t+s-20+"px",left:n+"px"})),a.connection.stopListeningFor("scroll-positions")}),this.connection.send("get-scroll-position")},hideDragScrollTargets:function(){p(".dragScrollTarget").hide()},deleteSelected:function(){this.connection.send("delete-selected")},hideDropPositions:function(){this.connection.send("dismiss-drop-positions")},enterFluid:function(e,t){this.$previewWorkarea.animate({margin:"auto"},100),this.destroyResizableOnPreviewWorkarea(),this.updateDimensions(e,t)},enableMarginsAndResizableOnPreviewWorkarea:function(){this.$previewWorkarea.animate({margin:"auto"},100),this.enableResizableOnPreviewWorkarea()},resizableEnabledOnPreviewWorkarea:function(){return this.$previewWorkarea.hasClass("ui-resizable")},enableResizableOnPreviewWorkarea:function(){this.resizableEnabledOnPreviewWorkarea()||this.$previewWorkarea.resizable(this.resizeOptions)},destroyResizableOnPreviewWorkarea:function(){this.resizableEnabledOnPreviewWorkarea()&&this.$previewWorkarea.resizable("destroy")},areRegionsPresent:function(e,t){this._handleConnectionEventOnce("cb-response-regions-presence",t),this.connection.send("cb-request-regions-presence",e)},getSectionChildrenCountsAsync:function(e,t){E.getSite().isWebApp()?k.getComponentInfoAsync(e,function(e){e?(e=e.contents,t.call(this,_.map(e,function(e){return e.contents.length}))):t.call(this,[])}):(this._handleConnectionEventOnce("cb-response-section-children-counts",t),this.connection.send("cb-request-section-children-counts",e))},_showComponentProperties:function(t){this._getIframeElAttrs(t,function(e){this.propertyEditorPanel.showComponentProperties(t,e)})},_getIframeElAttrs:function(e,t){this._handleConnectionEventOnce("cb-response-element-attributes",t),this.connection.send("cb-request-element-attributes",e)},_handleConnectionEventOnce:function(t,n){this.connection.listenFor(t,function(e){this.connection.stopListeningFor(t),n.call(this,e)}.bind(this))},_handleAddSection:function(e){var t={type:"sites.ui.connectors.LumenPageComponentConnector",container:e.container,beforeId:e.beforeId,argument:{properties:{fqn:E.getSite().isWebApp()?P.FQNS.SECTION_LWC:P.FQNS.SECTION}}},n=this;I.event.trigger("action:create-aura-component",{data:t,successCallback:function(e){n.connection.send("cb-dnd-drop-item",{data:t,results:e})},errorCallback:function(e){A.sldsPromptAlert({title:e.LastWarningTitle,content:e.LastWarning,yesText:e.LastWarningArg1})}})},_scrollElementIntoView:function(e){this.connection.send("scroll-element-into-view",e.itemId)}});function gf(e){e?cf.addClass("cb-Main--preview"):cf.removeClass("cb-Main--preview")}function hf(){var e=E.getComplianceBannerInfo();e&&e.message&&$P.auraRun(function(){$A.createComponent("community_builder:alertBanner",{message:e.message},function(e){$A.render(e),T("#appHeader").prepend(e.getElement()),$A.afterRender(e),e=T("#appHeader").height(),cf.css({top:"".concat(e,"px"),height:"calc(100% - ".concat(e,"px")})})})}var j={init:function(e,t){cf=e;e=new Hs({workareaLocator:"#sitePreviewWorkarea"});lf=new Gl,T("#appHeader").append(lf.render().el),hf(),T("#pagesLiveWorkareaPanel").prepend(e.render().$el),I.AccessControl(P.PERMISSIONS.PAGE_EDIT)&&(df=new Uv,T("#pagesLiveWorkareaPanel").prepend(df.el)),e.hide(),uf=new pf({el:"#pagesLiveWorkareaPanel",connData:t}),I.getAppState().on("change:workspaceMode",b.throttle(function(e){switch(e.get("workspaceMode")){case P.workspace.PAGE_CONFIG:lf.show(),uf.showPagesMode(),gf(!1);break;case P.workspace.PREVIEW:lf.show(!0),uf.showPreviewMode(),gf(!0)}},500)),o.on("load-appnav-settings",function(e){df.open(P.LEFT_PANEL.SETTINGS),o.trigger("settings-show-section",e)}),I.AccessControl(P.PERMISSIONS.IS_GUARDRAILS_ENABLED)&&this._createGuardrailEventHandlers(cf,lf)},getLiveMode:function(){return uf},getAppEvent:function(){return o},_createGuardrailEventHandlers:function(e,t){o.on("show-guardrails-tips",function(){e.find("#guardrailsContainer").trigger("show-guardrails-tips")}),o.on("mute-guardrails",function(){e.find("#guardrailsContainer").trigger("mute-guardrails")}),o.on("update-guardrails-menu",function(e){t.$el.find(".cb-AppHeaderHelp").trigger(T.Event("update-guardrails-menu",{count:e}))}),I.AccessControl(P.PERMISSIONS.SITES_PREDICTION_SERVICE_ENABLED)&&(o.on("update-guardrails-perfMenu",function(e){t.$el.find(".cb-AppHeaderHelp").trigger(T.Event("update-guardrails-perfMenu",{perfResults:e}))}),o.on("show-guardrails-perfPanel",function(){e.find("#guardrailsContainer").trigger("show-guardrails-perfPanel")}))}};window.$P.app=window.$P.app||{},$P.models={},$P.viewTypes={},$P.views={},$P.collections={},$P.utils={},$P.services={},$P.deferred={},$P.viewFactories={},$P.viewTypes.CommonTemplates=D,$P.viewTypes.ColorEditor=wm,$P.viewTypes.RichTextPicker=Rb,$P.viewTypes.ErrorDlgView=dc,$P.utils.dialog=A,$P.services.page=k,$P.services.asset=tc,$P.services.content={launchContentSelector:function(e){var t=e.successCallback,e=e.errorCallback;rc({targetId:I.getAppState().getNetworkId(),successCallback:t,errorCallback:e})}},$P.services.branding={getBrandingPropertyFromCssVarReference:N.getBrandingPropertyFromCssVarReference,isCssVariableReference:N.isCssVariableReference},$P.deferred=ha,$P.viewFactories.createHtmlBlockContentEditor=Co,window.getCurrentSiteGUID=function(){return E.getSite().get("guid")},window.OnErrorMsgDialog=function(e,t){setTimeout(function(){A.showDialog(new dc({message:e,title:t}))},0)};var mf=Backbone.View.extend({tagName:"div",className:"cb-DebugComponentTreeContainer slds-tree_container js-componenttree",isPublishedTree:!1,_treeTemplate:_.template("<ul role= \"{{= level === 1 ? 'tree' : 'group' }}\"class=\"{{= level === 1 ? 'cb-componentTree slds-tree' : '' }}\">{{ _.each(ChildNodes, function (node) { }}"+'<li data-id="{{= node.TreeObjectId }}" role="treeitem" class="js-componentTreeItem slds-truncate" aria-level="{{= level}}" aria-expanded="{{= level > 1 ? \'false\' : \'true\' }}"><div class="slds-tree__item"><button class="js-componentBranchExpand slds-button slds-button_icon slds-m-right_x-small {{= !((node.ChildNodes && node.ChildNodes.length) || (node.VariationNodes && node.VariationNodes.length)) ? \'slds-is-disabled\' : \'\' }}" aria-hidden="true" tabindex="-1" title="Expand Tree Branch"><svg class="slds-button__icon slds-button__icon_small" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/utility-sprite/svg/symbols.svg#chevronright"></use></svg><span class="slds-assistive-text">Expand Tree Branch</span></button><span class="slds-tree__item-label slds-truncate" title="{{= node.Name }}">{{= node.Name }}</span></div>{{ if (node.ChildNodes && node.ChildNodes.length) { }}{{= templateFn({ ChildNodes: node.ChildNodes, templateFn: templateFn, level: level+1 }) }}{{ } }}{{ if (node.VariationNodes && node.VariationNodes.length) { }}{{= templateFn({ ChildNodes: node.VariationNodes, templateFn: templateFn, level: level+1 }) }}{{ } }}</li>{{ }); }}</ul>'),_componentPropertyTemplate:_.template('<ul class="cb-componentPropertiesHeader"><li class="slds-text-heading_medium">{{= properties.Name }}</li><li class="slds-text-color_weak">ID: {{= properties.ComponentID }}</li></ul><div class="slds-text-title_caps slds-m-top_small slds-m-bottom_x-small">Properties</div><ul class="cb-componentPropertyList">{{ _.each(orderedProperties, function (prop) { }}<li class="">{{= prop}}: <span class="propValue">{{= properties[prop] }}</span></li>{{ }) }}</ul>{{ if (references && references.length) { }}<div class="slds-text-title_caps slds-m-top_small slds-m-bottom_x-small">References</div><ul class="cb-componentReferenceList">{{ _.each(references, function (ref) { }}<li class="">{{= ref.Name}}: <span class="slds-text-link"> {{= ref.ID}} </span> ref: {{= ref.RequireLatest }}</li>{{ }) }}</ul>{{ } }}'),events:{"click .js-componentTreeItem":"_onClickItem","click .js-componentBranchExpand":"_onClickToggleBranch"},initialize:function(e){this.isPublishedTree=!!e.isPublishedTree,this.$propsContainer=e.componentPropertyContainer,this.$propsContainer.addClass("cb-DebugComponentPropsContainer"),this.render()},render:function(){this.$el.html(D.spinner),(this.isPublishedTree?PicassoWebServices.PicassoDebug.GetPubComponentTree:PicassoWebServices.PicassoDebug.GetComponentTree)(this._createTree.bind(this))},show:function(){this.$el.addClass("hidden")},hide:function(){this.$el.addClass("hidden")},_createTree:function(e){var t=this._treeTemplate,e=this._treeTemplate(_.extend(e,{templateFn:t,level:1}));this.$el.empty().html(e)},_onClickToggleBranch:function(e){e.stopPropagation();var e=T(e.currentTarget).closest(".js-componentTreeItem"),t="true"===e.attr("aria-expanded");e.attr("aria-expanded",t?"false":"true")},_onClickItem:function(e){e.stopPropagation(),T('.js-componentTreeItem[aria-selected="true"]').attr("aria-selected","false");e=T(e.currentTarget);e.attr("aria-selected","true"),this.$propsContainer.empty().html(D.spinner),PicassoWebServices.PicassoDebug.GetComponentData(e.data("id"),this.isPublishedTree,this._showComponentData.bind(this))},_showComponentData:function(e){var n,t;e.properties&&(n={Deleted:0,Name:1,ComponentID:2,Path:3,RootContainer:4,RootContainerID:5,ContainerID:6,IsValid:7},t=Object.keys(e.properties).sort(function(e,t){return(n[e]||Number.MAX_SAFE_INTEGER)-(n[t]||Number.MAX_SAFE_INTEGER)}),e=this._componentPropertyTemplate(_.extend(e,{orderedProperties:t})),this.$propsContainer.html(vf(e)))}});function vf(e){return e.replace(/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/g,function(e){return"<a href='#' class='slds-text-link debug-id-link'>"+e+"</a>"})}function bf(){return T(".js-debug-dlg-action-container .absPanel").remove(),T(".js-debug-dlg-action-container").prepend('<div class="absInnerPanel absPanel" style="z-index: 10001;position: absolute; top: 50px; bottom: 50px; left: 100px; right: 100px; background: white; border: 1px solid #999;box-shadow:5px 5px 30px 5px black;"><div style="overflow:auto;position:absolute;top:25px;left:0;right:0;bottom:0;padding-left:20px;"></div></div>'),T(".js-debug-dlg-action-container").prepend('<div class="absOuterPanel absPanel" style="z-index: 10000;position: absolute; top: 0; bottom: 0; left: 0; right: 0; background: black; opacity: 0.5"></div>'),T('<button style="position:absolute;right:0;">X</button>').prependTo(".js-debug-dlg-action-container .absInnerPanel").click(function(){T(".js-debug-dlg-action-container .absPanel").remove()}),T(".js-debug-dlg-action-container .absInnerPanel > div")}function ff(e){var t;return e&&e.audienceData?((t=[]).push('<br><div style="font-size: 14px"><strong>Template Name: </strong>'+e.pageName+"</div>"),t.push('<div style="font-size: 14px"><strong>Template ID: </strong>'+e.pageId+"</div><br>"),b.each(e.audienceData,function(e){t.push("<div><strong>Audience Name: </strong>"+e.audienceName+"</div>"),t.push("<div><strong>Audience ID: </strong>"+e.audienceId+"</div>"),t.push("<div><strong>Group Priority: </strong>"+e.groupPriority+"</div>"),t.push("<div><strong>Page Variation Name: </strong>"+e.viewName+"</div>"),t.push("<div><strong>Page Variation ID: </strong>"+e.targetValue+"</div>"),t.push("<div><strong>Route Name: </strong>"+e.routeName+"</div>"),t.push("<div><strong>Route ID: </strong>"+e.routeId+"</div>"),t.push("<br>")}),t.join("")):""}function _f(n){for(var i=[],e=0;e<n.length;e++)!function(t){n[t]&&n[t].variationsData&&(i.push("<div><strong>Route ID : </strong>"+n[t].routeId+"</div>"),i.push("<div><strong>Route Name : </strong>"+n[t].routeName+"</div>"),i.push("<div><strong>View ID : </strong>"+n[t].viewId+"</div>"),i.push("<div><strong>View Name : </strong>"+n[t].viewName+"</div>"),i.push("<br>"),b.each(n[t].variationsData.ruleToVariationList,function(e){i.push("<div><strong>Target ID(Base Component UUID) : </strong>"+n[t].variationsData.targetId+"</div>"),i.push("<div><strong>Variation ID : </strong>"+e.variationId+"</div>"),i.push("<div><strong>Variation Name : </strong>"+e.name+"</div>"),i.push("<div><strong>Criteria Type : </strong>"+e.criteriaType+"</div>"),i.push("<div><strong>ExpressionCriteria : </strong>"+e.expressionCriteria+"</div>"),i.push("<div><strong>RuleName : </strong>"+e.ruleName+"</div>"),i.push("<div><strong>RuleDescription : </strong>"+e.ruleDescription+"</div>"),i.push("<br>")}),i.push("<br>"))}(e);return 0==i.length?'<br><div style="font-size: 14px"><strong>Theme Name: </strong>Content area has no variations data</div>':i.join("")}function Sf(n){for(var i=[],e=0;e<n.length;e++)!function(t){n[t]&&n[t].variationsData&&(i.push("<div><strong>Theme ID : </strong>"+n[t].themeId+"</div>"),i.push("<div><strong>Theme Name : </strong>"+n[t].themeName+"</div>"),i.push("<br>"),b.each(n[t].variationsData.ruleToVariationList,function(e){i.push("<div><strong>Target ID(Base Component UUID) : </strong>"+n[t].variationsData.targetId+"</div>"),i.push("<div><strong>Variation ID : </strong>"+e.variationId+"</div>"),i.push("<div><strong>Variation Name : </strong>"+e.name+"</div>"),i.push("<div><strong>Criteria Type : </strong>"+e.criteriaType+"</div>"),i.push("<div><strong>ExpressionCriteria : </strong>"+e.expressionCriteria+"</div>"),i.push("<div><strong>RuleName : </strong>"+e.ruleName+"</div>"),i.push("<div><strong>RuleDescription : </strong>"+e.ruleDescription+"</div>"),i.push("<br>")}),i.push("<br>"))}(e);return 0==i.length?'<br><div style="font-size: 14px"><strong>Theme Name: </strong>Theme Layout has no variations data</div>':i.join("")}function Cf(e){var t;return e&&e.audienceData&&e.audienceData.length?((t=[]).push('<br><div style="font-size: 14px"><strong>Template Name: </strong>'+e.pageName+"</div>"),t.push('<div style="font-size: 14px"><strong>Template ID: </strong>'+e.pageId+"</div><br>"),b.each(e.audienceData,function(e){t.push("<div><strong>Audience Name: </strong>"+e.audienceName+"</div>"),t.push("<div><strong>Audience ID: </strong>"+e.audienceId+"</div>"),t.push("<div><strong>Component Name: </strong>"+e.componentName+"</div>"),t.push("<div><strong>Component FQN: </strong>"+e.componentDevName+"</div>"),t.push("<div><strong>Component ID: </strong>"+e.targetValue+"</div>"),t.push("<div><strong>View Name: </strong>"+e.viewName+"</div>"),t.push("<div><strong>View ID: </strong>"+e.viewId+"</div>"),t.push("<div><strong>Route Name: </strong>"+e.routeName+"</div>"),t.push("<div><strong>Route ID: </strong>"+e.routeId+"</div>"),t.push("<br>")}),t.join("")):""}function yf(o,e,r){PicassoWebServices.PicassoDebug.GetComponentData(o,e,function(i){var t,e,s,n,a="<div style='padding-top:10px;font-weight:bold;'>PROPERTIES</div>";if(i.properties)for(e in T.each(["Deleted","Name","ComponentID","Path","RootContainer","RootContainerID","ContainerID","IsValid"],function(e,t){var n=i.properties[t];n&&(a+=s="<div>"+t+": "+n+"</div>",delete i.properties[t])}),i.properties)s="<div>"+e+": "+i.properties[e]+"</div>",a+=s;if(a=(a=a+"<div style='padding-top:10px;font-weight:bold;'>EXPORT</div>"+"<button id='exportCmpButton'>Export component</button>")+"<button id='exportCmpButtonNoCss'>Export component no stylesheets</button>"+"<div style='padding-top:10px;font-weight:bold;'>REFERENCES</div>",i.references)for(n=0;n<i.references.length;++n)t=i.references[n],s="<div>"+t.Name+": "+t.ID+" ref:"+t.RequireLatest+"</div>",a+=s;if(a+="<div style='padding-top:10px;font-weight:bold;'>SFDC REFERENCES</div>",i.sfdcreferences)for(n=0;n<i.sfdcreferences.length;++n)t=i.sfdcreferences[n],s="<div>id:"+t.id+" fields:"+t.fields+"</div>",a+=s;r.append(vf(a)),i.references&&T("<button id='backRefButton'>Find Back References</button>").click(function(){PicassoWebServices.PicassoDebug.GetBackRefInfo(o,function(e){if(e){if(a="",0===e.length)a="<div>No Back References</div>";else for(n=0;n<e.length;++n)t=e[n],s="<div class='backRefItem'>"+t.name+": "+t.id+"</div>",a+=s;r.find(".backRefItem").remove(),T("#backRefButton").after(vf(a))}})}).appendTo(r),T("#exportCmpButton").click(function(){PicassoWebServices.PicassoDebug.ExportComponent(o,function(e){e.url&&(window.location=e.url)})}),T("#exportCmpButtonNoCss").click(function(){PicassoWebServices.PicassoDebug.ExportComponentEx(o,!0,function(e){e.url&&(window.location=e.url)})})})}function Tf(e,t){var n=T("<div style='float:left; width:400px; height:550px; overflow:auto; margin-left:-30px' />").appendTo(e),e=T("<div style='float:left; width:400px; height:550px; overflow:auto; padding-left:10px' />").appendTo(e),e=new mf({componentPropertyContainer:e,isPublishedTree:t});n.append(e.$el)}function Pf(e,o){PicassoWebServices.PicassoDebug.GetAudienceData(e,function(n){var e=T('<div style="color:red; font-size: 14px">Choose Audience Data Type for current Home and Login pages</div><br>'),t=T('<button class="slds-button_neutral" type="button">Branding Sets</button>'),i=T('<button class="slds-button_neutral" type="button">Page Assignments</button>'),s=T('<button class="slds-button_neutral" type="button">Component Visibility</button>'),a=T("<div>");t.bind("click",function(){var e,t;a.empty(),a.append(vf((e=n.brandingAssignments.homePage)&&e.audienceData?((t=[]).push('<br><div style="font-size: 14px"><strong>Theme Name: </strong>'+e.themeName+"</div>"),t.push('<div style="font-size: 14px"><strong>Theme ID: </strong>'+e.themeId+"</div><br>"),t.push('<div style="font-size: 14px"><strong>Note: </strong> Home and Login Pages are pointed to the same Branding Sets</div><br>'),b.each(e.audienceData,function(e){t.push("<div><strong>Audience Name: </strong>"+e.audienceName+"</div>"),t.push("<div><strong>Audience ID: </strong>"+e.audienceId+"</div>"),t.push("<div><strong>Branding Set Name: </strong>"+e.brandingSetName+"</div>"),t.push("<div><strong>Branding Set ID: </strong>"+e.targetValue+"</div>"),t.push("<br>")}),t.join("")):""))}),i.bind("click",function(){a.empty(),a.append(vf(ff(n.pageAssignments.homePage))),a.append(vf(ff(n.pageAssignments.loginPage)))}),s.bind("click",function(){a.empty();var e=Cf(n.componentAssignments.homePage),t=Cf(n.componentAssignments.loginPage);e||t?(a.append(vf(e)),a.append(vf(t))):a.append('<br><div style="font-size: 14px"><strong>No Components Audience Mapping found</strong></div>')}),o.append(e),o.append(t),o.append(i),o.append(s),o.append(a)})}function If(e,r){PicassoWebServices.PicassoDebug.GetDynamicExperienceData(e,function(e){var t=T('<div style="color:red; font-size: 14px">Choose Visibility Data Type</div><br>'),n=T('<button class="slds-button_neutral" type="button">Component Visibility</button>'),i=T('<button class="slds-button_neutral" type="button">Theme Visibility</button>'),s=T('<button class="slds-button_neutral" type="button">Variation Component Visibility</button>'),a=T('<button class="slds-button_neutral" type="button">Theme Variation Component Visibility</button>'),o=T("<div>");n.bind("click",function(){o.empty(),o.append(vf(function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&e[n].visibilityData&&(t.push("<div><strong>Route ID : </strong>"+e[n].routeId+"</div>"),t.push("<div><strong>Route Name : </strong>"+e[n].routeName+"</div>"),t.push("<div><strong>View ID : </strong>"+e[n].viewId+"</div>"),t.push("<div><strong>View Name : </strong>"+e[n].viewName+"</div>"),t.push("<div><strong>Target ID(Component UUID) : </strong>"+e[n].visibilityData.targetId+"</div>"),t.push("<div><strong>Criteria Type : </strong>"+e[n].visibilityData.criteriaType+"</div>"),t.push("<div><strong>ExpressionCriteria : </strong>"+e[n].visibilityData.expressionCriteria+"</div>"),t.push("<div><strong>Is Active : </strong>"+e[n].visibilityData.isActive+"</div>"),t.push("<div><strong>Is Hidden On Operation Success : </strong>"+e[n].visibilityData.isHiddenOnOperationSuccess+"</div>"),t.push("<div><strong>RuleName : </strong>"+e[n].visibilityData.ruleName+"</div>"),t.push("<div><strong>RuleDescription : </strong>"+e[n].visibilityData.ruleDescription+"</div>"),t.push("<br>"));return 0==t.length?'<br><div style="font-size: 14px"><strong>Theme Name: </strong>Content area has no visibility data</div>':t.join("")}(e.contentOperationsData.homePageVisibility)))}),i.bind("click",function(){o.empty(),o.append(vf(function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&e[n].visibilityData&&(t.push("<div><strong>Theme ID : </strong>"+e[n].themeId+"</div>"),t.push("<div><strong>Theme Name : </strong>"+e[n].themeName+"</div>"),t.push("<div><strong>Target ID(Component UUID) : </strong>"+e[n].visibilityData.targetId+"</div>"),t.push("<div><strong>Criteria Type : </strong>"+e[n].visibilityData.criteriaType+"</div>"),t.push("<div><strong>ExpressionCriteria : </strong>"+e[n].visibilityData.expressionCriteria+"</div>"),t.push("<div><strong>Is Active : </strong>"+e[n].visibilityData.isActive+"</div>"),t.push("<div><strong>Is Hidden On Operation Success : </strong>"+e[n].visibilityData.isHiddenOnOperationSuccess+"</div>"),t.push("<div><strong>RuleName : </strong>"+e[n].visibilityData.ruleName+"</div>"),t.push("<div><strong>RuleDescription : </strong>"+e[n].visibilityData.ruleDescription+"</div>"),t.push("<br>"));return 0==t.length?'<br><div style="font-size: 14px"><strong>Theme Name: </strong>Theme Layout has no visibility data</div>':t.join("")}(e.contentOperationsData.themeVisibility)))}),s.bind("click",function(){o.empty(),o.append(vf(_f(e.contentOperationsData.homePageVariations)))}),a.bind("click",function(){o.empty(),o.append(vf(Sf(e.contentOperationsData.themeVariations)))}),r.append(t),r.append(n),r.append(i),r.append(s),r.append(a),r.append(o)})}function Ef(e,o){PicassoWebServices.PicassoDebug.GetDevNameCache("VariantsBundle",e,function(e){for(var t="<tr style='font-weight:bold'><th>DevName</th><th>UUID</th></tr>",n=e.cache,i=0,s=Object.entries(n);i<s.length;i++){var a=J(s[i],2);t+="<tr><td>"+a[0]+"</td><td>"+a[1]+"</td></tr>"}o.html("<table border='1' cellpadding='2'>"+vf(t)+"</table>"),e.error&&(n="<div style='font-weight:bold;margin:20px;'>Failed to get cache map: "+e.error+"</div>",o.append(n))})}function wf(e){var t,n={};for(t in e)for(var i in e[t]){var s=e[t][i].uid;e[t][i].content;n[s]={descriptor:t,mode:i,content:"[REMOVED]"}}return n}function Lf(t,l,e){T(e).empty();e=T('<div id="getWebAppResourcesPanel"></div>').appendTo(e);if(e.append('<p style="margin-top:15px;">Status: '+t.status+"</p>"),t.message&&e.append("<p>"+t.message+"</p>"),t.data&&0<Object.keys(t.data).length){var n,c=T('<table style="margin-top:15px;table-layout:fixed;width:100%"></table>').appendTo(e),d="padding:6px;border:1px solid #dddddd;word-break:break-all;",e="font-size:1.1rem;".concat(d),u=(T('<tr>\n            <th style="width:50%;'.concat(e,'">Descriptor</th>\n            <th style="').concat(e,'">Mode</th>\n            <th style="').concat(e,'">UID</th>\n            <th style="').concat(e,'">Version</th>\n            <th style="width:20%;').concat(e,'">Content</th>\n           </tr>')).appendTo(c),!0),i=se(Object.keys(t.data).sort());try{var s=function(){var e,o=n.value,r=t.data[o];for(e in r)!function(t){var e=r[t],n=e.uid,e=e.version,i="".concat(d).concat(u?"background-color:#dddddd;":""),s="".concat(o.replaceAll(/[:/@\.]/gi,"-")).concat(t),a='<button id="'.concat(s,'-button">Expand/Collapse</button>');T('<tr>\n                    <th style="'.concat(i,'">').concat(o,'</th>\n                    <th style="').concat(i,'">').concat(t,'</th>\n                    <th style="').concat(i,'">').concat(n,'</th>\n                    <th style="').concat(i,'">').concat(e,'</th>\n                    <th style="').concat(i,'">').concat(a,"</th>\n                  </tr>")).appendTo(c),T('<tr>\n                     <th style="word-break:break-all;" colspan="5">\n                        <p id="'.concat(s,'-content" style="display:none;\n                            border:1px solid #dddddd;\n                            font-family: \'Salesforce Sans\';\n                            line-height: normal;\n                            font-weight: lighter;\n                            font-size: .8rem;"></p>\n                     </th>\n                    </tr>')).appendTo(c),u=!u,T("#".concat(s,"-button")).click(function(){T("#".concat(s,"-content")).is(":hidden")?PicassoWebServices.PicassoDebug.GetWebAppResourceForLwrSite(o,l,function(e){e="SUCCESS"!==e.status?"".concat(e.status,": ").concat(e.message):e.data[t].content;T("#".concat(s,"-content")).text(e),T("#".concat(s,"-content")).toggle()}.bind(this)):T("#".concat(s,"-content")).toggle()})}(e)};for(i.s();!(n=i.n()).done;)s()}catch(e){i.e(e)}finally{i.f()}}}var Df={initialize:function(e){e.off("click.debug-id-link").on("click.debug-id-link",".debug-id-link",function(e){yf(T(e.target).html(),!1,bf())})},siteinfo:{name:"Site Info",render:function(a){PicassoWebServices.PicassoDebug.getSiteInfo(function(e){for(var t="<ul>",n=0;n<e.length;++n){var i,s=e[n];for(i in s)t+="<li><b>"+i+":</b>  "+s[i]+"</li>"}a.html(t+="</ul>")})}},lookupComponent:{name:"Lookup Component Info",render:function(e){e.append("<div>ComponentInfo:</div><div>ID: <input class='slds_input' type='text'/>  Published? <input class='slds_checkbox' type='checkbox'/>  <button class='slds-button_neutral'>Look up</button></div>"),e.find("button").click(function(){yf(e.find(".slds_input").val().trim(),e.find(".slds_checkbox").is(":checked"),bf())})}},componenttree:{name:"Component Tree",render:function(e){Tf(e,!1)}},pubcomponenttree:{name:"Component Tree (Published)",render:function(e){Tf(e,!0)}},urllist:{name:"Uri Hash Info From Db",render:function(s){PicassoWebServices.PicassoDebug.GetUrls(function(e){for(var t="<tr style='font-weight:bold'><th>URL</th><th>Name</th><th>ID</th><th>UriHash</th></tr>",n=0;n<e.urls.length;++n)var i=e.urls[n],t=t+("<tr><td>"+i.url+"</td><td>"+i.name+"</td><td>"+i.id+"</td><td>"+i.uriHash)+"</td></tr>";s.html("<table border='1' cellpadding='2'>"+vf(t)+"</table>")})}},undoredo:{name:"Undo Redo Stack",build:function(e,t){for(var n,i,s,a,t=T("<div />").appendTo(t),o=T("<div />").appendTo(t),r=T("<div style='width:400px;font-size:11px;float:left;padding-right:5px'>Undo Stack</div>").appendTo(o),o=T("<div style='width:400px;font-size:11px;float:left;padding-left:5px'>Redo Stack</div>").appendTo(o),l=(t.prepend("<div style='padding-bottom:10px'>Undo and Redo Information for "+e.context+"</div>"),T("<ul style='list-style-type:none;text-decoration:none;'>").appendTo(r)),c=e.undo,d=0;d<c.length;++d){for(n=c[d].actions,i=T("<li><a href='#'>"+c[d].info+"</a></li>").appendTo(l),s=T("<div>").appendTo(i),a=0;a<n.length;++a)s.append("<p>"+n[a]+"</p>");i.append("</div>")}r.append("</ul>"),l.accordion();var u=T("<ul style='list-style-type:none;text-decoration:none;'>").appendTo(o),c=e.redo;for(d=0;d<c.length;++d){for(n=c[d].actions,i=T("<li><a href='#'>"+c[d].info+"</a></li>").appendTo(u),s=T("<div>").appendTo(i),a=0;a<n.length;++a)s.append("<p>"+n[a]+"</p>");i.append("</div>")}o.append("</ul>"),u.accordion()},render:function(t){PicassoWebServices.PicassoDebug.GetUndoRedoStack(function(e){this.build(e,t)}.bind(this))}},changeditems:{name:"Changed Components",build:function(n,e){var i,t,s=T("<div />").appendTo(e),a=T("<div />").appendTo(e);s.css({float:"left",width:"400px",height:"550px",overflow:"auto",padding:"8px"}),a.css({float:"left",width:"370px",height:"550px",overflow:"auto",fontSize:"11px",padding:"8px"}),s.append("<div style='font-weight:bold;'>New - Updated</div>");for(i in n.changed)!function(){var e,t=n.changed[i],t=T("<div style='font-size:11px;'>"+t.name+" : "+i+"<a class='difflink' href='#'>Diffs</a></div>").appendTo(s);e=i,t.find("a.difflink").click(function(){a.empty().append("<div style='font-weight:bold;'>Differences for:"+e+"</div>"),PicassoWebServices.PicassoDebug.GetComponentDiffs(e,function(e){if(e.newcomponent&&a.append("<div>New component</div>"),e.crcdev&&a.append("<div>CRC-DEV:"+e.crcdev+"</div>"),e.crcpub&&a.append("<div>CRC-PUB:"+e.crcpub+"</div>"),e.diffs)for(var t in e.diffs){t=e.diffs[t];a.append("<div>"+t+"</div>")}})})}();for(t in s.append("<div style='font-weight:bold;'>Deleted</div>"),n.deleted){var o=n.deleted[t];s.append("<div style='font-size:11px;'>"+o.name+" : "+t+"</div>")}},render:function(t){PicassoWebServices.PicassoDebug.GetChangedItems(function(e){this.build(e,t)}.bind(this))}},changedrootitems:{name:"Changed Root Components",changed_cache:null,render:function(r){var l=T('<div style="width:750px; height: 550px; overflow:auto" />').appendTo(r),c=(this.changed_cache=null,this),d=[];PicassoWebServices.ManageSiteCommon.GetChangedRootItems(function(e){for(var t in c.changed_cache=e.changed,d.push("<div style='font-weight:bold;'>New - Updated Root Items</div>"),d.push("<div style='overflow:hidden;margin-top:10px'>"),e.changed){var n=e.changed[t];d.push("<input type='checkbox' class='slds-checkbox' style='float: left;' /><div itemid='"+t+"' style='font-size:11px;float:left;line-height:20px;margin-left:5px;margin-top:-5px;'>"+n.name+"("+n.type+") : "+t+" state:"+n.state+"</div><div style='clear:left'></div>")}for(var i in d.push("</div>"),d.push("<div style='font-weight:bold;margin-top:10px'>Deleted Root Items</div>"),d.push("<div style='overflow:hidden;margin-top:10px'>"),e.deleted){var s=e.deleted[i];d.push("<input type='checkbox' class='slds-checkbox' style='float: left;' /><div itemid='"+i+"' style='font-size:11px;float:left;line-height:20px;'>"+s.name+" : "+i+"</div><div style='clear:left'></div>")}d.push("</div>"),d.push("<div style='font-weight:bold;margin-top:10px'>Dependencies</div>"),l.html(d.join(""));var a=T("<div />").appendTo(l),o=r.find("input:checkbox");o.click(function(){var t={components:[]};o.each(function(){var e=T(this);e.is(":checked")&&(e=e.next().attr("itemid"),t.components.push({ObjectID:e}))}),PicassoWebServices.ManageSiteCommon.GetPublishDependencies(t,function(e){a.empty();for(var t=0;t<e.dependencies.length;++t){var n=e.dependencies[t];c.changed_cache[n.ID]?a.append("<div itemid='"+n.ID+"' style='font-size:11px;line-height:20px;'>"+n.Name+" : "+n.ID+" state:"+n.State+" dt:"+n.DependencyType+"</div>"):a.append("<div itemid='"+n.ID+"' style='font-size:11px;color:#aaa;line-height:20px;'>"+n.Name+" : "+n.ID+"</div>")}})})})}},changelists:{name:"Show All Changelists",render:function(i){PicassoWebServices.ManageSiteCommon.GetAllChangelists(function(e){for(var t in i.append("<div style='font-weight:bold;'>Changelists</div>"),e){var n=e[t];i.append("<div style='font-size:11px;'>id:"+t+" desc:"+n.description+(n.id.startsWith("0CL")?" changelist-number:":" deployment-number:")+n.number+" pub-date:"+n.publishedDate.displayData+" state:"+n.state+(n.id.startsWith("0CL")?" detailedPage:"+n.detailPageUrl+" approved:"+n.approved:" deployment-id:"+n.id)+"</div>")}})}},exportXml:{name:"Export XML",render:function(t){t.html(D.spinner),PicassoWebServices.PicassoDebug.ExportXml(function(e){t.html("<textarea style='width:700px;height:550px'>"+e+"</textarea>")})}},removeInactiveData:{name:"Remove Inactive Data",render:function(t){PicassoWebServices.PicassoDebug.RemoveInactiveData(function(e){t.append("<div style='font-weight:bold;'>"+(!0===e?"Success!":"Failure!")+"</div>")})}},getSfdcRefs:{name:"SFDC External Refs",render:function(t){PicassoWebServices.PicassoDebug.GetAllExternalizedReferences(function(e){var n=[];b.each(e,function(e){n.push("<div><strong>Component Name: </strong>"+e.name+"</div>"),n.push("<div><strong>Component ID: </strong>"+e.id+"</div>"),n.push("<div><strong>Externalized References Match (db/sitecom): </strong>"+e.isMatch+"</div>"),n.push("<div><strong>Externalized References:</strong></div>");var t=[];b.each(e.extReferences,function(e){t.push("<br><div><strong>Externalized Reference:</strong></div>"),t.push("<div><strong>Reference UddId: </strong>"+e.uddId+"</div>"),t.push("<div><strong>Reference Type Sitecom: </strong>"+e.isSitecomType+"</div>"),e.isSitecom&&(t.push("<div><strong>Reference Name: </strong>"+e.name+"</div>"),t.push("<div><strong>Reference ID: </strong>"+e.id+"</div>"))}),n.push(t.join("")),n.push("<br>")}),n?t.append(vf(n.join(""))):t.append("No sfdcexternal refs found")})}},getAuditTrail:{name:"Audit Trail",render:function(e){var t=$P.app.state.getCurrentSite().get("isInCmsStore"),n=T('<div style="color:red; font-size: 14px">Choose Time Frame for Audit Trail</div><br>'),t='<p>Source: \n                <select name="eventType" id="eventType">'+(t?'<option value="digitalexpbundle" selected="selected">DigitalExperienceBundle</option>':'<option value="expbundle" selected="selected">ExperienceBundle</option>')+'<option value="commwebservice">Builder</option>\n                <select>\n            </p>\n            <br>',i=T('<p>From: <input type="datetime-local" id="fromDate"></p><br>'),s=T('<p>Until: <input type="datetime-local" id="untilDate"></p><br>'),a=T('<button class="slds-button_neutral" type="button">Export Audit Trail</button>'),o=T("<div>");a.on("click",function(){o.empty();var e=i.find("input").val().replace("T"," ")+":00",t=s.find("input").val().replace("T"," ")+":00",n=T("#eventType").val();":00"==e?o.append("Missing proper From Date range"):":00"===!t?o.append("Missing proper Until Date range"):PicassoWebServices.PicassoDebug.ExportAuditTrail(e,t,n,function(e){e.error&&o.append("<div style='font-weight:bold;margin:20px;'>Failed to find Audit Trail: "+e.error+"</div>");e=e.url;e&&window.open(e)})}),e.append(n),e.append(t),e.append(i),e.append(s),e.append(a),e.append("<br>"),e.append(o)}},getAudienceDataDraft:{name:"Audience Data - Draft",render:function(e){Pf(!0,e)}},getAudienceDataPublish:{name:"Audience Data - Published",render:function(e){Pf(!1,e)}},getDynamicExperienceDraft:{name:"Dynamic Experience - Draft",render:function(e){$P.app.state.getCurrentSite().get("isInCmsStore")?If(!0,e):e.append("<div>This action is supported on CMS-backed sites only.</div>")}},getDynamicExperiencePublish:{name:"Dynamic Experience - Published",render:function(e){$P.app.state.getCurrentSite().get("isActive")?$P.app.state.getCurrentSite().get("isInCmsStore")?If(!1,e):e.append("<div>This action is supported on CMS-backed sites only.</div>"):e.append("<div>This site is not published.</div>")}},getDevNameCacheDraft:{name:"DevName Cache - Draft",render:function(e){Ef(!0,e)}},getDevNameCachePublished:{name:"DevName Cache - Published",render:function(e){Ef(!1,e)}},exportSite:{name:"Export Site",render:function(t){var n,i,s;PicassoWebServices.PicassoDebug.getSiteInfo(function(e){n=e[0],i=n["Site Guid"],s=n["Site Udd"],$emailText=T('<div style="color:red">Please specify the email address. The .site file will be emailed to this address in case of async export</div>'),$emailField=T('<input type="text">'),($button=T('<button class="slds-button_neutral" type="button">Export Site</button>')).bind("click",function(){var e=$emailField.val().trim();""!=e&&window.open("/sfsites/download?sid="+s+"&sguid="+i+"&emailid="+e)}),($newDiv=T("<div>").append($emailField)).append("Enter email address <br>"),$newDiv.append($button),$newDiv.append($emailText),t.append($newDiv)})}},listdomains:{name:"List Domains",render:function(s){PicassoWebServices.ManageSiteCommon.GetDomains(function(e){if(s.append("<div style='font-weight:bold;'>Domains</div>"),e.domains&&0<e.domains.length)for(var t="<div style='border:1px solid #ddd;margin:4px;'>",n=0;n<e.domains.length;++n)var i=e.domains[n],t=(t=(t=(t=(t+="<div style='border:1px solid #ddd;margin:4px;'>")+("<div><strong>Name:"+i.name+"</strong></div>"))+("<div>DomainId:"+i.domainId+"</div>"))+("<div>SiteId:"+i.domainSiteId+"</div>"))+("<div>ContextPath:"+i.contextPath+"</div>")+"</div>";else htmlout="<div style='font-size:11px;'>No domains found</div>";s.append(htmlout)})}},findDanglingViews:{name:"Find Dangling Views",render:function(a){var i;a.append("<div>Fetching routes and views data... (see console.log)</div>"),i=function(e,t){console.log("route ids",e),console.log("view ids",t);var i=[],s=[],e=Rr(e,i),t=Rr(t,s);Promise.all(e.concat(t)).then(function(){console.log("routes",i),console.log("views",s);e=i,n=[],s.forEach(function(t){e.find(function(e){return e.RoutePage===t.ViewPageID&&e.S1EventName===t.ViewType})||(n.push(t.ComponentID),console.log("dangling view",t))});var e,n,t=n;a.append("<div style='font-weight:bold;'>Found: "+(0<t.length?t.join(" "):"none")+"</div>")})},PicassoWebServices.PicassoDebug.GetComponentTree(function(e){var t=[],n=[];e.ChildNodes[0].ChildNodes.forEach(function(e){"RouteContainer"===e.NodeType?e.ChildNodes.forEach(function(e){t.push(e.TreeObjectId)}):"WidgetPage"===e.NodeType&&n.push(e.TreeObjectId)}),i(t,n)})}},clearPublishCache:{name:"Clear Published Cache",render:function(e){var t,n,i;E.getSite().get("isInCmsStore")?((t=e).append('<div style="font-weight:bold;">Clear Published Cache</div>'),t.append("<div>To resolve page caching issues with CMS-backed sites, clear the site's published cache. After you clear the cache, you must republish the site.</div>\n        <b>Note:</b> Applies to CMS-backed sites only."),n=T("<div></div>"),i=T('<button class="slds-button_neutral" type="button">Clear</button>'),t.append(n),t.append(T("<br/>")),t.append(i),i.bind("click",function(){PicassoWebServices.PicassoDebug.clearSitePublishCache(function(e){e&&e.success?(n.text("The site's published cache was cleared successfully."),i.prop("disabled",!0)):n.text("The cache can't be cleared due to an error. Contact the engineering team for assistance. Error Message: ".concat(e.error))})})):(e.append('<div style="font-weight:bold;">Clear Published Cache</div>'),e.append("<div>This action is supported on CMS-backed sites only.</div>"))}},bustAuraSitesIsolationKey:{name:"Bust Aura Sites Isolation Key",render:function(e){T(e).empty();var e=T('<div id="auraSitesIsolationKeyBusterPanel"></div>').appendTo(e),t=T('<div id="actionPanel"></div>').appendTo(e);T("<b>WARNING: This action can result in perf degradation for the next initial visits of Aura sites on cold cache!</b>").appendTo(t),T("<p>Press this button to bust the isolation key used by ALL Aura sites in this org, by incrementing the AuraSitesIsolationKeyCacheBuster orgValue by 1:</p>").appendTo(t),T("<p>This will bust the isolation key used by ComponentDefinitionStorage, forcing Aura to load up new component definitions from the server.</p>").appendTo(t),T('<button id="auraSitesIsolationKeyBusterButton" style="color:white;background-color:red;">Bust the isolation key!</button>').appendTo(t),T('<div id="resultsPanel" style="margin-top:10px;"></div>').appendTo(e);T("#auraSitesIsolationKeyBusterButton").click(function(){PicassoWebServices.PicassoDebug.BustAuraSitesIsolationKey(function(e){var t=T("#resultsPanel").empty();t.append("<p>Status: "+e.status+"</p>"),t.append("<p>Message: "+e.message+"</p>")})})}},lwrRelated:{header:"LWR Site Actions"},bustLwrSitesCacheKey:{name:"Bust LWR Sites ScaleCache",render:function(e){T(e).empty();var e=T('<div id="lwrSitesCacheKeyBusterPanel"></div>').appendTo(e),t=T('<div id="actionPanel"></div>').appendTo(e);T("<b>WARNING: This action can result in perf degradation for the next initial visits of LWR live sites on cold cache!</b>").appendTo(t),T("<p>Press this button to bust the scale cache used by ALL LWR sites in this org, by incrementing the LwrSitesCacheKeyBuster orgValue by 1:</p>").appendTo(t),T('<button id="lwrSitesCacheKeyBusterButton" style="color:white;background-color:red;">Bust the cache!</button>').appendTo(t),T('<div id="resultsPanel" style="margin-top:10px;"></div>').appendTo(e);T("#lwrSitesCacheKeyBusterButton").click(function(){PicassoWebServices.PicassoDebug.BustLwrSitesCacheKey(function(e){var t=T("#resultsPanel").empty();t.append("<p>Status: "+e.status+"</p>"),t.append("<p>Message: "+e.message+"</p>")})})}},getWebAppResourcesFromDb:{name:"Get WebAppResources (DB)",render:function(t){t.html(D.spinner),PicassoWebServices.PicassoDebug.GetWebAppResourcesForLwrSite(!1,!1,function(e){Lf(e,!1,t)}.bind(this))}},getWebAppResourcesFromScaleCache:{name:"Get WebAppResources (ScaleCache)",render:function(t){t.html(D.spinner),PicassoWebServices.PicassoDebug.GetWebAppResourcesForLwrSite(!0,!1,function(e){Lf(e,!0,t)}.bind(this))}},getWebAppResourcesDiff:{name:"Diff WebAppResources (DB vs ScaleCache)",build:function(e,t,n){T(n).empty();n=T('<div id="getWebAppResourcesDiffPanel"></div>').appendTo(n);if(n.append('<p style="margin-top:15px;">Resources from DB status: '+e.status+"</p>"),e.message&&n.append("<p>"+e.message+"</p>"),n.append('<p style="margin-top:15px;">Resources from ScaleCache status: '+t.status+"</p>"),t.message&&n.append("<p>"+t.message+"</p>"),e&&"SUCCESS"==e.status&&t&&"SUCCESS"==t.status){var i,s=wf(e.data),a=wf(t.data),o=Object.keys(s),r=Object.keys(a),l=[],c=se(o.filter(function(e){return!r.includes(e)}).concat(r.filter(function(e){return!o.includes(e)})));try{for(c.s();!(i=c.n()).done;){var d=i.value,u=a.hasOwnProperty(d),p=(u?a:s)[d];l.push(m(m({},p),{},{uid:d,source:u?"ScaleCache":"DB"}))}}catch(e){c.e(e)}finally{c.f()}n.append('<p style="margin-top:20px;">Diff:</p>'),n.append('<pre style="background-color:inherit;"><code>'+JSON.stringify(l,null,4)+"</code></pre>")}},render:function(n){n.html(D.spinner),PicassoWebServices.PicassoDebug.GetWebAppResourcesForLwrSite(!1,!1,function(t){PicassoWebServices.PicassoDebug.GetWebAppResourcesForLwrSite(!0,!1,function(e){this.build(t,e,n)}.bind(this))}.bind(this))}},migrationrelated:{header:"Migrations"},runMigrationOnDraftOnly:{name:"Migration - Draft Schema Only",render:function(t){PicassoWebServices.PicassoDebug.RunMigration(!0,function(e){t.append("<div style='font-weight:bold;'>"+(!0===e?"Success!":"Failure!")+"</div>")})}},runMigrationOnAllSchemas:{name:"Migration - All Schemas",render:function(t){PicassoWebServices.PicassoDebug.RunMigration(!1,function(e){t.append("<div style='font-weight:bold;'>"+(!0===e?"Success!":"Failure!")+"</div>")})}},runForceMigrationOnDraftOnly:{name:"Force Migration - Draft Schema Only",render:function(t){PicassoWebServices.PicassoDebug.RunForceMigration(!0,function(e){t.append("<div style='font-weight:bold;'>"+(!0===e?"Success!":"Failure!")+"</div>")})}},runForceMigrationOnAllSchemas:{name:"Force Migration - All Schemas",render:function(t){PicassoWebServices.PicassoDebug.RunForceMigration(!1,function(e){t.append("<div style='font-weight:bold;'>"+(!0===e?"Success!":"Failure!")+"</div>")})}},runSkippingMigrationOnDraftOnly:{name:"Skip-Check Migration - Draft Schema Only",render:function(t){PicassoWebServices.PicassoDebug.RunMigrationSkippingIdentifiers(!0,function(e){t.append("<div style='font-weight:bold;'>"+(!0===e?"Success!":"Failure!")+"</div>")})}},runSkippingMigrationOnAllSchemas:{name:"Skip-Check Migration - All Schemas",render:function(t){PicassoWebServices.PicassoDebug.RunMigrationSkippingIdentifiers(!1,function(e){t.append("<div style='font-weight:bold;'>"+(!0===e?"Success!":"Failure!")+"</div>")})}},runSkippingForceMigrationOnDraftOnly:{name:"Skip-Check Force Migration - Draft Schema Only",render:function(t){PicassoWebServices.PicassoDebug.RunForceMigrationSkippingIdentifiers(!0,function(e){t.append("<div style='font-weight:bold;'>"+(!0===e?"Success!":"Failure!")+"</div>")})}},runSkippingForceMigrationOnAllSchemas:{name:"Skip-Check Force Migration - All Schemas",render:function(t){PicassoWebServices.PicassoDebug.RunForceMigrationSkippingIdentifiers(!1,function(e){t.append("<div style='font-weight:bold;'>"+(!0===e?"Success!":"Failure!")+"</div>")})}},remapThemeForLoginPage:{name:"Remap Theme For Login Page",render:function(t){PicassoWebServices.PicassoDebug.RemapThemeForLoginPage(function(e){t.append("<div style='font-weight:bold;'>"+(!0===e?"Success!":"Failure!")+"</div>")})}},undoEnhancedLWRUpgrade:{name:"Undo Enhanced LWR Upgrade",hasAccess:P.PERMISSIONS.ENABLE_ROLLBACK_FOR_CMS_SITE,render:function(n){PicassoWebServices.ManageSiteCommon.rollBackToSiteDotCom(function(e){var t="SUCCESS"===e.status?"<p>Success!</p>":"<p>Failure!</p>";t+=function(e){var t;if(Array.isArray(e))return t="",e.forEach(function(e){return t+="<p>".concat(e,"</p>")}),t}(e.messages),n.append("<div style='font-weight:bold;'>"+t+"</div>")})}}},Af=Backbone.View.extend({className:"cb-DebugDlg",_shellTemplate:_.template('<div class="slds-text-heading_small slds-m-bottom_small">Debug Console</div><div class="cb-DebugDlg-actions js-debug-dlg-actions"></div><div class="js-debug-dlg-action-container"><button class="slds-button_neutral js-debug-dlg-back">Back to Menu</button><button class="slds-button_neutral js-debug-dlg-refresh">Refresh</button><div class="cb-DebugDlg-helpText js-debug-dlg-help-text"></div><div class="cb-DebugDlg-actionContent js-debug-dlg-action-content slds-m-top_small slds-p-left_small"></div></div>'),_sectionHeaderTemplate:_.template('<div class="cb-DebugDlg-section">{{= title }}</div>'),_itemTemplate:_.template('<div class="slds-m-bottom_x-small"><button data-index="{{= index }}" class="cb-DebugDlg-actionItem slds-button_neutral js-debug-dlg-action-item">{{= name }}</button></div>'),events:{"click .js-debug-dlg-back":"_onClickBack","click .js-debug-dlg-refresh":"_onClickRefresh","click .js-debug-dlg-action-item":"_onClickItem"},initialize:function(e){this._actions=e.actions,this._selectedItem=null},render:function(){return this.$el.html(this._shellTemplate()),this._renderActions(),this},_renderActions:function(){var n=this.$(".js-debug-dlg-actions");_.each(this._actions,function(e,t){"function"!=typeof e&&(e.header?n.append(this._sectionHeaderTemplate({title:e.header})):(_.isUndefined(e.hasAccess)||I.AccessControl(e.hasAccess))&&n.append(this._itemTemplate({index:t,name:e.name})))}.bind(this)),this._actions.initialize&&this._actions.initialize(this.$el),this.$(".js-debug-dlg-action-container").addClass("hidden"),this.$(".js-debug-dlg-actions").removeClass("hidden")},_onClickBack:function(){this.$(".js-debug-dlg-action-container").addClass("hidden"),this.$(".js-debug-dlg-actions").removeClass("hidden"),this._selectedItem=null},_onClickRefresh:function(){var e=this._actions[this._selectedItem],t=this.$(".js-debug-dlg-action-content").empty();e.render(t),t.hide().fadeIn("fast")},_onClickItem:function(e){var e=T(e.currentTarget).attr("data-index"),t=this._actions[e],n=(t.render(this.$(".js-debug-dlg-action-content").empty()),this.$(".js-debug-dlg-help-text"));t.helptext?(n.html(t.helptext),n.removeClass("hidden")):n.addClass("hidden"),this.$(".js-debug-dlg-actions").addClass("hidden"),this.$(".js-debug-dlg-action-container").removeClass("hidden"),this._selectedItem=e}});var kf,Nf,xf,Rf,jf=PicassoWebServices.Labels.LocalDevPreviewDialog,Bf=PicassoWebServices.Labels.PicassoDialog,Of=Backbone.View.extend({className:"cb-LocalDevPreviewDlg test-local-dev-preview-dlg",template:function(e){return'<header class="slds-modal__header">\n                <h2 class="slds-text-heading_medium test-modal-heading">'.concat(jf.Title,'</h2>\n            </header>\n            <div class="slds-modal__content slds-p-around_x-large">\n                <div class="cb-LocalDevPreviewDlg-description test-modal-description">\n                    ').concat(jf.Description1,"\n                </div>\n                ").concat(function(e){e=e.command;return'<div class="cb-LocalDevPreviewDlg-command-container">\n            <div class="cb-LocalDevPreviewDlg-command-text js-local-dev-preview-dlg-command-text">'.concat(e,"</div>\n            <div>\n                ").concat(D.bsButtonIconWithTooltip({buttonClassName:"slds-button_icon-container slds-button_icon-small js-local-dev-preview-dlg-copy",placement:"top",icon:"copy",svgClassName:"",label:jf.Copy}),"\n            </div>\n        </div>").trim()}({command:L.format(jf.Command1,e)}),'\n                <div class="cb-LocalDevPreviewDlg-description test-modal-description">\n                    ').concat(jf.Description2,'\n                </div>\n            </div>\n            <footer class="slds-modal__footer">\n                <button class="slds-button slds-button_neutral js-local-dev-preview-dlg-suppress">').concat(Bf.Suppress,'</button>\n                <button class="slds-button slds-button_brand js-local-dev-preview-dlg-close">').concat(Bf.Ok,"</button>\n            </footer>").trim()},events:{"click .js-local-dev-preview-dlg-suppress":"_suppressDialog","click .js-local-dev-preview-dlg-close":"_close","click .js-local-dev-preview-dlg-copy":"_copyToClipboard"},initialize:function(e){this._cookieName=(e=e||{}).cookieName},render:function(){var t=this,e=I.getAppState().getCurrentSite().get("name");return this.$el.html(this.template(e)),this.$('[data-toggle="tooltip"]').tooltip(),this.$('[data-toggle="tooltip"]').on("hidden.bs.tooltip",function(e){t.$(e.target).attr("data-original-title",jf.Copy)}),this},destroy:function(){this._removeListeners()},_removeListeners:function(){this.$el.off()},_close:function(){A.closeDialog()},_copyToClipboard:function(e){var t=e.target.closest(".cb-LocalDevPreviewDlg-command-container").querySelector(".js-local-dev-preview-dlg-command-text").textContent;navigator.clipboard.writeText(t),this.$(e.target).attr("data-original-title",jf.Copied).tooltip("show")},_suppressDialog:function(){"string"==typeof this._cookieName?$.cookie(this._cookieName,!0,{expires:400,path:"/"}):console.warn("Local dev preview dialog suppression cookie not set due to missing cookie name."),A.closeDialog()}}),Mf=PicassoWebServices.Labels.NotificationsWhatsNew,Vf=PicassoWebServices.Labels.NotificationsEndOfLife;function $f(e){return T.cookie(e)}function Uf(){return!$f(xf)&&I.AccessControl(P.PERMISSIONS.HELP_GUIDED_TOUR)}function Wf(){Uf()&&0===T(".cb-Dialog").length&&Hf()}function Ff(){var e=function(){for(var e=[],t=1;Mf["Item"+t+"Title"]&&Mf["Item"+t+"Description"];)e.push({title:Mf["Item"+t+"Title"],description:Mf["Item"+t+"Description"]}),t++;return e}(),t=E.getSite().get("currentVersionLabel"),n=Mf.Title.replace("{0}",t),i=T('<ul class="cb-Notification-items">');_.each(e,function(e){var t=T('<li class="cb-Notification-item">'),n=T('<div class="cb-Notification-itemTitle">'+_.escape(e.title)+"</div>"),e=T('<div class="cb-Notification-itemDescription">'+e.description+"</div>");t.append([n,e]),i.append(t)}),i.append(T('<li class="cb-Notification-releaseNote">'+Mf.ReleaseNote+'<a href="https://help.salesforce.com/articleView?id=release-notes.rn_experiences.htm" target="_blank">'+Mf.ReleaseNoteLink.replace("{0}",t)+"</a></li>")),A.sldsPromptAlert({title:n,content:i[0].outerHTML,headerClass:"cb-Dialog_header--info",className:"cb-Dialog--whatsNew test-whatsNew-dialog",afterClose:function(){Wf()}}),T.cookie(kf,!0,{expires:400,path:"/"})}function Hf(){j.getAppEvent().trigger("start-tour"),T.cookie(xf,!0,{expires:400,path:"/"})}function Gf(){var e,t,n=!I.getAppState().supportViewCrud()&&!$f(Nf),i=I.AccessControl(P.PERMISSIONS.LOCAL_DEV_PREVIEW)&&E.getSite().isWebApp()&&!$f(Rf),s=I.AccessControl(P.PERMISSIONS.HELP_WHATS_NEW)&&!$P.isRunningTest&&!$f(kf)&&I.getAppState().supportsNewFeatures();[n,i,s].includes(!0)?(n&&(n=Vf.Title,e=Vf.EndOfLifeMessage,t=Vf.UpgradeNow,A.sldsPromptAlert({title:n,content:e,headerClass:"cb-Dialog_header--info",className:"test-endOfLife-dialog",callback:function(e){e&&j.getAppEvent().trigger("load-appnav-settings","updates")},afterClose:function(){Wf()},yesText:t}),T.cookie(Nf,!0,{expires:14,path:"/"})),i&&(n={appendLocation:"#vexContainer",showCloseButton:!0,overlayClosesOnClick:!1,contentClassName:"cb-Dialog js-dialog cb-LocalDevPreviewDlg-modal",className:"slds-vex-theme",afterClose:function(){Wf()}},A.showDialog(new Of({cookieName:Rf}),n)),s&&Ff()):Uf()&&Hf()}var zf,Kf={initialize:function(){j.getAppEvent().on("init-app-complete",function(){kf="picasso_notification_whats_new_"+I.getAppState().getCurrentAppVersion().external,Nf="picasso_notification_end_of_life_"+I.getAppState().getCurrentAppVersion().external+"_"+I.getAppState().getNetworkId(),xf=(I.getAppState().isHomePageStarterTemplate()?"picasso_starter_tour_":"picasso_tour_")+2,Rf="picasso_notification_local_dev_preview"}),j.getAppEvent().on("show-notifications",function(){Gf()}),j.getAppEvent().on("show-notification-whats-new",function(){Ff()})}},Yf=PicassoWebServices.Labels.DynamicLayoutGuidedTour,qf=999999,Xf=330,Jf={},Qf=_.template('<span class="cb-Hopscotch-stepStatus js-step-status">'+L.format(Yf.StepStatus,"{{=currStep}}","{{=stepTotal}}")+"</span>");function Zf(){Jf={id:"intro",steps:[{target:".cb-ComponentPropertyPanel",delay:350,placement:"left",title:Yf.SectionEditorTitle,content:Yf.SectionEditorContent,xOffset:5,yOffset:48,onNext:t_,onShow:e_},{target:".js-app-header",placement:"bottom",title:Yf.AddSectionTitle,content:Yf.AddSectionContent,xOffset:"center",yOffset:"center",arrowOffset:"center",width:Xf,onNext:n_},{target:".js-app-nav",placement:"right",title:Yf.ThemeSettingsTitle,content:Yf.ThemeSettingsContent,onNext:i_,xOffset:400,yOffset:105},{target:".js-app-header-help",placement:"bottom",title:Yf.HelpMenuTitle,content:Yf.HelpMenuContent,arrowOffset:178,xOffset:-160,yOffset:-8}],i18n:{nextBtn:Yf.NextButton,doneBtn:Yf.DoneButton,closeTooltip:Yf.CloseButtonTooltip},onShow:l_,onEnd:o_,onClose:o_},_.each(Jf.steps,function(e){e.zindex=qf})}function e_(){l_(),zf.send("cb-request-element-dimensions",{selector:".add-section-top"})}function t_(){T(".js-propertyeditor-close").click()}function n_(){T(".js-settings-button").click(),T(".js-settings-menu-item-theme").click(),T(".js-settings-theme-advanced-tab").click()}function i_(){T(".js-left-panel-container:visible .js-close").click()}function s_(){j.getAppEvent().on("start-dynamic-layout-tour",function(e){(zf=e.connection).listenFor("cb-response-select-element-after-rendered",function(){Zf(),hopscotch.startTour(Jf,0),j.getAppEvent().on("preview-switcher-select",r_)}),zf.listenFor("cb-response-element-dimensions",function(e){var t;e&&(t=hopscotch.getCurrTour().steps[1],window.innerHeight-e.top<300?(t.placement="top",t.yOffset=e.top+T(".js-app-header")[0].clientHeight):t.yOffset=e.top+20,t.xOffset=e.left-Xf/2+20)}),e.forceStart?a_(e):I.event.once("state:page-change-success",a_)})}function a_(e){var t;t=P.workspace.PAGE_CONFIG,I.getAppState().set("workspaceMode",t),f.getCanvasComponentsForViewAsync(e.viewId,function(e){e=_.filter(k.getFlattenedImmediateChildren(e),function(e){return e.fqn===P.FQNS.SECTION});zf.send("cb-request-select-element-after-rendered",{itemId:e[0].id,hidePropertyEditor:!1})})}function o_(){j.getAppEvent().off("preview-switcher-select",r_),zf.stopListeningFor("cb-response-select-element-after-rendered"),zf.stopListeningFor("cb-response-element-offset")}function r_(){hopscotch.endTour(),o_()}function l_(){var e={currStep:hopscotch.getCurrStepNum()+1,stepTotal:Jf.steps.length};T(".hopscotch-actions").prepend(Qf(e))}var c_={initialize:function(){s_()}},B=PicassoWebServices.Labels.OnboardingGuidedTour,d_=PicassoWebServices.Labels.StarterOnboardingGuidedTour,u_=999999,p_={},g_=_.template('<span class="cb-Hopscotch-stepStatus js-step-status">'+L.format(B.StepStatus,"{{=currStep}}","{{=stepTotal}}")+"</span>");function h_(){p_={id:"intro",steps:I.getAppState().isHomePageStarterTemplate()?[{target:"#sitePreviewFrame",placement:"right",title:d_.WelcomeTitle,content:d_.WelcomeContent,xOffset:"center",yOffset:135,width:335,onShow:y_,onNext:I_},{target:".js-page-menu",placement:"right",title:B.PagesMenuTitle,content:B.PagesMenuContent,xOffset:0,yOffset:5,onNext:v_},{target:".js-page-menu",placement:"right",title:B.PageActionMenuTitle,content:B.PageActionMenuContent,xOffset:140,yOffset:177,onNext:b_},{target:".js-page-menu",placement:"right",title:B.PagePropertiesTitle,content:B.PagePropertiesDetailContent,xOffset:430,yOffset:70,onNext:P_},{target:".js-component-palette-button",placement:"right",title:d_.ComponentsTitle,content:d_.ComponentsContent,xOffset:258,onNext:D_},{target:".js-settings-menu-item-theme",placement:"right",title:d_.ThemeTitle,content:d_.ThemeContent,onNext:A_,width:300},{target:".js-settings-menu-item-developer",placement:"right",title:d_.DeveloperTitle,content:d_.DeveloperContent,onNext:k_,width:300},{target:".js-app-header-help",placement:"bottom",title:B.HelpMenuTitle,content:B.HelpMenuContent,arrowOffset:178,xOffset:-160,yOffset:-8}]:function(){var e=[{target:"#sitePreviewFrame",placement:"right",title:B.WelcomeTitle,content:B.WelcomeContent,xOffset:"center",yOffset:135,width:335,onShow:y_,onNext:I.getAppState().supportViewCrud()?P_:T_},{target:".js-component-palette-button",placement:"right",title:B.ComponentsTitle,content:B.ComponentsContent,xOffset:258,onNext:T_,excludeForSiteComTemplates:!0},{target:".js-theme-editor-button",placement:"right",title:B.ThemeEditorTitle,content:B.ThemeEditorContent,xOffset:258,onNext:E_},{target:".js-page-structure-button",placement:"right",title:B.PageStructureTitle,content:B.PageStructureContent,xOffset:258,onNext:L_},{target:".js-app-nav",placement:"right",title:B.SettingsTitle,content:I.getAppState().supportViewCrud()?B.SettingsContent:B.SettingsPreAuraContent,xOffset:530,yOffset:35,onNext:w_},{target:".cb-ComponentPropertyPanel",delay:350,placement:"left",title:B.ComponentPropertiesTitle,content:B.ComponentPropertiesContent,xOffset:5,yOffset:0,onNext:__},{target:".js-head-menu-container",placement:"bottom",title:B.NavigationTitle,content:B.NavigationContent,xOffset:10,yOffset:-8,onNext:I_},{target:".js-page-menu",placement:"right",title:B.PagesMenuTitle,content:B.PagesMenuContent,xOffset:0,yOffset:5,onNext:v_},{target:".js-page-menu",placement:"right",title:B.PageActionMenuTitle,content:B.PageActionMenuContent,xOffset:140,yOffset:177,onNext:b_,excludeForSiteComTemplates:!0},{target:".js-page-menu",placement:"right",title:B.PagePropertiesTitle,content:B.PagePropertiesDetailContent,xOffset:430,yOffset:70,onNext:S_,excludeForSiteComTemplates:!0},{target:".js-resolution-button",placement:"bottom",title:B.DevicePresetsTitle,content:B.DevicePresetsContent,arrowOffset:150,xOffset:-133,yOffset:-8},{target:".js-preview-button",placement:"bottom",title:B.PreviewTitle,content:B.PreviewContent,arrowOffset:240,xOffset:-220,yOffset:-8},{target:".js-publish-button",placement:"bottom",title:B.PublishTitle,content:B.PublishContent,arrowOffset:220,xOffset:-190,yOffset:-8},{target:".js-app-header-help",placement:"bottom",title:B.HelpMenuTitle,content:I.getAppState().supportViewCrud()?B.HelpMenuContent:B.HelpMenuPreAuraContent,arrowOffset:178,xOffset:-160,yOffset:-8}];I.getAppState().supportViewCrud()||(e=_.reject(e,function(e){return!0===e.excludeForSiteComTemplates}));return e}(),i18n:{nextBtn:B.NextButton,doneBtn:B.DoneButton,closeTooltip:B.CloseButtonTooltip},onShow:R_,onStart:function(e){I.getAppState().set("workspaceMode",e)}.bind(this,P.workspace.PAGE_CONFIG),onEnd:m_,onClose:m_},_.each(p_.steps,function(e){e.zindex=u_})}function m_(){N_(),j.getAppEvent().off("preview-switcher-select",C_)}function v_(){I.getAppState().supportViewCrud(),f_()}function b_(){f_(),T('.js-page-action-menu-item[data-value="PageManager"]').trigger("click")}function f_(){T(".js-pm-action-menu-trigger").first().trigger("click")}function __(){j.getAppEvent().trigger("close-left-panel"),p(".js-propertyeditor-close").click()}function S_(){N_(),j.getAppEvent().trigger("close-page-menu")}function C_(){hopscotch.endTour(),m_()}function y_(){R_(),T(".hopscotch-bubble-arrow-container").hide()}function T_(){T(".js-theme-editor-button").click()}function P_(){T(".js-component-palette-button").click()}function I_(){T(".js-pm-selected").trigger("click")}function E_(){T(".js-page-structure-button").click()}function w_(){T(".js-page-structure-button").click();var e=I.AccessControl(P.PERMISSIONS.NEW_PAGE_STRUCTURE_PANEL)?"dxp_builder-multi-action-tree-node a":'.js-region-section[data-is-theme-region="false"] .js-component-button';T(e).get(0).click()}function L_(){T(".js-settings-button").click()}function D_(){L_(),T(".js-settings-menu-item-theme").click()}function A_(){L_(),T(".js-settings-menu-item-developer").click()}function k_(){T(".js-left-panel-container:visible .js-close").click()}function N_(){T(".js-pm-list-item").first().removeClass("onboarding")}function x_(){j.getAppEvent().on("start-tour",function(){h_(),hopscotch.startTour(p_,0),j.getAppEvent().on("preview-switcher-select",C_)})}function R_(){var e={currStep:hopscotch.getCurrStepNum()+1,stepTotal:p_.steps.length};T(".hopscotch-actions").prepend(g_(e))}var j_,B_={initialize:function(){x_()}},O_=function(r){var l=T.Deferred(),c=!1,d=null,u=null,p=[],e={onLiveModeConnectionReady:function(t){l.done(function(e){e.stopListeningFor("live-loaded"),e.stopListeningFor("route-change-success"),e.stopListeningFor("show-error-dialog"),e.stopListeningFor("show-csp-error-dialog"),t(e,c,d,u,p)})}};return T(".loadingOverlay").show(),PicassoWebServices.CommCore.GetCBCanvasData(function(e){var t=e.url,n=C.getLanguagePath(e.isLWR,e.activeLangCode,e.baseLangCode),i=e.pageUrl||"",s=C.getBasePreviewQueryString(e.orgId,e.siteId,e.isLWR?"":e.activeLangCode),e=C.getLivePreviewQueryString(e.viewId,e.selectedFormFactor||r.get("formFactor")),a=T("#sitePreviewFrame"),o=new $P.app.postmessage(window,a[0].contentWindow,t);o.listenFor("live-loaded",function(){c=!0}).listenFor("route-change-success",function(e){d=e}).listenFor("show-error-dialog",function(e){u=e}).listenFor("show-csp-error-dialog",function(e){p.push(e)}),l.resolve(o),a[0].contentWindow.location=t+n+i+s+e}),e},M_="RunSiteMigrations",V_=[],$_={},U_=!1;function W_(e){return!$_.ept&&e!==M_}function F_(){U_=!0}function H_(){$_.ept&&$_.loadEventTime&&PicassoWebServices.CommPerformance.LogBuilderPerfMetrics($_.ept,$_.loadEventTime,$_.connectTime,$_.webServicesTiming,window.navigator.userAgent)}function G_(){var e,t;0!==V_.length||j_||(e="builderEpt",window.performance.measure(e),t=window.performance.getEntriesByName(e)[0],j_=setTimeout(function(){var i,e=window.performance.timing;$_.ept=Math.round(t.duration),$_.connectTime=e.connectEnd-e.navigationStart,$_.webServicesTiming=(i=[],e=window.performance.getEntriesByType("resource"),_.each(e,function(e){var t,n;"xmlhttprequest"===e.initiatorType&&(t=e.name.match(".*sfservice\\?Method=([^&]*)"))&&2===t.length&&t[1]!==M_&&((n={}).name=t[1],n.startTime=Math.round(e.startTime),n.duration=Math.round(e.duration),i.push(n))}),i),H_()},1e3))}var z_={init:function(){I.event.once("state:page-change-success",F_),window.addEventListener("load",function(){setTimeout(function(){var e=window.performance.timing;$_.loadEventTime=e.loadEventEnd-e.navigationStart,($_.ept?H_:G_)()},0)})},handleWebServiceRequested:function(e){W_(e)&&(V_.push(e),j_)&&(clearTimeout(j_),j_=null)},handleWebServiceProcessed:function(t){var e;W_(t)&&(e=V_.findIndex(function(e){return e===t}),V_.splice(e,1),E.getSite().isWebApp()||U_)&&G_()}};function K_(){var o=setTimeout(function(){T(".loadingOverlay").show()},300),r=O_(gt.getDefaultResolution());PicassoWebServices.CommCore.OnCBStudioLoad(function(e){var t,n,i,s,a;y.processPreUIInitResponse(e),ha.load(),function(){var e=E.getSite().get("homepage");if(e)return(e=h.getPages().get(e))&&e.isSPA()}()?(t=r,I.handleInitAppState(e),n=N.getInitialPreviewBrandingSetId(),I.getAppState().set("currentPreviewSiteBrandingSetId",n),E.getSite().isWebApp()&&E.getSite().isInCmsStore()&&(a=l.getAllBrandingSets(P.BRANDING_SET_TYPE.APP)).length&&(a=a[0],s=l.getBrandingSetPropertyDefs(a.def),a.brandsource)&&(_s.setBrandingSetToBrandMap(a.brandsource.brandingSetToBrandMap),s=_s.calculateDerivedColorProperties(a.values,s),_s.saveUpdatedDerivedColorProperites(a,s)),I.getAppState().on("change:currentPageId",function(e){window.$P.app.currentContextID=e.get("currentPageId");e=I.getAppState().getCurrentPageTemplate().get("ActiveBrandingSetId");e&&e!==n&&(n=e,I.event.trigger("action:set-preview-site-branding-set",{id:e}))}),$P.app.store=I.event,$P.app.store.getBrandingSet=l.getBrandingSet,$P.models.site=E.getSite(),$P.app.siteType=E.getSite().get("siteType"),$P.app.state=I.getAppState(),$P.app.vent=j.getAppEvent(),$P.collections.routes=h.getRoutes(),$P.app.currentContextID=I.getAppState().getCurrentPageId(),j.init(T("main"),t),$P.views.live=j.getLiveMode(),localStorage.getItem(P.LS_KEY.Updated)&&(localStorage.removeItem(P.LS_KEY.Updated),T(".js-settings-menu-item-updates").click(),j.getAppEvent().trigger("show-alert",{title:PicassoWebServices.Labels.CommunityBuilder.UpdateSuccessDialogTitle,message:'<div class="cb-Dialog-successContent"><span class="slds-icon_container slds-icon-action-approval slds-icon_container--circle cb-Dialog-successContentIcon"><svg aria-hidden="true" class="slds-icon slds-icon--small"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/sfsites/sfservice/builder/resources/external/slds/icons/action-sprite/svg/symbols.svg#approval"></use></svg></span><div class="content"><div><strong>'+PicassoWebServices.Labels.CommunityBuilder.UpdateSuccessDialogContentLine1+"</strong></div><div>"+PicassoWebServices.Labels.CommunityBuilder.UpdateSuccessDialogContentLine2+"</div></div></div>"})),j.getAppEvent().trigger("init-app-complete"),j.getAppEvent().trigger("show-notifications"),(a=C.getUrlVar("loadAppnavSettings"))&&(a=decodeURIComponent(a),j.getAppEvent().trigger("load-appnav-settings",a)),E.getSite().isWebApp()||c_.initialize(),y.processPostUIInitResponse(e),clearTimeout(o),T(".loadingOverlay").hide(),I.AccessControl(P.PERMISSIONS.PAGE_EDIT)&&(i=function(e){e=xi.runAndHandleFailure("BrandingPropertiesMigration from commeditor.core-init.js",Vi.doMigration,e);return e}(e),PicassoWebServices.CommCore.RunSiteMigrations(function(e){(e.dataChanged||i)&&A.sldsPromptAlert({title:PicassoWebServices.Labels.CommunityBuilder.DataMigratedHeader,content:PicassoWebServices.Labels.CommunityBuilder.DataMigrated,yesText:PicassoWebServices.Labels.CommunityBuilder.DataMigratedButtonText,headerClass:"cb-Dialog_header--info",callback:function(){window.location.reload(!0)}})})),Qe.fetchAllUpgradeFlows(),h.GetDefaultThemeLayoutForAllRoutes(),I.event.on("state:upgradeflows-loaded",function(){$P.upgradeFlows=Qe.getUpgradeFlows()})):window.location.href=E.getSite().get("studioUrl")})}function Y_(){function t(){T(".js-page-menu").removeClass("open"),T(".open > .dropdown-toggle").dropdown("toggle"),$P.auraRun(function(){var e=$A.getEvt("markup://siteforceBuilder:closeMenu");e&&e.fire()})}T(document).on("blur.cb-global",function(){t()}),T(window).on("blur.cb-global",function(){document.activeElement&&"sitePreviewFrame"===document.activeElement.id&&t();var e=T(".uiAutocompletePanel");T(".uiAutocompletePanel").length&&(e.find(".uiAutocompleteList").addClass("invisible"),e.find(".lookup__list").removeClass("visible"))}),T(document).off("keyup.debug-dlg").on("keyup.debug-dlg",function(e){if(e.shiftKey&&e.ctrlKey&&13===e.keyCode)return I.AccessControl(P.PERMISSIONS.IS_DEBUG_CONSOLE_ENABLED)&&A.showDialog(new Af({actions:Df}),{className:"slds-vex-theme cb-Dialog--PageWizard"}),!1})}function q_(){svg4everybody(),j.getAppEvent().on("show-alert",function(e){A.showDialog(new $P.viewTypes.ErrorDlgView(e))}),Kf.initialize(),B_.initialize(),z_.init(),PicassoWebServices.addCompletedRequest(function(e,t){if(z_.handleWebServiceProcessed(e),t&&t.UpdatedCsrfToken)throw window.csrfToken=t.UpdatedCsrfToken,{message:t.Errors,dontPropagate:!0}}),PicassoWebServices.addInvokingRequest(function(e){z_.handleWebServiceRequested(e)},!1),PicassoWebServices.addFailedRequest(function(e,t){var n,t=t.responseText,i=PicassoWebServices.Labels.PicassoDialog.UnsuccessfulRequest,s=PicassoWebServices.Labels.PicassoDialog.Error;z_.handleWebServiceProcessed(e),T(".loadingOverlay").hide();try{(n=T.parseJSON(t)).Errors&&(i=n.Errors)}catch(e){}window.navigator.onLine||(s=PicassoWebServices.Labels.PicassoDialog.NoConnectionTitle,i=PicassoWebServices.Labels.PicassoDialog.NoConnectionDescription),A.showDialog(new dc({message:i,title:s}))},!1),Y_(),K_()}var X_=P.AUDIENCE_TARGET_NAME,J_=PicassoWebServices.Labels.CommunityBuilder;function Q_(e,t,n,i){e=t.where({audienceId:e});!0===i&&t.remove(e),e&&n.push.apply(n,e)}function Z_(n,e){var i=[];return n&&b.forEach(e,function(e){var t=un(n,e);t&&(n.remove(t),i.push(e))}),i}I.event.on("action:update-audience-entity",function(e){var a=e.audienceId,o=e.audienceName;b.each(X_,function(e){t=a,i=[],(s=fe()[s=e])&&(s.where?Q_(t,s,i,n):b.each(s,function(e){Q_(t,e,i,n)}));var t,n,i,s=i;0<s.length&&(b.each(s,function(e){e.set("audienceName",o)}),I.event.trigger("state:audience-entity-updated",e,s))})}),I.event.on("action:delete-audience-entity",function(e){e.isAudienceAssigned&&w.warning({message:J_.ReloadBuilder,canDismiss:!1})}),I.event.on("state:aura-component-deleted",function(e){var t=I.getAppState().getCurrentViewId();0<Z_(fe()[X_.COMPONENT][t],e).length&&I.event.trigger("state:content-area-component-audiences-updated"),e=e,t=S.getThemeLayoutByViewId(t=t).themeLayoutId,0<Z_(fe()[X_.THEME_LAYOUT][t],e).length&&I.event.trigger("state:theme-layout-area-component-audiences-updated")});var eS="state:page-change-start",tS="state:page-change-failed",nS={},iS="",sS=P.PROP,aS=PicassoWebServices.Labels.CommBuilderPageManagement;function oS(e){var t,n=e.routeId,i=e.persistState,s=e.hidePropertyEditor,a=e.successCallback,e=e.viewId,o=void 0===e?r.getPreviewViewId():e,r=h.getRoutes().get(n),l=r.get(sS.ROUTE_URL_KEY);C.urlRequiresParameter(l)?(e=nS[l])?lS({route:r,viewId:o,url:e,persistState:i,hidePropertyEditor:s,successCallback:a}):(t=r.getRouteKeyPrefix(),ha.getDataObjects(function(e){e=t?b.find(e,{KeyPrefix:t}):null,e=e?e.Name:null;PicassoWebServices.CommPage.GetRouteDefaultParamValues(l,e,function(e){var n=l;b.each(e,function(e,t){n=n.replace(t,e)}),n=n.replace(/\(\/.*?\)$/g,""),C.urlRequiresParameter(n)||(nS[l]=n),lS({route:r,viewId:o,url:n,persistState:i,hidePropertyEditor:s,successCallback:a,noDataMessage:e.noDataMessage})})})):lS({route:r,viewId:o,url:l,persistState:i,hidePropertyEditor:s,successCallback:a})}function rS(e,t,n){e=C.getCurrentPreviewPath(e);I.getAppState().set("currentPreviewPath",e),I.getAppState().set("currentViewId",t),I.getAppState().set("currentRouteId",n)}function lS(e){var t,i,s=e.route,a=e.viewId,o=e.url,r=e.persistState,l=e.hidePropertyEditor,c=e.successCallback,e=e.noDataMessage;!C.urlRequiresParameter(o)||I.getAppState().isCurrentPageAura()||E.getSite().get("isWebApp")?(i=s.get(sS.ROUTE_PAGE_ID_KEY),PicassoWebServices.CommPage.CheckForRegionDifferenceAndUpdate(a,function(e){I.getAppState().set("currentPageId",i);var t=h.getPages().get(i),n=E.getSite().get("homepage"),n=(t.id===n?iS:t.get(sS.URL_KEY))+o,t=(rS(n,a,s.id),{url:n,viewId:a,routeId:s.id,persistState:r,hidePropertyEditor:l});I.event.trigger(eS,t),c&&c.call()})):(t=s.get(sS.NAME_KEY),e=e?L.format(e,t):L.format(aS.NoParamDataDialogContent,t),I.event.trigger(tS,a,{summary:aS.NoParamDataDialogTitle,detail:e}))}I.event.on("action:navigate-to-page",function(e){var t,n=e.url,i=e.viewId,s=e.routeId,e=e.successCallback;n?(t=E.getSite().get("homepage"),oS({viewId:(t=h.getRoutes().findWhere({PageId:t,RouteUrl:n})).getViewId(),routeId:t.id,persistState:!1,hidePropertyEditor:!0,successCallback:e})):s&&oS({viewId:i,routeId:s,persistState:!1,hidePropertyEditor:!0,successCallback:e})}),I.event.on("action:update-canvas-state",function(e){var t=e.routeId,n=e.canonicalRouteId,i=e.viewId,s=e.routeUrl,a=e.routeParams,e=e.resolvedRouteUrl,n=(n&&(t=n),s===P.ROUTE.ERROR_ROUTE_URL&&(n=h.getRoutes().get(t).get(sS.ROUTE_TYPE_KEY),h.getViews().get(i).get(sS.ROUTE_TYPE_KEY)!==n)&&(n=h.getRoutes().getRouteForView(i)[0])&&(t=n.id,s=n.get(sS.ROUTE_URL_KEY)),e?s=e:b.includes(s,":")&&b.each(a,function(e,t){s=s.replace(":"+t,e)}),I.getAppState().getCurrentPageUrl()),e=("/"===n?"":n)+s;rS(e,i,t),I.event.trigger("state:page-change-success",{routeId:t,viewId:i,path:e})}),I.event.on("action:refresh-current-page",function(e){var t=e&&e.persistState,n=e&&e.successCallback,e=!e||!e.hasOwnProperty("hidePropertyEditor")||e.hidePropertyEditor,i=I.getAppState().getCurrentViewId(),s=I.getAppState().getCurrentRouteId(),a=h.getRoutes().get(s).get(sS.ROUTE_URL_KEY);nS[a]=null,oS({viewId:i,routeId:s,persistState:t,hidePropertyEditor:e,successCallback:n})});I.event.on("action:save-rte-content",function(n){var e={items:[{ObjectID:n.itemId,Content:n.editorContent,renderEL:n.decodeContentAsset}]},t=f.getContainingViewOrThemeLayoutId(n.itemId);PicassoWebServices.ManageSiteCommon.SaveContentBlocks(e,t,function(e){y.hasProcessedErrorInResults(e)||y.processUndoRedoResponse(e);var t=n.successCallback;t&&"function"==typeof t&&n.successCallback(e)})});I.event.on("action:export-template",function(e){PicassoWebServices.CommUtil.CreateStaticResourceFromImageAndExportTemplate(e.imgUrls,e.info,function(e){I.event.trigger("state:template-exported",e)})});var cS=".availableFieldList",dS=".selectedFieldList",uS={fieldData:{0:"name",1:"value",2:"classname"},fieldEntry:"<li data-value='{1}' class='{2}'><span>{0}</span></li>",pickerHeight:"227px",selectedMoveFilter:null,showReorderButtons:!0,availableFieldsTitle:"",selectedFieldsTitle:""};function pS(e,t,n){var i,s;e.shiftKey?(i=n.find("li"),((n=n.find(".lastselect"))[0]?(n=i.index(n))<(s=i.index(t))?i.slice(n,s+1):i.slice(s,n):t).addClass("selected")):e.ctrlKey?t.addClass("selected"):t.addClass("selected").siblings().removeClass("selected"),t.addClass("lastselect").siblings().removeClass("lastselect"),e.preventDefault()}T.fn.extend({dualpicker:function(a){return a=T.extend({},uS,a),this.each(function(){var i,e,t,n,s=T(this);e=a,(i=s).data("dualfieldpicker.data",e),i.find(".upField").click(function(){var e=i.find(dS).find(".selected"),t=e.first().prev();t&&e.insertBefore(t)}),i.find(".downField").click(function(){var e=i.find(dS).find(".selected"),t=e.last().next();t&&e.insertAfter(t)}),i.find(".moveFieldsToRight").click(function(){var e=i.find(dS),t=(e.find(".selected").removeClass("selected"),i.find(cS).find(".selected")),n=i.data("dualfieldpicker.data");"function"==typeof n.moveRightDecorator&&n.moveRightDecorator(t),t.appendTo(e),e.scrollTop(e.attr("scrollHeight"))}),i.find(".moveFieldsToLeft").click(function(){var e=i.find(cS),t=(e.find(".selected").removeClass("selected"),i.find(dS).find(".selected")),n=i.data("dualfieldpicker.data"),n=("function"==typeof n.selectedMoveFilter&&(t=n.selectedMoveFilter(t)),"function"==typeof n.moveLeftDecorator&&n.moveLeftDecorator(t),t.appendTo(e),e.scrollTop(e.attr("scrollHeight")),e.find("li"));n.sort(function(e,t){return T(e).attr("data-value")-T(t).attr("data-value")}),e.empty().append(n)}),i.find(cS+","+dS).mousedown(function(){return!(this.onselectstart=function(){return!1})}).css("height",e.pickerHeight),t=i.find(cS),(n=i.find(dS)).click(function(){t.removeClass("infocus"),T(this).addClass("infocus")}).delegate("li","click",function(e){pS(e,T(this),n)}).delegate("li","dblclick",function(){i.find(".moveFieldsToLeft").click()}),t.click(function(){n.removeClass("infocus"),T(this).addClass("infocus")}).delegate("li","click",function(e){pS(e,T(this),t)}).delegate("li","dblclick",function(){i.find(".moveFieldsToRight").click()}),e.showReorderButtons||i.find(".rightButtons").hide(),""!=e.availableFieldsTitle&&i.find(".titleAvailable").html(e.availableFieldsTitle),""!=e.selectedFieldsTitle&&i.find(".titleSelected").html(e.selectedFieldsTitle)})},dualpicker_setfields:function(b,f){return this.each(function(){for(var e,t=T(this),n=b||[],i=f||[],s=(t=t).data("dualfieldpicker.data"),a=t.find(cS).empty(),t=t.find(dS).empty(),o="",r=0;r<n.length;++r){var l=n[r],c=s.fieldEntry;for(e in s.fieldData){void 0===(u=l[s.fieldData[e]])&&(u="");var d=new RegExp("\\{"+e+"\\}","gm"),u="0"===e?L.htmlEncode(u):u,c=c.replace(d,_.escape(u))}o+=c}a.append(o);var p="";for(r=0;r<i.length;++r){var g=i[r],h=s.fieldEntry;for(e in s.fieldData){void 0===(v=g[s.fieldData[e]])&&(v="");var m=new RegExp("\\{"+e+"\\}","gm"),v="0"===e?L.htmlEncode(v):v,h=h.replace(m,_.escape(v))}p+=h}t.append(p)})},dualpicker_selected:function(){var e=T(this).find(dS).find("li"),t=[];return e.each(function(){t.push(T(this).attr("data-value"))}),t},dualpicker_selectedpairs:function(){var e=T(this).find(dS).find("li"),n=[];return e.each(function(){var e=T(this),t=e.text(),e=e.attr("data-value");n.push({name:t,value:e})}),n}});return T(function(){q_()}),T(window).on("unload",function(){j.getAppEvent().off("show-alert"),j.getAppEvent().trigger("destroy"),T(window).off(".cb-global")}),O.AudienceStore={},O.DualFieldPicker={},O.NavStore={},O.RteStore={},O.TemplateStore={},O}({});